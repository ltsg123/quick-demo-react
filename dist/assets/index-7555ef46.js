(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))h(E);new MutationObserver(E=>{for(const T of E)if(T.type==="childList")for(const I of T.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&h(I)}).observe(document,{childList:!0,subtree:!0});function d(E){const T={};return E.integrity&&(T.integrity=E.integrity),E.referrerPolicy&&(T.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?T.credentials="include":E.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function h(E){if(E.ep)return;E.ep=!0;const T=d(E);fetch(E.href,T)}})();var IE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Y0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var z0={exports:{}},Mh={},q0={exports:{}},st={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yd=Symbol.for("react.element"),MF=Symbol.for("react.portal"),UF=Symbol.for("react.fragment"),xF=Symbol.for("react.strict_mode"),VF=Symbol.for("react.profiler"),jF=Symbol.for("react.provider"),FF=Symbol.for("react.context"),BF=Symbol.for("react.forward_ref"),GF=Symbol.for("react.suspense"),WF=Symbol.for("react.memo"),HF=Symbol.for("react.lazy"),xw=Symbol.iterator;function KF(r){return r===null||typeof r!="object"?null:(r=xw&&r[xw]||r["@@iterator"],typeof r=="function"?r:null)}var J0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},X0=Object.assign,Q0={};function gc(r,s,d){this.props=r,this.context=s,this.refs=Q0,this.updater=d||J0}gc.prototype.isReactComponent={};gc.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};gc.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function $0(){}$0.prototype=gc.prototype;function Km(r,s,d){this.props=r,this.context=s,this.refs=Q0,this.updater=d||J0}var Ym=Km.prototype=new $0;Ym.constructor=Km;X0(Ym,gc.prototype);Ym.isPureReactComponent=!0;var Vw=Array.isArray,Z0=Object.prototype.hasOwnProperty,zm={current:null},eN={key:!0,ref:!0,__self:!0,__source:!0};function tN(r,s,d){var h,E={},T=null,I=null;if(s!=null)for(h in s.ref!==void 0&&(I=s.ref),s.key!==void 0&&(T=""+s.key),s)Z0.call(s,h)&&!eN.hasOwnProperty(h)&&(E[h]=s[h]);var P=arguments.length-2;if(P===1)E.children=d;else if(1<P){for(var L=Array(P),V=0;V<P;V++)L[V]=arguments[V+2];E.children=L}if(r&&r.defaultProps)for(h in P=r.defaultProps,P)E[h]===void 0&&(E[h]=P[h]);return{$$typeof:Yd,type:r,key:T,ref:I,props:E,_owner:zm.current}}function YF(r,s){return{$$typeof:Yd,type:r.type,key:s,ref:r.ref,props:r.props,_owner:r._owner}}function qm(r){return typeof r=="object"&&r!==null&&r.$$typeof===Yd}function zF(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(d){return s[d]})}var jw=/\/+/g;function CE(r,s){return typeof r=="object"&&r!==null&&r.key!=null?zF(""+r.key):s.toString(36)}function Qu(r,s,d,h,E){var T=typeof r;(T==="undefined"||T==="boolean")&&(r=null);var I=!1;if(r===null)I=!0;else switch(T){case"string":case"number":I=!0;break;case"object":switch(r.$$typeof){case Yd:case MF:I=!0}}if(I)return I=r,E=E(I),r=h===""?"."+CE(I,0):h,Vw(E)?(d="",r!=null&&(d=r.replace(jw,"$&/")+"/"),Qu(E,s,d,"",function(V){return V})):E!=null&&(qm(E)&&(E=YF(E,d+(!E.key||I&&I.key===E.key?"":(""+E.key).replace(jw,"$&/")+"/")+r)),s.push(E)),1;if(I=0,h=h===""?".":h+":",Vw(r))for(var P=0;P<r.length;P++){T=r[P];var L=h+CE(T,P);I+=Qu(T,s,d,L,E)}else if(L=KF(r),typeof L=="function")for(r=L.call(r),P=0;!(T=r.next()).done;)T=T.value,L=h+CE(T,P++),I+=Qu(T,s,d,L,E);else if(T==="object")throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return I}function Lu(r,s,d){if(r==null)return r;var h=[],E=0;return Qu(r,h,"","",function(T){return s.call(d,T,E++)}),h}function qF(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(d){(r._status===0||r._status===-1)&&(r._status=1,r._result=d)},function(d){(r._status===0||r._status===-1)&&(r._status=2,r._result=d)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var ai={current:null},$u={transition:null},JF={ReactCurrentDispatcher:ai,ReactCurrentBatchConfig:$u,ReactCurrentOwner:zm};st.Children={map:Lu,forEach:function(r,s,d){Lu(r,function(){s.apply(this,arguments)},d)},count:function(r){var s=0;return Lu(r,function(){s++}),s},toArray:function(r){return Lu(r,function(s){return s})||[]},only:function(r){if(!qm(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};st.Component=gc;st.Fragment=UF;st.Profiler=VF;st.PureComponent=Km;st.StrictMode=xF;st.Suspense=GF;st.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=JF;st.cloneElement=function(r,s,d){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var h=X0({},r.props),E=r.key,T=r.ref,I=r._owner;if(s!=null){if(s.ref!==void 0&&(T=s.ref,I=zm.current),s.key!==void 0&&(E=""+s.key),r.type&&r.type.defaultProps)var P=r.type.defaultProps;for(L in s)Z0.call(s,L)&&!eN.hasOwnProperty(L)&&(h[L]=s[L]===void 0&&P!==void 0?P[L]:s[L])}var L=arguments.length-2;if(L===1)h.children=d;else if(1<L){P=Array(L);for(var V=0;V<L;V++)P[V]=arguments[V+2];h.children=P}return{$$typeof:Yd,type:r.type,key:E,ref:T,props:h,_owner:I}};st.createContext=function(r){return r={$$typeof:FF,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:jF,_context:r},r.Consumer=r};st.createElement=tN;st.createFactory=function(r){var s=tN.bind(null,r);return s.type=r,s};st.createRef=function(){return{current:null}};st.forwardRef=function(r){return{$$typeof:BF,render:r}};st.isValidElement=qm;st.lazy=function(r){return{$$typeof:HF,_payload:{_status:-1,_result:r},_init:qF}};st.memo=function(r,s){return{$$typeof:WF,type:r,compare:s===void 0?null:s}};st.startTransition=function(r){var s=$u.transition;$u.transition={};try{r()}finally{$u.transition=s}};st.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};st.useCallback=function(r,s){return ai.current.useCallback(r,s)};st.useContext=function(r){return ai.current.useContext(r)};st.useDebugValue=function(){};st.useDeferredValue=function(r){return ai.current.useDeferredValue(r)};st.useEffect=function(r,s){return ai.current.useEffect(r,s)};st.useId=function(){return ai.current.useId()};st.useImperativeHandle=function(r,s,d){return ai.current.useImperativeHandle(r,s,d)};st.useInsertionEffect=function(r,s){return ai.current.useInsertionEffect(r,s)};st.useLayoutEffect=function(r,s){return ai.current.useLayoutEffect(r,s)};st.useMemo=function(r,s){return ai.current.useMemo(r,s)};st.useReducer=function(r,s,d){return ai.current.useReducer(r,s,d)};st.useRef=function(r){return ai.current.useRef(r)};st.useState=function(r){return ai.current.useState(r)};st.useSyncExternalStore=function(r,s,d){return ai.current.useSyncExternalStore(r,s,d)};st.useTransition=function(){return ai.current.useTransition()};st.version="18.2.0";q0.exports=st;var Ir=q0.exports;const XF=Y0(Ir);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QF=Ir,$F=Symbol.for("react.element"),ZF=Symbol.for("react.fragment"),eB=Object.prototype.hasOwnProperty,tB=QF.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nB={key:!0,ref:!0,__self:!0,__source:!0};function nN(r,s,d){var h,E={},T=null,I=null;d!==void 0&&(T=""+d),s.key!==void 0&&(T=""+s.key),s.ref!==void 0&&(I=s.ref);for(h in s)eB.call(s,h)&&!nB.hasOwnProperty(h)&&(E[h]=s[h]);if(r&&r.defaultProps)for(h in s=r.defaultProps,s)E[h]===void 0&&(E[h]=s[h]);return{$$typeof:$F,type:r,key:T,ref:I,props:E,_owner:tB.current}}Mh.Fragment=ZF;Mh.jsx=nN;Mh.jsxs=nN;z0.exports=Mh;var Qt=z0.exports,QE={},iN={exports:{}},Hi={},rN={exports:{}},oN={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(Re,Ge){var je=Re.length;Re.push(Ge);e:for(;0<je;){var qt=je-1>>>1,dn=Re[qt];if(0<E(dn,Ge))Re[qt]=Ge,Re[je]=dn,je=qt;else break e}}function d(Re){return Re.length===0?null:Re[0]}function h(Re){if(Re.length===0)return null;var Ge=Re[0],je=Re.pop();if(je!==Ge){Re[0]=je;e:for(var qt=0,dn=Re.length,ea=dn>>>1;qt<ea;){var ur=2*(qt+1)-1,vc=Re[ur],hr=ur+1,ta=Re[hr];if(0>E(vc,je))hr<dn&&0>E(ta,vc)?(Re[qt]=ta,Re[hr]=je,qt=hr):(Re[qt]=vc,Re[ur]=je,qt=ur);else if(hr<dn&&0>E(ta,je))Re[qt]=ta,Re[hr]=je,qt=hr;else break e}}return Ge}function E(Re,Ge){var je=Re.sortIndex-Ge.sortIndex;return je!==0?je:Re.id-Ge.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;r.unstable_now=function(){return T.now()}}else{var I=Date,P=I.now();r.unstable_now=function(){return I.now()-P}}var L=[],V=[],ne=1,q=null,z=3,ue=!1,$=!1,_e=!1,pt=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(Re){for(var Ge=d(V);Ge!==null;){if(Ge.callback===null)h(V);else if(Ge.startTime<=Re)h(V),Ge.sortIndex=Ge.expirationTime,s(L,Ge);else break;Ge=d(V)}}function ee(Re){if(_e=!1,F(Re),!$)if(d(L)!==null)$=!0,lr(le);else{var Ge=d(V);Ge!==null&&Zs(ee,Ge.startTime-Re)}}function le(Re,Ge){$=!1,_e&&(_e=!1,j(Oe),Oe=-1),ue=!0;var je=z;try{for(F(Ge),q=d(L);q!==null&&(!(q.expirationTime>Ge)||Re&&!di());){var qt=q.callback;if(typeof qt=="function"){q.callback=null,z=q.priorityLevel;var dn=qt(q.expirationTime<=Ge);Ge=r.unstable_now(),typeof dn=="function"?q.callback=dn:q===d(L)&&h(L),F(Ge)}else h(L);q=d(L)}if(q!==null)var ea=!0;else{var ur=d(V);ur!==null&&Zs(ee,ur.startTime-Ge),ea=!1}return ea}finally{q=null,z=je,ue=!1}}var me=!1,Ae=null,Oe=-1,ct=5,Ze=-1;function di(){return!(r.unstable_now()-Ze<ct)}function Eo(){if(Ae!==null){var Re=r.unstable_now();Ze=Re;var Ge=!0;try{Ge=Ae(!0,Re)}finally{Ge?ls():(me=!1,Ae=null)}}else me=!1}var ls;if(typeof U=="function")ls=function(){U(Eo)};else if(typeof MessageChannel<"u"){var dr=new MessageChannel,$s=dr.port2;dr.port1.onmessage=Eo,ls=function(){$s.postMessage(null)}}else ls=function(){pt(Eo,0)};function lr(Re){Ae=Re,me||(me=!0,ls())}function Zs(Re,Ge){Oe=pt(function(){Re(r.unstable_now())},Ge)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Re){Re.callback=null},r.unstable_continueExecution=function(){$||ue||($=!0,lr(le))},r.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ct=0<Re?Math.floor(1e3/Re):5},r.unstable_getCurrentPriorityLevel=function(){return z},r.unstable_getFirstCallbackNode=function(){return d(L)},r.unstable_next=function(Re){switch(z){case 1:case 2:case 3:var Ge=3;break;default:Ge=z}var je=z;z=Ge;try{return Re()}finally{z=je}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Re,Ge){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var je=z;z=Re;try{return Ge()}finally{z=je}},r.unstable_scheduleCallback=function(Re,Ge,je){var qt=r.unstable_now();switch(typeof je=="object"&&je!==null?(je=je.delay,je=typeof je=="number"&&0<je?qt+je:qt):je=qt,Re){case 1:var dn=-1;break;case 2:dn=250;break;case 5:dn=1073741823;break;case 4:dn=1e4;break;default:dn=5e3}return dn=je+dn,Re={id:ne++,callback:Ge,priorityLevel:Re,startTime:je,expirationTime:dn,sortIndex:-1},je>qt?(Re.sortIndex=je,s(V,Re),d(L)===null&&Re===d(V)&&(_e?(j(Oe),Oe=-1):_e=!0,Zs(ee,je-qt))):(Re.sortIndex=dn,s(L,Re),$||ue||($=!0,lr(le))),Re},r.unstable_shouldYield=di,r.unstable_wrapCallback=function(Re){var Ge=z;return function(){var je=z;z=Ge;try{return Re.apply(this,arguments)}finally{z=je}}}})(oN);rN.exports=oN;var iB=rN.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sN=Ir,Wi=iB;function ce(r){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+r,d=1;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var aN=new Set,Nd={};function Xs(r,s){uc(r,s),uc(r+"Capture",s)}function uc(r,s){for(Nd[r]=s,r=0;r<s.length;r++)aN.add(s[r])}var uo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$E=Object.prototype.hasOwnProperty,rB=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Fw={},Bw={};function oB(r){return $E.call(Bw,r)?!0:$E.call(Fw,r)?!1:rB.test(r)?Bw[r]=!0:(Fw[r]=!0,!1)}function sB(r,s,d,h){if(d!==null&&d.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return h?!1:d!==null?!d.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function aB(r,s,d,h){if(s===null||typeof s>"u"||sB(r,s,d,h))return!0;if(h)return!1;if(d!==null)switch(d.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function ci(r,s,d,h,E,T,I){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=h,this.attributeNamespace=E,this.mustUseProperty=d,this.propertyName=r,this.type=s,this.sanitizeURL=T,this.removeEmptyString=I}var Gn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Gn[r]=new ci(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var s=r[0];Gn[s]=new ci(s,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Gn[r]=new ci(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Gn[r]=new ci(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Gn[r]=new ci(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Gn[r]=new ci(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Gn[r]=new ci(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Gn[r]=new ci(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Gn[r]=new ci(r,5,!1,r.toLowerCase(),null,!1,!1)});var Jm=/[\-:]([a-z])/g;function Xm(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var s=r.replace(Jm,Xm);Gn[s]=new ci(s,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var s=r.replace(Jm,Xm);Gn[s]=new ci(s,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var s=r.replace(Jm,Xm);Gn[s]=new ci(s,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Gn[r]=new ci(r,1,!1,r.toLowerCase(),null,!1,!1)});Gn.xlinkHref=new ci("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Gn[r]=new ci(r,1,!1,r.toLowerCase(),null,!0,!0)});function Qm(r,s,d,h){var E=Gn.hasOwnProperty(s)?Gn[s]:null;(E!==null?E.type!==0:h||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(aB(s,d,E,h)&&(d=null),h||E===null?oB(s)&&(d===null?r.removeAttribute(s):r.setAttribute(s,""+d)):E.mustUseProperty?r[E.propertyName]=d===null?E.type===3?!1:"":d:(s=E.attributeName,h=E.attributeNamespace,d===null?r.removeAttribute(s):(E=E.type,d=E===3||E===4&&d===!0?"":""+d,h?r.setAttributeNS(h,s,d):r.setAttribute(s,d))))}var _o=sN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ku=Symbol.for("react.element"),za=Symbol.for("react.portal"),qa=Symbol.for("react.fragment"),$m=Symbol.for("react.strict_mode"),ZE=Symbol.for("react.profiler"),cN=Symbol.for("react.provider"),dN=Symbol.for("react.context"),Zm=Symbol.for("react.forward_ref"),em=Symbol.for("react.suspense"),tm=Symbol.for("react.suspense_list"),eg=Symbol.for("react.memo"),Ko=Symbol.for("react.lazy"),lN=Symbol.for("react.offscreen"),Gw=Symbol.iterator;function od(r){return r===null||typeof r!="object"?null:(r=Gw&&r[Gw]||r["@@iterator"],typeof r=="function"?r:null)}var en=Object.assign,AE;function fd(r){if(AE===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);AE=s&&s[1]||""}return`
`+AE+r}var OE=!1;function wE(r,s){if(!r||OE)return"";OE=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(V){var h=V}Reflect.construct(r,[],s)}else{try{s.call()}catch(V){h=V}r.call(s.prototype)}else{try{throw Error()}catch(V){h=V}r()}}catch(V){if(V&&h&&typeof V.stack=="string"){for(var E=V.stack.split(`
`),T=h.stack.split(`
`),I=E.length-1,P=T.length-1;1<=I&&0<=P&&E[I]!==T[P];)P--;for(;1<=I&&0<=P;I--,P--)if(E[I]!==T[P]){if(I!==1||P!==1)do if(I--,P--,0>P||E[I]!==T[P]){var L=`
`+E[I].replace(" at new "," at ");return r.displayName&&L.includes("<anonymous>")&&(L=L.replace("<anonymous>",r.displayName)),L}while(1<=I&&0<=P);break}}}finally{OE=!1,Error.prepareStackTrace=d}return(r=r?r.displayName||r.name:"")?fd(r):""}function cB(r){switch(r.tag){case 5:return fd(r.type);case 16:return fd("Lazy");case 13:return fd("Suspense");case 19:return fd("SuspenseList");case 0:case 2:case 15:return r=wE(r.type,!1),r;case 11:return r=wE(r.type.render,!1),r;case 1:return r=wE(r.type,!0),r;default:return""}}function nm(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case qa:return"Fragment";case za:return"Portal";case ZE:return"Profiler";case $m:return"StrictMode";case em:return"Suspense";case tm:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case dN:return(r.displayName||"Context")+".Consumer";case cN:return(r._context.displayName||"Context")+".Provider";case Zm:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case eg:return s=r.displayName||null,s!==null?s:nm(r.type)||"Memo";case Ko:s=r._payload,r=r._init;try{return nm(r(s))}catch{}}return null}function dB(r){var s=r.type;switch(r.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=s.render,r=r.displayName||r.name||"",s.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return nm(s);case 8:return s===$m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function os(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function uN(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function lB(r){var s=uN(r)?"checked":"value",d=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),h=""+r[s];if(!r.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var E=d.get,T=d.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return E.call(this)},set:function(I){h=""+I,T.call(this,I)}}),Object.defineProperty(r,s,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(I){h=""+I},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function Mu(r){r._valueTracker||(r._valueTracker=lB(r))}function hN(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),h="";return r&&(h=uN(r)?r.checked?"true":"false":r.value),r=h,r!==d?(s.setValue(r),!0):!1}function uh(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function im(r,s){var d=s.checked;return en({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??r._wrapperState.initialChecked})}function Ww(r,s){var d=s.defaultValue==null?"":s.defaultValue,h=s.checked!=null?s.checked:s.defaultChecked;d=os(s.value!=null?s.value:d),r._wrapperState={initialChecked:h,initialValue:d,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function pN(r,s){s=s.checked,s!=null&&Qm(r,"checked",s,!1)}function rm(r,s){pN(r,s);var d=os(s.value),h=s.type;if(d!=null)h==="number"?(d===0&&r.value===""||r.value!=d)&&(r.value=""+d):r.value!==""+d&&(r.value=""+d);else if(h==="submit"||h==="reset"){r.removeAttribute("value");return}s.hasOwnProperty("value")?om(r,s.type,d):s.hasOwnProperty("defaultValue")&&om(r,s.type,os(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(r.defaultChecked=!!s.defaultChecked)}function Hw(r,s,d){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var h=s.type;if(!(h!=="submit"&&h!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+r._wrapperState.initialValue,d||s===r.value||(r.value=s),r.defaultValue=s}d=r.name,d!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,d!==""&&(r.name=d)}function om(r,s,d){(s!=="number"||uh(r.ownerDocument)!==r)&&(d==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+d&&(r.defaultValue=""+d))}var _d=Array.isArray;function oc(r,s,d,h){if(r=r.options,s){s={};for(var E=0;E<d.length;E++)s["$"+d[E]]=!0;for(d=0;d<r.length;d++)E=s.hasOwnProperty("$"+r[d].value),r[d].selected!==E&&(r[d].selected=E),E&&h&&(r[d].defaultSelected=!0)}else{for(d=""+os(d),s=null,E=0;E<r.length;E++){if(r[E].value===d){r[E].selected=!0,h&&(r[E].defaultSelected=!0);return}s!==null||r[E].disabled||(s=r[E])}s!==null&&(s.selected=!0)}}function sm(r,s){if(s.dangerouslySetInnerHTML!=null)throw Error(ce(91));return en({},s,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Kw(r,s){var d=s.value;if(d==null){if(d=s.children,s=s.defaultValue,d!=null){if(s!=null)throw Error(ce(92));if(_d(d)){if(1<d.length)throw Error(ce(93));d=d[0]}s=d}s==null&&(s=""),d=s}r._wrapperState={initialValue:os(d)}}function fN(r,s){var d=os(s.value),h=os(s.defaultValue);d!=null&&(d=""+d,d!==r.value&&(r.value=d),s.defaultValue==null&&r.defaultValue!==d&&(r.defaultValue=d)),h!=null&&(r.defaultValue=""+h)}function Yw(r){var s=r.textContent;s===r._wrapperState.initialValue&&s!==""&&s!==null&&(r.value=s)}function _N(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function am(r,s){return r==null||r==="http://www.w3.org/1999/xhtml"?_N(s):r==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Uu,EN=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,d,h,E){MSApp.execUnsafeLocalFunction(function(){return r(s,d,h,E)})}:r}(function(r,s){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=s;else{for(Uu=Uu||document.createElement("div"),Uu.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Uu.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;s.firstChild;)r.appendChild(s.firstChild)}});function bd(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var Td={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},uB=["Webkit","ms","Moz","O"];Object.keys(Td).forEach(function(r){uB.forEach(function(s){s=s+r.charAt(0).toUpperCase()+r.substring(1),Td[s]=Td[r]})});function mN(r,s,d){return s==null||typeof s=="boolean"||s===""?"":d||typeof s!="number"||s===0||Td.hasOwnProperty(r)&&Td[r]?(""+s).trim():s+"px"}function gN(r,s){r=r.style;for(var d in s)if(s.hasOwnProperty(d)){var h=d.indexOf("--")===0,E=mN(d,s[d],h);d==="float"&&(d="cssFloat"),h?r.setProperty(d,E):r[d]=E}}var hB=en({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function cm(r,s){if(s){if(hB[r]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(ce(137,r));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(ce(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(ce(61))}if(s.style!=null&&typeof s.style!="object")throw Error(ce(62))}}function dm(r,s){if(r.indexOf("-")===-1)return typeof s.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lm=null;function tg(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var um=null,sc=null,ac=null;function zw(r){if(r=Jd(r)){if(typeof um!="function")throw Error(ce(280));var s=r.stateNode;s&&(s=Fh(s),um(r.stateNode,r.type,s))}}function SN(r){sc?ac?ac.push(r):ac=[r]:sc=r}function TN(){if(sc){var r=sc,s=ac;if(ac=sc=null,zw(r),s)for(r=0;r<s.length;r++)zw(s[r])}}function vN(r,s){return r(s)}function RN(){}var NE=!1;function yN(r,s,d){if(NE)return r(s,d);NE=!0;try{return vN(r,s,d)}finally{NE=!1,(sc!==null||ac!==null)&&(RN(),TN())}}function Dd(r,s){var d=r.stateNode;if(d===null)return null;var h=Fh(d);if(h===null)return null;d=h[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(r=r.type,h=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!h;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(ce(231,s,typeof d));return d}var hm=!1;if(uo)try{var sd={};Object.defineProperty(sd,"passive",{get:function(){hm=!0}}),window.addEventListener("test",sd,sd),window.removeEventListener("test",sd,sd)}catch{hm=!1}function pB(r,s,d,h,E,T,I,P,L){var V=Array.prototype.slice.call(arguments,3);try{s.apply(d,V)}catch(ne){this.onError(ne)}}var vd=!1,hh=null,ph=!1,pm=null,fB={onError:function(r){vd=!0,hh=r}};function _B(r,s,d,h,E,T,I,P,L){vd=!1,hh=null,pB.apply(fB,arguments)}function EB(r,s,d,h,E,T,I,P,L){if(_B.apply(this,arguments),vd){if(vd){var V=hh;vd=!1,hh=null}else throw Error(ce(198));ph||(ph=!0,pm=V)}}function Qs(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function IN(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function qw(r){if(Qs(r)!==r)throw Error(ce(188))}function mB(r){var s=r.alternate;if(!s){if(s=Qs(r),s===null)throw Error(ce(188));return s!==r?null:r}for(var d=r,h=s;;){var E=d.return;if(E===null)break;var T=E.alternate;if(T===null){if(h=E.return,h!==null){d=h;continue}break}if(E.child===T.child){for(T=E.child;T;){if(T===d)return qw(E),r;if(T===h)return qw(E),s;T=T.sibling}throw Error(ce(188))}if(d.return!==h.return)d=E,h=T;else{for(var I=!1,P=E.child;P;){if(P===d){I=!0,d=E,h=T;break}if(P===h){I=!0,h=E,d=T;break}P=P.sibling}if(!I){for(P=T.child;P;){if(P===d){I=!0,d=T,h=E;break}if(P===h){I=!0,h=T,d=E;break}P=P.sibling}if(!I)throw Error(ce(189))}}if(d.alternate!==h)throw Error(ce(190))}if(d.tag!==3)throw Error(ce(188));return d.stateNode.current===d?r:s}function CN(r){return r=mB(r),r!==null?AN(r):null}function AN(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var s=AN(r);if(s!==null)return s;r=r.sibling}return null}var ON=Wi.unstable_scheduleCallback,Jw=Wi.unstable_cancelCallback,gB=Wi.unstable_shouldYield,SB=Wi.unstable_requestPaint,cn=Wi.unstable_now,TB=Wi.unstable_getCurrentPriorityLevel,ng=Wi.unstable_ImmediatePriority,wN=Wi.unstable_UserBlockingPriority,fh=Wi.unstable_NormalPriority,vB=Wi.unstable_LowPriority,NN=Wi.unstable_IdlePriority,Uh=null,Kr=null;function RB(r){if(Kr&&typeof Kr.onCommitFiberRoot=="function")try{Kr.onCommitFiberRoot(Uh,r,void 0,(r.current.flags&128)===128)}catch{}}var wr=Math.clz32?Math.clz32:CB,yB=Math.log,IB=Math.LN2;function CB(r){return r>>>=0,r===0?32:31-(yB(r)/IB|0)|0}var xu=64,Vu=4194304;function Ed(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function _h(r,s){var d=r.pendingLanes;if(d===0)return 0;var h=0,E=r.suspendedLanes,T=r.pingedLanes,I=d&268435455;if(I!==0){var P=I&~E;P!==0?h=Ed(P):(T&=I,T!==0&&(h=Ed(T)))}else I=d&~E,I!==0?h=Ed(I):T!==0&&(h=Ed(T));if(h===0)return 0;if(s!==0&&s!==h&&!(s&E)&&(E=h&-h,T=s&-s,E>=T||E===16&&(T&4194240)!==0))return s;if(h&4&&(h|=d&16),s=r.entangledLanes,s!==0)for(r=r.entanglements,s&=h;0<s;)d=31-wr(s),E=1<<d,h|=r[d],s&=~E;return h}function AB(r,s){switch(r){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OB(r,s){for(var d=r.suspendedLanes,h=r.pingedLanes,E=r.expirationTimes,T=r.pendingLanes;0<T;){var I=31-wr(T),P=1<<I,L=E[I];L===-1?(!(P&d)||P&h)&&(E[I]=AB(P,s)):L<=s&&(r.expiredLanes|=P),T&=~P}}function fm(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function bN(){var r=xu;return xu<<=1,!(xu&4194240)&&(xu=64),r}function bE(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function zd(r,s,d){r.pendingLanes|=s,s!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,s=31-wr(s),r[s]=d}function wB(r,s){var d=r.pendingLanes&~s;r.pendingLanes=s,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=s,r.mutableReadLanes&=s,r.entangledLanes&=s,s=r.entanglements;var h=r.eventTimes;for(r=r.expirationTimes;0<d;){var E=31-wr(d),T=1<<E;s[E]=0,h[E]=-1,r[E]=-1,d&=~T}}function ig(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var h=31-wr(d),E=1<<h;E&s|r[h]&s&&(r[h]|=s),d&=~E}}var It=0;function DN(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var PN,rg,LN,kN,MN,_m=!1,ju=[],Qo=null,$o=null,Zo=null,Pd=new Map,Ld=new Map,zo=[],NB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xw(r,s){switch(r){case"focusin":case"focusout":Qo=null;break;case"dragenter":case"dragleave":$o=null;break;case"mouseover":case"mouseout":Zo=null;break;case"pointerover":case"pointerout":Pd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ld.delete(s.pointerId)}}function ad(r,s,d,h,E,T){return r===null||r.nativeEvent!==T?(r={blockedOn:s,domEventName:d,eventSystemFlags:h,nativeEvent:T,targetContainers:[E]},s!==null&&(s=Jd(s),s!==null&&rg(s)),r):(r.eventSystemFlags|=h,s=r.targetContainers,E!==null&&s.indexOf(E)===-1&&s.push(E),r)}function bB(r,s,d,h,E){switch(s){case"focusin":return Qo=ad(Qo,r,s,d,h,E),!0;case"dragenter":return $o=ad($o,r,s,d,h,E),!0;case"mouseover":return Zo=ad(Zo,r,s,d,h,E),!0;case"pointerover":var T=E.pointerId;return Pd.set(T,ad(Pd.get(T)||null,r,s,d,h,E)),!0;case"gotpointercapture":return T=E.pointerId,Ld.set(T,ad(Ld.get(T)||null,r,s,d,h,E)),!0}return!1}function UN(r){var s=Fs(r.target);if(s!==null){var d=Qs(s);if(d!==null){if(s=d.tag,s===13){if(s=IN(d),s!==null){r.blockedOn=s,MN(r.priority,function(){LN(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Zu(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=Em(r.domEventName,r.eventSystemFlags,s[0],r.nativeEvent);if(d===null){d=r.nativeEvent;var h=new d.constructor(d.type,d);lm=h,d.target.dispatchEvent(h),lm=null}else return s=Jd(d),s!==null&&rg(s),r.blockedOn=d,!1;s.shift()}return!0}function Qw(r,s,d){Zu(r)&&d.delete(s)}function DB(){_m=!1,Qo!==null&&Zu(Qo)&&(Qo=null),$o!==null&&Zu($o)&&($o=null),Zo!==null&&Zu(Zo)&&(Zo=null),Pd.forEach(Qw),Ld.forEach(Qw)}function cd(r,s){r.blockedOn===s&&(r.blockedOn=null,_m||(_m=!0,Wi.unstable_scheduleCallback(Wi.unstable_NormalPriority,DB)))}function kd(r){function s(E){return cd(E,r)}if(0<ju.length){cd(ju[0],r);for(var d=1;d<ju.length;d++){var h=ju[d];h.blockedOn===r&&(h.blockedOn=null)}}for(Qo!==null&&cd(Qo,r),$o!==null&&cd($o,r),Zo!==null&&cd(Zo,r),Pd.forEach(s),Ld.forEach(s),d=0;d<zo.length;d++)h=zo[d],h.blockedOn===r&&(h.blockedOn=null);for(;0<zo.length&&(d=zo[0],d.blockedOn===null);)UN(d),d.blockedOn===null&&zo.shift()}var cc=_o.ReactCurrentBatchConfig,Eh=!0;function PB(r,s,d,h){var E=It,T=cc.transition;cc.transition=null;try{It=1,og(r,s,d,h)}finally{It=E,cc.transition=T}}function LB(r,s,d,h){var E=It,T=cc.transition;cc.transition=null;try{It=4,og(r,s,d,h)}finally{It=E,cc.transition=T}}function og(r,s,d,h){if(Eh){var E=Em(r,s,d,h);if(E===null)FE(r,s,h,mh,d),Xw(r,h);else if(bB(E,r,s,d,h))h.stopPropagation();else if(Xw(r,h),s&4&&-1<NB.indexOf(r)){for(;E!==null;){var T=Jd(E);if(T!==null&&PN(T),T=Em(r,s,d,h),T===null&&FE(r,s,h,mh,d),T===E)break;E=T}E!==null&&h.stopPropagation()}else FE(r,s,h,null,d)}}var mh=null;function Em(r,s,d,h){if(mh=null,r=tg(h),r=Fs(r),r!==null)if(s=Qs(r),s===null)r=null;else if(d=s.tag,d===13){if(r=IN(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null);return mh=r,null}function xN(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(TB()){case ng:return 1;case wN:return 4;case fh:case vB:return 16;case NN:return 536870912;default:return 16}default:return 16}}var Jo=null,sg=null,eh=null;function VN(){if(eh)return eh;var r,s=sg,d=s.length,h,E="value"in Jo?Jo.value:Jo.textContent,T=E.length;for(r=0;r<d&&s[r]===E[r];r++);var I=d-r;for(h=1;h<=I&&s[d-h]===E[T-h];h++);return eh=E.slice(r,1<h?1-h:void 0)}function th(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Fu(){return!0}function $w(){return!1}function Ki(r){function s(d,h,E,T,I){this._reactName=d,this._targetInst=E,this.type=h,this.nativeEvent=T,this.target=I,this.currentTarget=null;for(var P in r)r.hasOwnProperty(P)&&(d=r[P],this[P]=d?d(T):T[P]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Fu:$w,this.isPropagationStopped=$w,this}return en(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Fu)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Fu)},persist:function(){},isPersistent:Fu}),s}var Sc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ag=Ki(Sc),qd=en({},Sc,{view:0,detail:0}),kB=Ki(qd),DE,PE,dd,xh=en({},qd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cg,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==dd&&(dd&&r.type==="mousemove"?(DE=r.screenX-dd.screenX,PE=r.screenY-dd.screenY):PE=DE=0,dd=r),DE)},movementY:function(r){return"movementY"in r?r.movementY:PE}}),Zw=Ki(xh),MB=en({},xh,{dataTransfer:0}),UB=Ki(MB),xB=en({},qd,{relatedTarget:0}),LE=Ki(xB),VB=en({},Sc,{animationName:0,elapsedTime:0,pseudoElement:0}),jB=Ki(VB),FB=en({},Sc,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),BB=Ki(FB),GB=en({},Sc,{data:0}),e0=Ki(GB),WB={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},HB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},KB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function YB(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=KB[r])?!!s[r]:!1}function cg(){return YB}var zB=en({},qd,{key:function(r){if(r.key){var s=WB[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=th(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?HB[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cg,charCode:function(r){return r.type==="keypress"?th(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?th(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),qB=Ki(zB),JB=en({},xh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),t0=Ki(JB),XB=en({},qd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cg}),QB=Ki(XB),$B=en({},Sc,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZB=Ki($B),e3=en({},xh,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),t3=Ki(e3),n3=[9,13,27,32],dg=uo&&"CompositionEvent"in window,Rd=null;uo&&"documentMode"in document&&(Rd=document.documentMode);var i3=uo&&"TextEvent"in window&&!Rd,jN=uo&&(!dg||Rd&&8<Rd&&11>=Rd),n0=String.fromCharCode(32),i0=!1;function FN(r,s){switch(r){case"keyup":return n3.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function BN(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ja=!1;function r3(r,s){switch(r){case"compositionend":return BN(s);case"keypress":return s.which!==32?null:(i0=!0,n0);case"textInput":return r=s.data,r===n0&&i0?null:r;default:return null}}function o3(r,s){if(Ja)return r==="compositionend"||!dg&&FN(r,s)?(r=VN(),eh=sg=Jo=null,Ja=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return jN&&s.locale!=="ko"?null:s.data;default:return null}}var s3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function r0(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!s3[r.type]:s==="textarea"}function GN(r,s,d,h){SN(h),s=gh(s,"onChange"),0<s.length&&(d=new ag("onChange","change",null,d,h),r.push({event:d,listeners:s}))}var yd=null,Md=null;function a3(r){ZN(r,0)}function Vh(r){var s=$a(r);if(hN(s))return r}function c3(r,s){if(r==="change")return s}var WN=!1;if(uo){var kE;if(uo){var ME="oninput"in document;if(!ME){var o0=document.createElement("div");o0.setAttribute("oninput","return;"),ME=typeof o0.oninput=="function"}kE=ME}else kE=!1;WN=kE&&(!document.documentMode||9<document.documentMode)}function s0(){yd&&(yd.detachEvent("onpropertychange",HN),Md=yd=null)}function HN(r){if(r.propertyName==="value"&&Vh(Md)){var s=[];GN(s,Md,r,tg(r)),yN(a3,s)}}function d3(r,s,d){r==="focusin"?(s0(),yd=s,Md=d,yd.attachEvent("onpropertychange",HN)):r==="focusout"&&s0()}function l3(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Vh(Md)}function u3(r,s){if(r==="click")return Vh(s)}function h3(r,s){if(r==="input"||r==="change")return Vh(s)}function p3(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var br=typeof Object.is=="function"?Object.is:p3;function Ud(r,s){if(br(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),h=Object.keys(s);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var E=d[h];if(!$E.call(s,E)||!br(r[E],s[E]))return!1}return!0}function a0(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function c0(r,s){var d=a0(r);r=0;for(var h;d;){if(d.nodeType===3){if(h=r+d.textContent.length,r<=s&&h>=s)return{node:d,offset:s-r};r=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=a0(d)}}function KN(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?KN(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function YN(){for(var r=window,s=uh();s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=uh(r.document)}return s}function lg(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}function f3(r){var s=YN(),d=r.focusedElem,h=r.selectionRange;if(s!==d&&d&&d.ownerDocument&&KN(d.ownerDocument.documentElement,d)){if(h!==null&&lg(d)){if(s=h.start,r=h.end,r===void 0&&(r=s),"selectionStart"in d)d.selectionStart=s,d.selectionEnd=Math.min(r,d.value.length);else if(r=(s=d.ownerDocument||document)&&s.defaultView||window,r.getSelection){r=r.getSelection();var E=d.textContent.length,T=Math.min(h.start,E);h=h.end===void 0?T:Math.min(h.end,E),!r.extend&&T>h&&(E=h,h=T,T=E),E=c0(d,T);var I=c0(d,h);E&&I&&(r.rangeCount!==1||r.anchorNode!==E.node||r.anchorOffset!==E.offset||r.focusNode!==I.node||r.focusOffset!==I.offset)&&(s=s.createRange(),s.setStart(E.node,E.offset),r.removeAllRanges(),T>h?(r.addRange(s),r.extend(I.node,I.offset)):(s.setEnd(I.node,I.offset),r.addRange(s)))}}for(s=[],r=d;r=r.parentNode;)r.nodeType===1&&s.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<s.length;d++)r=s[d],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var _3=uo&&"documentMode"in document&&11>=document.documentMode,Xa=null,mm=null,Id=null,gm=!1;function d0(r,s,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;gm||Xa==null||Xa!==uh(h)||(h=Xa,"selectionStart"in h&&lg(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Id&&Ud(Id,h)||(Id=h,h=gh(mm,"onSelect"),0<h.length&&(s=new ag("onSelect","select",null,s,d),r.push({event:s,listeners:h}),s.target=Xa)))}function Bu(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var Qa={animationend:Bu("Animation","AnimationEnd"),animationiteration:Bu("Animation","AnimationIteration"),animationstart:Bu("Animation","AnimationStart"),transitionend:Bu("Transition","TransitionEnd")},UE={},zN={};uo&&(zN=document.createElement("div").style,"AnimationEvent"in window||(delete Qa.animationend.animation,delete Qa.animationiteration.animation,delete Qa.animationstart.animation),"TransitionEvent"in window||delete Qa.transitionend.transition);function jh(r){if(UE[r])return UE[r];if(!Qa[r])return r;var s=Qa[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in zN)return UE[r]=s[d];return r}var qN=jh("animationend"),JN=jh("animationiteration"),XN=jh("animationstart"),QN=jh("transitionend"),$N=new Map,l0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function as(r,s){$N.set(r,s),Xs(s,[r])}for(var xE=0;xE<l0.length;xE++){var VE=l0[xE],E3=VE.toLowerCase(),m3=VE[0].toUpperCase()+VE.slice(1);as(E3,"on"+m3)}as(qN,"onAnimationEnd");as(JN,"onAnimationIteration");as(XN,"onAnimationStart");as("dblclick","onDoubleClick");as("focusin","onFocus");as("focusout","onBlur");as(QN,"onTransitionEnd");uc("onMouseEnter",["mouseout","mouseover"]);uc("onMouseLeave",["mouseout","mouseover"]);uc("onPointerEnter",["pointerout","pointerover"]);uc("onPointerLeave",["pointerout","pointerover"]);Xs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var md="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),g3=new Set("cancel close invalid load scroll toggle".split(" ").concat(md));function u0(r,s,d){var h=r.type||"unknown-event";r.currentTarget=d,EB(h,s,void 0,r),r.currentTarget=null}function ZN(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var h=r[d],E=h.event;h=h.listeners;e:{var T=void 0;if(s)for(var I=h.length-1;0<=I;I--){var P=h[I],L=P.instance,V=P.currentTarget;if(P=P.listener,L!==T&&E.isPropagationStopped())break e;u0(E,P,V),T=L}else for(I=0;I<h.length;I++){if(P=h[I],L=P.instance,V=P.currentTarget,P=P.listener,L!==T&&E.isPropagationStopped())break e;u0(E,P,V),T=L}}}if(ph)throw r=pm,ph=!1,pm=null,r}function Wt(r,s){var d=s[ym];d===void 0&&(d=s[ym]=new Set);var h=r+"__bubble";d.has(h)||(eb(s,r,2,!1),d.add(h))}function jE(r,s,d){var h=0;s&&(h|=4),eb(d,r,h,s)}var Gu="_reactListening"+Math.random().toString(36).slice(2);function xd(r){if(!r[Gu]){r[Gu]=!0,aN.forEach(function(d){d!=="selectionchange"&&(g3.has(d)||jE(d,!1,r),jE(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Gu]||(s[Gu]=!0,jE("selectionchange",!1,s))}}function eb(r,s,d,h){switch(xN(s)){case 1:var E=PB;break;case 4:E=LB;break;default:E=og}d=E.bind(null,s,d,r),E=void 0,!hm||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(E=!0),h?E!==void 0?r.addEventListener(s,d,{capture:!0,passive:E}):r.addEventListener(s,d,!0):E!==void 0?r.addEventListener(s,d,{passive:E}):r.addEventListener(s,d,!1)}function FE(r,s,d,h,E){var T=h;if(!(s&1)&&!(s&2)&&h!==null)e:for(;;){if(h===null)return;var I=h.tag;if(I===3||I===4){var P=h.stateNode.containerInfo;if(P===E||P.nodeType===8&&P.parentNode===E)break;if(I===4)for(I=h.return;I!==null;){var L=I.tag;if((L===3||L===4)&&(L=I.stateNode.containerInfo,L===E||L.nodeType===8&&L.parentNode===E))return;I=I.return}for(;P!==null;){if(I=Fs(P),I===null)return;if(L=I.tag,L===5||L===6){h=T=I;continue e}P=P.parentNode}}h=h.return}yN(function(){var V=T,ne=tg(d),q=[];e:{var z=$N.get(r);if(z!==void 0){var ue=ag,$=r;switch(r){case"keypress":if(th(d)===0)break e;case"keydown":case"keyup":ue=qB;break;case"focusin":$="focus",ue=LE;break;case"focusout":$="blur",ue=LE;break;case"beforeblur":case"afterblur":ue=LE;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ue=Zw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ue=UB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ue=QB;break;case qN:case JN:case XN:ue=jB;break;case QN:ue=ZB;break;case"scroll":ue=kB;break;case"wheel":ue=t3;break;case"copy":case"cut":case"paste":ue=BB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ue=t0}var _e=(s&4)!==0,pt=!_e&&r==="scroll",j=_e?z!==null?z+"Capture":null:z;_e=[];for(var U=V,F;U!==null;){F=U;var ee=F.stateNode;if(F.tag===5&&ee!==null&&(F=ee,j!==null&&(ee=Dd(U,j),ee!=null&&_e.push(Vd(U,ee,F)))),pt)break;U=U.return}0<_e.length&&(z=new ue(z,$,null,d,ne),q.push({event:z,listeners:_e}))}}if(!(s&7)){e:{if(z=r==="mouseover"||r==="pointerover",ue=r==="mouseout"||r==="pointerout",z&&d!==lm&&($=d.relatedTarget||d.fromElement)&&(Fs($)||$[ho]))break e;if((ue||z)&&(z=ne.window===ne?ne:(z=ne.ownerDocument)?z.defaultView||z.parentWindow:window,ue?($=d.relatedTarget||d.toElement,ue=V,$=$?Fs($):null,$!==null&&(pt=Qs($),$!==pt||$.tag!==5&&$.tag!==6)&&($=null)):(ue=null,$=V),ue!==$)){if(_e=Zw,ee="onMouseLeave",j="onMouseEnter",U="mouse",(r==="pointerout"||r==="pointerover")&&(_e=t0,ee="onPointerLeave",j="onPointerEnter",U="pointer"),pt=ue==null?z:$a(ue),F=$==null?z:$a($),z=new _e(ee,U+"leave",ue,d,ne),z.target=pt,z.relatedTarget=F,ee=null,Fs(ne)===V&&(_e=new _e(j,U+"enter",$,d,ne),_e.target=F,_e.relatedTarget=pt,ee=_e),pt=ee,ue&&$)t:{for(_e=ue,j=$,U=0,F=_e;F;F=Ya(F))U++;for(F=0,ee=j;ee;ee=Ya(ee))F++;for(;0<U-F;)_e=Ya(_e),U--;for(;0<F-U;)j=Ya(j),F--;for(;U--;){if(_e===j||j!==null&&_e===j.alternate)break t;_e=Ya(_e),j=Ya(j)}_e=null}else _e=null;ue!==null&&h0(q,z,ue,_e,!1),$!==null&&pt!==null&&h0(q,pt,$,_e,!0)}}e:{if(z=V?$a(V):window,ue=z.nodeName&&z.nodeName.toLowerCase(),ue==="select"||ue==="input"&&z.type==="file")var le=c3;else if(r0(z))if(WN)le=h3;else{le=l3;var me=d3}else(ue=z.nodeName)&&ue.toLowerCase()==="input"&&(z.type==="checkbox"||z.type==="radio")&&(le=u3);if(le&&(le=le(r,V))){GN(q,le,d,ne);break e}me&&me(r,z,V),r==="focusout"&&(me=z._wrapperState)&&me.controlled&&z.type==="number"&&om(z,"number",z.value)}switch(me=V?$a(V):window,r){case"focusin":(r0(me)||me.contentEditable==="true")&&(Xa=me,mm=V,Id=null);break;case"focusout":Id=mm=Xa=null;break;case"mousedown":gm=!0;break;case"contextmenu":case"mouseup":case"dragend":gm=!1,d0(q,d,ne);break;case"selectionchange":if(_3)break;case"keydown":case"keyup":d0(q,d,ne)}var Ae;if(dg)e:{switch(r){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else Ja?FN(r,d)&&(Oe="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Oe="onCompositionStart");Oe&&(jN&&d.locale!=="ko"&&(Ja||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&Ja&&(Ae=VN()):(Jo=ne,sg="value"in Jo?Jo.value:Jo.textContent,Ja=!0)),me=gh(V,Oe),0<me.length&&(Oe=new e0(Oe,r,null,d,ne),q.push({event:Oe,listeners:me}),Ae?Oe.data=Ae:(Ae=BN(d),Ae!==null&&(Oe.data=Ae)))),(Ae=i3?r3(r,d):o3(r,d))&&(V=gh(V,"onBeforeInput"),0<V.length&&(ne=new e0("onBeforeInput","beforeinput",null,d,ne),q.push({event:ne,listeners:V}),ne.data=Ae))}ZN(q,s)})}function Vd(r,s,d){return{instance:r,listener:s,currentTarget:d}}function gh(r,s){for(var d=s+"Capture",h=[];r!==null;){var E=r,T=E.stateNode;E.tag===5&&T!==null&&(E=T,T=Dd(r,d),T!=null&&h.unshift(Vd(r,T,E)),T=Dd(r,s),T!=null&&h.push(Vd(r,T,E))),r=r.return}return h}function Ya(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function h0(r,s,d,h,E){for(var T=s._reactName,I=[];d!==null&&d!==h;){var P=d,L=P.alternate,V=P.stateNode;if(L!==null&&L===h)break;P.tag===5&&V!==null&&(P=V,E?(L=Dd(d,T),L!=null&&I.unshift(Vd(d,L,P))):E||(L=Dd(d,T),L!=null&&I.push(Vd(d,L,P)))),d=d.return}I.length!==0&&r.push({event:s,listeners:I})}var S3=/\r\n?/g,T3=/\u0000|\uFFFD/g;function p0(r){return(typeof r=="string"?r:""+r).replace(S3,`
`).replace(T3,"")}function Wu(r,s,d){if(s=p0(s),p0(r)!==s&&d)throw Error(ce(425))}function Sh(){}var Sm=null,Tm=null;function vm(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Rm=typeof setTimeout=="function"?setTimeout:void 0,v3=typeof clearTimeout=="function"?clearTimeout:void 0,f0=typeof Promise=="function"?Promise:void 0,R3=typeof queueMicrotask=="function"?queueMicrotask:typeof f0<"u"?function(r){return f0.resolve(null).then(r).catch(y3)}:Rm;function y3(r){setTimeout(function(){throw r})}function BE(r,s){var d=s,h=0;do{var E=d.nextSibling;if(r.removeChild(d),E&&E.nodeType===8)if(d=E.data,d==="/$"){if(h===0){r.removeChild(E),kd(s);return}h--}else d!=="$"&&d!=="$?"&&d!=="$!"||h++;d=E}while(d);kd(s)}function es(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return r}function _0(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"){if(s===0)return r;s--}else d==="/$"&&s++}r=r.previousSibling}return null}var Tc=Math.random().toString(36).slice(2),Hr="__reactFiber$"+Tc,jd="__reactProps$"+Tc,ho="__reactContainer$"+Tc,ym="__reactEvents$"+Tc,I3="__reactListeners$"+Tc,C3="__reactHandles$"+Tc;function Fs(r){var s=r[Hr];if(s)return s;for(var d=r.parentNode;d;){if(s=d[ho]||d[Hr]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=_0(r);r!==null;){if(d=r[Hr])return d;r=_0(r)}return s}r=d,d=r.parentNode}return null}function Jd(r){return r=r[Hr]||r[ho],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function $a(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(ce(33))}function Fh(r){return r[jd]||null}var Im=[],Za=-1;function cs(r){return{current:r}}function Ht(r){0>Za||(r.current=Im[Za],Im[Za]=null,Za--)}function jt(r,s){Za++,Im[Za]=r.current,r.current=s}var ss={},Zn=cs(ss),Ii=cs(!1),Ks=ss;function hc(r,s){var d=r.type.contextTypes;if(!d)return ss;var h=r.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===s)return h.__reactInternalMemoizedMaskedChildContext;var E={},T;for(T in d)E[T]=s[T];return h&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=E),E}function Ci(r){return r=r.childContextTypes,r!=null}function Th(){Ht(Ii),Ht(Zn)}function E0(r,s,d){if(Zn.current!==ss)throw Error(ce(168));jt(Zn,s),jt(Ii,d)}function tb(r,s,d){var h=r.stateNode;if(s=s.childContextTypes,typeof h.getChildContext!="function")return d;h=h.getChildContext();for(var E in h)if(!(E in s))throw Error(ce(108,dB(r)||"Unknown",E));return en({},d,h)}function vh(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||ss,Ks=Zn.current,jt(Zn,r),jt(Ii,Ii.current),!0}function m0(r,s,d){var h=r.stateNode;if(!h)throw Error(ce(169));d?(r=tb(r,s,Ks),h.__reactInternalMemoizedMergedChildContext=r,Ht(Ii),Ht(Zn),jt(Zn,r)):Ht(Ii),jt(Ii,d)}var so=null,Bh=!1,GE=!1;function nb(r){so===null?so=[r]:so.push(r)}function A3(r){Bh=!0,nb(r)}function ds(){if(!GE&&so!==null){GE=!0;var r=0,s=It;try{var d=so;for(It=1;r<d.length;r++){var h=d[r];do h=h(!0);while(h!==null)}so=null,Bh=!1}catch(E){throw so!==null&&(so=so.slice(r+1)),ON(ng,ds),E}finally{It=s,GE=!1}}return null}var ec=[],tc=0,Rh=null,yh=0,ir=[],rr=0,Ys=null,ao=1,co="";function Vs(r,s){ec[tc++]=yh,ec[tc++]=Rh,Rh=r,yh=s}function ib(r,s,d){ir[rr++]=ao,ir[rr++]=co,ir[rr++]=Ys,Ys=r;var h=ao;r=co;var E=32-wr(h)-1;h&=~(1<<E),d+=1;var T=32-wr(s)+E;if(30<T){var I=E-E%5;T=(h&(1<<I)-1).toString(32),h>>=I,E-=I,ao=1<<32-wr(s)+E|d<<E|h,co=T+r}else ao=1<<T|d<<E|h,co=r}function ug(r){r.return!==null&&(Vs(r,1),ib(r,1,0))}function hg(r){for(;r===Rh;)Rh=ec[--tc],ec[tc]=null,yh=ec[--tc],ec[tc]=null;for(;r===Ys;)Ys=ir[--rr],ir[rr]=null,co=ir[--rr],ir[rr]=null,ao=ir[--rr],ir[rr]=null}var Gi=null,Bi=null,zt=!1,Or=null;function rb(r,s){var d=or(5,null,null,0);d.elementType="DELETED",d.stateNode=s,d.return=r,s=r.deletions,s===null?(r.deletions=[d],r.flags|=16):s.push(d)}function g0(r,s){switch(r.tag){case 5:var d=r.type;return s=s.nodeType!==1||d.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(r.stateNode=s,Gi=r,Bi=es(s.firstChild),!0):!1;case 6:return s=r.pendingProps===""||s.nodeType!==3?null:s,s!==null?(r.stateNode=s,Gi=r,Bi=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(d=Ys!==null?{id:ao,overflow:co}:null,r.memoizedState={dehydrated:s,treeContext:d,retryLane:1073741824},d=or(18,null,null,0),d.stateNode=s,d.return=r,r.child=d,Gi=r,Bi=null,!0):!1;default:return!1}}function Cm(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Am(r){if(zt){var s=Bi;if(s){var d=s;if(!g0(r,s)){if(Cm(r))throw Error(ce(418));s=es(d.nextSibling);var h=Gi;s&&g0(r,s)?rb(h,d):(r.flags=r.flags&-4097|2,zt=!1,Gi=r)}}else{if(Cm(r))throw Error(ce(418));r.flags=r.flags&-4097|2,zt=!1,Gi=r}}}function S0(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Gi=r}function Hu(r){if(r!==Gi)return!1;if(!zt)return S0(r),zt=!0,!1;var s;if((s=r.tag!==3)&&!(s=r.tag!==5)&&(s=r.type,s=s!=="head"&&s!=="body"&&!vm(r.type,r.memoizedProps)),s&&(s=Bi)){if(Cm(r))throw ob(),Error(ce(418));for(;s;)rb(r,s),s=es(s.nextSibling)}if(S0(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ce(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"){if(s===0){Bi=es(r.nextSibling);break e}s--}else d!=="$"&&d!=="$!"&&d!=="$?"||s++}r=r.nextSibling}Bi=null}}else Bi=Gi?es(r.stateNode.nextSibling):null;return!0}function ob(){for(var r=Bi;r;)r=es(r.nextSibling)}function pc(){Bi=Gi=null,zt=!1}function pg(r){Or===null?Or=[r]:Or.push(r)}var O3=_o.ReactCurrentBatchConfig;function Cr(r,s){if(r&&r.defaultProps){s=en({},s),r=r.defaultProps;for(var d in r)s[d]===void 0&&(s[d]=r[d]);return s}return s}var Ih=cs(null),Ch=null,nc=null,fg=null;function _g(){fg=nc=Ch=null}function Eg(r){var s=Ih.current;Ht(Ih),r._currentValue=s}function Om(r,s,d){for(;r!==null;){var h=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,h!==null&&(h.childLanes|=s)):h!==null&&(h.childLanes&s)!==s&&(h.childLanes|=s),r===d)break;r=r.return}}function dc(r,s){Ch=r,fg=nc=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&s&&(yi=!0),r.firstContext=null)}function ar(r){var s=r._currentValue;if(fg!==r)if(r={context:r,memoizedValue:s,next:null},nc===null){if(Ch===null)throw Error(ce(308));nc=r,Ch.dependencies={lanes:0,firstContext:r}}else nc=nc.next=r;return s}var Bs=null;function mg(r){Bs===null?Bs=[r]:Bs.push(r)}function sb(r,s,d,h){var E=s.interleaved;return E===null?(d.next=d,mg(s)):(d.next=E.next,E.next=d),s.interleaved=d,po(r,h)}function po(r,s){r.lanes|=s;var d=r.alternate;for(d!==null&&(d.lanes|=s),d=r,r=r.return;r!==null;)r.childLanes|=s,d=r.alternate,d!==null&&(d.childLanes|=s),d=r,r=r.return;return d.tag===3?d.stateNode:null}var Yo=!1;function gg(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ab(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function lo(r,s){return{eventTime:r,lane:s,tag:0,payload:null,callback:null,next:null}}function ts(r,s,d){var h=r.updateQueue;if(h===null)return null;if(h=h.shared,lt&2){var E=h.pending;return E===null?s.next=s:(s.next=E.next,E.next=s),h.pending=s,po(r,d)}return E=h.interleaved,E===null?(s.next=s,mg(h)):(s.next=E.next,E.next=s),h.interleaved=s,po(r,d)}function nh(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194240)!==0)){var h=s.lanes;h&=r.pendingLanes,d|=h,s.lanes=d,ig(r,d)}}function T0(r,s){var d=r.updateQueue,h=r.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var E=null,T=null;if(d=d.firstBaseUpdate,d!==null){do{var I={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};T===null?E=T=I:T=T.next=I,d=d.next}while(d!==null);T===null?E=T=s:T=T.next=s}else E=T=s;d={baseState:h.baseState,firstBaseUpdate:E,lastBaseUpdate:T,shared:h.shared,effects:h.effects},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}function Ah(r,s,d,h){var E=r.updateQueue;Yo=!1;var T=E.firstBaseUpdate,I=E.lastBaseUpdate,P=E.shared.pending;if(P!==null){E.shared.pending=null;var L=P,V=L.next;L.next=null,I===null?T=V:I.next=V,I=L;var ne=r.alternate;ne!==null&&(ne=ne.updateQueue,P=ne.lastBaseUpdate,P!==I&&(P===null?ne.firstBaseUpdate=V:P.next=V,ne.lastBaseUpdate=L))}if(T!==null){var q=E.baseState;I=0,ne=V=L=null,P=T;do{var z=P.lane,ue=P.eventTime;if((h&z)===z){ne!==null&&(ne=ne.next={eventTime:ue,lane:0,tag:P.tag,payload:P.payload,callback:P.callback,next:null});e:{var $=r,_e=P;switch(z=s,ue=d,_e.tag){case 1:if($=_e.payload,typeof $=="function"){q=$.call(ue,q,z);break e}q=$;break e;case 3:$.flags=$.flags&-65537|128;case 0:if($=_e.payload,z=typeof $=="function"?$.call(ue,q,z):$,z==null)break e;q=en({},q,z);break e;case 2:Yo=!0}}P.callback!==null&&P.lane!==0&&(r.flags|=64,z=E.effects,z===null?E.effects=[P]:z.push(P))}else ue={eventTime:ue,lane:z,tag:P.tag,payload:P.payload,callback:P.callback,next:null},ne===null?(V=ne=ue,L=q):ne=ne.next=ue,I|=z;if(P=P.next,P===null){if(P=E.shared.pending,P===null)break;z=P,P=z.next,z.next=null,E.lastBaseUpdate=z,E.shared.pending=null}}while(1);if(ne===null&&(L=q),E.baseState=L,E.firstBaseUpdate=V,E.lastBaseUpdate=ne,s=E.shared.interleaved,s!==null){E=s;do I|=E.lane,E=E.next;while(E!==s)}else T===null&&(E.shared.lanes=0);qs|=I,r.lanes=I,r.memoizedState=q}}function v0(r,s,d){if(r=s.effects,s.effects=null,r!==null)for(s=0;s<r.length;s++){var h=r[s],E=h.callback;if(E!==null){if(h.callback=null,h=d,typeof E!="function")throw Error(ce(191,E));E.call(h)}}}var cb=new sN.Component().refs;function wm(r,s,d,h){s=r.memoizedState,d=d(h,s),d=d==null?s:en({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var Gh={isMounted:function(r){return(r=r._reactInternals)?Qs(r)===r:!1},enqueueSetState:function(r,s,d){r=r._reactInternals;var h=si(),E=is(r),T=lo(h,E);T.payload=s,d!=null&&(T.callback=d),s=ts(r,T,E),s!==null&&(Nr(s,r,E,h),nh(s,r,E))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var h=si(),E=is(r),T=lo(h,E);T.tag=1,T.payload=s,d!=null&&(T.callback=d),s=ts(r,T,E),s!==null&&(Nr(s,r,E,h),nh(s,r,E))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=si(),h=is(r),E=lo(d,h);E.tag=2,s!=null&&(E.callback=s),s=ts(r,E,h),s!==null&&(Nr(s,r,h,d),nh(s,r,h))}};function R0(r,s,d,h,E,T,I){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(h,T,I):s.prototype&&s.prototype.isPureReactComponent?!Ud(d,h)||!Ud(E,T):!0}function db(r,s,d){var h=!1,E=ss,T=s.contextType;return typeof T=="object"&&T!==null?T=ar(T):(E=Ci(s)?Ks:Zn.current,h=s.contextTypes,T=(h=h!=null)?hc(r,E):ss),s=new s(d,T),r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=Gh,r.stateNode=s,s._reactInternals=r,h&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=E,r.__reactInternalMemoizedMaskedChildContext=T),s}function y0(r,s,d,h){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,h),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,h),s.state!==r&&Gh.enqueueReplaceState(s,s.state,null)}function Nm(r,s,d,h){var E=r.stateNode;E.props=d,E.state=r.memoizedState,E.refs=cb,gg(r);var T=s.contextType;typeof T=="object"&&T!==null?E.context=ar(T):(T=Ci(s)?Ks:Zn.current,E.context=hc(r,T)),E.state=r.memoizedState,T=s.getDerivedStateFromProps,typeof T=="function"&&(wm(r,s,T,d),E.state=r.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(s=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),s!==E.state&&Gh.enqueueReplaceState(E,E.state,null),Ah(r,d,E,h),E.state=r.memoizedState),typeof E.componentDidMount=="function"&&(r.flags|=4194308)}function ld(r,s,d){if(r=d.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(ce(309));var h=d.stateNode}if(!h)throw Error(ce(147,r));var E=h,T=""+r;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===T?s.ref:(s=function(I){var P=E.refs;P===cb&&(P=E.refs={}),I===null?delete P[T]:P[T]=I},s._stringRef=T,s)}if(typeof r!="string")throw Error(ce(284));if(!d._owner)throw Error(ce(290,r))}return r}function Ku(r,s){throw r=Object.prototype.toString.call(s),Error(ce(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r))}function I0(r){var s=r._init;return s(r._payload)}function lb(r){function s(j,U){if(r){var F=j.deletions;F===null?(j.deletions=[U],j.flags|=16):F.push(U)}}function d(j,U){if(!r)return null;for(;U!==null;)s(j,U),U=U.sibling;return null}function h(j,U){for(j=new Map;U!==null;)U.key!==null?j.set(U.key,U):j.set(U.index,U),U=U.sibling;return j}function E(j,U){return j=rs(j,U),j.index=0,j.sibling=null,j}function T(j,U,F){return j.index=F,r?(F=j.alternate,F!==null?(F=F.index,F<U?(j.flags|=2,U):F):(j.flags|=2,U)):(j.flags|=1048576,U)}function I(j){return r&&j.alternate===null&&(j.flags|=2),j}function P(j,U,F,ee){return U===null||U.tag!==6?(U=JE(F,j.mode,ee),U.return=j,U):(U=E(U,F),U.return=j,U)}function L(j,U,F,ee){var le=F.type;return le===qa?ne(j,U,F.props.children,ee,F.key):U!==null&&(U.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===Ko&&I0(le)===U.type)?(ee=E(U,F.props),ee.ref=ld(j,U,F),ee.return=j,ee):(ee=ch(F.type,F.key,F.props,null,j.mode,ee),ee.ref=ld(j,U,F),ee.return=j,ee)}function V(j,U,F,ee){return U===null||U.tag!==4||U.stateNode.containerInfo!==F.containerInfo||U.stateNode.implementation!==F.implementation?(U=XE(F,j.mode,ee),U.return=j,U):(U=E(U,F.children||[]),U.return=j,U)}function ne(j,U,F,ee,le){return U===null||U.tag!==7?(U=Hs(F,j.mode,ee,le),U.return=j,U):(U=E(U,F),U.return=j,U)}function q(j,U,F){if(typeof U=="string"&&U!==""||typeof U=="number")return U=JE(""+U,j.mode,F),U.return=j,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case ku:return F=ch(U.type,U.key,U.props,null,j.mode,F),F.ref=ld(j,null,U),F.return=j,F;case za:return U=XE(U,j.mode,F),U.return=j,U;case Ko:var ee=U._init;return q(j,ee(U._payload),F)}if(_d(U)||od(U))return U=Hs(U,j.mode,F,null),U.return=j,U;Ku(j,U)}return null}function z(j,U,F,ee){var le=U!==null?U.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return le!==null?null:P(j,U,""+F,ee);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case ku:return F.key===le?L(j,U,F,ee):null;case za:return F.key===le?V(j,U,F,ee):null;case Ko:return le=F._init,z(j,U,le(F._payload),ee)}if(_d(F)||od(F))return le!==null?null:ne(j,U,F,ee,null);Ku(j,F)}return null}function ue(j,U,F,ee,le){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return j=j.get(F)||null,P(U,j,""+ee,le);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case ku:return j=j.get(ee.key===null?F:ee.key)||null,L(U,j,ee,le);case za:return j=j.get(ee.key===null?F:ee.key)||null,V(U,j,ee,le);case Ko:var me=ee._init;return ue(j,U,F,me(ee._payload),le)}if(_d(ee)||od(ee))return j=j.get(F)||null,ne(U,j,ee,le,null);Ku(U,ee)}return null}function $(j,U,F,ee){for(var le=null,me=null,Ae=U,Oe=U=0,ct=null;Ae!==null&&Oe<F.length;Oe++){Ae.index>Oe?(ct=Ae,Ae=null):ct=Ae.sibling;var Ze=z(j,Ae,F[Oe],ee);if(Ze===null){Ae===null&&(Ae=ct);break}r&&Ae&&Ze.alternate===null&&s(j,Ae),U=T(Ze,U,Oe),me===null?le=Ze:me.sibling=Ze,me=Ze,Ae=ct}if(Oe===F.length)return d(j,Ae),zt&&Vs(j,Oe),le;if(Ae===null){for(;Oe<F.length;Oe++)Ae=q(j,F[Oe],ee),Ae!==null&&(U=T(Ae,U,Oe),me===null?le=Ae:me.sibling=Ae,me=Ae);return zt&&Vs(j,Oe),le}for(Ae=h(j,Ae);Oe<F.length;Oe++)ct=ue(Ae,j,Oe,F[Oe],ee),ct!==null&&(r&&ct.alternate!==null&&Ae.delete(ct.key===null?Oe:ct.key),U=T(ct,U,Oe),me===null?le=ct:me.sibling=ct,me=ct);return r&&Ae.forEach(function(di){return s(j,di)}),zt&&Vs(j,Oe),le}function _e(j,U,F,ee){var le=od(F);if(typeof le!="function")throw Error(ce(150));if(F=le.call(F),F==null)throw Error(ce(151));for(var me=le=null,Ae=U,Oe=U=0,ct=null,Ze=F.next();Ae!==null&&!Ze.done;Oe++,Ze=F.next()){Ae.index>Oe?(ct=Ae,Ae=null):ct=Ae.sibling;var di=z(j,Ae,Ze.value,ee);if(di===null){Ae===null&&(Ae=ct);break}r&&Ae&&di.alternate===null&&s(j,Ae),U=T(di,U,Oe),me===null?le=di:me.sibling=di,me=di,Ae=ct}if(Ze.done)return d(j,Ae),zt&&Vs(j,Oe),le;if(Ae===null){for(;!Ze.done;Oe++,Ze=F.next())Ze=q(j,Ze.value,ee),Ze!==null&&(U=T(Ze,U,Oe),me===null?le=Ze:me.sibling=Ze,me=Ze);return zt&&Vs(j,Oe),le}for(Ae=h(j,Ae);!Ze.done;Oe++,Ze=F.next())Ze=ue(Ae,j,Oe,Ze.value,ee),Ze!==null&&(r&&Ze.alternate!==null&&Ae.delete(Ze.key===null?Oe:Ze.key),U=T(Ze,U,Oe),me===null?le=Ze:me.sibling=Ze,me=Ze);return r&&Ae.forEach(function(Eo){return s(j,Eo)}),zt&&Vs(j,Oe),le}function pt(j,U,F,ee){if(typeof F=="object"&&F!==null&&F.type===qa&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case ku:e:{for(var le=F.key,me=U;me!==null;){if(me.key===le){if(le=F.type,le===qa){if(me.tag===7){d(j,me.sibling),U=E(me,F.props.children),U.return=j,j=U;break e}}else if(me.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===Ko&&I0(le)===me.type){d(j,me.sibling),U=E(me,F.props),U.ref=ld(j,me,F),U.return=j,j=U;break e}d(j,me);break}else s(j,me);me=me.sibling}F.type===qa?(U=Hs(F.props.children,j.mode,ee,F.key),U.return=j,j=U):(ee=ch(F.type,F.key,F.props,null,j.mode,ee),ee.ref=ld(j,U,F),ee.return=j,j=ee)}return I(j);case za:e:{for(me=F.key;U!==null;){if(U.key===me)if(U.tag===4&&U.stateNode.containerInfo===F.containerInfo&&U.stateNode.implementation===F.implementation){d(j,U.sibling),U=E(U,F.children||[]),U.return=j,j=U;break e}else{d(j,U);break}else s(j,U);U=U.sibling}U=XE(F,j.mode,ee),U.return=j,j=U}return I(j);case Ko:return me=F._init,pt(j,U,me(F._payload),ee)}if(_d(F))return $(j,U,F,ee);if(od(F))return _e(j,U,F,ee);Ku(j,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,U!==null&&U.tag===6?(d(j,U.sibling),U=E(U,F),U.return=j,j=U):(d(j,U),U=JE(F,j.mode,ee),U.return=j,j=U),I(j)):d(j,U)}return pt}var fc=lb(!0),ub=lb(!1),Xd={},Yr=cs(Xd),Fd=cs(Xd),Bd=cs(Xd);function Gs(r){if(r===Xd)throw Error(ce(174));return r}function Sg(r,s){switch(jt(Bd,s),jt(Fd,r),jt(Yr,Xd),r=s.nodeType,r){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:am(null,"");break;default:r=r===8?s.parentNode:s,s=r.namespaceURI||null,r=r.tagName,s=am(s,r)}Ht(Yr),jt(Yr,s)}function _c(){Ht(Yr),Ht(Fd),Ht(Bd)}function hb(r){Gs(Bd.current);var s=Gs(Yr.current),d=am(s,r.type);s!==d&&(jt(Fd,r),jt(Yr,d))}function Tg(r){Fd.current===r&&(Ht(Yr),Ht(Fd))}var $t=cs(0);function Oh(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var WE=[];function vg(){for(var r=0;r<WE.length;r++)WE[r]._workInProgressVersionPrimary=null;WE.length=0}var ih=_o.ReactCurrentDispatcher,HE=_o.ReactCurrentBatchConfig,zs=0,Zt=null,An=null,Ln=null,wh=!1,Cd=!1,Gd=0,w3=0;function Xn(){throw Error(ce(321))}function Rg(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!br(r[d],s[d]))return!1;return!0}function yg(r,s,d,h,E,T){if(zs=T,Zt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,ih.current=r===null||r.memoizedState===null?P3:L3,r=d(h,E),Cd){T=0;do{if(Cd=!1,Gd=0,25<=T)throw Error(ce(301));T+=1,Ln=An=null,s.updateQueue=null,ih.current=k3,r=d(h,E)}while(Cd)}if(ih.current=Nh,s=An!==null&&An.next!==null,zs=0,Ln=An=Zt=null,wh=!1,s)throw Error(ce(300));return r}function Ig(){var r=Gd!==0;return Gd=0,r}function Wr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ln===null?Zt.memoizedState=Ln=r:Ln=Ln.next=r,Ln}function cr(){if(An===null){var r=Zt.alternate;r=r!==null?r.memoizedState:null}else r=An.next;var s=Ln===null?Zt.memoizedState:Ln.next;if(s!==null)Ln=s,An=r;else{if(r===null)throw Error(ce(310));An=r,r={memoizedState:An.memoizedState,baseState:An.baseState,baseQueue:An.baseQueue,queue:An.queue,next:null},Ln===null?Zt.memoizedState=Ln=r:Ln=Ln.next=r}return Ln}function Wd(r,s){return typeof s=="function"?s(r):s}function KE(r){var s=cr(),d=s.queue;if(d===null)throw Error(ce(311));d.lastRenderedReducer=r;var h=An,E=h.baseQueue,T=d.pending;if(T!==null){if(E!==null){var I=E.next;E.next=T.next,T.next=I}h.baseQueue=E=T,d.pending=null}if(E!==null){T=E.next,h=h.baseState;var P=I=null,L=null,V=T;do{var ne=V.lane;if((zs&ne)===ne)L!==null&&(L=L.next={lane:0,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),h=V.hasEagerState?V.eagerState:r(h,V.action);else{var q={lane:ne,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null};L===null?(P=L=q,I=h):L=L.next=q,Zt.lanes|=ne,qs|=ne}V=V.next}while(V!==null&&V!==T);L===null?I=h:L.next=P,br(h,s.memoizedState)||(yi=!0),s.memoizedState=h,s.baseState=I,s.baseQueue=L,d.lastRenderedState=h}if(r=d.interleaved,r!==null){E=r;do T=E.lane,Zt.lanes|=T,qs|=T,E=E.next;while(E!==r)}else E===null&&(d.lanes=0);return[s.memoizedState,d.dispatch]}function YE(r){var s=cr(),d=s.queue;if(d===null)throw Error(ce(311));d.lastRenderedReducer=r;var h=d.dispatch,E=d.pending,T=s.memoizedState;if(E!==null){d.pending=null;var I=E=E.next;do T=r(T,I.action),I=I.next;while(I!==E);br(T,s.memoizedState)||(yi=!0),s.memoizedState=T,s.baseQueue===null&&(s.baseState=T),d.lastRenderedState=T}return[T,h]}function pb(){}function fb(r,s){var d=Zt,h=cr(),E=s(),T=!br(h.memoizedState,E);if(T&&(h.memoizedState=E,yi=!0),h=h.queue,Cg(mb.bind(null,d,h,r),[r]),h.getSnapshot!==s||T||Ln!==null&&Ln.memoizedState.tag&1){if(d.flags|=2048,Hd(9,Eb.bind(null,d,h,E,s),void 0,null),kn===null)throw Error(ce(349));zs&30||_b(d,s,E)}return E}function _b(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=Zt.updateQueue,s===null?(s={lastEffect:null,stores:null},Zt.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function Eb(r,s,d,h){s.value=d,s.getSnapshot=h,gb(s)&&Sb(r)}function mb(r,s,d){return d(function(){gb(s)&&Sb(r)})}function gb(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!br(r,d)}catch{return!0}}function Sb(r){var s=po(r,1);s!==null&&Nr(s,r,1,-1)}function C0(r){var s=Wr();return typeof r=="function"&&(r=r()),s.memoizedState=s.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wd,lastRenderedState:r},s.queue=r,r=r.dispatch=D3.bind(null,Zt,r),[s.memoizedState,r]}function Hd(r,s,d,h){return r={tag:r,create:s,destroy:d,deps:h,next:null},s=Zt.updateQueue,s===null?(s={lastEffect:null,stores:null},Zt.updateQueue=s,s.lastEffect=r.next=r):(d=s.lastEffect,d===null?s.lastEffect=r.next=r:(h=d.next,d.next=r,r.next=h,s.lastEffect=r)),r}function Tb(){return cr().memoizedState}function rh(r,s,d,h){var E=Wr();Zt.flags|=r,E.memoizedState=Hd(1|s,d,void 0,h===void 0?null:h)}function Wh(r,s,d,h){var E=cr();h=h===void 0?null:h;var T=void 0;if(An!==null){var I=An.memoizedState;if(T=I.destroy,h!==null&&Rg(h,I.deps)){E.memoizedState=Hd(s,d,T,h);return}}Zt.flags|=r,E.memoizedState=Hd(1|s,d,T,h)}function A0(r,s){return rh(8390656,8,r,s)}function Cg(r,s){return Wh(2048,8,r,s)}function vb(r,s){return Wh(4,2,r,s)}function Rb(r,s){return Wh(4,4,r,s)}function yb(r,s){if(typeof s=="function")return r=r(),s(r),function(){s(null)};if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function Ib(r,s,d){return d=d!=null?d.concat([r]):null,Wh(4,4,yb.bind(null,s,r),d)}function Ag(){}function Cb(r,s){var d=cr();s=s===void 0?null:s;var h=d.memoizedState;return h!==null&&s!==null&&Rg(s,h[1])?h[0]:(d.memoizedState=[r,s],r)}function Ab(r,s){var d=cr();s=s===void 0?null:s;var h=d.memoizedState;return h!==null&&s!==null&&Rg(s,h[1])?h[0]:(r=r(),d.memoizedState=[r,s],r)}function Ob(r,s,d){return zs&21?(br(d,s)||(d=bN(),Zt.lanes|=d,qs|=d,r.baseState=!0),s):(r.baseState&&(r.baseState=!1,yi=!0),r.memoizedState=d)}function N3(r,s){var d=It;It=d!==0&&4>d?d:4,r(!0);var h=HE.transition;HE.transition={};try{r(!1),s()}finally{It=d,HE.transition=h}}function wb(){return cr().memoizedState}function b3(r,s,d){var h=is(r);if(d={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null},Nb(r))bb(s,d);else if(d=sb(r,s,d,h),d!==null){var E=si();Nr(d,r,h,E),Db(d,s,h)}}function D3(r,s,d){var h=is(r),E={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null};if(Nb(r))bb(s,E);else{var T=r.alternate;if(r.lanes===0&&(T===null||T.lanes===0)&&(T=s.lastRenderedReducer,T!==null))try{var I=s.lastRenderedState,P=T(I,d);if(E.hasEagerState=!0,E.eagerState=P,br(P,I)){var L=s.interleaved;L===null?(E.next=E,mg(s)):(E.next=L.next,L.next=E),s.interleaved=E;return}}catch{}finally{}d=sb(r,s,E,h),d!==null&&(E=si(),Nr(d,r,h,E),Db(d,s,h))}}function Nb(r){var s=r.alternate;return r===Zt||s!==null&&s===Zt}function bb(r,s){Cd=wh=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function Db(r,s,d){if(d&4194240){var h=s.lanes;h&=r.pendingLanes,d|=h,s.lanes=d,ig(r,d)}}var Nh={readContext:ar,useCallback:Xn,useContext:Xn,useEffect:Xn,useImperativeHandle:Xn,useInsertionEffect:Xn,useLayoutEffect:Xn,useMemo:Xn,useReducer:Xn,useRef:Xn,useState:Xn,useDebugValue:Xn,useDeferredValue:Xn,useTransition:Xn,useMutableSource:Xn,useSyncExternalStore:Xn,useId:Xn,unstable_isNewReconciler:!1},P3={readContext:ar,useCallback:function(r,s){return Wr().memoizedState=[r,s===void 0?null:s],r},useContext:ar,useEffect:A0,useImperativeHandle:function(r,s,d){return d=d!=null?d.concat([r]):null,rh(4194308,4,yb.bind(null,s,r),d)},useLayoutEffect:function(r,s){return rh(4194308,4,r,s)},useInsertionEffect:function(r,s){return rh(4,2,r,s)},useMemo:function(r,s){var d=Wr();return s=s===void 0?null:s,r=r(),d.memoizedState=[r,s],r},useReducer:function(r,s,d){var h=Wr();return s=d!==void 0?d(s):s,h.memoizedState=h.baseState=s,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:s},h.queue=r,r=r.dispatch=b3.bind(null,Zt,r),[h.memoizedState,r]},useRef:function(r){var s=Wr();return r={current:r},s.memoizedState=r},useState:C0,useDebugValue:Ag,useDeferredValue:function(r){return Wr().memoizedState=r},useTransition:function(){var r=C0(!1),s=r[0];return r=N3.bind(null,r[1]),Wr().memoizedState=r,[s,r]},useMutableSource:function(){},useSyncExternalStore:function(r,s,d){var h=Zt,E=Wr();if(zt){if(d===void 0)throw Error(ce(407));d=d()}else{if(d=s(),kn===null)throw Error(ce(349));zs&30||_b(h,s,d)}E.memoizedState=d;var T={value:d,getSnapshot:s};return E.queue=T,A0(mb.bind(null,h,T,r),[r]),h.flags|=2048,Hd(9,Eb.bind(null,h,T,d,s),void 0,null),d},useId:function(){var r=Wr(),s=kn.identifierPrefix;if(zt){var d=co,h=ao;d=(h&~(1<<32-wr(h)-1)).toString(32)+d,s=":"+s+"R"+d,d=Gd++,0<d&&(s+="H"+d.toString(32)),s+=":"}else d=w3++,s=":"+s+"r"+d.toString(32)+":";return r.memoizedState=s},unstable_isNewReconciler:!1},L3={readContext:ar,useCallback:Cb,useContext:ar,useEffect:Cg,useImperativeHandle:Ib,useInsertionEffect:vb,useLayoutEffect:Rb,useMemo:Ab,useReducer:KE,useRef:Tb,useState:function(){return KE(Wd)},useDebugValue:Ag,useDeferredValue:function(r){var s=cr();return Ob(s,An.memoizedState,r)},useTransition:function(){var r=KE(Wd)[0],s=cr().memoizedState;return[r,s]},useMutableSource:pb,useSyncExternalStore:fb,useId:wb,unstable_isNewReconciler:!1},k3={readContext:ar,useCallback:Cb,useContext:ar,useEffect:Cg,useImperativeHandle:Ib,useInsertionEffect:vb,useLayoutEffect:Rb,useMemo:Ab,useReducer:YE,useRef:Tb,useState:function(){return YE(Wd)},useDebugValue:Ag,useDeferredValue:function(r){var s=cr();return An===null?s.memoizedState=r:Ob(s,An.memoizedState,r)},useTransition:function(){var r=YE(Wd)[0],s=cr().memoizedState;return[r,s]},useMutableSource:pb,useSyncExternalStore:fb,useId:wb,unstable_isNewReconciler:!1};function Ec(r,s){try{var d="",h=s;do d+=cB(h),h=h.return;while(h);var E=d}catch(T){E=`
Error generating stack: `+T.message+`
`+T.stack}return{value:r,source:s,stack:E,digest:null}}function zE(r,s,d){return{value:r,source:null,stack:d??null,digest:s??null}}function bm(r,s){try{console.error(s.value)}catch(d){setTimeout(function(){throw d})}}var M3=typeof WeakMap=="function"?WeakMap:Map;function Pb(r,s,d){d=lo(-1,d),d.tag=3,d.payload={element:null};var h=s.value;return d.callback=function(){Dh||(Dh=!0,Fm=h),bm(r,s)},d}function Lb(r,s,d){d=lo(-1,d),d.tag=3;var h=r.type.getDerivedStateFromError;if(typeof h=="function"){var E=s.value;d.payload=function(){return h(E)},d.callback=function(){bm(r,s)}}var T=r.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(d.callback=function(){bm(r,s),typeof h!="function"&&(ns===null?ns=new Set([this]):ns.add(this));var I=s.stack;this.componentDidCatch(s.value,{componentStack:I!==null?I:""})}),d}function O0(r,s,d){var h=r.pingCache;if(h===null){h=r.pingCache=new M3;var E=new Set;h.set(s,E)}else E=h.get(s),E===void 0&&(E=new Set,h.set(s,E));E.has(d)||(E.add(d),r=J3.bind(null,r,s,d),s.then(r,r))}function w0(r){do{var s;if((s=r.tag===13)&&(s=r.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return r;r=r.return}while(r!==null);return null}function N0(r,s,d,h,E){return r.mode&1?(r.flags|=65536,r.lanes=E,r):(r===s?r.flags|=65536:(r.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(s=lo(-1,1),s.tag=2,ts(d,s,1))),d.lanes|=1),r)}var U3=_o.ReactCurrentOwner,yi=!1;function oi(r,s,d,h){s.child=r===null?ub(s,null,d,h):fc(s,r.child,d,h)}function b0(r,s,d,h,E){d=d.render;var T=s.ref;return dc(s,E),h=yg(r,s,d,h,T,E),d=Ig(),r!==null&&!yi?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~E,fo(r,s,E)):(zt&&d&&ug(s),s.flags|=1,oi(r,s,h,E),s.child)}function D0(r,s,d,h,E){if(r===null){var T=d.type;return typeof T=="function"&&!kg(T)&&T.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(s.tag=15,s.type=T,kb(r,s,T,h,E)):(r=ch(d.type,null,h,s,s.mode,E),r.ref=s.ref,r.return=s,s.child=r)}if(T=r.child,!(r.lanes&E)){var I=T.memoizedProps;if(d=d.compare,d=d!==null?d:Ud,d(I,h)&&r.ref===s.ref)return fo(r,s,E)}return s.flags|=1,r=rs(T,h),r.ref=s.ref,r.return=s,s.child=r}function kb(r,s,d,h,E){if(r!==null){var T=r.memoizedProps;if(Ud(T,h)&&r.ref===s.ref)if(yi=!1,s.pendingProps=h=T,(r.lanes&E)!==0)r.flags&131072&&(yi=!0);else return s.lanes=r.lanes,fo(r,s,E)}return Dm(r,s,d,h,E)}function Mb(r,s,d){var h=s.pendingProps,E=h.children,T=r!==null?r.memoizedState:null;if(h.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},jt(rc,Fi),Fi|=d;else{if(!(d&1073741824))return r=T!==null?T.baseLanes|d:d,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:r,cachePool:null,transitions:null},s.updateQueue=null,jt(rc,Fi),Fi|=r,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=T!==null?T.baseLanes:d,jt(rc,Fi),Fi|=h}else T!==null?(h=T.baseLanes|d,s.memoizedState=null):h=d,jt(rc,Fi),Fi|=h;return oi(r,s,E,d),s.child}function Ub(r,s){var d=s.ref;(r===null&&d!==null||r!==null&&r.ref!==d)&&(s.flags|=512,s.flags|=2097152)}function Dm(r,s,d,h,E){var T=Ci(d)?Ks:Zn.current;return T=hc(s,T),dc(s,E),d=yg(r,s,d,h,T,E),h=Ig(),r!==null&&!yi?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~E,fo(r,s,E)):(zt&&h&&ug(s),s.flags|=1,oi(r,s,d,E),s.child)}function P0(r,s,d,h,E){if(Ci(d)){var T=!0;vh(s)}else T=!1;if(dc(s,E),s.stateNode===null)oh(r,s),db(s,d,h),Nm(s,d,h,E),h=!0;else if(r===null){var I=s.stateNode,P=s.memoizedProps;I.props=P;var L=I.context,V=d.contextType;typeof V=="object"&&V!==null?V=ar(V):(V=Ci(d)?Ks:Zn.current,V=hc(s,V));var ne=d.getDerivedStateFromProps,q=typeof ne=="function"||typeof I.getSnapshotBeforeUpdate=="function";q||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(P!==h||L!==V)&&y0(s,I,h,V),Yo=!1;var z=s.memoizedState;I.state=z,Ah(s,h,I,E),L=s.memoizedState,P!==h||z!==L||Ii.current||Yo?(typeof ne=="function"&&(wm(s,d,ne,h),L=s.memoizedState),(P=Yo||R0(s,d,P,h,z,L,V))?(q||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(s.flags|=4194308)):(typeof I.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=h,s.memoizedState=L),I.props=h,I.state=L,I.context=V,h=P):(typeof I.componentDidMount=="function"&&(s.flags|=4194308),h=!1)}else{I=s.stateNode,ab(r,s),P=s.memoizedProps,V=s.type===s.elementType?P:Cr(s.type,P),I.props=V,q=s.pendingProps,z=I.context,L=d.contextType,typeof L=="object"&&L!==null?L=ar(L):(L=Ci(d)?Ks:Zn.current,L=hc(s,L));var ue=d.getDerivedStateFromProps;(ne=typeof ue=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(P!==q||z!==L)&&y0(s,I,h,L),Yo=!1,z=s.memoizedState,I.state=z,Ah(s,h,I,E);var $=s.memoizedState;P!==q||z!==$||Ii.current||Yo?(typeof ue=="function"&&(wm(s,d,ue,h),$=s.memoizedState),(V=Yo||R0(s,d,V,h,z,$,L)||!1)?(ne||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(h,$,L),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(h,$,L)),typeof I.componentDidUpdate=="function"&&(s.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof I.componentDidUpdate!="function"||P===r.memoizedProps&&z===r.memoizedState||(s.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||P===r.memoizedProps&&z===r.memoizedState||(s.flags|=1024),s.memoizedProps=h,s.memoizedState=$),I.props=h,I.state=$,I.context=L,h=V):(typeof I.componentDidUpdate!="function"||P===r.memoizedProps&&z===r.memoizedState||(s.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||P===r.memoizedProps&&z===r.memoizedState||(s.flags|=1024),h=!1)}return Pm(r,s,d,h,T,E)}function Pm(r,s,d,h,E,T){Ub(r,s);var I=(s.flags&128)!==0;if(!h&&!I)return E&&m0(s,d,!1),fo(r,s,T);h=s.stateNode,U3.current=s;var P=I&&typeof d.getDerivedStateFromError!="function"?null:h.render();return s.flags|=1,r!==null&&I?(s.child=fc(s,r.child,null,T),s.child=fc(s,null,P,T)):oi(r,s,P,T),s.memoizedState=h.state,E&&m0(s,d,!0),s.child}function xb(r){var s=r.stateNode;s.pendingContext?E0(r,s.pendingContext,s.pendingContext!==s.context):s.context&&E0(r,s.context,!1),Sg(r,s.containerInfo)}function L0(r,s,d,h,E){return pc(),pg(E),s.flags|=256,oi(r,s,d,h),s.child}var Lm={dehydrated:null,treeContext:null,retryLane:0};function km(r){return{baseLanes:r,cachePool:null,transitions:null}}function Vb(r,s,d){var h=s.pendingProps,E=$t.current,T=!1,I=(s.flags&128)!==0,P;if((P=I)||(P=r!==null&&r.memoizedState===null?!1:(E&2)!==0),P?(T=!0,s.flags&=-129):(r===null||r.memoizedState!==null)&&(E|=1),jt($t,E&1),r===null)return Am(s),r=s.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(s.mode&1?r.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(I=h.children,r=h.fallback,T?(h=s.mode,T=s.child,I={mode:"hidden",children:I},!(h&1)&&T!==null?(T.childLanes=0,T.pendingProps=I):T=Yh(I,h,0,null),r=Hs(r,h,d,null),T.return=s,r.return=s,T.sibling=r,s.child=T,s.child.memoizedState=km(d),s.memoizedState=Lm,r):Og(s,I));if(E=r.memoizedState,E!==null&&(P=E.dehydrated,P!==null))return x3(r,s,I,h,P,E,d);if(T){T=h.fallback,I=s.mode,E=r.child,P=E.sibling;var L={mode:"hidden",children:h.children};return!(I&1)&&s.child!==E?(h=s.child,h.childLanes=0,h.pendingProps=L,s.deletions=null):(h=rs(E,L),h.subtreeFlags=E.subtreeFlags&14680064),P!==null?T=rs(P,T):(T=Hs(T,I,d,null),T.flags|=2),T.return=s,h.return=s,h.sibling=T,s.child=h,h=T,T=s.child,I=r.child.memoizedState,I=I===null?km(d):{baseLanes:I.baseLanes|d,cachePool:null,transitions:I.transitions},T.memoizedState=I,T.childLanes=r.childLanes&~d,s.memoizedState=Lm,h}return T=r.child,r=T.sibling,h=rs(T,{mode:"visible",children:h.children}),!(s.mode&1)&&(h.lanes=d),h.return=s,h.sibling=null,r!==null&&(d=s.deletions,d===null?(s.deletions=[r],s.flags|=16):d.push(r)),s.child=h,s.memoizedState=null,h}function Og(r,s){return s=Yh({mode:"visible",children:s},r.mode,0,null),s.return=r,r.child=s}function Yu(r,s,d,h){return h!==null&&pg(h),fc(s,r.child,null,d),r=Og(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function x3(r,s,d,h,E,T,I){if(d)return s.flags&256?(s.flags&=-257,h=zE(Error(ce(422))),Yu(r,s,I,h)):s.memoizedState!==null?(s.child=r.child,s.flags|=128,null):(T=h.fallback,E=s.mode,h=Yh({mode:"visible",children:h.children},E,0,null),T=Hs(T,E,I,null),T.flags|=2,h.return=s,T.return=s,h.sibling=T,s.child=h,s.mode&1&&fc(s,r.child,null,I),s.child.memoizedState=km(I),s.memoizedState=Lm,T);if(!(s.mode&1))return Yu(r,s,I,null);if(E.data==="$!"){if(h=E.nextSibling&&E.nextSibling.dataset,h)var P=h.dgst;return h=P,T=Error(ce(419)),h=zE(T,h,void 0),Yu(r,s,I,h)}if(P=(I&r.childLanes)!==0,yi||P){if(h=kn,h!==null){switch(I&-I){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=E&(h.suspendedLanes|I)?0:E,E!==0&&E!==T.retryLane&&(T.retryLane=E,po(r,E),Nr(h,r,E,-1))}return Lg(),h=zE(Error(ce(421))),Yu(r,s,I,h)}return E.data==="$?"?(s.flags|=128,s.child=r.child,s=X3.bind(null,r),E._reactRetry=s,null):(r=T.treeContext,Bi=es(E.nextSibling),Gi=s,zt=!0,Or=null,r!==null&&(ir[rr++]=ao,ir[rr++]=co,ir[rr++]=Ys,ao=r.id,co=r.overflow,Ys=s),s=Og(s,h.children),s.flags|=4096,s)}function k0(r,s,d){r.lanes|=s;var h=r.alternate;h!==null&&(h.lanes|=s),Om(r.return,s,d)}function qE(r,s,d,h,E){var T=r.memoizedState;T===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:E}:(T.isBackwards=s,T.rendering=null,T.renderingStartTime=0,T.last=h,T.tail=d,T.tailMode=E)}function jb(r,s,d){var h=s.pendingProps,E=h.revealOrder,T=h.tail;if(oi(r,s,h.children,d),h=$t.current,h&2)h=h&1|2,s.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&k0(r,d,s);else if(r.tag===19)k0(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}h&=1}if(jt($t,h),!(s.mode&1))s.memoizedState=null;else switch(E){case"forwards":for(d=s.child,E=null;d!==null;)r=d.alternate,r!==null&&Oh(r)===null&&(E=d),d=d.sibling;d=E,d===null?(E=s.child,s.child=null):(E=d.sibling,d.sibling=null),qE(s,!1,E,d,T);break;case"backwards":for(d=null,E=s.child,s.child=null;E!==null;){if(r=E.alternate,r!==null&&Oh(r)===null){s.child=E;break}r=E.sibling,E.sibling=d,d=E,E=r}qE(s,!0,d,null,T);break;case"together":qE(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function oh(r,s){!(s.mode&1)&&r!==null&&(r.alternate=null,s.alternate=null,s.flags|=2)}function fo(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),qs|=s.lanes,!(d&s.childLanes))return null;if(r!==null&&s.child!==r.child)throw Error(ce(153));if(s.child!==null){for(r=s.child,d=rs(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=rs(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function V3(r,s,d){switch(s.tag){case 3:xb(s),pc();break;case 5:hb(s);break;case 1:Ci(s.type)&&vh(s);break;case 4:Sg(s,s.stateNode.containerInfo);break;case 10:var h=s.type._context,E=s.memoizedProps.value;jt(Ih,h._currentValue),h._currentValue=E;break;case 13:if(h=s.memoizedState,h!==null)return h.dehydrated!==null?(jt($t,$t.current&1),s.flags|=128,null):d&s.child.childLanes?Vb(r,s,d):(jt($t,$t.current&1),r=fo(r,s,d),r!==null?r.sibling:null);jt($t,$t.current&1);break;case 19:if(h=(d&s.childLanes)!==0,r.flags&128){if(h)return jb(r,s,d);s.flags|=128}if(E=s.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),jt($t,$t.current),h)break;return null;case 22:case 23:return s.lanes=0,Mb(r,s,d)}return fo(r,s,d)}var Fb,Mm,Bb,Gb;Fb=function(r,s){for(var d=s.child;d!==null;){if(d.tag===5||d.tag===6)r.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break;for(;d.sibling===null;){if(d.return===null||d.return===s)return;d=d.return}d.sibling.return=d.return,d=d.sibling}};Mm=function(){};Bb=function(r,s,d,h){var E=r.memoizedProps;if(E!==h){r=s.stateNode,Gs(Yr.current);var T=null;switch(d){case"input":E=im(r,E),h=im(r,h),T=[];break;case"select":E=en({},E,{value:void 0}),h=en({},h,{value:void 0}),T=[];break;case"textarea":E=sm(r,E),h=sm(r,h),T=[];break;default:typeof E.onClick!="function"&&typeof h.onClick=="function"&&(r.onclick=Sh)}cm(d,h);var I;d=null;for(V in E)if(!h.hasOwnProperty(V)&&E.hasOwnProperty(V)&&E[V]!=null)if(V==="style"){var P=E[V];for(I in P)P.hasOwnProperty(I)&&(d||(d={}),d[I]="")}else V!=="dangerouslySetInnerHTML"&&V!=="children"&&V!=="suppressContentEditableWarning"&&V!=="suppressHydrationWarning"&&V!=="autoFocus"&&(Nd.hasOwnProperty(V)?T||(T=[]):(T=T||[]).push(V,null));for(V in h){var L=h[V];if(P=E!=null?E[V]:void 0,h.hasOwnProperty(V)&&L!==P&&(L!=null||P!=null))if(V==="style")if(P){for(I in P)!P.hasOwnProperty(I)||L&&L.hasOwnProperty(I)||(d||(d={}),d[I]="");for(I in L)L.hasOwnProperty(I)&&P[I]!==L[I]&&(d||(d={}),d[I]=L[I])}else d||(T||(T=[]),T.push(V,d)),d=L;else V==="dangerouslySetInnerHTML"?(L=L?L.__html:void 0,P=P?P.__html:void 0,L!=null&&P!==L&&(T=T||[]).push(V,L)):V==="children"?typeof L!="string"&&typeof L!="number"||(T=T||[]).push(V,""+L):V!=="suppressContentEditableWarning"&&V!=="suppressHydrationWarning"&&(Nd.hasOwnProperty(V)?(L!=null&&V==="onScroll"&&Wt("scroll",r),T||P===L||(T=[])):(T=T||[]).push(V,L))}d&&(T=T||[]).push("style",d);var V=T;(s.updateQueue=V)&&(s.flags|=4)}};Gb=function(r,s,d,h){d!==h&&(s.flags|=4)};function ud(r,s){if(!zt)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:h.sibling=null}}function Qn(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,h=0;if(s)for(var E=r.child;E!==null;)d|=E.lanes|E.childLanes,h|=E.subtreeFlags&14680064,h|=E.flags&14680064,E.return=r,E=E.sibling;else for(E=r.child;E!==null;)d|=E.lanes|E.childLanes,h|=E.subtreeFlags,h|=E.flags,E.return=r,E=E.sibling;return r.subtreeFlags|=h,r.childLanes=d,s}function j3(r,s,d){var h=s.pendingProps;switch(hg(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qn(s),null;case 1:return Ci(s.type)&&Th(),Qn(s),null;case 3:return h=s.stateNode,_c(),Ht(Ii),Ht(Zn),vg(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(r===null||r.child===null)&&(Hu(s)?s.flags|=4:r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Or!==null&&(Wm(Or),Or=null))),Mm(r,s),Qn(s),null;case 5:Tg(s);var E=Gs(Bd.current);if(d=s.type,r!==null&&s.stateNode!=null)Bb(r,s,d,h,E),r.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!h){if(s.stateNode===null)throw Error(ce(166));return Qn(s),null}if(r=Gs(Yr.current),Hu(s)){h=s.stateNode,d=s.type;var T=s.memoizedProps;switch(h[Hr]=s,h[jd]=T,r=(s.mode&1)!==0,d){case"dialog":Wt("cancel",h),Wt("close",h);break;case"iframe":case"object":case"embed":Wt("load",h);break;case"video":case"audio":for(E=0;E<md.length;E++)Wt(md[E],h);break;case"source":Wt("error",h);break;case"img":case"image":case"link":Wt("error",h),Wt("load",h);break;case"details":Wt("toggle",h);break;case"input":Ww(h,T),Wt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!T.multiple},Wt("invalid",h);break;case"textarea":Kw(h,T),Wt("invalid",h)}cm(d,T),E=null;for(var I in T)if(T.hasOwnProperty(I)){var P=T[I];I==="children"?typeof P=="string"?h.textContent!==P&&(T.suppressHydrationWarning!==!0&&Wu(h.textContent,P,r),E=["children",P]):typeof P=="number"&&h.textContent!==""+P&&(T.suppressHydrationWarning!==!0&&Wu(h.textContent,P,r),E=["children",""+P]):Nd.hasOwnProperty(I)&&P!=null&&I==="onScroll"&&Wt("scroll",h)}switch(d){case"input":Mu(h),Hw(h,T,!0);break;case"textarea":Mu(h),Yw(h);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(h.onclick=Sh)}h=E,s.updateQueue=h,h!==null&&(s.flags|=4)}else{I=E.nodeType===9?E:E.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=_N(d)),r==="http://www.w3.org/1999/xhtml"?d==="script"?(r=I.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof h.is=="string"?r=I.createElement(d,{is:h.is}):(r=I.createElement(d),d==="select"&&(I=r,h.multiple?I.multiple=!0:h.size&&(I.size=h.size))):r=I.createElementNS(r,d),r[Hr]=s,r[jd]=h,Fb(r,s,!1,!1),s.stateNode=r;e:{switch(I=dm(d,h),d){case"dialog":Wt("cancel",r),Wt("close",r),E=h;break;case"iframe":case"object":case"embed":Wt("load",r),E=h;break;case"video":case"audio":for(E=0;E<md.length;E++)Wt(md[E],r);E=h;break;case"source":Wt("error",r),E=h;break;case"img":case"image":case"link":Wt("error",r),Wt("load",r),E=h;break;case"details":Wt("toggle",r),E=h;break;case"input":Ww(r,h),E=im(r,h),Wt("invalid",r);break;case"option":E=h;break;case"select":r._wrapperState={wasMultiple:!!h.multiple},E=en({},h,{value:void 0}),Wt("invalid",r);break;case"textarea":Kw(r,h),E=sm(r,h),Wt("invalid",r);break;default:E=h}cm(d,E),P=E;for(T in P)if(P.hasOwnProperty(T)){var L=P[T];T==="style"?gN(r,L):T==="dangerouslySetInnerHTML"?(L=L?L.__html:void 0,L!=null&&EN(r,L)):T==="children"?typeof L=="string"?(d!=="textarea"||L!=="")&&bd(r,L):typeof L=="number"&&bd(r,""+L):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Nd.hasOwnProperty(T)?L!=null&&T==="onScroll"&&Wt("scroll",r):L!=null&&Qm(r,T,L,I))}switch(d){case"input":Mu(r),Hw(r,h,!1);break;case"textarea":Mu(r),Yw(r);break;case"option":h.value!=null&&r.setAttribute("value",""+os(h.value));break;case"select":r.multiple=!!h.multiple,T=h.value,T!=null?oc(r,!!h.multiple,T,!1):h.defaultValue!=null&&oc(r,!!h.multiple,h.defaultValue,!0);break;default:typeof E.onClick=="function"&&(r.onclick=Sh)}switch(d){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Qn(s),null;case 6:if(r&&s.stateNode!=null)Gb(r,s,r.memoizedProps,h);else{if(typeof h!="string"&&s.stateNode===null)throw Error(ce(166));if(d=Gs(Bd.current),Gs(Yr.current),Hu(s)){if(h=s.stateNode,d=s.memoizedProps,h[Hr]=s,(T=h.nodeValue!==d)&&(r=Gi,r!==null))switch(r.tag){case 3:Wu(h.nodeValue,d,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Wu(h.nodeValue,d,(r.mode&1)!==0)}T&&(s.flags|=4)}else h=(d.nodeType===9?d:d.ownerDocument).createTextNode(h),h[Hr]=s,s.stateNode=h}return Qn(s),null;case 13:if(Ht($t),h=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(zt&&Bi!==null&&s.mode&1&&!(s.flags&128))ob(),pc(),s.flags|=98560,T=!1;else if(T=Hu(s),h!==null&&h.dehydrated!==null){if(r===null){if(!T)throw Error(ce(318));if(T=s.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(ce(317));T[Hr]=s}else pc(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Qn(s),T=!1}else Or!==null&&(Wm(Or),Or=null),T=!0;if(!T)return s.flags&65536?s:null}return s.flags&128?(s.lanes=d,s):(h=h!==null,h!==(r!==null&&r.memoizedState!==null)&&h&&(s.child.flags|=8192,s.mode&1&&(r===null||$t.current&1?On===0&&(On=3):Lg())),s.updateQueue!==null&&(s.flags|=4),Qn(s),null);case 4:return _c(),Mm(r,s),r===null&&xd(s.stateNode.containerInfo),Qn(s),null;case 10:return Eg(s.type._context),Qn(s),null;case 17:return Ci(s.type)&&Th(),Qn(s),null;case 19:if(Ht($t),T=s.memoizedState,T===null)return Qn(s),null;if(h=(s.flags&128)!==0,I=T.rendering,I===null)if(h)ud(T,!1);else{if(On!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(I=Oh(r),I!==null){for(s.flags|=128,ud(T,!1),h=I.updateQueue,h!==null&&(s.updateQueue=h,s.flags|=4),s.subtreeFlags=0,h=d,d=s.child;d!==null;)T=d,r=h,T.flags&=14680066,I=T.alternate,I===null?(T.childLanes=0,T.lanes=r,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=I.childLanes,T.lanes=I.lanes,T.child=I.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=I.memoizedProps,T.memoizedState=I.memoizedState,T.updateQueue=I.updateQueue,T.type=I.type,r=I.dependencies,T.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),d=d.sibling;return jt($t,$t.current&1|2),s.child}r=r.sibling}T.tail!==null&&cn()>mc&&(s.flags|=128,h=!0,ud(T,!1),s.lanes=4194304)}else{if(!h)if(r=Oh(I),r!==null){if(s.flags|=128,h=!0,d=r.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),ud(T,!0),T.tail===null&&T.tailMode==="hidden"&&!I.alternate&&!zt)return Qn(s),null}else 2*cn()-T.renderingStartTime>mc&&d!==1073741824&&(s.flags|=128,h=!0,ud(T,!1),s.lanes=4194304);T.isBackwards?(I.sibling=s.child,s.child=I):(d=T.last,d!==null?d.sibling=I:s.child=I,T.last=I)}return T.tail!==null?(s=T.tail,T.rendering=s,T.tail=s.sibling,T.renderingStartTime=cn(),s.sibling=null,d=$t.current,jt($t,h?d&1|2:d&1),s):(Qn(s),null);case 22:case 23:return Pg(),h=s.memoizedState!==null,r!==null&&r.memoizedState!==null!==h&&(s.flags|=8192),h&&s.mode&1?Fi&1073741824&&(Qn(s),s.subtreeFlags&6&&(s.flags|=8192)):Qn(s),null;case 24:return null;case 25:return null}throw Error(ce(156,s.tag))}function F3(r,s){switch(hg(s),s.tag){case 1:return Ci(s.type)&&Th(),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return _c(),Ht(Ii),Ht(Zn),vg(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 5:return Tg(s),null;case 13:if(Ht($t),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(ce(340));pc()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Ht($t),null;case 4:return _c(),null;case 10:return Eg(s.type._context),null;case 22:case 23:return Pg(),null;case 24:return null;default:return null}}var zu=!1,$n=!1,B3=typeof WeakSet=="function"?WeakSet:Set,ye=null;function ic(r,s){var d=r.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(h){tn(r,s,h)}else d.current=null}function Um(r,s,d){try{d()}catch(h){tn(r,s,h)}}var M0=!1;function G3(r,s){if(Sm=Eh,r=YN(),lg(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var E=h.anchorOffset,T=h.focusNode;h=h.focusOffset;try{d.nodeType,T.nodeType}catch{d=null;break e}var I=0,P=-1,L=-1,V=0,ne=0,q=r,z=null;t:for(;;){for(var ue;q!==d||E!==0&&q.nodeType!==3||(P=I+E),q!==T||h!==0&&q.nodeType!==3||(L=I+h),q.nodeType===3&&(I+=q.nodeValue.length),(ue=q.firstChild)!==null;)z=q,q=ue;for(;;){if(q===r)break t;if(z===d&&++V===E&&(P=I),z===T&&++ne===h&&(L=I),(ue=q.nextSibling)!==null)break;q=z,z=q.parentNode}q=ue}d=P===-1||L===-1?null:{start:P,end:L}}else d=null}d=d||{start:0,end:0}}else d=null;for(Tm={focusedElem:r,selectionRange:d},Eh=!1,ye=s;ye!==null;)if(s=ye,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,ye=r;else for(;ye!==null;){s=ye;try{var $=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if($!==null){var _e=$.memoizedProps,pt=$.memoizedState,j=s.stateNode,U=j.getSnapshotBeforeUpdate(s.elementType===s.type?_e:Cr(s.type,_e),pt);j.__reactInternalSnapshotBeforeUpdate=U}break;case 3:var F=s.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ce(163))}}catch(ee){tn(s,s.return,ee)}if(r=s.sibling,r!==null){r.return=s.return,ye=r;break}ye=s.return}return $=M0,M0=!1,$}function Ad(r,s,d){var h=s.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var E=h=h.next;do{if((E.tag&r)===r){var T=E.destroy;E.destroy=void 0,T!==void 0&&Um(s,d,T)}E=E.next}while(E!==h)}}function Hh(r,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var d=s=s.next;do{if((d.tag&r)===r){var h=d.create;d.destroy=h()}d=d.next}while(d!==s)}}function xm(r){var s=r.ref;if(s!==null){var d=r.stateNode;switch(r.tag){case 5:r=d;break;default:r=d}typeof s=="function"?s(r):s.current=r}}function Wb(r){var s=r.alternate;s!==null&&(r.alternate=null,Wb(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&(delete s[Hr],delete s[jd],delete s[ym],delete s[I3],delete s[C3])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function Hb(r){return r.tag===5||r.tag===3||r.tag===4}function U0(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Hb(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Vm(r,s,d){var h=r.tag;if(h===5||h===6)r=r.stateNode,s?d.nodeType===8?d.parentNode.insertBefore(r,s):d.insertBefore(r,s):(d.nodeType===8?(s=d.parentNode,s.insertBefore(r,d)):(s=d,s.appendChild(r)),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=Sh));else if(h!==4&&(r=r.child,r!==null))for(Vm(r,s,d),r=r.sibling;r!==null;)Vm(r,s,d),r=r.sibling}function jm(r,s,d){var h=r.tag;if(h===5||h===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(h!==4&&(r=r.child,r!==null))for(jm(r,s,d),r=r.sibling;r!==null;)jm(r,s,d),r=r.sibling}var Fn=null,Ar=!1;function Ho(r,s,d){for(d=d.child;d!==null;)Kb(r,s,d),d=d.sibling}function Kb(r,s,d){if(Kr&&typeof Kr.onCommitFiberUnmount=="function")try{Kr.onCommitFiberUnmount(Uh,d)}catch{}switch(d.tag){case 5:$n||ic(d,s);case 6:var h=Fn,E=Ar;Fn=null,Ho(r,s,d),Fn=h,Ar=E,Fn!==null&&(Ar?(r=Fn,d=d.stateNode,r.nodeType===8?r.parentNode.removeChild(d):r.removeChild(d)):Fn.removeChild(d.stateNode));break;case 18:Fn!==null&&(Ar?(r=Fn,d=d.stateNode,r.nodeType===8?BE(r.parentNode,d):r.nodeType===1&&BE(r,d),kd(r)):BE(Fn,d.stateNode));break;case 4:h=Fn,E=Ar,Fn=d.stateNode.containerInfo,Ar=!0,Ho(r,s,d),Fn=h,Ar=E;break;case 0:case 11:case 14:case 15:if(!$n&&(h=d.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){E=h=h.next;do{var T=E,I=T.destroy;T=T.tag,I!==void 0&&(T&2||T&4)&&Um(d,s,I),E=E.next}while(E!==h)}Ho(r,s,d);break;case 1:if(!$n&&(ic(d,s),h=d.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=d.memoizedProps,h.state=d.memoizedState,h.componentWillUnmount()}catch(P){tn(d,s,P)}Ho(r,s,d);break;case 21:Ho(r,s,d);break;case 22:d.mode&1?($n=(h=$n)||d.memoizedState!==null,Ho(r,s,d),$n=h):Ho(r,s,d);break;default:Ho(r,s,d)}}function x0(r){var s=r.updateQueue;if(s!==null){r.updateQueue=null;var d=r.stateNode;d===null&&(d=r.stateNode=new B3),s.forEach(function(h){var E=Q3.bind(null,r,h);d.has(h)||(d.add(h),h.then(E,E))})}}function yr(r,s){var d=s.deletions;if(d!==null)for(var h=0;h<d.length;h++){var E=d[h];try{var T=r,I=s,P=I;e:for(;P!==null;){switch(P.tag){case 5:Fn=P.stateNode,Ar=!1;break e;case 3:Fn=P.stateNode.containerInfo,Ar=!0;break e;case 4:Fn=P.stateNode.containerInfo,Ar=!0;break e}P=P.return}if(Fn===null)throw Error(ce(160));Kb(T,I,E),Fn=null,Ar=!1;var L=E.alternate;L!==null&&(L.return=null),E.return=null}catch(V){tn(E,s,V)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)Yb(s,r),s=s.sibling}function Yb(r,s){var d=r.alternate,h=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(yr(s,r),Gr(r),h&4){try{Ad(3,r,r.return),Hh(3,r)}catch(_e){tn(r,r.return,_e)}try{Ad(5,r,r.return)}catch(_e){tn(r,r.return,_e)}}break;case 1:yr(s,r),Gr(r),h&512&&d!==null&&ic(d,d.return);break;case 5:if(yr(s,r),Gr(r),h&512&&d!==null&&ic(d,d.return),r.flags&32){var E=r.stateNode;try{bd(E,"")}catch(_e){tn(r,r.return,_e)}}if(h&4&&(E=r.stateNode,E!=null)){var T=r.memoizedProps,I=d!==null?d.memoizedProps:T,P=r.type,L=r.updateQueue;if(r.updateQueue=null,L!==null)try{P==="input"&&T.type==="radio"&&T.name!=null&&pN(E,T),dm(P,I);var V=dm(P,T);for(I=0;I<L.length;I+=2){var ne=L[I],q=L[I+1];ne==="style"?gN(E,q):ne==="dangerouslySetInnerHTML"?EN(E,q):ne==="children"?bd(E,q):Qm(E,ne,q,V)}switch(P){case"input":rm(E,T);break;case"textarea":fN(E,T);break;case"select":var z=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!T.multiple;var ue=T.value;ue!=null?oc(E,!!T.multiple,ue,!1):z!==!!T.multiple&&(T.defaultValue!=null?oc(E,!!T.multiple,T.defaultValue,!0):oc(E,!!T.multiple,T.multiple?[]:"",!1))}E[jd]=T}catch(_e){tn(r,r.return,_e)}}break;case 6:if(yr(s,r),Gr(r),h&4){if(r.stateNode===null)throw Error(ce(162));E=r.stateNode,T=r.memoizedProps;try{E.nodeValue=T}catch(_e){tn(r,r.return,_e)}}break;case 3:if(yr(s,r),Gr(r),h&4&&d!==null&&d.memoizedState.isDehydrated)try{kd(s.containerInfo)}catch(_e){tn(r,r.return,_e)}break;case 4:yr(s,r),Gr(r);break;case 13:yr(s,r),Gr(r),E=r.child,E.flags&8192&&(T=E.memoizedState!==null,E.stateNode.isHidden=T,!T||E.alternate!==null&&E.alternate.memoizedState!==null||(bg=cn())),h&4&&x0(r);break;case 22:if(ne=d!==null&&d.memoizedState!==null,r.mode&1?($n=(V=$n)||ne,yr(s,r),$n=V):yr(s,r),Gr(r),h&8192){if(V=r.memoizedState!==null,(r.stateNode.isHidden=V)&&!ne&&r.mode&1)for(ye=r,ne=r.child;ne!==null;){for(q=ye=ne;ye!==null;){switch(z=ye,ue=z.child,z.tag){case 0:case 11:case 14:case 15:Ad(4,z,z.return);break;case 1:ic(z,z.return);var $=z.stateNode;if(typeof $.componentWillUnmount=="function"){h=z,d=z.return;try{s=h,$.props=s.memoizedProps,$.state=s.memoizedState,$.componentWillUnmount()}catch(_e){tn(h,d,_e)}}break;case 5:ic(z,z.return);break;case 22:if(z.memoizedState!==null){j0(q);continue}}ue!==null?(ue.return=z,ye=ue):j0(q)}ne=ne.sibling}e:for(ne=null,q=r;;){if(q.tag===5){if(ne===null){ne=q;try{E=q.stateNode,V?(T=E.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(P=q.stateNode,L=q.memoizedProps.style,I=L!=null&&L.hasOwnProperty("display")?L.display:null,P.style.display=mN("display",I))}catch(_e){tn(r,r.return,_e)}}}else if(q.tag===6){if(ne===null)try{q.stateNode.nodeValue=V?"":q.memoizedProps}catch(_e){tn(r,r.return,_e)}}else if((q.tag!==22&&q.tag!==23||q.memoizedState===null||q===r)&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===r)break e;for(;q.sibling===null;){if(q.return===null||q.return===r)break e;ne===q&&(ne=null),q=q.return}ne===q&&(ne=null),q.sibling.return=q.return,q=q.sibling}}break;case 19:yr(s,r),Gr(r),h&4&&x0(r);break;case 21:break;default:yr(s,r),Gr(r)}}function Gr(r){var s=r.flags;if(s&2){try{e:{for(var d=r.return;d!==null;){if(Hb(d)){var h=d;break e}d=d.return}throw Error(ce(160))}switch(h.tag){case 5:var E=h.stateNode;h.flags&32&&(bd(E,""),h.flags&=-33);var T=U0(r);jm(r,T,E);break;case 3:case 4:var I=h.stateNode.containerInfo,P=U0(r);Vm(r,P,I);break;default:throw Error(ce(161))}}catch(L){tn(r,r.return,L)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function W3(r,s,d){ye=r,zb(r)}function zb(r,s,d){for(var h=(r.mode&1)!==0;ye!==null;){var E=ye,T=E.child;if(E.tag===22&&h){var I=E.memoizedState!==null||zu;if(!I){var P=E.alternate,L=P!==null&&P.memoizedState!==null||$n;P=zu;var V=$n;if(zu=I,($n=L)&&!V)for(ye=E;ye!==null;)I=ye,L=I.child,I.tag===22&&I.memoizedState!==null?F0(E):L!==null?(L.return=I,ye=L):F0(E);for(;T!==null;)ye=T,zb(T),T=T.sibling;ye=E,zu=P,$n=V}V0(r)}else E.subtreeFlags&8772&&T!==null?(T.return=E,ye=T):V0(r)}}function V0(r){for(;ye!==null;){var s=ye;if(s.flags&8772){var d=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:$n||Hh(5,s);break;case 1:var h=s.stateNode;if(s.flags&4&&!$n)if(d===null)h.componentDidMount();else{var E=s.elementType===s.type?d.memoizedProps:Cr(s.type,d.memoizedProps);h.componentDidUpdate(E,d.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var T=s.updateQueue;T!==null&&v0(s,T,h);break;case 3:var I=s.updateQueue;if(I!==null){if(d=null,s.child!==null)switch(s.child.tag){case 5:d=s.child.stateNode;break;case 1:d=s.child.stateNode}v0(s,I,d)}break;case 5:var P=s.stateNode;if(d===null&&s.flags&4){d=P;var L=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":L.autoFocus&&d.focus();break;case"img":L.src&&(d.src=L.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var V=s.alternate;if(V!==null){var ne=V.memoizedState;if(ne!==null){var q=ne.dehydrated;q!==null&&kd(q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ce(163))}$n||s.flags&512&&xm(s)}catch(z){tn(s,s.return,z)}}if(s===r){ye=null;break}if(d=s.sibling,d!==null){d.return=s.return,ye=d;break}ye=s.return}}function j0(r){for(;ye!==null;){var s=ye;if(s===r){ye=null;break}var d=s.sibling;if(d!==null){d.return=s.return,ye=d;break}ye=s.return}}function F0(r){for(;ye!==null;){var s=ye;try{switch(s.tag){case 0:case 11:case 15:var d=s.return;try{Hh(4,s)}catch(L){tn(s,d,L)}break;case 1:var h=s.stateNode;if(typeof h.componentDidMount=="function"){var E=s.return;try{h.componentDidMount()}catch(L){tn(s,E,L)}}var T=s.return;try{xm(s)}catch(L){tn(s,T,L)}break;case 5:var I=s.return;try{xm(s)}catch(L){tn(s,I,L)}}}catch(L){tn(s,s.return,L)}if(s===r){ye=null;break}var P=s.sibling;if(P!==null){P.return=s.return,ye=P;break}ye=s.return}}var H3=Math.ceil,bh=_o.ReactCurrentDispatcher,wg=_o.ReactCurrentOwner,sr=_o.ReactCurrentBatchConfig,lt=0,kn=null,vn=null,Bn=0,Fi=0,rc=cs(0),On=0,Kd=null,qs=0,Kh=0,Ng=0,Od=null,Ri=null,bg=0,mc=1/0,oo=null,Dh=!1,Fm=null,ns=null,qu=!1,Xo=null,Ph=0,wd=0,Bm=null,sh=-1,ah=0;function si(){return lt&6?cn():sh!==-1?sh:sh=cn()}function is(r){return r.mode&1?lt&2&&Bn!==0?Bn&-Bn:O3.transition!==null?(ah===0&&(ah=bN()),ah):(r=It,r!==0||(r=window.event,r=r===void 0?16:xN(r.type)),r):1}function Nr(r,s,d,h){if(50<wd)throw wd=0,Bm=null,Error(ce(185));zd(r,d,h),(!(lt&2)||r!==kn)&&(r===kn&&(!(lt&2)&&(Kh|=d),On===4&&qo(r,Bn)),Ai(r,h),d===1&&lt===0&&!(s.mode&1)&&(mc=cn()+500,Bh&&ds()))}function Ai(r,s){var d=r.callbackNode;OB(r,s);var h=_h(r,r===kn?Bn:0);if(h===0)d!==null&&Jw(d),r.callbackNode=null,r.callbackPriority=0;else if(s=h&-h,r.callbackPriority!==s){if(d!=null&&Jw(d),s===1)r.tag===0?A3(B0.bind(null,r)):nb(B0.bind(null,r)),R3(function(){!(lt&6)&&ds()}),d=null;else{switch(DN(h)){case 1:d=ng;break;case 4:d=wN;break;case 16:d=fh;break;case 536870912:d=NN;break;default:d=fh}d=tD(d,qb.bind(null,r))}r.callbackPriority=s,r.callbackNode=d}}function qb(r,s){if(sh=-1,ah=0,lt&6)throw Error(ce(327));var d=r.callbackNode;if(lc()&&r.callbackNode!==d)return null;var h=_h(r,r===kn?Bn:0);if(h===0)return null;if(h&30||h&r.expiredLanes||s)s=Lh(r,h);else{s=h;var E=lt;lt|=2;var T=Xb();(kn!==r||Bn!==s)&&(oo=null,mc=cn()+500,Ws(r,s));do try{z3();break}catch(P){Jb(r,P)}while(1);_g(),bh.current=T,lt=E,vn!==null?s=0:(kn=null,Bn=0,s=On)}if(s!==0){if(s===2&&(E=fm(r),E!==0&&(h=E,s=Gm(r,E))),s===1)throw d=Kd,Ws(r,0),qo(r,h),Ai(r,cn()),d;if(s===6)qo(r,h);else{if(E=r.current.alternate,!(h&30)&&!K3(E)&&(s=Lh(r,h),s===2&&(T=fm(r),T!==0&&(h=T,s=Gm(r,T))),s===1))throw d=Kd,Ws(r,0),qo(r,h),Ai(r,cn()),d;switch(r.finishedWork=E,r.finishedLanes=h,s){case 0:case 1:throw Error(ce(345));case 2:js(r,Ri,oo);break;case 3:if(qo(r,h),(h&130023424)===h&&(s=bg+500-cn(),10<s)){if(_h(r,0)!==0)break;if(E=r.suspendedLanes,(E&h)!==h){si(),r.pingedLanes|=r.suspendedLanes&E;break}r.timeoutHandle=Rm(js.bind(null,r,Ri,oo),s);break}js(r,Ri,oo);break;case 4:if(qo(r,h),(h&4194240)===h)break;for(s=r.eventTimes,E=-1;0<h;){var I=31-wr(h);T=1<<I,I=s[I],I>E&&(E=I),h&=~T}if(h=E,h=cn()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*H3(h/1960))-h,10<h){r.timeoutHandle=Rm(js.bind(null,r,Ri,oo),h);break}js(r,Ri,oo);break;case 5:js(r,Ri,oo);break;default:throw Error(ce(329))}}}return Ai(r,cn()),r.callbackNode===d?qb.bind(null,r):null}function Gm(r,s){var d=Od;return r.current.memoizedState.isDehydrated&&(Ws(r,s).flags|=256),r=Lh(r,s),r!==2&&(s=Ri,Ri=d,s!==null&&Wm(s)),r}function Wm(r){Ri===null?Ri=r:Ri.push.apply(Ri,r)}function K3(r){for(var s=r;;){if(s.flags&16384){var d=s.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var h=0;h<d.length;h++){var E=d[h],T=E.getSnapshot;E=E.value;try{if(!br(T(),E))return!1}catch{return!1}}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function qo(r,s){for(s&=~Ng,s&=~Kh,r.suspendedLanes|=s,r.pingedLanes&=~s,r=r.expirationTimes;0<s;){var d=31-wr(s),h=1<<d;r[d]=-1,s&=~h}}function B0(r){if(lt&6)throw Error(ce(327));lc();var s=_h(r,0);if(!(s&1))return Ai(r,cn()),null;var d=Lh(r,s);if(r.tag!==0&&d===2){var h=fm(r);h!==0&&(s=h,d=Gm(r,h))}if(d===1)throw d=Kd,Ws(r,0),qo(r,s),Ai(r,cn()),d;if(d===6)throw Error(ce(345));return r.finishedWork=r.current.alternate,r.finishedLanes=s,js(r,Ri,oo),Ai(r,cn()),null}function Dg(r,s){var d=lt;lt|=1;try{return r(s)}finally{lt=d,lt===0&&(mc=cn()+500,Bh&&ds())}}function Js(r){Xo!==null&&Xo.tag===0&&!(lt&6)&&lc();var s=lt;lt|=1;var d=sr.transition,h=It;try{if(sr.transition=null,It=1,r)return r()}finally{It=h,sr.transition=d,lt=s,!(lt&6)&&ds()}}function Pg(){Fi=rc.current,Ht(rc)}function Ws(r,s){r.finishedWork=null,r.finishedLanes=0;var d=r.timeoutHandle;if(d!==-1&&(r.timeoutHandle=-1,v3(d)),vn!==null)for(d=vn.return;d!==null;){var h=d;switch(hg(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&Th();break;case 3:_c(),Ht(Ii),Ht(Zn),vg();break;case 5:Tg(h);break;case 4:_c();break;case 13:Ht($t);break;case 19:Ht($t);break;case 10:Eg(h.type._context);break;case 22:case 23:Pg()}d=d.return}if(kn=r,vn=r=rs(r.current,null),Bn=Fi=s,On=0,Kd=null,Ng=Kh=qs=0,Ri=Od=null,Bs!==null){for(s=0;s<Bs.length;s++)if(d=Bs[s],h=d.interleaved,h!==null){d.interleaved=null;var E=h.next,T=d.pending;if(T!==null){var I=T.next;T.next=E,h.next=I}d.pending=h}Bs=null}return r}function Jb(r,s){do{var d=vn;try{if(_g(),ih.current=Nh,wh){for(var h=Zt.memoizedState;h!==null;){var E=h.queue;E!==null&&(E.pending=null),h=h.next}wh=!1}if(zs=0,Ln=An=Zt=null,Cd=!1,Gd=0,wg.current=null,d===null||d.return===null){On=1,Kd=s,vn=null;break}e:{var T=r,I=d.return,P=d,L=s;if(s=Bn,P.flags|=32768,L!==null&&typeof L=="object"&&typeof L.then=="function"){var V=L,ne=P,q=ne.tag;if(!(ne.mode&1)&&(q===0||q===11||q===15)){var z=ne.alternate;z?(ne.updateQueue=z.updateQueue,ne.memoizedState=z.memoizedState,ne.lanes=z.lanes):(ne.updateQueue=null,ne.memoizedState=null)}var ue=w0(I);if(ue!==null){ue.flags&=-257,N0(ue,I,P,T,s),ue.mode&1&&O0(T,V,s),s=ue,L=V;var $=s.updateQueue;if($===null){var _e=new Set;_e.add(L),s.updateQueue=_e}else $.add(L);break e}else{if(!(s&1)){O0(T,V,s),Lg();break e}L=Error(ce(426))}}else if(zt&&P.mode&1){var pt=w0(I);if(pt!==null){!(pt.flags&65536)&&(pt.flags|=256),N0(pt,I,P,T,s),pg(Ec(L,P));break e}}T=L=Ec(L,P),On!==4&&(On=2),Od===null?Od=[T]:Od.push(T),T=I;do{switch(T.tag){case 3:T.flags|=65536,s&=-s,T.lanes|=s;var j=Pb(T,L,s);T0(T,j);break e;case 1:P=L;var U=T.type,F=T.stateNode;if(!(T.flags&128)&&(typeof U.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(ns===null||!ns.has(F)))){T.flags|=65536,s&=-s,T.lanes|=s;var ee=Lb(T,P,s);T0(T,ee);break e}}T=T.return}while(T!==null)}$b(d)}catch(le){s=le,vn===d&&d!==null&&(vn=d=d.return);continue}break}while(1)}function Xb(){var r=bh.current;return bh.current=Nh,r===null?Nh:r}function Lg(){(On===0||On===3||On===2)&&(On=4),kn===null||!(qs&268435455)&&!(Kh&268435455)||qo(kn,Bn)}function Lh(r,s){var d=lt;lt|=2;var h=Xb();(kn!==r||Bn!==s)&&(oo=null,Ws(r,s));do try{Y3();break}catch(E){Jb(r,E)}while(1);if(_g(),lt=d,bh.current=h,vn!==null)throw Error(ce(261));return kn=null,Bn=0,On}function Y3(){for(;vn!==null;)Qb(vn)}function z3(){for(;vn!==null&&!gB();)Qb(vn)}function Qb(r){var s=eD(r.alternate,r,Fi);r.memoizedProps=r.pendingProps,s===null?$b(r):vn=s,wg.current=null}function $b(r){var s=r;do{var d=s.alternate;if(r=s.return,s.flags&32768){if(d=F3(d,s),d!==null){d.flags&=32767,vn=d;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{On=6,vn=null;return}}else if(d=j3(d,s,Fi),d!==null){vn=d;return}if(s=s.sibling,s!==null){vn=s;return}vn=s=r}while(s!==null);On===0&&(On=5)}function js(r,s,d){var h=It,E=sr.transition;try{sr.transition=null,It=1,q3(r,s,d,h)}finally{sr.transition=E,It=h}return null}function q3(r,s,d,h){do lc();while(Xo!==null);if(lt&6)throw Error(ce(327));d=r.finishedWork;var E=r.finishedLanes;if(d===null)return null;if(r.finishedWork=null,r.finishedLanes=0,d===r.current)throw Error(ce(177));r.callbackNode=null,r.callbackPriority=0;var T=d.lanes|d.childLanes;if(wB(r,T),r===kn&&(vn=kn=null,Bn=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||qu||(qu=!0,tD(fh,function(){return lc(),null})),T=(d.flags&15990)!==0,d.subtreeFlags&15990||T){T=sr.transition,sr.transition=null;var I=It;It=1;var P=lt;lt|=4,wg.current=null,G3(r,d),Yb(d,r),f3(Tm),Eh=!!Sm,Tm=Sm=null,r.current=d,W3(d),SB(),lt=P,It=I,sr.transition=T}else r.current=d;if(qu&&(qu=!1,Xo=r,Ph=E),T=r.pendingLanes,T===0&&(ns=null),RB(d.stateNode),Ai(r,cn()),s!==null)for(h=r.onRecoverableError,d=0;d<s.length;d++)E=s[d],h(E.value,{componentStack:E.stack,digest:E.digest});if(Dh)throw Dh=!1,r=Fm,Fm=null,r;return Ph&1&&r.tag!==0&&lc(),T=r.pendingLanes,T&1?r===Bm?wd++:(wd=0,Bm=r):wd=0,ds(),null}function lc(){if(Xo!==null){var r=DN(Ph),s=sr.transition,d=It;try{if(sr.transition=null,It=16>r?16:r,Xo===null)var h=!1;else{if(r=Xo,Xo=null,Ph=0,lt&6)throw Error(ce(331));var E=lt;for(lt|=4,ye=r.current;ye!==null;){var T=ye,I=T.child;if(ye.flags&16){var P=T.deletions;if(P!==null){for(var L=0;L<P.length;L++){var V=P[L];for(ye=V;ye!==null;){var ne=ye;switch(ne.tag){case 0:case 11:case 15:Ad(8,ne,T)}var q=ne.child;if(q!==null)q.return=ne,ye=q;else for(;ye!==null;){ne=ye;var z=ne.sibling,ue=ne.return;if(Wb(ne),ne===V){ye=null;break}if(z!==null){z.return=ue,ye=z;break}ye=ue}}}var $=T.alternate;if($!==null){var _e=$.child;if(_e!==null){$.child=null;do{var pt=_e.sibling;_e.sibling=null,_e=pt}while(_e!==null)}}ye=T}}if(T.subtreeFlags&2064&&I!==null)I.return=T,ye=I;else e:for(;ye!==null;){if(T=ye,T.flags&2048)switch(T.tag){case 0:case 11:case 15:Ad(9,T,T.return)}var j=T.sibling;if(j!==null){j.return=T.return,ye=j;break e}ye=T.return}}var U=r.current;for(ye=U;ye!==null;){I=ye;var F=I.child;if(I.subtreeFlags&2064&&F!==null)F.return=I,ye=F;else e:for(I=U;ye!==null;){if(P=ye,P.flags&2048)try{switch(P.tag){case 0:case 11:case 15:Hh(9,P)}}catch(le){tn(P,P.return,le)}if(P===I){ye=null;break e}var ee=P.sibling;if(ee!==null){ee.return=P.return,ye=ee;break e}ye=P.return}}if(lt=E,ds(),Kr&&typeof Kr.onPostCommitFiberRoot=="function")try{Kr.onPostCommitFiberRoot(Uh,r)}catch{}h=!0}return h}finally{It=d,sr.transition=s}}return!1}function G0(r,s,d){s=Ec(d,s),s=Pb(r,s,1),r=ts(r,s,1),s=si(),r!==null&&(zd(r,1,s),Ai(r,s))}function tn(r,s,d){if(r.tag===3)G0(r,r,d);else for(;s!==null;){if(s.tag===3){G0(s,r,d);break}else if(s.tag===1){var h=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(ns===null||!ns.has(h))){r=Ec(d,r),r=Lb(s,r,1),s=ts(s,r,1),r=si(),s!==null&&(zd(s,1,r),Ai(s,r));break}}s=s.return}}function J3(r,s,d){var h=r.pingCache;h!==null&&h.delete(s),s=si(),r.pingedLanes|=r.suspendedLanes&d,kn===r&&(Bn&d)===d&&(On===4||On===3&&(Bn&130023424)===Bn&&500>cn()-bg?Ws(r,0):Ng|=d),Ai(r,s)}function Zb(r,s){s===0&&(r.mode&1?(s=Vu,Vu<<=1,!(Vu&130023424)&&(Vu=4194304)):s=1);var d=si();r=po(r,s),r!==null&&(zd(r,s,d),Ai(r,d))}function X3(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),Zb(r,d)}function Q3(r,s){var d=0;switch(r.tag){case 13:var h=r.stateNode,E=r.memoizedState;E!==null&&(d=E.retryLane);break;case 19:h=r.stateNode;break;default:throw Error(ce(314))}h!==null&&h.delete(s),Zb(r,d)}var eD;eD=function(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps||Ii.current)yi=!0;else{if(!(r.lanes&d)&&!(s.flags&128))return yi=!1,V3(r,s,d);yi=!!(r.flags&131072)}else yi=!1,zt&&s.flags&1048576&&ib(s,yh,s.index);switch(s.lanes=0,s.tag){case 2:var h=s.type;oh(r,s),r=s.pendingProps;var E=hc(s,Zn.current);dc(s,d),E=yg(null,s,h,r,E,d);var T=Ig();return s.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Ci(h)?(T=!0,vh(s)):T=!1,s.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,gg(s),E.updater=Gh,s.stateNode=E,E._reactInternals=s,Nm(s,h,r,d),s=Pm(null,s,h,!0,T,d)):(s.tag=0,zt&&T&&ug(s),oi(null,s,E,d),s=s.child),s;case 16:h=s.elementType;e:{switch(oh(r,s),r=s.pendingProps,E=h._init,h=E(h._payload),s.type=h,E=s.tag=Z3(h),r=Cr(h,r),E){case 0:s=Dm(null,s,h,r,d);break e;case 1:s=P0(null,s,h,r,d);break e;case 11:s=b0(null,s,h,r,d);break e;case 14:s=D0(null,s,h,Cr(h.type,r),d);break e}throw Error(ce(306,h,""))}return s;case 0:return h=s.type,E=s.pendingProps,E=s.elementType===h?E:Cr(h,E),Dm(r,s,h,E,d);case 1:return h=s.type,E=s.pendingProps,E=s.elementType===h?E:Cr(h,E),P0(r,s,h,E,d);case 3:e:{if(xb(s),r===null)throw Error(ce(387));h=s.pendingProps,T=s.memoizedState,E=T.element,ab(r,s),Ah(s,h,null,d);var I=s.memoizedState;if(h=I.element,T.isDehydrated)if(T={element:h,isDehydrated:!1,cache:I.cache,pendingSuspenseBoundaries:I.pendingSuspenseBoundaries,transitions:I.transitions},s.updateQueue.baseState=T,s.memoizedState=T,s.flags&256){E=Ec(Error(ce(423)),s),s=L0(r,s,h,d,E);break e}else if(h!==E){E=Ec(Error(ce(424)),s),s=L0(r,s,h,d,E);break e}else for(Bi=es(s.stateNode.containerInfo.firstChild),Gi=s,zt=!0,Or=null,d=ub(s,null,h,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(pc(),h===E){s=fo(r,s,d);break e}oi(r,s,h,d)}s=s.child}return s;case 5:return hb(s),r===null&&Am(s),h=s.type,E=s.pendingProps,T=r!==null?r.memoizedProps:null,I=E.children,vm(h,E)?I=null:T!==null&&vm(h,T)&&(s.flags|=32),Ub(r,s),oi(r,s,I,d),s.child;case 6:return r===null&&Am(s),null;case 13:return Vb(r,s,d);case 4:return Sg(s,s.stateNode.containerInfo),h=s.pendingProps,r===null?s.child=fc(s,null,h,d):oi(r,s,h,d),s.child;case 11:return h=s.type,E=s.pendingProps,E=s.elementType===h?E:Cr(h,E),b0(r,s,h,E,d);case 7:return oi(r,s,s.pendingProps,d),s.child;case 8:return oi(r,s,s.pendingProps.children,d),s.child;case 12:return oi(r,s,s.pendingProps.children,d),s.child;case 10:e:{if(h=s.type._context,E=s.pendingProps,T=s.memoizedProps,I=E.value,jt(Ih,h._currentValue),h._currentValue=I,T!==null)if(br(T.value,I)){if(T.children===E.children&&!Ii.current){s=fo(r,s,d);break e}}else for(T=s.child,T!==null&&(T.return=s);T!==null;){var P=T.dependencies;if(P!==null){I=T.child;for(var L=P.firstContext;L!==null;){if(L.context===h){if(T.tag===1){L=lo(-1,d&-d),L.tag=2;var V=T.updateQueue;if(V!==null){V=V.shared;var ne=V.pending;ne===null?L.next=L:(L.next=ne.next,ne.next=L),V.pending=L}}T.lanes|=d,L=T.alternate,L!==null&&(L.lanes|=d),Om(T.return,d,s),P.lanes|=d;break}L=L.next}}else if(T.tag===10)I=T.type===s.type?null:T.child;else if(T.tag===18){if(I=T.return,I===null)throw Error(ce(341));I.lanes|=d,P=I.alternate,P!==null&&(P.lanes|=d),Om(I,d,s),I=T.sibling}else I=T.child;if(I!==null)I.return=T;else for(I=T;I!==null;){if(I===s){I=null;break}if(T=I.sibling,T!==null){T.return=I.return,I=T;break}I=I.return}T=I}oi(r,s,E.children,d),s=s.child}return s;case 9:return E=s.type,h=s.pendingProps.children,dc(s,d),E=ar(E),h=h(E),s.flags|=1,oi(r,s,h,d),s.child;case 14:return h=s.type,E=Cr(h,s.pendingProps),E=Cr(h.type,E),D0(r,s,h,E,d);case 15:return kb(r,s,s.type,s.pendingProps,d);case 17:return h=s.type,E=s.pendingProps,E=s.elementType===h?E:Cr(h,E),oh(r,s),s.tag=1,Ci(h)?(r=!0,vh(s)):r=!1,dc(s,d),db(s,h,E),Nm(s,h,E,d),Pm(null,s,h,!0,r,d);case 19:return jb(r,s,d);case 22:return Mb(r,s,d)}throw Error(ce(156,s.tag))};function tD(r,s){return ON(r,s)}function $3(r,s,d,h){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function or(r,s,d,h){return new $3(r,s,d,h)}function kg(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Z3(r){if(typeof r=="function")return kg(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Zm)return 11;if(r===eg)return 14}return 2}function rs(r,s){var d=r.alternate;return d===null?(d=or(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&14680064,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d}function ch(r,s,d,h,E,T){var I=2;if(h=r,typeof r=="function")kg(r)&&(I=1);else if(typeof r=="string")I=5;else e:switch(r){case qa:return Hs(d.children,E,T,s);case $m:I=8,E|=8;break;case ZE:return r=or(12,d,s,E|2),r.elementType=ZE,r.lanes=T,r;case em:return r=or(13,d,s,E),r.elementType=em,r.lanes=T,r;case tm:return r=or(19,d,s,E),r.elementType=tm,r.lanes=T,r;case lN:return Yh(d,E,T,s);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case cN:I=10;break e;case dN:I=9;break e;case Zm:I=11;break e;case eg:I=14;break e;case Ko:I=16,h=null;break e}throw Error(ce(130,r==null?r:typeof r,""))}return s=or(I,d,s,E),s.elementType=r,s.type=h,s.lanes=T,s}function Hs(r,s,d,h){return r=or(7,r,h,s),r.lanes=d,r}function Yh(r,s,d,h){return r=or(22,r,h,s),r.elementType=lN,r.lanes=d,r.stateNode={isHidden:!1},r}function JE(r,s,d){return r=or(6,r,null,s),r.lanes=d,r}function XE(r,s,d){return s=or(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}function eG(r,s,d,h,E){this.tag=s,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bE(0),this.expirationTimes=bE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bE(0),this.identifierPrefix=h,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function Mg(r,s,d,h,E,T,I,P,L){return r=new eG(r,s,d,P,L),s===1?(s=1,T===!0&&(s|=8)):s=0,T=or(3,null,null,s),r.current=T,T.stateNode=r,T.memoizedState={element:h,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},gg(T),r}function tG(r,s,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:za,key:h==null?null:""+h,children:r,containerInfo:s,implementation:d}}function nD(r){if(!r)return ss;r=r._reactInternals;e:{if(Qs(r)!==r||r.tag!==1)throw Error(ce(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Ci(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(ce(171))}if(r.tag===1){var d=r.type;if(Ci(d))return tb(r,d,s)}return s}function iD(r,s,d,h,E,T,I,P,L){return r=Mg(d,h,!0,r,E,T,I,P,L),r.context=nD(null),d=r.current,h=si(),E=is(d),T=lo(h,E),T.callback=s??null,ts(d,T,E),r.current.lanes=E,zd(r,E,h),Ai(r,h),r}function zh(r,s,d,h){var E=s.current,T=si(),I=is(E);return d=nD(d),s.context===null?s.context=d:s.pendingContext=d,s=lo(T,I),s.payload={element:r},h=h===void 0?null:h,h!==null&&(s.callback=h),r=ts(E,s,I),r!==null&&(Nr(r,E,I,T),nh(r,E,I)),I}function kh(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function W0(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function Ug(r,s){W0(r,s),(r=r.alternate)&&W0(r,s)}function nG(){return null}var rD=typeof reportError=="function"?reportError:function(r){console.error(r)};function xg(r){this._internalRoot=r}qh.prototype.render=xg.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(ce(409));zh(r,s,null,null)};qh.prototype.unmount=xg.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Js(function(){zh(null,r,null,null)}),s[ho]=null}};function qh(r){this._internalRoot=r}qh.prototype.unstable_scheduleHydration=function(r){if(r){var s=kN();r={blockedOn:null,target:r,priority:s};for(var d=0;d<zo.length&&s!==0&&s<zo[d].priority;d++);zo.splice(d,0,r),d===0&&UN(r)}};function Vg(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Jh(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function H0(){}function iG(r,s,d,h,E){if(E){if(typeof h=="function"){var T=h;h=function(){var V=kh(I);T.call(V)}}var I=iD(s,h,r,0,null,!1,!1,"",H0);return r._reactRootContainer=I,r[ho]=I.current,xd(r.nodeType===8?r.parentNode:r),Js(),I}for(;E=r.lastChild;)r.removeChild(E);if(typeof h=="function"){var P=h;h=function(){var V=kh(L);P.call(V)}}var L=Mg(r,0,!1,null,null,!1,!1,"",H0);return r._reactRootContainer=L,r[ho]=L.current,xd(r.nodeType===8?r.parentNode:r),Js(function(){zh(s,L,d,h)}),L}function Xh(r,s,d,h,E){var T=d._reactRootContainer;if(T){var I=T;if(typeof E=="function"){var P=E;E=function(){var L=kh(I);P.call(L)}}zh(s,I,r,E)}else I=iG(d,s,r,E,h);return kh(I)}PN=function(r){switch(r.tag){case 3:var s=r.stateNode;if(s.current.memoizedState.isDehydrated){var d=Ed(s.pendingLanes);d!==0&&(ig(s,d|1),Ai(s,cn()),!(lt&6)&&(mc=cn()+500,ds()))}break;case 13:Js(function(){var h=po(r,1);if(h!==null){var E=si();Nr(h,r,1,E)}}),Ug(r,1)}};rg=function(r){if(r.tag===13){var s=po(r,134217728);if(s!==null){var d=si();Nr(s,r,134217728,d)}Ug(r,134217728)}};LN=function(r){if(r.tag===13){var s=is(r),d=po(r,s);if(d!==null){var h=si();Nr(d,r,s,h)}Ug(r,s)}};kN=function(){return It};MN=function(r,s){var d=It;try{return It=r,s()}finally{It=d}};um=function(r,s,d){switch(s){case"input":if(rm(r,d),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<d.length;s++){var h=d[s];if(h!==r&&h.form===r.form){var E=Fh(h);if(!E)throw Error(ce(90));hN(h),rm(h,E)}}}break;case"textarea":fN(r,d);break;case"select":s=d.value,s!=null&&oc(r,!!d.multiple,s,!1)}};vN=Dg;RN=Js;var rG={usingClientEntryPoint:!1,Events:[Jd,$a,Fh,SN,TN,Dg]},hd={findFiberByHostInstance:Fs,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},oG={bundleType:hd.bundleType,version:hd.version,rendererPackageName:hd.rendererPackageName,rendererConfig:hd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_o.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=CN(r),r===null?null:r.stateNode},findFiberByHostInstance:hd.findFiberByHostInstance||nG,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ju=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ju.isDisabled&&Ju.supportsFiber)try{Uh=Ju.inject(oG),Kr=Ju}catch{}}Hi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rG;Hi.createPortal=function(r,s){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vg(s))throw Error(ce(200));return tG(r,s,null,d)};Hi.createRoot=function(r,s){if(!Vg(r))throw Error(ce(299));var d=!1,h="",E=rD;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(h=s.identifierPrefix),s.onRecoverableError!==void 0&&(E=s.onRecoverableError)),s=Mg(r,1,!1,null,null,d,!1,h,E),r[ho]=s.current,xd(r.nodeType===8?r.parentNode:r),new xg(s)};Hi.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(ce(188)):(r=Object.keys(r).join(","),Error(ce(268,r)));return r=CN(s),r=r===null?null:r.stateNode,r};Hi.flushSync=function(r){return Js(r)};Hi.hydrate=function(r,s,d){if(!Jh(s))throw Error(ce(200));return Xh(null,r,s,!0,d)};Hi.hydrateRoot=function(r,s,d){if(!Vg(r))throw Error(ce(405));var h=d!=null&&d.hydratedSources||null,E=!1,T="",I=rD;if(d!=null&&(d.unstable_strictMode===!0&&(E=!0),d.identifierPrefix!==void 0&&(T=d.identifierPrefix),d.onRecoverableError!==void 0&&(I=d.onRecoverableError)),s=iD(s,null,r,1,d??null,E,!1,T,I),r[ho]=s.current,xd(r),h)for(r=0;r<h.length;r++)d=h[r],E=d._getVersion,E=E(d._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[d,E]:s.mutableSourceEagerHydrationData.push(d,E);return new qh(s)};Hi.render=function(r,s,d){if(!Jh(s))throw Error(ce(200));return Xh(null,r,s,!1,d)};Hi.unmountComponentAtNode=function(r){if(!Jh(r))throw Error(ce(40));return r._reactRootContainer?(Js(function(){Xh(null,null,r,!1,function(){r._reactRootContainer=null,r[ho]=null})}),!0):!1};Hi.unstable_batchedUpdates=Dg;Hi.unstable_renderSubtreeIntoContainer=function(r,s,d,h){if(!Jh(d))throw Error(ce(200));if(r==null||r._reactInternals===void 0)throw Error(ce(38));return Xh(r,s,d,!1,h)};Hi.version="18.2.0-next-9e3b772b8-20220608";function oD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oD)}catch(r){console.error(r)}}oD(),iN.exports=Hi;var sG=iN.exports,K0=sG;QE.createRoot=K0.createRoot,QE.hydrateRoot=K0.hydrateRoot;var sD={exports:{}};(function(r,s){(function(d,h){r.exports=h()})(IE,function(){function d(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof IE<"u"?IE:typeof self<"u"?self:{},E=function(e){try{return!!e()}catch{return!0}},T=!E(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),I=T,P=Function.prototype,L=P.bind,V=P.call,ne=I&&L.bind(V,V),q=I?function(e){return e&&ne(e)}:function(e){return e&&function(){return V.apply(e,arguments)}},z=q({}.isPrototypeOf),ue=function(e){return e&&e.Math==Math&&e},$=ue(typeof globalThis=="object"&&globalThis)||ue(typeof window=="object"&&window)||ue(typeof self=="object"&&self)||ue(typeof h=="object"&&h)||function(){return this}()||Function("return this")(),_e=T,pt=Function.prototype,j=pt.apply,U=pt.call,F=typeof Reflect=="object"&&Reflect.apply||(_e?U.bind(j):function(){return U.apply(j,arguments)}),ee=function(e){return typeof e=="function"},le={},me=!E(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ae=T,Oe=Function.prototype.call,ct=Ae?Oe.bind(Oe):function(){return Oe.apply(Oe,arguments)},Ze={},di={}.propertyIsEnumerable,Eo=Object.getOwnPropertyDescriptor,ls=Eo&&!di.call({1:2},1);Ze.f=ls?function(e){var t=Eo(this,e);return!!t&&t.enumerable}:di;var dr,$s,lr=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Zs=q,Re=Zs({}.toString),Ge=Zs("".slice),je=function(e){return Ge(Re(e),8,-1)},qt=q,dn=E,ea=je,ur=$.Object,vc=qt("".split),hr=dn(function(){return!ur("z").propertyIsEnumerable(0)})?function(e){return ea(e)=="String"?vc(e,""):ur(e)}:ur,ta=$.TypeError,Qd=function(e){if(e==null)throw ta("Can't call method on "+e);return e},cD=hr,dD=Qd,mo=function(e){return cD(dD(e))},lD=ee,Yi=function(e){return typeof e=="object"?e!==null:lD(e)},go={},Qh=go,$h=$,uD=ee,jg=function(e){return uD(e)?e:void 0},Dr=function(e,t){return arguments.length<2?jg(Qh[e])||jg($h[e]):Qh[e]&&Qh[e][t]||$h[e]&&$h[e][t]},us=Dr("navigator","userAgent")||"",Fg=$,Zh=us,Bg=Fg.process,Gg=Fg.Deno,Wg=Bg&&Bg.versions||Gg&&Gg.version,Hg=Wg&&Wg.v8;Hg&&($s=(dr=Hg.split("."))[0]>0&&dr[0]<4?1:+(dr[0]+dr[1])),!$s&&Zh&&(!(dr=Zh.match(/Edge\/(\d+)/))||dr[1]>=74)&&(dr=Zh.match(/Chrome\/(\d+)/))&&($s=+dr[1]);var na=$s,Kg=na,hD=E,ep=!!Object.getOwnPropertySymbols&&!hD(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Kg&&Kg<41}),Yg=ep&&!Symbol.sham&&typeof Symbol.iterator=="symbol",pD=Dr,fD=ee,_D=z,ED=Yg,mD=$.Object,tp=ED?function(e){return typeof e=="symbol"}:function(e){var t=pD("Symbol");return fD(t)&&_D(t.prototype,mD(e))},gD=$.String,$d=function(e){try{return gD(e)}catch{return"Object"}},SD=ee,TD=$d,vD=$.TypeError,zr=function(e){if(SD(e))return e;throw vD(TD(e)+" is not a function")},RD=zr,np=function(e,t){var n=e[t];return n==null?void 0:RD(n)},ip=ct,rp=ee,op=Yi,yD=$.TypeError,Zd={exports:{}},zg=$,ID=Object.defineProperty,CD=function(e,t){try{ID(zg,e,{value:t,configurable:!0,writable:!0})}catch{zg[e]=t}return t},qg="__core-js_shared__",sp=$[qg]||CD(qg,{}),Jg=sp;(Zd.exports=function(e,t){return Jg[e]||(Jg[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var AD=Qd,OD=$.Object,So=function(e){return OD(AD(e))},wD=So,ND=q({}.hasOwnProperty),ei=Object.hasOwn||function(e,t){return ND(wD(e),t)},bD=q,DD=0,PD=Math.random(),LD=bD(1 .toString),ap=function(e){return"Symbol("+(e===void 0?"":e)+")_"+LD(++DD+PD,36)},kD=$,MD=Zd.exports,Xg=ei,UD=ap,Qg=ep,$g=Yg,Rc=MD("wks"),hs=kD.Symbol,Zg=hs&&hs.for,xD=$g?hs:hs&&hs.withoutSetter||UD,ln=function(e){if(!Xg(Rc,e)||!Qg&&typeof Rc[e]!="string"){var t="Symbol."+e;Qg&&Xg(hs,e)?Rc[e]=hs[e]:Rc[e]=$g&&Zg?Zg(t):xD(t)}return Rc[e]},VD=ct,eS=Yi,tS=tp,jD=np,FD=function(e,t){var n,i;if(t==="string"&&rp(n=e.toString)&&!op(i=ip(n,e))||rp(n=e.valueOf)&&!op(i=ip(n,e))||t!=="string"&&rp(n=e.toString)&&!op(i=ip(n,e)))return i;throw yD("Can't convert object to primitive value")},BD=ln,GD=$.TypeError,WD=BD("toPrimitive"),HD=function(e,t){if(!eS(e)||tS(e))return e;var n,i=jD(e,WD);if(i){if(t===void 0&&(t="default"),n=VD(i,e,t),!eS(n)||tS(n))return n;throw GD("Can't convert object to primitive value")}return t===void 0&&(t="number"),FD(e,t)},KD=tp,el=function(e){var t=HD(e,"string");return KD(t)?t:t+""},nS=Yi,cp=$.document,YD=nS(cp)&&nS(cp.createElement),dp=function(e){return YD?cp.createElement(e):{}},zD=dp,iS=!me&&!E(function(){return Object.defineProperty(zD("div"),"a",{get:function(){return 7}}).a!=7}),qD=me,JD=ct,XD=Ze,QD=lr,$D=mo,ZD=el,eP=ei,tP=iS,rS=Object.getOwnPropertyDescriptor;le.f=qD?rS:function(e,t){if(e=$D(e),t=ZD(t),tP)try{return rS(e,t)}catch{}if(eP(e,t))return QD(!JD(XD.f,e,t),e[t])};var nP=E,iP=ee,rP=/#|\.prototype\./,yc=function(e,t){var n=sP[oP(e)];return n==cP||n!=aP&&(iP(t)?nP(t):!!t)},oP=yc.normalize=function(e){return String(e).replace(rP,".").toLowerCase()},sP=yc.data={},aP=yc.NATIVE="N",cP=yc.POLYFILL="P",oS=yc,dP=zr,lP=T,uP=q(q.bind),Ic=function(e,t){return dP(e),t===void 0?e:lP?uP(e,t):function(){return e.apply(t,arguments)}},pr={},sS=me&&E(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),aS=$,hP=Yi,pP=aS.String,fP=aS.TypeError,fr=function(e){if(hP(e))return e;throw fP(pP(e)+" is not an object")},_P=me,EP=iS,mP=sS,tl=fr,cS=el,gP=$.TypeError,lp=Object.defineProperty,SP=Object.getOwnPropertyDescriptor,TP="enumerable",vP="configurable",RP="writable";pr.f=_P?mP?function(e,t,n){if(tl(e),t=cS(t),tl(n),typeof e=="function"&&t==="prototype"&&"value"in n&&RP in n&&!n.writable){var i=SP(e,t);i&&i.writable&&(e[t]=n.value,n={configurable:vP in n?n.configurable:i.configurable,enumerable:TP in n?n.enumerable:i.enumerable,writable:!1})}return lp(e,t,n)}:lp:function(e,t,n){if(tl(e),t=cS(t),tl(n),EP)try{return lp(e,t,n)}catch{}if("get"in n||"set"in n)throw gP("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var yP=pr,IP=lr,ps=me?function(e,t,n){return yP.f(e,t,IP(1,n))}:function(e,t,n){return e[t]=n,e},nl=$,CP=F,AP=q,OP=ee,wP=le.f,NP=oS,ia=go,bP=Ic,ra=ps,dS=ei,DP=function(e){var t=function(n,i,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,o)}return CP(e,this,arguments)};return t.prototype=e.prototype,t},Mn=function(e,t){var n,i,o,a,c,l,u,f,p=e.target,_=e.global,S=e.stat,R=e.proto,C=_?nl:S?nl[p]:(nl[p]||{}).prototype,A=_?ia:ia[p]||ra(ia,p,{})[p],O=A.prototype;for(o in t)n=!NP(_?o:p+(S?".":"#")+o,e.forced)&&C&&dS(C,o),c=A[o],n&&(l=e.noTargetGet?(f=wP(C,o))&&f.value:C[o]),a=n&&l?l:t[o],n&&typeof c==typeof a||(u=e.bind&&n?bP(a,nl):e.wrap&&n?DP(a):R&&OP(a)?AP(a):a,(e.sham||a&&a.sham||c&&c.sham)&&ra(u,"sham",!0),ra(A,o,u),R&&(dS(ia,i=p+"Prototype")||ra(ia,i,{}),ra(ia[i],o,a),e.real&&O&&!O[o]&&ra(O,o,a)))},PP=Math.ceil,LP=Math.floor,up=function(e){var t=+e;return t!=t||t===0?0:(t>0?LP:PP)(t)},kP=up,MP=Math.min,UP=function(e){return e>0?MP(kP(e),9007199254740991):0},To=function(e){return UP(e.length)},xP=zr,VP=So,jP=hr,FP=To,BP=$.TypeError,lS=function(e){return function(t,n,i,o){xP(n);var a=VP(t),c=jP(a),l=FP(a),u=e?l-1:0,f=e?-1:1;if(i<2)for(;;){if(u in c){o=c[u],u+=f;break}if(u+=f,e?u<0:l<=u)throw BP("Reduce of empty array with no initial value")}for(;e?u>=0:l>u;u+=f)u in c&&(o=n(o,c[u],u,a));return o}},GP={left:lS(!1),right:lS(!0)},WP=E,hp=function(e,t){var n=[][e];return!!n&&WP(function(){n.call(null,t||function(){throw 1},1)})},il=je($.process)=="process",HP=GP.left,uS=na,KP=il;Mn({target:"Array",proto:!0,forced:!hp("reduce")||!KP&&uS>79&&uS<83},{reduce:function(e){var t=arguments.length;return HP(this,e,t,t>1?arguments[1]:void 0)}});var YP=go,vo=function(e){return YP[e+"Prototype"]},zP=vo("Array").reduce,qP=z,JP=zP,pp=Array.prototype,hS=function(e){var t=e.reduce;return e===pp||qP(pp,e)&&t===pp.reduce?JP:t},Ro=hS;let pS=!0,fS=!0;function rl(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function fs(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(c,l){if(c!==t)return o.apply(this,arguments);const u=f=>{const p=n(f);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,u),o.apply(this,[c,u])};const a=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(l))return a.apply(this,arguments);const u=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,u])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function XP(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(pS=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function QP(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(fS=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function _S(){if(typeof window=="object"){if(pS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function fp(e,t){fS&&console.warn(e+" is deprecated, please use "+t+" instead.")}function $P(e){const t={browser:null,version:null};if(e===void 0||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=rl(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=rl(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=rl(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function ES(e){return Object.prototype.toString.call(e)==="[object Object]"}function mS(e){var t;return ES(e)?Ro(t=Object.keys(e)).call(t,function(n,i){const o=ES(e[i]),a=o?mS(e[i]):e[i],c=o&&!Object.keys(a).length;return a===void 0||c?n:Object.assign(n,{[i]:a})},{}):e}function gS(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const a=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&a.push(c)}),a.forEach(c=>{e.forEach(l=>{l.type===i&&l.trackId===c.id&&function u(f,p,_){p&&!_.has(p.id)&&(_.set(p.id,p),Object.keys(p).forEach(S=>{S.endsWith("Id")?u(f,f.get(p[S]),_):S.endsWith("Ids")&&p[S].forEach(R=>{u(f,f.get(R),_)})}))}(e,l,o)})}),o}var ZP=Zd.exports,eL=ap,SS=ZP("keys"),ol=function(e){return SS[e]||(SS[e]=eL(e))},tL=!E(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),nL=$,iL=ei,rL=ee,oL=So,sL=tL,TS=ol("IE_PROTO"),_p=nL.Object,aL=_p.prototype,Ep=sL?_p.getPrototypeOf:function(e){var t=oL(e);if(iL(t,TS))return t[TS];var n=t.constructor;return rL(n)&&t instanceof n?n.prototype:t instanceof _p?aL:null},vS=$,cL=ee,dL=vS.String,lL=vS.TypeError,uL=q,hL=fr,pL=function(e){if(typeof e=="object"||cL(e))return e;throw lL("Can't set "+dL(e)+" as a prototype")},fL=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=uL(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch{}return function(i,o){return hL(i),pL(o),t?e(i,o):i.__proto__=o,i}}():void 0),sl={},_L=up,EL=Math.max,mL=Math.min,mp=function(e,t){var n=_L(e);return n<0?EL(n+t,0):mL(n,t)},gL=mo,SL=mp,TL=To,RS=function(e){return function(t,n,i){var o,a=gL(t),c=TL(a),l=SL(i,c);if(e&&n!=n){for(;c>l;)if((o=a[l++])!=o)return!0}else for(;c>l;l++)if((e||l in a)&&a[l]===n)return e||l||0;return!e&&-1}},vL={includes:RS(!0),indexOf:RS(!1)},al={},gp=ei,RL=mo,yL=vL.indexOf,IL=al,yS=q([].push),IS=function(e,t){var n,i=RL(e),o=0,a=[];for(n in i)!gp(IL,n)&&gp(i,n)&&yS(a,n);for(;t.length>o;)gp(i,n=t[o++])&&(~yL(a,n)||yS(a,n));return a},Sp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],CL=IS,AL=Sp.concat("length","prototype");sl.f=Object.getOwnPropertyNames||function(e){return CL(e,AL)};var Tp={};Tp.f=Object.getOwnPropertySymbols;var OL=Dr,wL=sl,NL=Tp,bL=fr,DL=q([].concat),PL=OL("Reflect","ownKeys")||function(e){var t=wL.f(bL(e)),n=NL.f;return n?DL(t,n(e)):t},CS=ei,LL=PL,kL=le,ML=pr,vp={},UL=IS,xL=Sp,Rp=Object.keys||function(e){return UL(e,xL)},VL=me,jL=sS,FL=pr,BL=fr,GL=mo,WL=Rp;vp.f=VL&&!jL?Object.defineProperties:function(e,t){BL(e);for(var n,i=GL(t),o=WL(t),a=o.length,c=0;a>c;)FL.f(e,n=o[c++],i[n]);return e};var cl,AS=Dr("document","documentElement"),HL=fr,KL=vp,OS=Sp,YL=al,zL=AS,qL=dp,wS=ol("IE_PROTO"),yp=function(){},NS=function(e){return"<script>"+e+"<\/script>"},bS=function(e){e.write(NS("")),e.close();var t=e.parentWindow.Object;return e=null,t},dl=function(){try{cl=new ActiveXObject("htmlfile")}catch{}var e,t;dl=typeof document<"u"?document.domain&&cl?bS(cl):((t=qL("iframe")).style.display="none",zL.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write(NS("document.F=Object")),e.close(),e.F):bS(cl);for(var n=OS.length;n--;)delete dl.prototype[OS[n]];return dl()};YL[wS]=!0;var ll=Object.create||function(e,t){var n;return e!==null?(yp.prototype=HL(e),n=new yp,yp.prototype=null,n[wS]=e):n=dl(),t===void 0?n:KL.f(n,t)},JL=q("".replace),XL=String(Error("zxcasd").stack),DS=/\n\s*at [^:]*:[^\n]*/,QL=DS.test(XL),$L=Yi,ZL=ps,oa={},ek=oa,tk=ln("iterator"),nk=Array.prototype,PS={};PS[ln("toStringTag")]="z";var Ip=String(PS)==="[object z]",ik=$,rk=Ip,ok=ee,ul=je,sk=ln("toStringTag"),ak=ik.Object,ck=ul(function(){return arguments}())=="Arguments",yo=rk?ul:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,a){try{return o[a]}catch{}}(t=ak(e),sk))=="string"?n:ck?ul(t):(i=ul(t))=="Object"&&ok(t.callee)?"Arguments":i},dk=yo,LS=np,lk=oa,uk=ln("iterator"),kS=function(e){if(e!=null)return LS(e,uk)||LS(e,"@@iterator")||lk[dk(e)]},hk=ct,pk=zr,fk=fr,_k=$d,Ek=kS,mk=$.TypeError,gk=ct,MS=fr,Sk=np,Tk=Ic,vk=ct,Rk=fr,yk=$d,Ik=function(e){return e!==void 0&&(ek.Array===e||nk[tk]===e)},Ck=To,US=z,Ak=function(e,t){var n=arguments.length<2?Ek(e):t;if(pk(n))return fk(hk(n,e));throw mk(_k(e)+" is not iterable")},Ok=kS,xS=function(e,t,n){var i,o;MS(e);try{if(!(i=Sk(e,"return"))){if(t==="throw")throw n;return n}i=gk(i,e)}catch(a){o=!0,i=a}if(t==="throw")throw n;if(o)throw i;return MS(i),n},wk=$.TypeError,hl=function(e,t){this.stopped=e,this.result=t},VS=hl.prototype,pl=function(e,t,n){var i,o,a,c,l,u,f,p=n&&n.that,_=!(!n||!n.AS_ENTRIES),S=!(!n||!n.IS_ITERATOR),R=!(!n||!n.INTERRUPTED),C=Tk(t,p),A=function(k){return i&&xS(i,"normal",k),new hl(!0,k)},O=function(k){return _?(Rk(k),R?C(k[0],k[1],A):C(k[0],k[1])):R?C(k,A):C(k)};if(S)i=e;else{if(!(o=Ok(e)))throw wk(yk(e)+" is not iterable");if(Ik(o)){for(a=0,c=Ck(e);c>a;a++)if((l=O(e[a]))&&US(VS,l))return l;return new hl(!1)}i=Ak(e,o)}for(u=i.next;!(f=vk(u,i)).done;){try{l=O(f.value)}catch(k){xS(i,"throw",k)}if(typeof l=="object"&&l&&US(VS,l))return l}return new hl(!1)},Nk=yo,bk=$.String,sa=function(e){if(Nk(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return bk(e)},Dk=sa,Pk=lr,Lk=!E(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Pk(1,7)),e.stack!==7)}),kk=Mn,Mk=$,Uk=z,xk=Ep,fl=fL,Vk=function(e,t,n){for(var i=LL(t),o=ML.f,a=kL.f,c=0;c<i.length;c++){var l=i[c];CS(e,l)||n&&CS(n,l)||o(e,l,a(t,l))}},jS=ll,_l=ps,Cp=lr,jk=function(e,t){if(QL&&typeof e=="string")for(;t--;)e=JL(e,DS,"");return e},Fk=function(e,t){$L(t)&&"cause"in t&&ZL(e,"cause",t.cause)},Bk=pl,Gk=function(e,t){return e===void 0?arguments.length<2?"":t:Dk(e)},Wk=Lk,Hk=ln("toStringTag"),El=Mk.Error,Kk=[].push,Cc=function(e,t){var n,i=arguments.length>2?arguments[2]:void 0,o=Uk(Ap,this);fl?n=fl(new El,o?xk(this):Ap):(n=o?this:jS(Ap),_l(n,Hk,"Error")),t!==void 0&&_l(n,"message",Gk(t)),Wk&&_l(n,"stack",jk(n.stack,1)),Fk(n,i);var a=[];return Bk(e,Kk,{that:a}),_l(n,"errors",a),n};fl?fl(Cc,El):Vk(Cc,El,{name:!0});var Ap=Cc.prototype=jS(El.prototype,{constructor:Cp(1,Cc),message:Cp(1,""),name:Cp(1,"AggregateError")});kk({global:!0},{AggregateError:Cc});var Yk=ee,Op=sp,zk=q(Function.toString);Yk(Op.inspectSource)||(Op.inspectSource=function(e){return zk(e)});var ml,Ac,gl,wp=Op.inspectSource,qk=ee,Jk=wp,FS=$.WeakMap,Xk=qk(FS)&&/native code/.test(Jk(FS)),BS=$,Np=q,Qk=Yi,$k=ps,bp=ei,Dp=sp,Zk=ol,e1=al,GS="Object already initialized",Pp=BS.TypeError,t1=BS.WeakMap;if(Xk||Dp.state){var _s=Dp.state||(Dp.state=new t1),n1=Np(_s.get),WS=Np(_s.has),i1=Np(_s.set);ml=function(e,t){if(WS(_s,e))throw new Pp(GS);return t.facade=e,i1(_s,e,t),t},Ac=function(e){return n1(_s,e)||{}},gl=function(e){return WS(_s,e)}}else{var aa=Zk("state");e1[aa]=!0,ml=function(e,t){if(bp(e,aa))throw new Pp(GS);return t.facade=e,$k(e,aa,t),t},Ac=function(e){return bp(e,aa)?e[aa]:{}},gl=function(e){return bp(e,aa)}}var Es,HS,KS,Sl={set:ml,get:Ac,has:gl,enforce:function(e){return gl(e)?Ac(e):ml(e,{})},getterFor:function(e){return function(t){var n;if(!Qk(t)||(n=Ac(t)).type!==e)throw Pp("Incompatible receiver, "+e+" required");return n}}},Lp=me,r1=ei,YS=Function.prototype,o1=Lp&&Object.getOwnPropertyDescriptor,kp=r1(YS,"name"),zS={EXISTS:kp,PROPER:kp&&(function(){}).name==="something",CONFIGURABLE:kp&&(!Lp||Lp&&o1(YS,"name").configurable)},s1=ps,Tl=function(e,t,n,i){i&&i.enumerable?e[t]=n:s1(e,t,n)},a1=E,c1=ee,d1=ll,qS=Ep,l1=Tl,Mp=ln("iterator"),JS=!1;[].keys&&("next"in(KS=[].keys())?(HS=qS(qS(KS)))!==Object.prototype&&(Es=HS):JS=!0);var u1=Es==null||a1(function(){var e={};return Es[Mp].call(e)!==e});c1((Es=u1?{}:d1(Es))[Mp])||l1(Es,Mp,function(){return this});var XS={IteratorPrototype:Es,BUGGY_SAFARI_ITERATORS:JS},h1=yo,p1=Ip?{}.toString:function(){return"[object "+h1(this)+"]"},f1=Ip,_1=pr.f,E1=ps,m1=ei,g1=p1,QS=ln("toStringTag"),Oc=function(e,t,n,i){if(e){var o=n?e:e.prototype;m1(o,QS)||_1(o,QS,{configurable:!0,value:t}),i&&!f1&&E1(o,"toString",g1)}},S1=XS.IteratorPrototype,T1=ll,v1=lr,R1=Oc,y1=oa,I1=function(){return this},C1=Mn,A1=ct,O1=function(e,t,n,i){var o=t+" Iterator";return e.prototype=T1(S1,{next:v1(+!i,n)}),R1(e,o,!1,!0),y1[o]=I1,e},w1=Ep,N1=Oc,$S=Tl,ZS=oa,b1=zS.PROPER,vl=XS.BUGGY_SAFARI_ITERATORS,Up=ln("iterator"),eT="keys",Rl="values",tT="entries",D1=function(){return this},nT=function(e,t,n,i,o,a,c){O1(n,t,i);var l,u,f,p=function(k){if(k===o&&A)return A;if(!vl&&k in R)return R[k];switch(k){case eT:case Rl:case tT:return function(){return new n(this,k)}}return function(){return new n(this)}},_=t+" Iterator",S=!1,R=e.prototype,C=R[Up]||R["@@iterator"]||o&&R[o],A=!vl&&C||p(o),O=t=="Array"&&R.entries||C;if(O&&(l=w1(O.call(new e)))!==Object.prototype&&l.next&&(N1(l,_,!0,!0),ZS[_]=D1),b1&&o==Rl&&C&&C.name!==Rl&&(S=!0,A=function(){return A1(C,this)}),o)if(u={values:p(Rl),keys:a?A:p(eT),entries:p(tT)},c)for(f in u)(vl||S||!(f in R))&&$S(R,f,u[f]);else C1({target:t,proto:!0,forced:vl||S},u);return c&&R[Up]!==A&&$S(R,Up,A,{name:o}),ZS[t]=A,u},P1=mo,iT=oa,rT=Sl;pr.f;var L1=nT,oT="Array Iterator",k1=rT.set,M1=rT.getterFor(oT);L1(Array,"Array",function(e,t){k1(this,{type:oT,target:P1(e),index:0,kind:t})},function(){var e=M1(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):n=="keys"?{value:i,done:!1}:n=="values"?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}},"values"),iT.Arguments=iT.Array;var sT=$.Promise,U1=Tl,x1=Dr,V1=pr,j1=me,aT=ln("species"),F1=z,B1=$.TypeError,cT=ln("iterator"),dT=!1;try{var G1=0,lT={next:function(){return{done:!!G1++}},return:function(){dT=!0}};lT[cT]=function(){return this},Array.from(lT,function(){throw 2})}catch{}var W1=q,H1=E,uT=ee,K1=yo,Y1=wp,hT=function(){},z1=[],pT=Dr("Reflect","construct"),xp=/^\s*(?:class|function)\b/,q1=W1(xp.exec),J1=!xp.exec(hT),wc=function(e){if(!uT(e))return!1;try{return pT(hT,z1,e),!0}catch{return!1}},fT=function(e){if(!uT(e))return!1;switch(K1(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return J1||!!q1(xp,Y1(e))}catch{return!0}};fT.sham=!0;var Nc,ca,_T,Vp,jp=!pT||H1(function(){var e;return wc(wc.call)||!wc(Object)||!wc(function(){e=!0})||e})?fT:wc,X1=jp,Q1=$d,$1=$.TypeError,ET=fr,Z1=function(e){if(X1(e))return e;throw $1(Q1(e)+" is not a constructor")},eM=ln("species"),mT=function(e,t){var n,i=ET(e).constructor;return i===void 0||(n=ET(i)[eM])==null?t:Z1(n)},Fp=q([].slice),gT=/(?:ipad|iphone|ipod).*applewebkit/i.test(us),Oi=$,tM=F,nM=Ic,ST=ee,iM=ei,rM=E,TT=AS,oM=Fp,vT=dp,sM=gT,aM=il,Bp=Oi.setImmediate,Gp=Oi.clearImmediate,cM=Oi.process,Wp=Oi.Dispatch,dM=Oi.Function,RT=Oi.MessageChannel,lM=Oi.String,Hp=0,bc={},uM="onreadystatechange";try{Nc=Oi.location}catch{}var Kp=function(e){if(iM(bc,e)){var t=bc[e];delete bc[e],t()}},Yp=function(e){return function(){Kp(e)}},yT=function(e){Kp(e.data)},IT=function(e){Oi.postMessage(lM(e),Nc.protocol+"//"+Nc.host)};Bp&&Gp||(Bp=function(e){var t=oM(arguments,1);return bc[++Hp]=function(){tM(ST(e)?e:dM(e),void 0,t)},ca(Hp),Hp},Gp=function(e){delete bc[e]},aM?ca=function(e){cM.nextTick(Yp(e))}:Wp&&Wp.now?ca=function(e){Wp.now(Yp(e))}:RT&&!sM?(Vp=(_T=new RT).port2,_T.port1.onmessage=yT,ca=nM(Vp.postMessage,Vp)):Oi.addEventListener&&ST(Oi.postMessage)&&!Oi.importScripts&&Nc&&Nc.protocol!=="file:"&&!rM(IT)?(ca=IT,Oi.addEventListener("message",yT,!1)):ca=uM in vT("script")?function(e){TT.appendChild(vT("script")).onreadystatechange=function(){TT.removeChild(this),Kp(e)}}:function(e){setTimeout(Yp(e),0)});var Dc,ms,Pc,da,zp,qp,Jp,CT,AT={set:Bp,clear:Gp},hM=$,pM=/ipad|iphone|ipod/i.test(us)&&hM.Pebble!==void 0,fM=/web0s(?!.*chrome)/i.test(us),gs=$,OT=Ic,_M=le.f,Xp=AT.set,EM=gT,mM=pM,gM=fM,Qp=il,wT=gs.MutationObserver||gs.WebKitMutationObserver,NT=gs.document,bT=gs.process,yl=gs.Promise,DT=_M(gs,"queueMicrotask"),PT=DT&&DT.value;PT||(Dc=function(){var e,t;for(Qp&&(e=bT.domain)&&e.exit();ms;){t=ms.fn,ms=ms.next;try{t()}catch(n){throw ms?da():Pc=void 0,n}}Pc=void 0,e&&e.enter()},EM||Qp||gM||!wT||!NT?!mM&&yl&&yl.resolve?((Jp=yl.resolve(void 0)).constructor=yl,CT=OT(Jp.then,Jp),da=function(){CT(Dc)}):Qp?da=function(){bT.nextTick(Dc)}:(Xp=OT(Xp,gs),da=function(){Xp(Dc)}):(zp=!0,qp=NT.createTextNode(""),new wT(Dc).observe(qp,{characterData:!0}),da=function(){qp.data=zp=!zp}));var SM=PT||function(e){var t={fn:e,next:void 0};Pc&&(Pc.next=t),ms||(ms=t,da()),Pc=t},la={},LT=zr,TM=function(e){var t,n;this.promise=new e(function(i,o){if(t!==void 0||n!==void 0)throw TypeError("Bad Promise constructor");t=i,n=o}),this.resolve=LT(t),this.reject=LT(n)};la.f=function(e){return new TM(e)};var vM=fr,RM=Yi,yM=la,kT=function(e,t){if(vM(e),RM(t)&&t.constructor===e)return t;var n=yM.f(e);return(0,n.resolve)(t),n.promise},IM=$,Il=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},MT=function(){this.head=null,this.tail=null};MT.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var $p,UT,Zp,CM=typeof window=="object",Cl=Mn,qr=$,AM=Dr,Io=ct,ef=sT,OM=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:U1(e,i,t[i],n);return e},wM=Oc,NM=function(e){var t=x1(e),n=V1.f;j1&&t&&!t[aT]&&n(t,aT,{configurable:!0,get:function(){return this}})},tf=zr,Al=ee,bM=Yi,DM=function(e,t){if(F1(t,e))return e;throw B1("Incorrect invocation")},PM=wp,xT=pl,LM=function(e,t){if(!t&&!dT)return!1;var n=!1;try{var i={};i[cT]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},kM=mT,VT=AT.set,nf=SM,MM=kT,UM=function(e,t){var n=IM.console;n&&n.error&&(arguments.length==1?n.error(e):n.error(e,t))},jT=la,rf=Il,xM=MT,of=Sl,VM=oS,jM=CM,Ol=il,FT=na,FM=ln("species"),Pr="Promise",BT=of.getterFor(Pr),BM=of.set,GM=of.getterFor(Pr),WM=ef&&ef.prototype,Lr=ef,wl=WM,GT=qr.TypeError,sf=qr.document,af=qr.process,ua=jT.f,HM=ua,KM=!!(sf&&sf.createEvent&&qr.dispatchEvent),WT=Al(qr.PromiseRejectionEvent),HT="unhandledrejection",Nl=VM(Pr,function(){var e=PM(Lr),t=e!==String(Lr);if(!t&&FT===66||!wl.finally)return!0;if(FT>=51&&/native code/.test(e))return!1;var n=new Lr(function(o){o(1)}),i=function(o){o(function(){},function(){})};return(n.constructor={})[FM]=i,!(n.then(function(){})instanceof i)||!t&&jM&&!WT}),YM=Nl||!LM(function(e){Lr.all(e).catch(function(){})}),KT=function(e){var t;return!(!bM(e)||!Al(t=e.then))&&t},YT=function(e,t){var n,i,o,a=t.value,c=t.state==1,l=c?e.ok:e.fail,u=e.resolve,f=e.reject,p=e.domain;try{l?(c||(t.rejection===2&&qM(t),t.rejection=1),l===!0?n=a:(p&&p.enter(),n=l(a),p&&(p.exit(),o=!0)),n===e.promise?f(GT("Promise-chain cycle")):(i=KT(n))?Io(i,n,u,f):u(n)):f(a)}catch(_){p&&!o&&p.exit(),f(_)}},zT=function(e,t){e.notified||(e.notified=!0,nf(function(){for(var n,i=e.reactions;n=i.get();)YT(n,e);e.notified=!1,t&&!e.rejection&&zM(e)}))},qT=function(e,t,n){var i,o;KM?((i=sf.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),qr.dispatchEvent(i)):i={promise:t,reason:n},!WT&&(o=qr["on"+e])?o(i):e===HT&&UM("Unhandled promise rejection",n)},zM=function(e){Io(VT,qr,function(){var t,n=e.facade,i=e.value;if(JT(e)&&(t=rf(function(){Ol?af.emit("unhandledRejection",i,n):qT(HT,n,i)}),e.rejection=Ol||JT(e)?2:1,t.error))throw t.value})},JT=function(e){return e.rejection!==1&&!e.parent},qM=function(e){Io(VT,qr,function(){var t=e.facade;Ol?af.emit("rejectionHandled",t):qT("rejectionhandled",t,e.value)})},ha=function(e,t,n){return function(i){e(t,i,n)}},pa=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,zT(e,!0))},cf=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw GT("Promise can't be resolved itself");var i=KT(t);i?nf(function(){var o={done:!1};try{Io(i,t,ha(cf,o,e),ha(pa,o,e))}catch(a){pa(o,a,e)}}):(e.value=t,e.state=1,zT(e,!1))}catch(o){pa({done:!1},o,e)}}};Nl&&(wl=(Lr=function(e){DM(this,wl),tf(e),Io($p,this);var t=BT(this);try{e(ha(cf,t),ha(pa,t))}catch(n){pa(t,n)}}).prototype,($p=function(e){BM(this,{type:Pr,done:!1,notified:!1,parent:!1,reactions:new xM,rejection:!1,state:0,value:void 0})}).prototype=OM(wl,{then:function(e,t){var n=GM(this),i=ua(kM(this,Lr));return n.parent=!0,i.ok=!Al(e)||e,i.fail=Al(t)&&t,i.domain=Ol?af.domain:void 0,n.state==0?n.reactions.add(i):nf(function(){YT(i,n)}),i.promise},catch:function(e){return this.then(void 0,e)}}),UT=function(){var e=new $p,t=BT(e);this.promise=e,this.resolve=ha(cf,t),this.reject=ha(pa,t)},jT.f=ua=function(e){return e===Lr||e===Zp?new UT(e):HM(e)}),Cl({global:!0,wrap:!0,forced:Nl},{Promise:Lr}),wM(Lr,Pr,!1,!0),NM(Pr),Zp=AM(Pr),Cl({target:Pr,stat:!0,forced:Nl},{reject:function(e){var t=ua(this);return Io(t.reject,void 0,e),t.promise}}),Cl({target:Pr,stat:!0,forced:!0},{resolve:function(e){return MM(this===Zp?Lr:this,e)}}),Cl({target:Pr,stat:!0,forced:YM},{all:function(e){var t=this,n=ua(t),i=n.resolve,o=n.reject,a=rf(function(){var c=tf(t.resolve),l=[],u=0,f=1;xT(e,function(p){var _=u++,S=!1;f++,Io(c,t,p).then(function(R){S||(S=!0,l[_]=R,--f||i(l))},o)}),--f||i(l)});return a.error&&o(a.value),n.promise},race:function(e){var t=this,n=ua(t),i=n.reject,o=rf(function(){var a=tf(t.resolve);xT(e,function(c){Io(a,t,c).then(n.resolve,i)})});return o.error&&i(o.value),n.promise}});var JM=ct,XM=zr,QM=la,$M=Il,ZM=pl;Mn({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=QM.f(t),i=n.resolve,o=n.reject,a=$M(function(){var c=XM(t.resolve),l=[],u=0,f=1;ZM(e,function(p){var _=u++,S=!1;f++,JM(c,t,p).then(function(R){S||(S=!0,l[_]={status:"fulfilled",value:R},--f||i(l))},function(R){S||(S=!0,l[_]={status:"rejected",reason:R},--f||i(l))})}),--f||i(l)});return a.error&&o(a.value),n.promise}});var eU=zr,tU=Dr,nU=ct,iU=la,rU=Il,oU=pl,XT="No one promise resolved";Mn({target:"Promise",stat:!0},{any:function(e){var t=this,n=tU("AggregateError"),i=iU.f(t),o=i.resolve,a=i.reject,c=rU(function(){var l=eU(t.resolve),u=[],f=0,p=1,_=!1;oU(e,function(S){var R=f++,C=!1;p++,nU(l,t,S).then(function(A){C||_||(_=!0,o(A))},function(A){C||_||(C=!0,u[R]=A,--p||a(new n(u,XT)))})}),--p||a(new n(u,XT))});return c.error&&a(c.value),i.promise}});var QT=sT,sU=Dr,aU=ee,cU=mT,$T=kT;Mn({target:"Promise",proto:!0,real:!0,forced:!!QT&&E(function(){QT.prototype.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=cU(this,sU("Promise")),n=aU(e);return this.then(n?function(i){return $T(t,e()).then(function(){return i})}:e,n?function(i){return $T(t,e()).then(function(){throw i})}:e)}});var df=q,dU=up,lU=sa,uU=Qd,hU=df("".charAt),ZT=df("".charCodeAt),pU=df("".slice),ev=function(e){return function(t,n){var i,o,a=lU(uU(t)),c=dU(n),l=a.length;return c<0||c>=l?e?"":void 0:(i=ZT(a,c))<55296||i>56319||c+1===l||(o=ZT(a,c+1))<56320||o>57343?e?hU(a,c):i:e?pU(a,c,c+2):o-56320+(i-55296<<10)+65536}},fU={codeAt:ev(!1),charAt:ev(!0)}.charAt,_U=sa,tv=Sl,EU=nT,nv="String Iterator",mU=tv.set,gU=tv.getterFor(nv);EU(String,"String",function(e){mU(this,{type:nv,string:_U(e),index:0})},function(){var e,t=gU(this),n=t.string,i=t.index;return i>=n.length?{value:void 0,done:!0}:(e=fU(n,i),t.index+=e.length,{value:e,done:!1})});var SU=go.Promise,TU={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},vU=$,RU=yo,yU=ps,iv=oa,rv=ln("toStringTag");for(var lf in TU){var ov=vU[lf],uf=ov&&ov.prototype;uf&&RU(uf)!==rv&&yU(uf,rv,lf),iv[lf]=iv.Array}var sv=SU,ie=sv;const av=_S;function cv(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const f=typeof c[u]=="object"?c[u]:{ideal:c[u]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const p=function(_,S){return _?_+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(f.ideal!==void 0){l.optional=l.optional||[];let _={};typeof f.ideal=="number"?(_[p("min",u)]=f.ideal,l.optional.push(_),_={},_[p("max",u)]=f.ideal,l.optional.push(_)):(_[p("",u)]=f.ideal,l.optional.push(_))}f.exact!==void 0&&typeof f.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",u)]=f.exact):["min","max"].forEach(_=>{f[_]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(_,u)]=f[_])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},o=function(c,l){if(t.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const u=function(f,p,_){p in f&&!(_ in f)&&(f[_]=f[p],delete f[p])};u((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const f=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||f)){let p;if(delete c.video.facingMode,u.exact==="environment"||u.ideal==="environment"?p=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(_=>{let S=(_=_.filter(R=>R.kind==="videoinput")).find(R=>p.some(C=>R.label.toLowerCase().includes(C)));return!S&&_.length&&p.includes("back")&&(S=_[_.length-1]),S&&(c.video.deviceId=u.exact?{exact:S.deviceId}:{ideal:S.deviceId}),c.video=i(c.video),av("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return av("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,u){o(c,f=>{n.webkitGetUserMedia(f,l,p=>{u&&u(a(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return o(l,u=>c(u).then(f=>{if(u.audio&&!f.getAudioTracks().length||u.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return f},f=>ie.reject(a(f))))}}}function dv(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function lv(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else fs(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function uv(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=o.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){let u=o.apply(this,arguments);return u||(u=t(this,c),this._senders.push(u)),u};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){a.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(a=>{const c=this._senders.find(l=>l.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function hv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const a=function(l){const u={};return l.result().forEach(f=>{const p={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(_=>{p[_]=f.stat(_)}),u[p.id]=p}),u},c=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){const l=function(u){i(c(a(u)))};return t.apply(this,[l,n])}return new ie((l,u)=>{t.apply(this,[function(f){l(c(a(f)))},u])}).then(i,o)}}function pv(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>gS(a,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),fs(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>gS(o,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,o,a;return this.getSenders().forEach(c=>{c.track===n&&(i?a=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(o?a=!0:o=c),c.track===n)),a||i&&o?ie.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():ie.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function fv(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(a);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),o.apply(this,arguments)}}function _v(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return fv(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(p=>this._reverseStreams[p.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(p=>{if(this.getSenders().find(_=>_.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const p=new e.MediaStream(f.getTracks());this._streams[f.id]=p,this._reverseStreams[p.id]=f,f=p}i.apply(this,[f])};const o=e.RTCPeerConnection.prototype.removeStream;function a(f,p){let _=p.sdp;return Object.keys(f._reverseStreams||[]).forEach(S=>{const R=f._reverseStreams[S],C=f._streams[R.id];_=_.replace(new RegExp(C.id,"g"),R.id)}),new RTCSessionDescription({type:p.type,sdp:_})}function c(f,p){let _=p.sdp;return Object.keys(f._reverseStreams||[]).forEach(S=>{const R=f._reverseStreams[S],C=f._streams[R.id];_=_.replace(new RegExp(R.id,"g"),C.id)}),new RTCSessionDescription({type:p.type,sdp:_})}e.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},e.RTCPeerConnection.prototype.addTrack=function(f,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(C=>C===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[p.id];if(R)R.addTrack(f),ie.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new e.MediaStream([f]);this._streams[p.id]=C,this._reverseStreams[C.id]=p,this.addStream(C)}return this.getSenders().find(C=>C.track===f)},["createOffer","createAnswer"].forEach(function(f){const p=e.RTCPeerConnection.prototype[f],_={[f](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[R=>{const C=a(this,R);S[0].apply(null,[C])},R=>{S[1]&&S[1].apply(null,R)},arguments[2]]):p.apply(this,arguments).then(R=>a(this,R))}};e.RTCPeerConnection.prototype[f]=_[f]});const l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=c(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const f=u.get.apply(this);return f.type===""?f:a(this,f)}}),e.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(f._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(S=>f.track===S)&&(p=this._streams[_])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function hf(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function Ev(e,t){fs(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var mv=Object.freeze({__proto__:null,shimMediaStream:dv,shimOnTrack:lv,shimGetSendersWithDtmf:uv,shimGetStats:hv,shimSenderReceiverGetStats:pv,shimAddTrackRemoveTrackWithNative:fv,shimAddTrackRemoveTrack:_v,shimPeerConnection:hf,fixNegotiationNeeded:Ev,shimGetUserMedia:cv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const o=n.video&&n.video.width,a=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},o&&(n.video.mandatory.maxWidth=o),a&&(n.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function gv(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,a,c){fp("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(a,c)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),o(c.audio,"autoGainControl","mozAutoGainControl"),o(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return o(l,"mozAutoGainControl","autoGainControl"),o(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),o(l,"autoGainControl","mozAutoGainControl"),o(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function Sv(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function pf(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const a=e.RTCPeerConnection.prototype[o],c={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=c[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,a,c]=arguments;return i.apply(this,[o||null]).then(l=>{if(t.version<53&&!a)try{l.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((f,p)=>{l.set(p,Object.assign({},f,{type:n[f.type]||f.type}))})}return l}).then(a,c)}}function Tv(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ie.resolve(new Map)}}function vv(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),fs(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Rv(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){fp("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function yv(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Iv(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(i){const{sender:a}=o,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function Cv(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Av(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ie.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ov(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ie.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var wv=Object.freeze({__proto__:null,shimOnTrack:Sv,shimPeerConnection:pf,shimSenderGetStats:Tv,shimReceiverGetStats:vv,shimRemoveStream:Rv,shimRTCDataChannel:yv,shimAddTransceiver:Iv,shimGetParameters:Cv,shimCreateOffer:Av,shimCreateAnswer:Ov,shimGetUserMedia:gv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,ie.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function Nv(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return o&&o.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function bv(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,this.dispatchEvent(a)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,n.dispatchEvent(a)})}),t.apply(n,arguments)}}}function Dv(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(u,f){const p=arguments.length>=2?arguments[2]:arguments[0],_=n.apply(this,[p]);return f?(_.then(u,f),ie.resolve()):_},t.createAnswer=function(u,f){const p=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[p]);return f?(_.then(u,f),ie.resolve()):_};let l=function(u,f,p){const _=o.apply(this,[u]);return p?(_.then(f,p),ie.resolve()):_};t.setLocalDescription=l,l=function(u,f,p){const _=a.apply(this,[u]);return p?(_.then(f,p),ie.resolve()):_},t.setRemoteDescription=l,l=function(u,f,p){const _=c.apply(this,[u]);return p?(_.then(f,p),ie.resolve()):_},t.addIceCandidate=l}function Pv(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>i(Lv(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,o){t.mediaDevices.getUserMedia(n).then(i,o)}).bind(t))}function Lv(e){return e&&e.video!==void 0?Object.assign({},e,{video:mS(e.video)}):e}function kv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const o=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(fp("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,o.push(c)):o.push(n.iceServers[a])}n.iceServers=o}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Mv(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Uv(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function xv(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Vv=Object.freeze({__proto__:null,shimLocalStreamsAPI:Nv,shimRemoteStreamsAPI:bv,shimCallbacksAPI:Dv,shimGetUserMedia:Pv,shimConstraints:Lv,shimRTCIceServerUrls:kv,shimTrackEventTransceiver:Mv,shimCreateOfferLegacy:Uv,shimAudioContext:xv}),IU=`	
\v\f\r                　\u2028\u2029\uFEFF`,CU=Qd,AU=sa,jv=q("".replace),bl=`[	
\v\f\r                　\u2028\u2029\uFEFF]`,OU=RegExp("^"+bl+bl+"*"),wU=RegExp(bl+bl+"*$"),ff=function(e){return function(t){var n=AU(CU(t));return 1&e&&(n=jv(n,OU,"")),2&e&&(n=jv(n,wU,"")),n}},NU={start:ff(1),end:ff(2),trim:ff(3)},bU=zS.PROPER,DU=E,Fv=IU,PU=NU.trim;Mn({target:"String",proto:!0,forced:function(e){return DU(function(){return!!Fv[e]()||"​᠎"[e]()!=="​᠎"||bU&&Fv[e].name!==e})}("trim")},{trim:function(){return PU(this)}});var LU=vo("String").trim,kU=z,MU=LU,_f=String.prototype,Jr=function(e){var t=e.trim;return typeof e=="string"||e===_f||kU(_f,e)&&t===_f.trim?MU:t},Ef={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return Jr(n).call(n).split(`
`).map(i=>Jr(i).call(i))},t.splitSections=function(n){return n.split(`
m=`).map((i,o)=>{var a;return Jr(a=o>0?"m="+i:i).call(a)+`\r
`})},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(o=>o.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":o.relatedAddress=i[a+1];break;case"rport":o.relatedPort=parseInt(i[a+1],10);break;case"tcptype":o.tcpType=i[a+1];break;case"ufrag":o.ufrag=i[a+1],o.usernameFragment=i[a+1];break;default:o[i[a]]===void 0&&(o[i[a]]=i[a+1])}return o},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const o=n.component;o==="rtp"?i.push(1):o==="rtcp"?i.push(2):i.push(o),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const a=n.type;return i.push("typ"),i.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substr(14).split(" ")},t.parseRtpMap=function(n){let i=n.substr(9).split(" ");const o={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),o.name=i[0],o.clockRate=parseInt(i[1],10),o.channels=i.length===3?parseInt(i[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){const i=n.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},t.parseFmtp=function(n){const i={};let o;const a=n.substr(n.indexOf(" ")+1).split(";");for(let u=0;u<a.length;u++){var c,l;o=Jr(c=a[u]).call(c).split("="),i[Jr(l=o[0]).call(l)]=o[1]}return i},t.writeFmtp=function(n){let i="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?a.push(c+"="+n.parameters[c]):a.push(c)}),i+="a=fmtp:"+o+" "+a.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substr(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+o+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),o={ssrc:parseInt(n.substr(7,i-7),10)},a=n.indexOf(":",i);return a>-1?(o.attribute=n.substr(i+1,a-i-1),o.value=n.substr(a+1)):o.attribute=n.substr(i+1),o},t.parseSsrcGroup=function(n){const i=n.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(o=>parseInt(o,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(n){const i=n.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let o="a=setup:"+i+`\r
`;return n.fingerprints.forEach(a=>{o+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),o},t.parseCryptoLine=function(n){const i=n.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const o=t.matchPrefix(n+i,"a=ice-ufrag:")[0],a=t.matchPrefix(n+i,"a=ice-pwd:")[0];return o&&a?{usernameFragment:o.substr(12),password:a.substr(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");for(let a=3;a<o.length;a++){const c=o[a],l=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=t.parseRtpMap(l),f=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=f.length?t.parseFmtp(f[0]):{},u.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase())}}}return t.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(t.parseExtmap(a))}),i},t.writeRtpDescription=function(n,i){let o="";o+="m="+n+" ",o+=i.codecs.length>0?"9":"0",o+=" UDP/TLS/RTP/SAVPF ",o+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{o+=t.writeRtpMap(c),o+=t.writeFmtp(c),o+=t.writeRtcpFb(c)});let a=0;return i.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(o+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{o+=t.writeExtmap(c)}),o},t.parseRtpEncodingParameters=function(n){const i=[],o=t.parseRtpParameters(n),a=o.fecMechanisms.indexOf("RED")!==-1,c=o.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(n,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),u=l.length>0&&l[0].ssrc;let f;const p=t.matchPrefix(n,"a=ssrc-group:FID").map(S=>S.substr(17).split(" ").map(R=>parseInt(R,10)));p.length>0&&p[0].length>1&&p[0][0]===u&&(f=p[0][1]),o.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let R={ssrc:u,codecPayloadType:parseInt(S.parameters.apt,10)};u&&f&&(R.rtx={ssrc:f}),i.push(R),a&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},i.push(R))}}),i.length===0&&u&&i.push({ssrc:u});let _=t.matchPrefix(n,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substr(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substr(5),10)*.95-16e3:void 0,i.forEach(S=>{S.maxBitrate=_})),i},t.parseRtcpParameters=function(n){const i={},o=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];o&&(i.cname=o.value,i.ssrc=o.ssrc);const a=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;const c=t.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const o=t.matchPrefix(n,"a=msid:");if(o.length===1)return i=o[0].substr(7).split(" "),{stream:i[0],track:i[1]};const a=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:");let a;o.length>0&&(a=parseInt(o[0].substr(19),10)),isNaN(a)&&(a=65536);const c=t.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substr(12),10),protocol:i.fmt,maxMessageSize:a};const l=t.matchPrefix(n,"a=sctpmap:");if(l.length>0){const u=l[0].substr(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:a}}},t.writeSctpDescription=function(n,i){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&o.push("a=max-message-size:"+i.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(n,i,o){let a;const c=i!==void 0?i:2;return a=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const o=t.splitLines(n);for(let a=0;a<o.length;a++)switch(o[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[a].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substr(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let o=0;o<i.length;o++)if(i[o].length<2||i[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(Ef);var fa=Ef.exports,UU=Object.freeze(d({__proto__:null,default:fa},[Ef.exports]));function Dl(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),o=fa.parseCandidate(n.candidate),a=Object.assign(i,o);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,fs(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function mf(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||fs(e,"icecandidate",t=>{if(t.candidate){const n=fa.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Pl(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const u=fa.splitSections(l.sdp);return u.shift(),u.some(f=>{const p=fa.parseMLine(f);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const f=parseInt(u[1],10);return f!=f?-1:f},o=function(l){let u=65536;return t.browser==="firefox"&&(u=t.version<57?l===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),u},a=function(l,u){let f=65536;t.browser==="firefox"&&t.version===57&&(f=65535);const p=fa.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?f=parseInt(p[0].substr(19),10):t.browser==="firefox"&&u!==-1&&(f=2147483637),f},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),u=o(l),f=a(arguments[0],l);let p;p=u===0&&f===0?Number.POSITIVE_INFINITY:u===0||f===0?Math.max(u,f):Math.min(u,f);const _={};Object.defineProperty(_,"maxMessageSize",{get:()=>p}),this._sctp=_}return c.apply(this,arguments)}}function Ll(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,o){const a=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&o.sctp&&l>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},fs(e,"datachannel",i=>(t(i.channel,i.target),i))}function gf(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const a=o.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",o);a.dispatchEvent(c)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Sf(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(a=>Jr(a).call(a)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function kl(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ie.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ie.resolve())})}function Ml(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var xU=Object.freeze({__proto__:null,shimRTCIceCandidate:Dl,shimRTCIceCandidateRelayProtocol:mf,shimMaxMessageSize:Pl,shimSendThrowTypeError:Ll,shimConnectionState:gf,removeExtmapAllowMixed:Sf,shimAddIceCandidateNullOrEmpty:kl,shimParameterlessSetLocalDescription:Ml});let un,qe;(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=_S,i=$P(e),o={browserDetails:i,commonShim:xU,extractVersion:rl,disableLog:XP,disableWarnings:QP,sdp:UU};switch(i.browser){case"chrome":if(!mv||!hf||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=mv,kl(e,i),Ml(e),cv(e,i),dv(e),hf(e,i),lv(e),_v(e,i),uv(e),hv(e),pv(e),Ev(e,i),Dl(e),mf(e),gf(e),Pl(e,i),Ll(e),Sf(e,i);break;case"firefox":if(!wv||!pf||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=wv,kl(e,i),Ml(e),gv(e,i),pf(e,i),Sv(e),Rv(e),Tv(e),vv(e),yv(e),Iv(e),Cv(e),Av(e),Ov(e),Dl(e),gf(e),Pl(e,i),Ll(e);break;case"safari":if(!Vv||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=Vv,kl(e,i),Ml(e),kv(e),Uv(e),Dv(e),Nv(e),bv(e),Mv(e),Pv(e),xv(e),Dl(e),mf(e),Pl(e,i),Ll(e),Sf(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(un||(un={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(qe||(qe={}));var Tf={exports:{}};(function(e,t){(function(n,i){var o="function",a="undefined",c="object",l="string",u="major",f="model",p="name",_="type",S="vendor",R="version",C="architecture",A="console",O="mobile",k="tablet",M="smarttv",H="wearable",re="embedded",Y="Amazon",J="Apple",W="ASUS",Q="BlackBerry",Be="Firefox",he="Google",rt="Huawei",Xe="LG",Ot="Microsoft",sn="Motorola",yt="Opera",qn="Samsung",x="Sharp",K="Sony",te="Xiaomi",Se="Zebra",xe="Facebook",X="Chromium OS",g="Mac OS",w=function(Tt){for(var Mt={},tt=0;tt<Tt.length;tt++)Mt[Tt[tt].toUpperCase()]=Tt[tt];return Mt},b=function(Tt,Mt){return typeof Tt===l&&B(Mt).indexOf(B(Tt))!==-1},B=function(Tt){return Tt.toLowerCase()},ve=function(Tt,Mt){if(typeof Tt===l)return Tt=Tt.replace(/^\s\s*/,""),typeof Mt===a?Tt:Tt.substring(0,350)},ot=function(Tt,Mt){for(var tt,jn,Br,vt,Ue,Jn,Wo=0;Wo<Mt.length&&!Ue;){var Rr=Mt[Wo],Uw=Mt[Wo+1];for(tt=jn=0;tt<Rr.length&&!Ue&&Rr[tt];)if(Ue=Rr[tt++].exec(Tt))for(Br=0;Br<Uw.length;Br++)Jn=Ue[++jn],typeof(vt=Uw[Br])===c&&vt.length>0?vt.length===2?typeof vt[1]==o?this[vt[0]]=vt[1].call(this,Jn):this[vt[0]]=vt[1]:vt.length===3?typeof vt[1]!==o||vt[1].exec&&vt[1].test?this[vt[0]]=Jn?Jn.replace(vt[1],vt[2]):i:this[vt[0]]=Jn?vt[1].call(this,Jn,vt[2]):i:vt.length===4&&(this[vt[0]]=Jn?vt[3].call(this,Jn.replace(vt[1],vt[2])):i):this[vt]=Jn||i;Wo+=2}},an=function(Tt,Mt){for(var tt in Mt)if(typeof Mt[tt]===c&&Mt[tt].length>0){for(var jn=0;jn<Mt[tt].length;jn++)if(b(Mt[tt][jn],Tt))return tt==="?"?i:tt}else if(b(Mt[tt],Tt))return tt==="?"?i:tt;return Tt},nr={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Bo={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[R,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[R,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,R],[/opios[\/ ]+([\w\.]+)/i],[R,[p,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[R,[p,yt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,R],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[R,[p,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[R,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[R,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[R,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[R,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[R,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure Browser"],R],[/\bfocus\/([\w\.]+)/i],[R,[p,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[R,[p,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[R,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[R,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[R,[p,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[R,[p,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[R,[p,Be]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 Browser"],R],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],R],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,R],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,xe],R],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,R],[/\bgsa\/([\w\.]+) .*safari\//i],[R,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[R,[p,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,"Chrome WebView"],R],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[R,[p,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,R],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[R,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[R,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[R,an,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,R],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],R],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[R,[p,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,R],[/(cobalt)\/([\w\.]+)/i],[p,[R,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[C,"amd64"]],[/(ia32(?=;))/i],[[C,B]],[/((?:i[346]|x)86)[;\)]/i],[[C,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[C,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/windows (ce|mobile); ppc;/i],[[C,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[C,/ower/,"",B]],[/(sun4\w)[;\)]/i],[[C,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[C,B]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[S,qn],[_,k]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[f,[S,qn],[_,O]],[/\((ip(?:hone|od)[\w ]*);/i],[f,[S,J],[_,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[S,J],[_,k]],[/(macintosh);/i],[f,[S,J]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[S,x],[_,O]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[S,rt],[_,k]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[S,rt],[_,O]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[f,/_/g," "],[S,te],[_,O]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[S,te],[_,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[S,"OPPO"],[_,O]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[S,"Vivo"],[_,O]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[f,[S,"Realme"],[_,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[S,sn],[_,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[S,sn],[_,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[S,Xe],[_,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[S,Xe],[_,O]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[S,"Lenovo"],[_,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[S,"Nokia"],[_,O]],[/(pixel c)\b/i],[f,[S,he],[_,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[S,he],[_,O]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[S,K],[_,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[S,K],[_,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[S,"OnePlus"],[_,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[S,Y],[_,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[S,Y],[_,O]],[/(playbook);[-\w\),; ]+(rim)/i],[f,S,[_,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[S,Q],[_,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[S,W],[_,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[S,W],[_,O]],[/(nexus 9)/i],[f,[S,"HTC"],[_,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[f,/_/g," "],[_,O]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[S,"Acer"],[_,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[S,"Meizu"],[_,O]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,f,[_,O]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,f,[_,k]],[/(surface duo)/i],[f,[S,Ot],[_,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[S,"Fairphone"],[_,O]],[/(u304aa)/i],[f,[S,"AT&T"],[_,O]],[/\bsie-(\w*)/i],[f,[S,"Siemens"],[_,O]],[/\b(rct\w+) b/i],[f,[S,"RCA"],[_,k]],[/\b(venue[\d ]{2,7}) b/i],[f,[S,"Dell"],[_,k]],[/\b(q(?:mv|ta)\w+) b/i],[f,[S,"Verizon"],[_,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[S,"Barnes & Noble"],[_,k]],[/\b(tm\d{3}\w+) b/i],[f,[S,"NuVision"],[_,k]],[/\b(k88) b/i],[f,[S,"ZTE"],[_,k]],[/\b(nx\d{3}j) b/i],[f,[S,"ZTE"],[_,O]],[/\b(gen\d{3}) b.+49h/i],[f,[S,"Swiss"],[_,O]],[/\b(zur\d{3}) b/i],[f,[S,"Swiss"],[_,k]],[/\b((zeki)?tb.*\b) b/i],[f,[S,"Zeki"],[_,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],f,[_,k]],[/\b(ns-?\w{0,9}) b/i],[f,[S,"Insignia"],[_,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[S,"NextBook"],[_,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],f,[_,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],f,[_,O]],[/\b(ph-1) /i],[f,[S,"Essential"],[_,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[S,"Envizen"],[_,k]],[/\b(trio[-\w\. ]+) b/i],[f,[S,"MachSpeed"],[_,k]],[/\btu_(1491) b/i],[f,[S,"Rotor"],[_,k]],[/(shield[\w ]+) b/i],[f,[S,"Nvidia"],[_,k]],[/(sprint) (\w+)/i],[S,f,[_,O]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[S,Ot],[_,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[S,Se],[_,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[S,Se],[_,O]],[/smart-tv.+(samsung)/i],[S,[_,M]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[S,qn],[_,M]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Xe],[_,M]],[/(apple) ?tv/i],[S,[f,"Apple TV"],[_,M]],[/crkey/i],[[f,"Chromecast"],[S,he],[_,M]],[/droid.+aft(\w)( bui|\))/i],[f,[S,Y],[_,M]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[S,x],[_,M]],[/(bravia[\w ]+)( bui|\))/i],[f,[S,K],[_,M]],[/(mitv-\w{5}) bui/i],[f,[S,te],[_,M]],[/Hbbtv.*(technisat) (.*);/i],[S,f,[_,M]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,ve],[f,ve],[_,M]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,M]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,f,[_,A]],[/droid.+; (shield) bui/i],[f,[S,"Nvidia"],[_,A]],[/(playstation [345portablevi]+)/i],[f,[S,K],[_,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[S,Ot],[_,A]],[/((pebble))app/i],[S,f,[_,H]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[S,J],[_,H]],[/droid.+; (glass) \d/i],[f,[S,he],[_,H]],[/droid.+; (wt63?0{2,3})\)/i],[f,[S,Se],[_,H]],[/(quest( 2| pro)?)/i],[f,[S,xe],[_,H]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[_,re]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[f,[_,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[_,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,O]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[R,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[R,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,R],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[R,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,R],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[R,an,nr]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[R,an,nr]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[R,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,g],[R,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[R,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,R],[/\(bb(10);/i],[R,[p,Q]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[R,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[R,[p,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[R,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[R,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[R,[p,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,X],R],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,R],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],R],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,R]]},ji=function(Tt,Mt){if(typeof Tt===c&&(Mt=Tt,Tt=i),!(this instanceof ji))return new ji(Tt,Mt).getResult();var tt=typeof n!==a&&n.navigator?n.navigator:i,jn=Tt||(tt&&tt.userAgent?tt.userAgent:""),Br=tt&&tt.userAgentData?tt.userAgentData:i,vt=Mt?function(Ue,Jn){var Wo={};for(var Rr in Ue)Jn[Rr]&&Jn[Rr].length%2==0?Wo[Rr]=Jn[Rr].concat(Ue[Rr]):Wo[Rr]=Ue[Rr];return Wo}(Bo,Mt):Bo;return this.getBrowser=function(){var Ue={};return Ue.name=i,Ue.version=i,ot.call(Ue,jn,vt.browser),Ue.major=function(Jn){return typeof Jn===l?Jn.replace(/[^\d\.]/g,"").split(".")[0]:i}(Ue.version),tt&&tt.brave&&typeof tt.brave.isBrave==o&&(Ue.name="Brave"),Ue},this.getCPU=function(){var Ue={};return Ue.architecture=i,ot.call(Ue,jn,vt.cpu),Ue},this.getDevice=function(){var Ue={};return Ue.vendor=i,Ue.model=i,Ue.type=i,ot.call(Ue,jn,vt.device),!Ue.type&&Br&&Br.mobile&&(Ue.type=O),Ue.model=="Macintosh"&&tt&&typeof tt.standalone!==a&&tt.maxTouchPoints&&tt.maxTouchPoints>2&&(Ue.model="iPad",Ue.type=k),Ue},this.getEngine=function(){var Ue={};return Ue.name=i,Ue.version=i,ot.call(Ue,jn,vt.engine),Ue},this.getOS=function(){var Ue={};return Ue.name=i,Ue.version=i,ot.call(Ue,jn,vt.os),!Ue.name&&Br&&Br.platform!="Unknown"&&(Ue.name=Br.platform.replace(/chrome os/i,X).replace(/macos/i,g)),Ue},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return jn},this.setUA=function(Ue){return jn=typeof Ue===l&&Ue.length>350?ve(Ue,350):Ue,this},this.setUA(jn),this};ji.VERSION="0.7.34",ji.BROWSER=w([p,R,u]),ji.CPU=w([C]),ji.DEVICE=w([f,S,_,A,O,M,k,H,re]),ji.ENGINE=ji.OS=w([p,R]),e.exports&&(t=e.exports=ji),t.UAParser=ji;var Go=typeof n!==a&&(n.jQuery||n.Zepto);if(Go&&!Go.ua){var Ka=new ji;Go.ua=Ka.getResult(),Go.ua.get=function(){return Ka.getUA()},Go.ua.set=function(Tt){Ka.setUA(Tt);var Mt=Ka.getResult();for(var tt in Mt)Go.ua[tt]=Mt[tt]}}})(typeof window=="object"?window:h)})(Tf,Tf.exports);const vf=new Tf.exports;let Rf,li,Xr=vf.getResult(),yf=null;function We(e){if(!yf){e&&vf.setUA(e),Xr=vf.getResult();const t=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return qe.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return qe.CHROME;case"Safari":case"Mobile Safari":return qe.SAFARI;case"Edge":return qe.EDGE;case"Firefox":return qe.FIREFOX;case"QQBrowser":return qe.QQ;case"Opera":return qe.OPERA;case"WeChat":return qe.WECHAT;default:return a.browser.name||""}}(Xr),n=function(a){let c;return c=a.engine.name==="Blink"?a.engine.version||"":a.browser.version||"",c.split(".")[0]}(Xr),i=function(a){switch(a.os.name){case"Windows":return a.os.version?a.os.name+" "+a.os.version:a.os.name;default:return a.os.name||""}}(Xr),o=Xr.os.version;if(!(t&&n&&i&&o))return{name:t,version:n,os:i,osVersion:o};yf={name:t,version:n,os:i,osVersion:o}}return yf}function Bv(){return We().os}function Gv(){const e=We();return"".concat(e.os," ").concat(e.osVersion)}function Ul(){const e=We();return!!(Xr.engine.name==="WebKit"&&e.os===un.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==qe.SAFARI||Nn()&&e.name!==qe.SAFARI)}function VU(){const e=We();if(Ul()){if(e.os===un.MAC_OS)return!0;if(e.os===un.IOS){const t=Xr.os.version&&Xr.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function jU(){return Xr.engine.name==="WebKit"}function If(){return We().name===qe.CHROME}function wn(){return We().name===qe.SAFARI}function Et(){return We().name===qe.FIREFOX}function Nn(){return We().os===un.IOS}function Cf(e){const t=We();return!(t.name!==qe.CHROME||!t.osVersion)&&Number(t.version)>=e}function Wv(e){const t=We();return!(t.name!==qe.EDGE||!t.osVersion)&&Number(t.version)>=e}function Hv(e){const t=We();return!(t.name!==qe.OPERA||!t.osVersion)&&Number(t.version)>=e}function Kv(){const e=We();return!(e.name!==qe.CHROME||!e.osVersion)&&Number(e.version)<=90}function Yv(){const e=We();if(e.os!==un.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function _a(){const e=We();if(e.os!==un.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function Af(){const e=We();if(e.os!==un.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function zv(){const e=We();if(e.os!==un.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function kr(){return wn()&&navigator.maxTouchPoints>0}function qv(){return We().name===qe.WECHAT}function Jv(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Ss(){const e=We();return e.name===qe.EDGE||e.name===qe.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function xl(){return Bv()===un.ANDROID}function Lc(){const e=We();return xl()&&(e.name===qe.CHROME||e.name===qe.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(e){e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY"})(Rf||(Rf={})),function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(li||(li={}));var Xv={exports:{}},FU=Mn,BU=me,Qv=pr.f;FU({target:"Object",stat:!0,forced:Object.defineProperty!==Qv,sham:!BU},{defineProperty:Qv});var $v=go.Object,GU=Xv.exports=function(e,t,n){return $v.defineProperty(e,t,n)};$v.defineProperty.sham&&(GU.sham=!0);var Zv=Xv.exports;function m(e,t,n){return t in e?Zv(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Of,wf={exports:{}},eR=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}},WU=eR,Nf=Object.prototype.toString,bf=(Of=Object.create(null),function(e){var t=Nf.call(e);return Of[t]||(Of[t]=t.slice(8,-1).toLowerCase())});function Ts(e){return e=e.toLowerCase(),function(t){return bf(t)===e}}function Df(e){return Array.isArray(e)}function Vl(e){return e===void 0}var tR=Ts("ArrayBuffer");function nR(e){return e!==null&&typeof e=="object"}function jl(e){if(bf(e)!=="object")return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}var HU=Ts("Date"),KU=Ts("File"),YU=Ts("Blob"),zU=Ts("FileList");function Pf(e){return Nf.call(e)==="[object Function]"}var qU=Ts("URLSearchParams");function Lf(e,t){if(e!=null)if(typeof e!="object"&&(e=[e]),Df(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var kf,JU=(kf=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(e){return kf&&e instanceof kf}),Un={isArray:Df,isArrayBuffer:tR,isBuffer:function(e){return e!==null&&!Vl(e)&&e.constructor!==null&&!Vl(e.constructor)&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||Nf.call(e)===t||Pf(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&tR(e.buffer)},isString:function(e){return typeof e=="string"},isNumber:function(e){return typeof e=="number"},isObject:nR,isPlainObject:jl,isUndefined:Vl,isDate:HU,isFile:KU,isBlob:YU,isFunction:Pf,isStream:function(e){return nR(e)&&Pf(e.pipe)},isURLSearchParams:qU,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:Lf,merge:function e(){var t={};function n(a,c){jl(t[c])&&jl(a)?t[c]=e(t[c],a):jl(a)?t[c]=e({},a):Df(a)?t[c]=a.slice():t[c]=a}for(var i=0,o=arguments.length;i<o;i++)Lf(arguments[i],n);return t},extend:function(e,t,n){return Lf(t,function(i,o){e[o]=n&&typeof i=="function"?WU(i,n):i}),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e},inherits:function(e,t,n,i){e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var i,o,a,c={};t=t||{};do{for(o=(i=Object.getOwnPropertyNames(e)).length;o-- >0;)c[a=i[o]]||(t[a]=e[a],c[a]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:bf,kindOfTest:Ts,endsWith:function(e,t,n){e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;var i=e.indexOf(t,n);return i!==-1&&i===n},toArray:function(e){if(!e)return null;var t=e.length;if(Vl(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:JU,isFileList:zU},Ea=Un;function iR(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var rR=function(e,t,n){if(!t)return e;var i;if(n)i=n(t);else if(Ea.isURLSearchParams(t))i=t.toString();else{var o=[];Ea.forEach(t,function(c,l){c!=null&&(Ea.isArray(c)?l+="[]":c=[c],Ea.forEach(c,function(u){Ea.isDate(u)?u=u.toISOString():Ea.isObject(u)&&(u=JSON.stringify(u)),o.push(iR(l)+"="+iR(u))}))}),i=o.join("&")}if(i){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},XU=Un;function Fl(){this.handlers=[]}Fl.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},Fl.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Fl.prototype.forEach=function(e){XU.forEach(this.handlers,function(t){t!==null&&e(t)})};var QU=Fl,$U=Un,oR=Un;function ma(e,t,n,i,o){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),o&&(this.response=o)}oR.inherits(ma,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var sR=ma.prototype,aR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){aR[e]={value:e}}),Object.defineProperties(ma,aR),Object.defineProperty(sR,"isAxiosError",{value:!0}),ma.from=function(e,t,n,i,o,a){var c=Object.create(sR);return oR.toFlatObject(e,c,function(l){return l!==Error.prototype}),ma.call(c,e.message,t,n,i,o),c.name=e.name,a&&Object.assign(c,a),c};var ga=ma,cR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},_r=Un,dR=function(e,t){t=t||new FormData;var n=[];function i(o){return o===null?"":_r.isDate(o)?o.toISOString():_r.isArrayBuffer(o)||_r.isTypedArray(o)?typeof Blob=="function"?new Blob([o]):Buffer.from(o):o}return function o(a,c){if(_r.isPlainObject(a)||_r.isArray(a)){if(n.indexOf(a)!==-1)throw Error("Circular reference detected in "+c);n.push(a),_r.forEach(a,function(l,u){if(!_r.isUndefined(l)){var f,p=c?c+"."+u:u;if(l&&!c&&typeof l=="object"){if(_r.endsWith(u,"{}"))l=JSON.stringify(l);else if(_r.endsWith(u,"[]")&&(f=_r.toArray(l)))return void f.forEach(function(_){!_r.isUndefined(_)&&t.append(p,i(_))})}o(l,p)}}),n.pop()}else t.append(c,i(a))}(e),t},Mf=ga,Bl=Un,ZU=Bl.isStandardBrowserEnv()?{write:function(e,t,n,i,o,a){var c=[];c.push(e+"="+encodeURIComponent(t)),Bl.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),Bl.isString(i)&&c.push("path="+i),Bl.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},ex=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},tx=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},lR=function(e,t){return e&&!ex(t)?tx(e,t):t},Uf=Un,nx=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],uR=Un,ix=uR.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(o){var a=o;return t&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(o){var a=uR.isString(o)?i(o):o;return a.protocol===e.protocol&&a.host===e.host}}():function(){return!0},xf=ga;function hR(e){xf.call(this,e??"canceled",xf.ERR_CANCELED),this.name="CanceledError"}Un.inherits(hR,xf,{__CANCEL__:!0});var Gl=hR,kc=Un,rx=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new Mf("Request failed with status code "+n.status,[Mf.ERR_BAD_REQUEST,Mf.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)},ox=ZU,sx=rR,ax=lR,cx=function(e){var t,n,i,o={};return e&&Uf.forEach(e.split(`
`),function(a){if(i=a.indexOf(":"),t=Uf.trim(a.substr(0,i)).toLowerCase(),n=Uf.trim(a.substr(i+1)),t){if(o[t]&&nx.indexOf(t)>=0)return;o[t]=t==="set-cookie"?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}}),o},dx=ix,lx=cR,Qr=ga,ux=Gl,hx=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},px=function(e){return new Promise(function(t,n){var i,o=e.data,a=e.headers,c=e.responseType;function l(){e.cancelToken&&e.cancelToken.unsubscribe(i),e.signal&&e.signal.removeEventListener("abort",i)}kc.isFormData(o)&&kc.isStandardBrowserEnv()&&delete a["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",p=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.Authorization="Basic "+btoa(f+":"+p)}var _=ax(e.baseURL,e.url);function S(){if(u){var A="getAllResponseHeaders"in u?cx(u.getAllResponseHeaders()):null,O={data:c&&c!=="text"&&c!=="json"?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:A,config:e,request:u};rx(function(k){t(k),l()},function(k){n(k),l()},O),u=null}}if(u.open(e.method.toUpperCase(),sx(_,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=S:u.onreadystatechange=function(){u&&u.readyState===4&&(u.status!==0||u.responseURL&&u.responseURL.indexOf("file:")===0)&&setTimeout(S)},u.onabort=function(){u&&(n(new Qr("Request aborted",Qr.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new Qr("Network Error",Qr.ERR_NETWORK,e,u,u)),u=null},u.ontimeout=function(){var A=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",O=e.transitional||lx;e.timeoutErrorMessage&&(A=e.timeoutErrorMessage),n(new Qr(A,O.clarifyTimeoutError?Qr.ETIMEDOUT:Qr.ECONNABORTED,e,u)),u=null},kc.isStandardBrowserEnv()){var R=(e.withCredentials||dx(_))&&e.xsrfCookieName?ox.read(e.xsrfCookieName):void 0;R&&(a[e.xsrfHeaderName]=R)}"setRequestHeader"in u&&kc.forEach(a,function(A,O){o===void 0&&O.toLowerCase()==="content-type"?delete a[O]:u.setRequestHeader(O,A)}),kc.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),c&&c!=="json"&&(u.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&u.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(i=function(A){u&&(n(!A||A&&A.type?new ux:A),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(i),e.signal&&(e.signal.aborted?i():e.signal.addEventListener("abort",i))),o||(o=null);var C=hx(_);C&&["http","https","file"].indexOf(C)===-1?n(new Qr("Unsupported protocol "+C+":",Qr.ERR_BAD_REQUEST,e)):u.send(o)})},bn=Un,pR=function(e,t){$U.forEach(e,function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])})},fR=ga,fx=dR,_x={"Content-Type":"application/x-www-form-urlencoded"};function _R(e,t){!bn.isUndefined(e)&&bn.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var ER,Wl={transitional:cR,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(ER=px),ER),transformRequest:[function(e,t){if(pR(t,"Accept"),pR(t,"Content-Type"),bn.isFormData(e)||bn.isArrayBuffer(e)||bn.isBuffer(e)||bn.isStream(e)||bn.isFile(e)||bn.isBlob(e))return e;if(bn.isArrayBufferView(e))return e.buffer;if(bn.isURLSearchParams(e))return _R(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,i=bn.isObject(e),o=t&&t["Content-Type"];if((n=bn.isFileList(e))||i&&o==="multipart/form-data"){var a=this.env&&this.env.FormData;return fx(n?{"files[]":e}:e,a&&new a)}return i||o==="application/json"?(_R(t,"application/json"),function(c,l,u){if(bn.isString(c))try{return(l||JSON.parse)(c),bn.trim(c)}catch(f){if(f.name!=="SyntaxError")throw f}return(u||JSON.stringify)(c)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Wl.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,o=!n&&this.responseType==="json";if(o||i&&bn.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?fR.from(a,fR.ERR_BAD_RESPONSE,this,null,this.response):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};bn.forEach(["delete","get","head"],function(e){Wl.headers[e]={}}),bn.forEach(["post","put","patch"],function(e){Wl.headers[e]=bn.merge(_x)});var Vf=Wl,Ex=Un,mx=Vf,mR=function(e){return!(!e||!e.__CANCEL__)},gR=Un,jf=function(e,t,n){var i=this||mx;return Ex.forEach(n,function(o){e=o.call(i,e,t)}),e},gx=mR,Sx=Vf,Tx=Gl;function Ff(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Tx}var wi=Un,SR=function(e,t){t=t||{};var n={};function i(f,p){return wi.isPlainObject(f)&&wi.isPlainObject(p)?wi.merge(f,p):wi.isPlainObject(p)?wi.merge({},p):wi.isArray(p)?p.slice():p}function o(f){return wi.isUndefined(t[f])?wi.isUndefined(e[f])?void 0:i(void 0,e[f]):i(e[f],t[f])}function a(f){if(!wi.isUndefined(t[f]))return i(void 0,t[f])}function c(f){return wi.isUndefined(t[f])?wi.isUndefined(e[f])?void 0:i(void 0,e[f]):i(void 0,t[f])}function l(f){return f in t?i(e[f],t[f]):f in e?i(void 0,e[f]):void 0}var u={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l};return wi.forEach(Object.keys(e).concat(Object.keys(t)),function(f){var p=u[f]||o,_=p(f);wi.isUndefined(_)&&p!==l||(n[f]=_)}),n},TR="0.27.2",vx=TR,Co=ga,Bf={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){Bf[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});var vR={};Bf.transitional=function(e,t,n){function i(o,a){return"[Axios v"+vx+"] Transitional option '"+o+"'"+a+(n?". "+n:"")}return function(o,a,c){if(e===!1)throw new Co(i(a," has been removed"+(t?" in "+t:"")),Co.ERR_DEPRECATED);return t&&!vR[a]&&(vR[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,a,c)}};var RR=Un,Rx=rR,yR=QU,IR=function(e){return Ff(e),e.headers=e.headers||{},e.data=jf.call(e,e.data,e.headers,e.transformRequest),e.headers=gR.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),gR.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||Sx.adapter)(e).then(function(t){return Ff(e),t.data=jf.call(e,t.data,t.headers,e.transformResponse),t},function(t){return gx(t)||(Ff(e),t&&t.response&&(t.response.data=jf.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},Hl=SR,yx=lR,CR={assertOptions:function(e,t,n){if(typeof e!="object")throw new Co("options must be an object",Co.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(e),o=i.length;o-- >0;){var a=i[o],c=t[a];if(c){var l=e[a],u=l===void 0||c(l,a,e);if(u!==!0)throw new Co("option "+a+" must be "+u,Co.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Co("Unknown option "+a,Co.ERR_BAD_OPTION)}},validators:Bf},Sa=CR.validators;function Ta(e){this.defaults=e,this.interceptors={request:new yR,response:new yR}}Ta.prototype.request=function(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},(t=Hl(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;n!==void 0&&CR.assertOptions(n,{silentJSONParsing:Sa.transitional(Sa.boolean),forcedJSONParsing:Sa.transitional(Sa.boolean),clarifyTimeoutError:Sa.transitional(Sa.boolean)},!1);var i=[],o=!0;this.interceptors.request.forEach(function(_){typeof _.runWhen=="function"&&_.runWhen(t)===!1||(o=o&&_.synchronous,i.unshift(_.fulfilled,_.rejected))});var a,c=[];if(this.interceptors.response.forEach(function(_){c.push(_.fulfilled,_.rejected)}),!o){var l=[IR,void 0];for(Array.prototype.unshift.apply(l,i),l=l.concat(c),a=Promise.resolve(t);l.length;)a=a.then(l.shift(),l.shift());return a}for(var u=t;i.length;){var f=i.shift(),p=i.shift();try{u=f(u)}catch(_){p(_);break}}try{a=IR(u)}catch(_){return Promise.reject(_)}for(;c.length;)a=a.then(c.shift(),c.shift());return a},Ta.prototype.getUri=function(e){e=Hl(this.defaults,e);var t=yx(e.baseURL,e.url);return Rx(t,e.params,e.paramsSerializer)},RR.forEach(["delete","get","head","options"],function(e){Ta.prototype[e]=function(t,n){return this.request(Hl(n||{},{method:e,url:t,data:(n||{}).data}))}}),RR.forEach(["post","put","patch"],function(e){function t(n){return function(i,o,a){return this.request(Hl(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Ta.prototype[e]=t(),Ta.prototype[e+"Form"]=t(!0)});var Ix=Ta,Cx=Gl;function va(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(i){t=i});var n=this;this.promise.then(function(i){if(n._listeners){var o,a=n._listeners.length;for(o=0;o<a;o++)n._listeners[o](i);n._listeners=null}}),this.promise.then=function(i){var o,a=new Promise(function(c){n.subscribe(c),o=c}).then(i);return a.cancel=function(){n.unsubscribe(o)},a},e(function(i){n.reason||(n.reason=new Cx(i),t(n.reason))})}va.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},va.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},va.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}},va.source=function(){var e;return{token:new va(function(t){e=t}),cancel:e}};var Ax=va,Ox=Un,AR=Un,wx=eR,Kl=Ix,Nx=SR,ui=function e(t){var n=new Kl(t),i=wx(Kl.prototype.request,n);return AR.extend(i,Kl.prototype,n),AR.extend(i,n),i.create=function(o){return e(Nx(t,o))},i}(Vf);ui.Axios=Kl,ui.CanceledError=Gl,ui.CancelToken=Ax,ui.isCancel=mR,ui.VERSION=TR,ui.toFormData=dR,ui.AxiosError=ga,ui.Cancel=ui.CanceledError,ui.all=function(e){return Promise.all(e)},ui.spread=function(e){return function(t){return e.apply(null,t)}},ui.isAxiosError=function(e){return Ox.isObject(e)&&e.isAxiosError===!0},wf.exports=ui,wf.exports.default=ui;var hi=wf.exports;class bx{constructor(t){m(this,"logger",void 0),m(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}class ft{constructor(){m(this,"_events",{}),m(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const i=this._events[t],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(c=>c);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];for(let c=0;c<n.length;c+=1){const l=n[c];l.once&&this.off(t,l.listener),l.listener.apply(this,o||[])}}safeEmit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];[...this._events[t]||[]].forEach(a=>{a.once&&this.off(t,a.listener);try{a.listener.apply(this,i)}catch(c){v.error("safeEmit event:".concat(t," error ").concat(c==null?void 0:c.toString()))}})}_indexOfListener(t,n){let i=t.length;for(;i--;)if(t[i].listener===n)return i;return-1}}const Yl=new class extends ft{reportLogUploadError(e){this.emit("REPORT_LOG_UPLOAD",e)}};let y;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(y||(y={}));class N extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),m(this,"code",void 0),m(this,"message",void 0),m(this,"data",void 0),m(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return t==="error"&&v.error(this.toString()),t==="warning"&&v.warning(this.toString()),this}throw(){throw this.print(),this}}const wt={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Gf(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Er(e,t,n,i){const o=Object.assign({},wt,i);let a=o.timeout;const c=async()=>{await function(f){return new ie(p=>{window.setTimeout(p,f)})}(a),a*=o.timeoutFactor,a=Math.min(o.maxRetryTimeout,a)};let l=!1;const u=new ie(async(f,p)=>{t=t||(()=>!1),n=n||(()=>!0);for(let _=0;_<o.maxRetryCount;_+=1){if(l)return p(new N(y.OPERATION_ABORTED));try{const S=await e();if(!t(S,_)||_+1===o.maxRetryCount)return f(S);await c()}catch(S){if(!n(S,_)||_+1===o.maxRetryCount)return p(S);await c()}}});return u.cancel=()=>l=!0,u}function Wf(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function OR(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Ni={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},zl=Date.now(),Mc=e=>{for(const t in Ni)if(Object.prototype.hasOwnProperty.call(Ni,t)&&Ni[t]===e)return t;return"DEFAULT"},v=new class{constructor(){m(this,"proxyServerURL",void 0),m(this,"logLevel",Ni.DEBUG),m(this,"uploadState","collecting"),m(this,"uploadLogWaitingList",[]),m(this,"uploadLogUploadingList",[]),m(this,"uploadErrorCount",0),m(this,"currentLogID",0),m(this,"url",void 0),m(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ni.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ni.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ni.WARNING].concat(t);this.log.apply(this,i)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ni.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ni.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){et("UPLOAD_LOG",!0)}disableLogUpload(){et("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new bx(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-zl<100)return void setTimeout(()=>{this.log(...t)},Date.now()-zl);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=Wf()+" Agora-SDK [".concat(Mc(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const o=Wf()+" %cAgora-SDK [".concat(Mc(i),"]:");let a=[];if(!D("USE_NEW_LOG"))switch(i){case Ni.DEBUG:a=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case Ni.INFO:a=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case Ni.WARNING:a=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case Ni.ERROR:a=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-zl<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-zl);const i=Math.max(0,Math.min(4,t[0]));t[0]=Wf()+" Agora-SDK [".concat(Mc(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!D("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=OR()+" Agora-SDK [".concat(Mc(e),"]:"):n[0]=OR()+" Agora-SDK [".concat(Mc(e),"]:");let o="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),o+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:bi,process_id:D("PROCESS_ID"),payload:JSON.stringify(e)};return Er(async()=>{const n=await hi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(D("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(D("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>(n.response?Yl.reportLogUploadError({status:n.response.status,data:n.response.data,headers:n.response.headers,message:n.message}):n.request?Yl.reportLogUploadError({status:n.request.status,message:n.message}):Yl.reportLogUploadError({status:-1,message:n.message}),!0),{timeout:D("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:D("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,D("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},Hf="v4.18.2-0-g8d83af1d-dirty(7/11/2023, 7:07:15 PM)",bi=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],o=t[2];return"".concat(i,".").concat(o)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],o=n[2];return"".concat(i,".").concat(100*(Number(o)+1))}return"4.0.0.999"}("4.18.2"),Kf=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),wR=["CHINA","GLOBAL"],pi=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),o=[];for(let l=0;l<6;l++)o.push("1");const a=o.join(""),c={};return c[e]=i,c[t]=a,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=pi;const Dx={"90p":Le(160,90),"90p_1":Le(160,90),"120p":Le(160,120,15,30,65),"120p_1":Le(160,120,15,30,65),"120p_3":Le(120,120,15,30,50),"120p_4":Le(212,120),"180p":Le(320,180,15,30,140),"180p_1":Le(320,180,15,30,140),"180p_3":Le(180,180,15,30,100),"180p_4":Le(240,180,15,30,120),"240p":Le(320,240,15,40,200),"240p_1":Le(320,240,15,40,200),"240p_3":Le(240,240,15,40,140),"240p_4":Le(424,240,15,40,220),"360p":Le(640,360,15,80,400),"360p_1":Le(640,360,15,80,400),"360p_3":Le(360,360,15,80,260),"360p_4":Le(640,360,30,80,600),"360p_6":Le(360,360,30,80,400),"360p_7":Le(480,360,15,80,320),"360p_8":Le(480,360,30,80,490),"360p_9":Le(640,360,15,80,800),"360p_10":Le(640,360,24,80,800),"360p_11":Le(640,360,24,80,1e3),"480p":Le(640,480,15,100,500),"480p_1":Le(640,480,15,100,500),"480p_2":Le(640,480,30,100,1e3),"480p_3":Le(480,480,15,100,400),"480p_4":Le(640,480,30,100,750),"480p_6":Le(480,480,30,100,600),"480p_8":Le(848,480,15,100,610),"480p_9":Le(848,480,30,100,930),"480p_10":Le(640,480,10,100,400),"720p":Le(1280,720,15,120,1130),"720p_1":Le(1280,720,15,120,1130),"720p_2":Le(1280,720,30,120,2e3),"720p_3":Le(1280,720,30,120,1710),"720p_5":Le(960,720,15,120,910),"720p_6":Le(960,720,30,120,1380),"1080p":Le(1920,1080,15,120,2080),"1080p_1":Le(1920,1080,15,120,2080),"1080p_2":Le(1920,1080,30,120,3e3),"1080p_3":Le(1920,1080,30,120,3150),"1080p_5":Le(1920,1080,60,120,4780),"1440p":Le(2560,1440,30,120,4850),"1440p_1":Le(2560,1440,30,120,4850),"1440p_2":Le(2560,1440,60,120,7350),"4k":Le(3840,2160,30,120,8910),"4k_1":Le(3840,2160,30,120,8910),"4k_3":Le(3840,2160,60,120,13500)},Px={"480p":zi(640,480,5),"480p_1":zi(640,480,5),"480p_2":zi(640,480,30),"480p_3":zi(640,480,15),"720p":zi(1280,720,5),"720p_1":zi(1280,720,5),"720p_2":zi(1280,720,30),"720p_3":zi(1280,720,15),"1080p":zi(1920,1080,5),"1080p_1":zi(1920,1080,5),"1080p_2":zi(1920,1080,30),"1080p_3":zi(1920,1080,15)},Lx={"1SL1TL":zf(1,1),"3SL3TL":zf(3,3),"2SL3TL":zf(2,3)};function vs(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Dx[e]):e}function Yf(e){return typeof e=="string"?Object.assign({},Px[e]):e}function ql(e){return typeof e=="string"?Object.assign({},Lx[e]):e}const kx={speech_low_quality:Ra(16e3,!1),speech_standard:Ra(32e3,!1,18),music_standard:Ra(48e3,!1),standard_stereo:Ra(48e3,!0,56),high_quality:Ra(48e3,!1,128),high_quality_stereo:Ra(48e3,!0,192)};function Jl(e){return typeof e=="string"?Object.assign({},kx[e]):e}function et(e,t,n){Object.keys(Wn).includes(e)&&(!n&&Object.keys(Rs).includes(e)||(Wn[e]=t))}function D(e){return Wn[e]}const Wn={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:wR,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},Rs={};function Ra(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Le(e,t,n,i,o){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:o}}function zi(e,t,n,i,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:o}}function zf(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}Kf||(Wn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Wn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Wn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Wn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Wn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Wn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Wn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Wn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Wn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Wn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Wn.AREAS=["NORTH_AMERICA","OVERSEA"]);const Mx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ys=[],Uc=[];function Is(e,t){return!!t&&ys.some(n=>n.uid===e&&n.channelName===t)}var Ux=el,xx=pr,Vx=lr,qf=function(e,t,n){var i=Ux(t);i in e?xx.f(e,i,Vx(0,n)):e[i]=n},NR=mp,jx=To,Fx=qf,Bx=$.Array,Gx=Math.max,bR=function(e,t,n){for(var i=jx(e),o=NR(t,i),a=NR(n===void 0?i:n,i),c=Bx(Gx(a-o,0)),l=0;o<a;o++,l++)Fx(c,l,e[o]);return c.length=l,c},DR=bR,Wx=Math.floor,Jf=function(e,t){var n=e.length,i=Wx(n/2);return n<8?Hx(e,t):Kx(e,Jf(DR(e,0,i),t),Jf(DR(e,i),t),t)},Hx=function(e,t){for(var n,i,o=e.length,a=1;a<o;){for(i=a,n=e[a];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==a++&&(e[i]=n)}return e},Kx=function(e,t,n,i){for(var o=t.length,a=n.length,c=0,l=0;c<o||l<a;)e[c+l]=c<o&&l<a?i(t[c],n[l])<=0?t[c++]:n[l++]:c<o?t[c++]:n[l++];return e},Yx=Jf,PR=us.match(/firefox\/(\d+)/i),zx=!!PR&&+PR[1],qx=/MSIE|Trident/.test(us),LR=us.match(/AppleWebKit\/(\d+)\./),Jx=!!LR&&+LR[1],Xx=Mn,kR=q,Qx=zr,$x=So,Zx=To,MR=sa,Xf=E,e2=Yx,t2=hp,UR=zx,n2=qx,xR=na,VR=Jx,Ao=[],jR=kR(Ao.sort),i2=kR(Ao.push),r2=Xf(function(){Ao.sort(void 0)}),o2=Xf(function(){Ao.sort(null)}),s2=t2("sort"),FR=!Xf(function(){if(xR)return xR<70;if(!(UR&&UR>3)){if(n2)return!0;if(VR)return VR<603;var e,t,n,i,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Ao.push({k:t+i,v:n})}for(Ao.sort(function(a,c){return c.v-a.v}),i=0;i<Ao.length;i++)t=Ao[i].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});Xx({target:"Array",proto:!0,forced:r2||!o2||!s2||!FR},{sort:function(e){e!==void 0&&Qx(e);var t=$x(this);if(FR)return e===void 0?jR(t):jR(t,e);var n,i,o=[],a=Zx(t);for(i=0;i<a;i++)i in t&&i2(o,t[i]);for(e2(o,function(c){return function(l,u){return u===void 0?-1:l===void 0?1:c!==void 0?+c(l,u)||0:MR(l)>MR(u)?1:-1}}(e)),n=o.length,i=0;i<n;)t[i]=o[i++];for(;i<a;)delete t[i++];return t}});var a2=vo("Array").sort,c2=z,d2=a2,Qf=Array.prototype,$f=function(e){var t=e.sort;return e===Qf||c2(Qf,e)&&t===Qf.sort?d2:t};function ya(e,t){if(typeof e!="boolean")throw new N(y.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Jt(e,t,n){if(!n.includes(e))throw new N(y.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function nt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e<n||e>i||o&&!l2(e))throw new N(y.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function Zf(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new N(y.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&nt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&nt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&nt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&nt(e.ideal,"".concat(t,".ideal"),1,1/0)}else nt(e,t,1,1/0)}function hn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new N(y.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!BR(e,n,i,o))throw new N(y.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(o?" ASCII characters only.":""))}function $r(e,t){if(!Array.isArray(e))throw new N(y.INVALID_PARAMS,"".concat(t," should be an array"))}function e_(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw v.error("Invalid Channel Name ".concat(e)),new N(y.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function t_(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||BR(e,1,255)))throw v.error("Invalid UID ".concat(e," ").concat(typeof e)),new N(y.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&v.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function dt(e){return e==null}function BR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||u2(e))}function l2(e){return typeof e=="number"&&e%1==0}function u2(e){if(typeof e!="string")return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}let GR,WR,pn;(function(e){e.FREE="free",e.UPLOADING="uploading"})(GR||(GR={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(WR||(WR={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(pn||(pn={}));const n_={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function h2(e){return hn(e.reportId,"params.reportId",0,100,!1),hn(e.category,"params.category",0,100,!1),hn(e.event,"params.event",0,100,!1),hn(e.label,"params.label",0,100,!1),nt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const p2={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let nn,_t,HR,i_,Nt,ut,Cs,Zr,Ia,xc,fi,fn,fe,r_,He,be,xn,Je,de,Ee,ti,we,KR,Hn;function YR(e){return nt(e.timeout,"config.timeout",0,1e5),nt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),nt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),nt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function f2(e){return Jt(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Jt(e.mode,"config.mode",["rtc","live"]),e.audioCodec!==void 0&&Jt(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),e.proxyServer!==void 0&&hn(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&zR(e.turnServer),e.httpRetryConfig!==void 0&&YR(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&YR(e.websocketRetryConfig),!0}function Vc(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function zR(e){return hn(e.turnServerURL,"turnServerURL"),hn(e.username,"username"),hn(e.password,"password"),e.udpport&&nt(e.udpport,"udpport",1,99999,!0),e.forceturn&&ya(e.forceturn,"forceturn"),e.security&&ya(e.security,"security"),e.tcpport&&nt(e.tcpport,"tcpport",1,99999,!0),!0}function qR(e){return e.level!==void 0&&Jt(e.level,"level",[1,2,3]),!0}(function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats"})(nn||(nn={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats"}(_t||(_t={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(HR||(HR={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(i_||(i_={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(Nt||(Nt={})),function(e){e.TRACER="tracer"}(ut||(ut={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(Cs||(Cs={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Zr||(Zr={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Ia||(Ia={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(xc||(xc={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(fi||(fi={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(fn||(fn={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(fe||(fe={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(r_||(r_={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(He||(He={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(be||(be={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(xn||(xn={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(Je||(Je={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback"}(de||(de={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter"}(Ee||(Ee={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(ti||(ti={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(we||(we={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(KR||(KR={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(Hn||(Hn={}));const o_={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},s_={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},JR={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},_2={uplinkNetworkQuality:0,downlinkNetworkQuality:0},XR={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Te,Ut,Oo;(function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(Te||(Te={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(Ut||(Ut={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Oo||(Oo={}));const E2={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},a_={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function c_(e,t){hn(e.url,"".concat(t,".url"),1,1e3,!1),dt(e.x)||nt(e.x,"".concat(t,".x"),0,1e4),dt(e.y)||nt(e.y,"".concat(t,".y"),0,1e4),dt(e.width)||nt(e.width,"".concat(t,".width"),0,1e4),dt(e.height)||nt(e.height,"".concat(t,".height"),0,1e4),dt(e.zOrder)||nt(e.zOrder,"".concat(t,".zOrder"),0,255),dt(e.alpha)||nt(e.alpha,"".concat(t,".alpha"),0,1,!1)}const m2={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},g2={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let qi,Ca,Rt,QR,_n,mr,Dn,wo,xt,ht,bt,Xl,ge,Ft,Aa,d_,l_,jc,No,Oa,ke;function $R(e){if(!e.channelName)throw new N(y.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new N(y.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&hn(e.token,"info.token",1,2047),t_(e.uid),e_(e.channelName),!0}function ZR(e){return Jt(e,"mediaSource",["screen","window","application"]),!0}(function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(qi||(qi={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Ca||(Ca={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Rt||(Rt={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(QR||(QR={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(_n||(_n={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(mr||(mr={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Dn||(Dn={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(wo||(wo={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(xt||(xt={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(ht||(ht={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data"}(bt||(bt={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(Xl||(Xl={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(ge||(ge={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(Ft||(Ft={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(Aa||(Aa={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(d_||(d_={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(l_||(l_={})),function(e){e.TRANSCEIVER_UPDATED="transceiver-updated"}(jc||(jc={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(No||(No={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Oa||(Oa={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(ke||(ke={}));const S2=[ke.AFRICA,ke.ASIA,ke.CHINA,ke.EUROPE,ke.GLOBAL,ke.INDIA,ke.JAPAN,ke.NORTH_AMERICA,ke.OCEANIA,ke.OVERSEA,ke.SOUTH_AMERICA];let Xt;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"})(Xt||(Xt={}));const Ql={CHINA:{},ASIA:{CODE:Xt.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Xt.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Xt.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Xt.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Xt.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Xt.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Xt.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Xt.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Xt.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Xt.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Xt.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Xt.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Xt.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let Fc,ey,Ie,rn,gr,oe,Bt,Me,Rn,bo,En,Kn,_i,Ei,Vt,Mr,mt,Sr,ty,ni,Di,Do;Kf&&(Ql.CHINA={CODE:Xt.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Fc||(Fc={}));class $l extends ft{constructor(t,n){super(),m(this,"onICEConnectionStateChange",void 0),m(this,"onConnectionStateChange",void 0),m(this,"onDTLSTransportStateChange",void 0),m(this,"onDTLSTransportError",void 0),m(this,"onICETransportStateChange",void 0),m(this,"onFirstAudioReceived",void 0),m(this,"onFirstVideoReceived",void 0),m(this,"onFirstAudioDecoded",void 0),m(this,"onFirstVideoDecoded",void 0),m(this,"onFirstVideoDecodedTimeout",void 0),m(this,"onSelectedLocalCandidateChanged",void 0),m(this,"onSelectedRemoteCandidateChanged",void 0),m(this,"establishPromise",void 0)}}(function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"})(ey||(ey={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(Ie||(Ie={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY"}(rn||(rn={})),function(e){e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(gr||(gr={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(oe||(oe={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(Bt||(Bt={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState"}(Me||(Me={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(Rn||(Rn={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(bo||(bo={})),function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(En||(En={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(Kn||(Kn={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(_i||(_i={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Ei||(Ei={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Vt||(Vt={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(Mr||(Mr={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(mt||(mt={})),function(e){e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Sr||(Sr={})),function(e){e[e.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",e[e.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",e[e.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",e[e.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",e[e.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",e[e.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",e[e.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",e[e.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",e[e.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",e[e.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",e[e.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",e[e.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",e[e.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",e[e.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",e[e.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",e[e.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",e[e.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",e[e.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",e[e.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",e[e.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(ty||(ty={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(ni||(ni={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Di||(Di={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Do||(Do={}));const yn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function Ct(){return yn}let Kt;(function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Kt||(Kt={}));var T2=je,Bc=Array.isArray||function(e){return T2(e)=="Array"},v2=$,ny=Bc,R2=jp,y2=Yi,I2=ln("species"),iy=v2.Array,C2=function(e){var t;return ny(e)&&(t=e.constructor,(R2(t)&&(t===iy||ny(t.prototype))||y2(t)&&(t=t[I2])===null)&&(t=void 0)),t===void 0?iy:t},ry=function(e,t){return new(C2(e))(t===0?0:t)},A2=Ic,O2=hr,w2=So,N2=To,b2=ry,oy=q([].push),Po=function(e){var t=e==1,n=e==2,i=e==3,o=e==4,a=e==6,c=e==7,l=e==5||a;return function(u,f,p,_){for(var S,R,C=w2(u),A=O2(C),O=A2(f,p),k=N2(A),M=0,H=_||b2,re=t?H(u,k):n||c?H(u,0):void 0;k>M;M++)if((l||M in A)&&(R=O(S=A[M],M,C),e))if(t)re[M]=R;else if(R)switch(e){case 3:return!0;case 5:return S;case 6:return M;case 2:oy(re,S)}else switch(e){case 4:return!1;case 7:oy(re,S)}return a?-1:i||o?o:re}},sy={forEach:Po(0),map:Po(1),filter:Po(2),some:Po(3),every:Po(4),find:Po(5),findIndex:Po(6),filterReject:Po(7)},D2=sy.forEach,ay=hp("forEach")?[].forEach:function(e){return D2(this,e,arguments.length>1?arguments[1]:void 0)};Mn({target:"Array",proto:!0,forced:[].forEach!=ay},{forEach:ay});var P2=vo("Array").forEach,L2=yo,k2=ei,M2=z,U2=P2,u_=Array.prototype,x2={DOMTokenList:!0,NodeList:!0},V2=function(e){var t=e.forEach;return e===u_||M2(u_,e)&&t===u_.forEach||k2(x2,L2(e))?U2:t},j2=So,cy=Rp;Mn({target:"Object",stat:!0,forced:E(function(){cy(1)})},{keys:function(e){return cy(j2(e))}});var F2=go.Object.keys,B2=hS,G2=Mn,W2=Bc,H2=q([].reverse),dy=[1,2];G2({target:"Array",proto:!0,forced:String(dy)===String(dy.reverse())},{reverse:function(){return W2(this)&&(this.length=this.length),H2(this)}});var K2=vo("Array").reverse,Y2=z,z2=K2,h_=Array.prototype,q2=function(e){var t=e.reverse;return e===h_||Y2(h_,e)&&t===h_.reverse?z2:t},J2=E,X2=na,Q2=ln("species"),ly=function(e){return X2>=51||!J2(function(){var t=[];return(t.constructor={})[Q2]=function(){return{foo:1}},t[e](Boolean).foo!==1})},$2=Mn,Z2=$,uy=Bc,eV=jp,tV=Yi,hy=mp,nV=To,iV=mo,rV=qf,oV=ln,sV=Fp,aV=ly("slice"),cV=oV("species"),p_=Z2.Array,dV=Math.max;$2({target:"Array",proto:!0,forced:!aV},{slice:function(e,t){var n,i,o,a=iV(this),c=nV(a),l=hy(e,c),u=hy(t===void 0?c:t,c);if(uy(a)&&(n=a.constructor,(eV(n)&&(n===p_||uy(n.prototype))||tV(n)&&(n=n[cV])===null)&&(n=void 0),n===p_||n===void 0))return sV(a,l,u);for(i=new(n===void 0?p_:n)(dV(u-l,0)),o=0;l<u;l++,o++)l in a&&rV(i,o,a[l]);return i.length=o,i}});var lV=vo("Array").slice,uV=z,hV=lV,f_=Array.prototype,pV=function(e){var t=e.slice;return e===f_||uV(f_,e)&&t===f_.slice?hV:t};function G(e,t,n,i,o){var a,c,l,u={};return V2(a=F2(i)).call(a,function(f){u[f]=i[f]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=B2(c=q2(l=pV(n).call(n)).call(l)).call(c,function(f,p){return p(e,t,f)||f},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0&&(Zv(e,t,u),u=null),u}var fV=vo("Array").keys,_V=yo,EV=ei,mV=z,gV=fV,__=Array.prototype,SV={DOMTokenList:!0,NodeList:!0},As=function(e){var t=e.keys;return e===__||mV(__,e)&&t===__.keys||EV(SV,_V(e))?gV:t};function py(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function fy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?py(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):py(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Zl=0,E_=0;function Ji(e,t,n,i){return new ie((o,a)=>{t.timeout=t.timeout||D("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Zl+=La(t.data)):n&&(t.data.size?Zl+=t.data.size:t.data instanceof FormData?Zl+=function(c){let l=0;return/DingTalk/i.test(navigator.userAgent)&&c.realFormData&&(c=c.realFormData),c.forEach(u=>{l+=typeof u=="string"?La(u):u.size}),l+138}(t.data):Zl+=La(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,hi.request(t).then(c=>{typeof c.data=="string"?E_+=La(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?E_+=c.data.byteLength:E_+=La(JSON.stringify(c.data)),i&&o({data:c.data,headers:c.headers}),o(c.data)}).catch(c=>{hi.isCancel(c)?a(new N(y.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new N(y.NETWORK_TIMEOUT,c.message)):c.response?a(new N(y.NETWORK_RESPONSE_ERROR,c.response.status)):a(new N(y.NETWORK_ERROR,c.message))})})}async function TV(e,t){const n=new Blob([t.data],{type:"buffer"});return await Ji(e,fy(fy({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Dt=new class extends ft{set networkState(e){v.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(bo.NETWORK_STATE_CHANGE,e,this._networkState),e===Rn.ONLINE?this.emit(bo.ONLINE):e===Rn.OFFLINE&&(this.onlineWaiter=new ie(t=>{this.once(bo.ONLINE,()=>{this.onlineWaiter=void 0,t(Rn.ONLINE)})}),this.emit(bo.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}constructor(){super(),m(this,"_moduleName","network-indicator"),m(this,"_networkState",Rn.ONLINE),m(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Rn.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Rn.OFFLINE})}};let m_=!1;const mi=new class extends ft{constructor(){super(...arguments),m(this,"onAutoplayFailed",void 0),m(this,"onAudioAutoplayFailed",void 0)}};function _y(){if(We(),!m_){const e=t=>{t.preventDefault(),m_=!1,Lc()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};m_=!0,Lc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),mi.onAutoplayFailed?mi.onAutoplayFailed():mi.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),mi.emit("autoplay-failed")}}function g_(e){return new TextEncoder().encode(e)}const Ey=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},vV=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(o=>{i+=o.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",g_(e)),16);function my(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?my(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):my(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function pe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const o=i.value;if(typeof o=="function"){const a=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];let f=l;if(e.argsMap)try{f=e.argsMap(this,...l)}catch(_){v.warning(_),f=[]}try{JSON.stringify(f)}catch{v.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),f=[]}const p=(e.report||se).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(n)),options:f,tag:ut.TRACER,reportResult:e.reportResult},e.throttleTime);try{const _=o.apply(this,l);return _ instanceof ie?_.then(S=>(p.onSuccess(e.reportResult&&S),S)).catch(S=>{throw p.onError(S),S}):(p.onSuccess(e.reportResult&&_),_)}catch(_){throw p.onError(_),_}}}return i}}const se=new class{constructor(){m(this,"baseInfoMap",new Map),m(this,"proxyServer",void 0),m(this,"clientList",ys),m(this,"eventUploadTimer",void 0),m(this,"setSessionIdTimer",void 0),m(this,"url",void 0),m(this,"backupUrl",void 0),m(this,"_appId",void 0),m(this,"keyEventUploadPendingItems",[]),m(this,"normalEventUploadPendingItems",[]),m(this,"apiInvokeUploadPendingItems",[]),m(this,"apiInvokeCount",0),m(this,"ltsList",[]),m(this,"lastSendNormalEventTime",Date.now()),m(this,"customReportCounterTimer",void 0),m(this,"customReportCount",0),m(this,"extApiInvoke",async e=>{for(const t of e){const n=Ce(Ce({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:ut.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),D("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),D("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void v.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),i=t.startTime;t.startTime=n,v.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-i,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,a=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}),c=!!D("SHOW_REPORT_INVOKER_LOG");c&&v.info("".concat(t.name," start"),t.options);let l=!1;gn(t.timeout).then(()=>{l||(this.sendApiInvoke(Ce(Ce({},a()),{},{error:y.API_INVOKE_TIMEOUT,success:!1})),v.debug("".concat(t.name," timeout")))});const u=new N(y.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:f=>{const p=()=>{if(l)throw u;return l=!0,this.sendApiInvoke(Ce(Ce({},a()),{},{success:!0},t.reportResult&&{result:f})),c&&v.info("".concat(t.name," onSuccess")),f};return n?LI(p,t.name+"Success",n,()=>l=!0):p()},onError:f=>{const p=()=>{if(l)throw f;l=!0,this.sendApiInvoke(Ce(Ce({},a()),{},{success:!1,error:f})),c&&v.info("".concat(t.name," onFailure"),f.toString())};return n?LI(p,t.name+"Error",n,()=>l=!0):p()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const o=Object.assign({},{willUploadConsoleLog:D("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Kf?"global":"oversea",areas:D("AREAS")&&D("AREAS").join(",")},t.extend),a=Date.now(),c=Ce(Ce({},i),{},{eventType:nn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:Hf,lts:a,elapse:a-n,extend:JSON.stringify(o),mode:t.mode,process:D("PROCESS_ID"),appType:D("APP_TYPE"),success:!0,version:bi});this.send({type:_t.SESSION,data:c},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce({},i),{},{eventType:nn.JOIN_CHOOSE_SERVER,lts:o,eventElapse:o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:_t.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce({},i),{},{eventType:nn.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:_t.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const o=Date.now(),{firstSuccess:a,avoidJoinStartTime:c,isProxy:l,addr:u}=t,f=o-(a&&c?c:n.startTime),p=Ce(Ce({},i),{},{eventType:nn.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:f,eventElapse:o-t.lts,firstSuccess:a,signalChannel:t.signalChannel}),_=p.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),a)this.send({type:_t.JOIN_GATEWAY,data:p},!0);else{let S;if(u)if(l){const C=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),A=u.match(/p=[0-9]{1,6}/g);S={isSuccess:_,gatewayIp:C&&C.length?C[0].split("=")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split("=")[1]:"",isProxy:l?1:0}}else{const C=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),A=u.match(/:[0-9]{1,6}/g);S={isSuccess:_,gatewayIp:C&&C.length?C[0].split("//")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split(":")[1]:"",isProxy:l?1:0}}else S={isSuccess:_,gatewayIp:"",port:"",isProxy:l?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const R=Object.assign({},p,S,{eventType:nn.REJOIN_GATEWAY});this.send({type:_t.RE_JOIN_GATEWAY,data:R},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),o=Ce(Ce({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:_t.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce({},i),{},{eventType:nn.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:_t.PUBLISH,data:a},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),c=Ce(Ce({},o),{},{eventType:nn.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?c.peerSuid=t.peerid:c.peer=t.peerid,this.send({type:_t.SUBSCRIBE,data:c},!0)}wsCompressorInit(e){var t;const n=[...As(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(i);if(!o)return;const a=o.info,c=Date.now(),l=Ce(Ce({},a),{},{eventType:nn.WS_COMPRESSOR_INIT,lts:c,eventElapse:e.eventElapse,elapse:c-o.startTime,status:e.status?1:2});this.send({type:_t.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ce(Ce(Ce({},a),i),{},{elapse:c-o.startTime,eventType:t,lts:c,firstDecodeFrame:Math.max(c-o.startTime,0),apEnd:Math.max(i.apEnd-o.startTime,0),apStart:Math.max(i.apStart-o.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-o.startTime,0),joinGwStart:Math.max(i.joinGwStart-o.startTime,0),pcEnd:Math.max(i.pcEnd-o.startTime,0),pcStart:Math.max(i.pcStart-o.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-o.startTime,0),subscriberStart:Math.max(i.subscriberStart-o.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-o.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ce(Ce(Ce({},a),i),{},{elapse:c-o.startTime,eventType:t,lts:c});this.send({type:n,data:l},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce(Ce({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:nn.PC_STATS,lts:o});this.send({type:_t.PC_STATS,data:a},!0)}onGatewayStream(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ce(Ce(Ce({},a),i),{},{eventType:t,lts:c});this.send({type:n,data:l},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce({},i),{},{eventType:nn.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:_t.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce({},i),{},{eventType:nn.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:_t.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce({},i),{},{eventType:nn.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:_t.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(e){this.proxyServer=e,e?v.debug("reportProxyServerurl: ".concat(e)):v.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:_t.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now();(function(a,c,l){const u=a[c];if(!u||typeof u!="string")return[a];a[c]="";const f=La(JSON.stringify(a));let p=0;const _=[];let S=0;for(let R=0;R<u.length;R++)S+=u.charCodeAt(R)<=127?1:3,S<=l-f||(_[_.length]=Ns(Ns({},a),{},{[c]:u.substring(p,R)}),p=R,S=u.charCodeAt(R)<=127?1:3);return p!==u.length-1&&(_[_.length]=Ns(Ns({},a),{},{[c]:u.substring(p)})),_})(Ce(Ce(Ce({},i),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:_t.WORKER_EVENT,data:a},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce(Ce({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:_t.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce(Ce({},i),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:_t.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ce(Ce(Ce({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:_t.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>D("CUSTOM_REPORT_LIMIT"))throw new N(y.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(o=>({type:_t.USER_ANALYTICS,data:Ce(Ce({sid:e},o),{},{lts:n})}));try{D("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(o){throw v.error("send custom report message failed",o.toString()),new N(y.CUSTOM_REPORT_SEND_FAILED,o.message)}}autoplayFailed(e,t,n,i){if(!e)return;const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ce(Ce({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:c,elapse:c-o.startTime,cbRegistered:mi.onAutoplayFailed||mi.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});this.send({type:_t.AUTOPLAY_FAILED,data:l},!0)}sendApiInvoke(e){const t=D("NOT_REPORT_EVENT");if(e.tag&&t.includes&&t.includes(e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:o,cid:a}=n.info;e.lts=e.lts||Date.now();let c;if(e.error)if(e.error instanceof N){const{code:u,message:f}=e.error;c=u||f||e.error.toString()}else c=e.error.toString();const l={invokeId:e.invokeId,sid:e.sid,cname:i,cid:a,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?c:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:_t.API_INVOKE,data:l},!1),!0}appendSessionId(){this.clientList.forEach(e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const i=this.apiInvokeUploadPendingItems.shift();i&&(i.sid=e._sessionId,this.sendApiInvoke(Object.assign({},i)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>D("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const a=e.shift();n.length<20?n.push(a):i.push(a)}e.push(...i);for(const a of[...n]){var o;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),$f(o=this.ltsList).call(o,(c,l)=>c-l))}return t||(this.lastSendNormalEventTime=Date.now()),D("ENABLE_EVENT_REPORT")&&n.length&&(D("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((a=>c=>{D("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>D("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-D("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Dt.networkState===Rn.OFFLINE&&await ie.race([Dt.onlineWaiter,gn(2*wt.maxRetryTimeout)]);const t=o=>{let a=new Uint8Array;return o.forEach(c=>{const l=g_(JSON.stringify(c.data)),u=new ArrayBuffer(5),f=(_=>{let S=0;return Object.entries(_t).forEach(R=>{let[C,A]=R;A===_.type&&(S=i_[C])}),S})(c),p=new DataView(u);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&f),p.setUint8(3,f>>>8&255),p.setUint8(4,f>>>16&255),a=Ey(a,new Uint8Array(u)),a=Ey(a,l)}),a},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(D("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(D("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Ji(i,{timeout:1e4,data:t(e),headers:Ce(Ce({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(o===1)throw a;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(a=>JSON.stringify(a)),vid:(a=>{const c=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return c&&c.info.vid&&+c.info.vid||0})(e[0])};Dt.networkState===Rn.OFFLINE&&await ie.race([Dt.onlineWaiter,gn(2*wt.maxRetryTimeout)]);const i=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("EVENT_REPORT_DOMAIN"),"&p=").concat(D("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(D("EVENT_REPORT_DOMAIN"),":").concat(D("STATS_COLLECTOR_PORT")).concat(i));for(let a=0;a<2;a+=1){a===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(D("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(D("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(D("STATS_COLLECTOR_PORT")).concat(i)));try{t?await TV(o,{timeout:1e4,data:n}):await Ji(o,{timeout:1e4,data:n})}catch(c){if(a===1)throw c;continue}return}}createBaseInfo(e,t){const n=Object.assign({},p2);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:ut.TRACER}).onSuccess()}};Yl.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Dt.networkState,se.reportApiInvoke(null,{name:"logUploadError",options:e,tag:ut.TRACER})});class gy extends ft{constructor(t,n){super(),m(this,"trackMediaType",void 0),m(this,"_ID",void 0),m(this,"_rtpTransceiver",void 0),m(this,"_lowRtpTransceiver",void 0),m(this,"_hints",[]),m(this,"_isClosed",!1),m(this,"_originMediaStreamTrack",void 0),m(this,"_mediaStreamTrack",void 0),m(this,"_external",{}),this._ID=n||at(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(i){Uc.includes(i)||Uc.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const n=se.reportApiInvoke(null,{name:Nt.GET_MEDIA_STREAM_TRACK,options:[],tag:ut.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Aa.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Uc.indexOf(t);n!==-1&&Uc.splice(n,1)}(this),this.emit(No.CLOSED)}_updateRtpTransceiver(t,n){if(n===Aa.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(jc.TRANSCEIVER_UPDATED,t,n)}}let Yt,RV=1;class Pn{constructor(t){m(this,"lockingPromise",ie.resolve()),m(this,"locks",0),m(this,"name",""),m(this,"lockId",void 0),this.lockId=RV++,t&&(this.name=t),v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let n;this.locks+=1,v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const i=new ie(a=>{n=()=>{this.locks-=1,v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),a()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),o}}function wa(e,t){return function(n,i,o){const a=o.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const l=await c.lock("From ".concat(e,".").concat(i));try{for(var u=arguments.length,f=new Array(u),p=0;p<u;p++)f[p]=arguments[p];return await a.apply(this,f)}finally{l()}},o}}class S_ extends gy{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,n){super(t,n),m(this,"_enabled",!0),m(this,"_muted",!1),m(this,"_isExternalTrack",!1),m(this,"_isClosed",!1),m(this,"_enabledMutex",void 0),m(this,"processor",void 0),m(this,"_processorContext",void 0),m(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Pn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(ge.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await St(this,ge.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(No.TRACK_ENDED)}stateCheck(t,n){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),ya(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new N(y.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new N(y.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function Sy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}(function(e){e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"})(Yt||(Yt={}));const Ty=window.AudioContext||window.webkitAudioContext;let gi=null;const Ke=new class extends ft{constructor(){super(...arguments),m(this,"prevState",void 0),m(this,"curState",void 0),m(this,"currentTime",void 0),m(this,"currentTimeStuckAt",void 0),m(this,"interruptDetectorTrack",void 0),m(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit(Yt.IOS_15_16_INTERRUPTION_START)}),m(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(gi&&await gi.suspend(),this.emit(Yt.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){v.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){v.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function yV(){if(!Ty)return void v.error("your browser is not support web audio");v.info("create audio context");const e=function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Sy(Object(i),!0).forEach(function(o){m(t,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Sy(Object(i)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(i,o))})}return t}({},D("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(e)),gi=new Ty(e),Ke.curState=gi.state,gi.onstatechange=()=>{Ke.prevState=Ke.curState,Ke.curState=gi?gi.state:void 0;const{prevState:t,curState:n}=Ke,i=n==="running",o=n==="interrupted",a=t==="running",c=t==="suspended",l=t==="interrupted",u=We().osVersion;(Nn()||kr())&&a&&o&&(v.info("ios".concat(u,"-interruption-start")),Ke.emit(Yt.IOS_INTERRUPTION_START)),(Nn()||kr())&&(c||l)&&i&&(v.info("ios".concat(u,"-interruption-end")),Ke.emit(Yt.IOS_INTERRUPTION_END)),t!==n&&(v.debug("AudioContext State Change","".concat(t,"=>").concat(n)),Ke.emit(Yt.STATE_CHANGE))},setInterval(()=>{var t;const n=(t=gi)===null||t===void 0?void 0:t.currentTime;Ke.currentTime!==n?(Ke.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(n)),Ke.currentTimeStuckAt=void 0),Ke.currentTime=n):(n!==Ke.currentTimeStuckAt&&(se.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:ut.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(n))),Ke.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,o=!1,a=!1,c=!1;function l(O){t.state==="running"?u(!1):Nn()||kr()?t.state==="suspended"&&(u(!0),O&&t.resume().then(p,p)):t.state!=="closed"&&(u(!0),O&&t.resume().then(p,p))}function u(O){if(o!==O){o=O;for(let k=0,M=n;k<M.length;k+=1){const H=M[k];O?window.addEventListener(H,_,{capture:!0,passive:!0}):window.removeEventListener(H,_,{capture:!0,passive:!0})}}}function f(){l(!0)}function p(){l(!1)}function _(){l(!0)}function S(O){if(!c)if(i.paused)if(O){R(!1),c=!0;let k;try{k=i.play(),k?k.then(C,C):(i.addEventListener("playing",C),i.addEventListener("abort",C),i.addEventListener("error",C))}catch{C()}}else R(!0);else R(!1)}function R(O){if(a!==O){a=O;for(let k=0,M=n;k<M.length;k++){const H=M[k];O?window.addEventListener(H,A,{capture:!0,passive:!0}):window.removeEventListener(H,A,{capture:!0,passive:!0})}}}function C(){i.removeEventListener("playing",C),i.removeEventListener("abort",C),i.removeEventListener("error",C),c=!1,S(!1)}function A(){S(!0)}if(Nn()){const O=t.createMediaStreamDestination(),k=document.createElement("div");k.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=k.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=O.stream,S(!0)}Ke.on(Yt.STATE_CHANGE,f),l(!1)}(gi)}function Na(){if(!gi){if(yV(),!gi)throw new N(y.NOT_SUPPORTED,"can not create audio context");return gi}return gi}function vy(){return!!gi}function Os(e){if(function(){if(T_!==null)return T_;const i=Na(),o=i.createBufferSource(),a=i.createGain(),c=i.createGain();o.connect(a),o.connect(c),o.disconnect(a);let l=!1;try{o.disconnect(a)}catch{l=!0}return o.disconnect(),T_=l,l}())return;const t=e.connect,n=e.disconnect;e.connect=(i,o,a)=>(e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,o,a)):t.call(e,i,o)),e),e.disconnect=(i,o,a)=>{n.call(e),i?N_(e._inputNodes,i):e._inputNodes=[];for(const c of e._inputNodes)t.call(e,c)}}let T_=null;function Ry(e,t){let n=!1;const i=1/t;if(D("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*i)}else{const o=Na();let a=o.createGain();a.gain.value=0,a.connect(o.destination);const c=()=>{if(n)return void(a=null);const l=o.createOscillator();l.onended=c,l.connect(a),l.start(0),l.stop(o.currentTime+i),e(o.currentTime)};c()}return()=>{n=!0}}class yy{constructor(){m(this,"context",void 0),m(this,"analyserNode",void 0),m(this,"sourceNode",void 0),this.context=Na(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Nn()||kr()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let o=0;o<t.length;++o)t[o]=i[o]/128-1}const n=Ro(t).call(t,(i,o)=>i+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Iy extends ft{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),m(this,"outputNode",void 0),m(this,"outputTrack",void 0),m(this,"isPlayed",!1),m(this,"sourceNode",void 0),m(this,"context",void 0),m(this,"audioBufferNode",void 0),m(this,"destNode",void 0),m(this,"audioOutputLevel",0),m(this,"volumeLevelAnalyser",void 0),m(this,"_processedNode",void 0),m(this,"playNode",void 0),m(this,"isDestroyed",!1),m(this,"onNoAudioInput",void 0),m(this,"isNoAudioInput",!1),m(this,"_noAudioInputCount",0),this.context=Na(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Os(this.outputNode),this.volumeLevelAnalyser=new yy}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Hn.ON_AUDIO_BUFFER,function(i){for(let o=0;o<i.outputBuffer.numberOfChannels;o+=1){const a=i.outputBuffer.getChannelData(o);for(let c=0;c<a.length;c+=1)a[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ct().webAudioMediaStreamDest)throw new N(y.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Tr(()=>{Ke.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Nn()||kr()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let o=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await gn(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class v_ extends Iy{get isFreeze(){return!1}constructor(t,n,i){var o;if(super(),m(this,"sourceNode",void 0),m(this,"track",void 0),m(this,"clonedTrack",void 0),m(this,"audioElement",void 0),m(this,"isCurrentTrackCloned",!1),m(this,"isRemoteTrack",!1),m(this,"originVolumeLevelAnalyser",void 0),m(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const u=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(u),Os(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),Os(this.outputNode),this.emit(Hn.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=u,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new N(y.UNEXPECTED_ERROR);this.track=t;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),Os(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,v.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([l]));Os(u),this.originVolumeLevelAnalyser=new yy,this.originVolumeLevelAnalyser.updateSource(u)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const c=We();n&&c.os===un.IOS&&Number((o=c.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(Ke.on(Yt.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Os(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Hn.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Ke.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),v.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Os(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Cy(e,t){const n=(o,a)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||a:o:a,i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function IV(e){const t=await Ay(e.mediaSource),n=await function(i){return new ie((o,a)=>{const c=document.createElement("div");c.innerText="share screen",c.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const l=document.createElement("div");l.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const u=document.createElement("div");u.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",u.setAttribute("style","height: 12%;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const p=document.createElement("div");p.setAttribute("style","text-align: right; padding: 16px 0;");const _=document.createElement("button");_.innerHTML="cancel",_.setAttribute("style","width: 85px;"),_.onclick=()=>{document.body.removeChild(S);const R=new Error("NotAllowedError");R.name="NotAllowedError",a(R)},p.appendChild(_),l.appendChild(u),l.appendChild(f),l.appendChild(p);const S=document.createElement("div");S.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),S.appendChild(c),S.appendChild(l),document.body.appendChild(S),i.map(R=>{if(R.id){const C=document.createElement("div");C.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let A=R.thumbnail;const{width:O}=A.getSize();O>1920&&(A=A.resize({width:1920})),C.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+A.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(R.name.replace(/[\u00A0-\u9999<>\&]/g,function(k){return"&#"+k.charCodeAt(0)+";"})+"</span>"),C.onclick=()=>{document.body.removeChild(S),o(R.id)},f.appendChild(C)}})})}(t);return await Cy(n,e)}async function Ay(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=Oy();if(!n)throw new N(y.ELECTRON_IS_NULL);let i=null;try{var o;i=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new ie((a,c)=>{n.desktopCapturer.getSources({types:t},(l,u)=>{l?c(l):a(u)})}));try{return await i}catch(a){throw new N(y.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}let eu=null;function Oy(){if(eu)return eu;try{return eu=window.require("electron"),eu}catch{return null}}function wy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}const R_=new Pn("safari");let Ny=!1,by=!1;async function Xi(e,t){let n=0,i=null;for(;n<2;)try{i=await CV(e,t,n>0);break}catch(o){if(o instanceof N)throw v.error("[".concat(t,"] ").concat(o.toString())),o;const a=tu(o.name||o.code||o,o.message);if(a.code===y.MEDIA_OPTION_INVALID){v.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await gn(500);continue}throw v.error("[".concat(t,"] ").concat(a.toString())),a}if(!i)throw new N(y.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function CV(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new N(y.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=Ct(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return v.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(Oy())e.screen.sourceId?ba(o,await Cy(e.screen.sourceId,e.screen)):ba(o,await IV(e.screen));else if(If()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new N(y.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const S=await(c=e.screen.extensionId,l=t,new ie((R,C)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},A=>{if(!A||!A.streamId)return v.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),A),void C(new N(y.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));R(A.streamId)})}catch(A){v.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),A.toString()),C(new N(y.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=S,ba(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var a;e.screen.mediaSource&&ZR(e.screen.mediaSource);const S={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(a=e.screen.displaySurface)!==null&&a!==void 0?a:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:R,surfaceSwitching:C,systemAudio:A}=e.screen,O={selfBrowserSurface:R,surfaceSwitching:C,systemAudio:A};!R&&delete O.selfBrowserSurface,!C&&delete O.surfaceSwitching,!A&&delete O.systemAudio,v.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:S,audio:!!e.screenAudio,controls:O})),ba(o,await navigator.mediaDevices.getDisplayMedia(function(k){for(var M=1;M<arguments.length;M++){var H=arguments[M]!=null?arguments[M]:{};M%2?wy(Object(H),!0).forEach(function(re){m(k,re,H[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(H)):wy(Object(H)).forEach(function(re){Object.defineProperty(k,re,Object.getOwnPropertyDescriptor(H,re))})}return k}({video:S,audio:!!e.screenAudio},O)))}else{if(!Et())throw v.error("[".concat(t,"] This browser does not support screenSharing")),new N(y.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&ZR(e.screen.mediaSource);const S={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};v.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(S))),ba(o,await navigator.mediaDevices.getUserMedia(S))}}var c,l;if(!e.video&&!e.audio)return o;let u={video:e.video,audio:e.audio},f=D("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),u=function S(R,C){if(!kI(R)||!kI(C)||Array.isArray(R)&&!Array.isArray(C)||!Array.isArray(R)&&Array.isArray(C))return C;if(Array.isArray(C)&&Array.isArray(R)){const A=[...R];for(let O=0;O<C.length;O++)A[O]=S(R[O],C[O]);return A}{const A=Ns({},R);for(const O in C)Object.prototype.hasOwnProperty.call(C,O)&&(Object.prototype.hasOwnProperty.call(R,O)?A[O]=S(R[O],C[O]):A[O]=C[O]);return A}}(u,f)}catch{}v.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(u)),We();let p,_=null;(wn()||Nn()||Ul())&&(_=await R_.lock());try{p=await navigator.mediaDevices.getUserMedia(u)}catch(S){throw _&&_(),S}return u.audio&&(Ny=!0),u.video&&(by=!0),ba(o,p),_&&_(),o}function tu(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new N(y.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new N(y.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new N(y.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new N(y.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new N(y.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new N(y.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return v.error("getUserMedia unexpected error",e),new N(y.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function ba(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],o=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(i&&e.removeTrack(i),e.addTrack(a)),o&&(n&&e.removeTrack(n),e.addTrack(o))}const Si=new class extends ft{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Zr.STATE_CHANGE,e),this._state=e)}constructor(){super(),m(this,"_state",Cs.IDLE),m(this,"isAccessMicrophonePermission",!1),m(this,"isAccessCameraPermission",!1),m(this,"lastAccessMicrophonePermission",!1),m(this,"lastAccessCameraPermission",!1),m(this,"checkdeviceMatched",!1),m(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(D("ENUMERATE_DEVICES_INTERVAL")||(xl()||Bv()===un.HARMONY_OS)&&Ss())&&this.updateDevicesInfo()},D("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>v.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new N(y.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(i);let a=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;o.audio&&(a=!1),o.video&&(c=!1);let l=null,u=null,f=null;if(!n&&(a||c)){if(R_.isLocked&&(v.debug("[device manager] wait GUM lock"),(await R_.lock())(),v.debug("[device manager] GUM unlock")),Ny&&(a=!1,this.isAccessMicrophonePermission=!0),by&&(c=!1,this.isAccessCameraPermission=!0),v.debug("[device manager] check media device permissions",e,t,a,c),a&&c){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const _=tu(p.name||p.code||p,p.message);if(_.code===y.PERMISSION_DENIED)throw _;v.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({audio:e})}catch(p){const _=tu(p.name||p.code||p,p.message);if(_.code===y.PERMISSION_DENIED)throw _;v.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({video:t})}catch(p){const _=tu(p.name||p.code||p,p.message);if(_.code===y.PERMISSION_DENIED)throw _;v.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}v.debug("[device manager] mic permission",e,"cam permission",t)}try{const p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),f&&f.getTracks().forEach(_=>_.stop()),l=null,u=null,f=null,p}catch(p){return l&&l.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),f&&f.getTracks().forEach(_=>_.stop()),l=null,u=null,f=null,new N(y.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new N(y.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Cs.INITING;try{await this.updateDevicesInfo(),this.state=Cs.INITEND}catch(e){throw v.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Cs.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new N(y.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),a=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");o&&a?a.groupId===o.groupId?v.debug("[device-check] default input ".concat(o.label," and output ").concat(a.label," is the same group")):v.warning("[device-check] default input ".concat(o.label," and output ").concat(a.label," is not the same group")):v.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(o=>{if(!o.deviceId)return;const a=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const c={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),c),n.push(c)}a&&(a.updateAt=t)}),this.deviceInfoMap.forEach((o,a)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state!==Cs.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Zr.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Zr.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Zr.PLAYOUT_DEVICE_CHANGED,o)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(o=>o.kind==="audioinput"),n=e.filter(o=>o.kind==="videoinput"),i={audio:!1,video:!1};for(const o of t)if(o.label&&o.deviceId){i.audio=!0;break}for(const o of n)if(o.label&&o.deviceId){i.video=!0;break}return i}},AV=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ii=new class{constructor(){m(this,"onAutoplayFailed",void 0),m(this,"elementMap",new Map),m(this,"elementStateMap",new Map),m(this,"elementsNeedToResume",[]),m(this,"sinkIdMap",new Map),m(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=this.elementStateMap.get(t),o=n.srcObject.getAudioTracks()[0];_a()?o&&o.readyState==="live"&&Ke.curState==="running"&&(v.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):i&&i==="paused"&&o&&o.readyState==="live"&&Ke.curState==="running"&&(v.debug("auto resume after interruption for iOS"),n.play())})}),m(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Ke.on(Yt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ke.on(Yt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ke.on(Yt.STATE_CHANGE,()=>{Nn()&&Ke.prevState==="suspended"&&Ke.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new N(y.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,pn.INIT),this.setVolume(t,n);const a=this.sinkIdMap.get(t);if(a)try{o.setSinkId(a).catch(l=>{v.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){v.warning("[".concat(t,"] set sink id failed"),l.toString())}const c=o.play();c&&c.then&&c.catch(l=>{i&&se.autoplayFailed(i,"audio",l.message,t),v.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),Tr(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_y()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){AV.forEach(n=>{t.addEventListener(n,i=>{const o=this.elementStateMap.get(e),a=i.type==="pause"?"paused":i.type;if(v.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(a)),i.type==="error"){const c=t==null?void 0:t.error;c&&v.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,a)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{v.debug("Auto resume audio element success")}).catch(n=>{v.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ie(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Lc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function gt(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new N(y.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];const l=i.apply(this,a);return l instanceof ie?new ie((u,f)=>{l.then(u).catch(f)}):l}),n}}var OV=vo("Array").values,wV=yo,NV=ei,bV=z,DV=OV,y_=Array.prototype,PV={DOMTokenList:!0,NodeList:!0},Ur=function(e){var t=e.values;return e===y_||bV(y_,e)&&t===y_.values||NV(PV,wV(e))?DV:t};function Dy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function nu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Dy(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dy(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Py extends ft{constructor(t){super(),m(this,"name","VideoProcessorDestination"),m(this,"ID","0"),m(this,"_source",void 0),m(this,"videoContext",void 0),m(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new N(y.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new N(y.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(En.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(En.ON_TRACK,void 0)}}class Ly extends ft{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),m(this,"constraintsMap",new Map),m(this,"statsRegistry",[]),m(this,"usageRegistry",[]),m(this,"trackId",void 0),m(this,"direction",void 0),m(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Sn(this,Kn.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return v.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),St(this,Kn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ur(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return v.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),St(this,Kn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ur(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:i,type:o,stats:c})}catch(c){v.error(new N(y.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof ie&&(i=await i),t.push(nu(nu({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class ky extends ft{constructor(t){super(),m(this,"name","AudioProcessorDestination"),m(this,"ID","0"),m(this,"inputTrack",void 0),m(this,"inputNode",void 0),m(this,"audioProcessorContext",void 0),m(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new N(y.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new N(y.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(En.ON_TRACK,void 0),this.emit(En.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(En.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(En.ON_NODE,this.inputNode))}}class My extends ft{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),m(this,"constraintsMap",new Map),m(this,"statsRegistry",[]),m(this,"audioContext",void 0),m(this,"trackId",void 0),m(this,"direction",void 0),m(this,"usageRegistry",[]),m(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return Sn(this,Kn.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return v.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),St(this,Kn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ur(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),St(this,Kn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ur(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:i,type:o,stats:c})}catch(c){v.error(new N(y.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof ie&&(i=await i),t.push(nu(nu({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class I_ extends ft{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),m(this,"context",void 0),m(this,"processSourceNode",void 0),m(this,"outputTrack",void 0),m(this,"processedNode",void 0),m(this,"clonedTrack",void 0),m(this,"outputNode",void 0),this.outputNode=new LV}setVolume(){}createOutputTrack(){throw new N(y.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class LV{disconnect(){}connect(){}}let iu,Da=null;class kV{constructor(){m(this,"state","open"),m(this,"trigger",void 0),m(this,"tasks",[]),v.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",v.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(t=>t.key),"]")),this.trigger=void 0,this.tasks.forEach(t=>{let{func:n}=t;return n()}),this.tasks.length=0,v.debug("[macro-task-queue] is closed.")})}enqueue(t,n){this.state!=="closed"&&(this.tasks.push({key:t,func:n}),v.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")))}runTask(t){if(this.state==="closed")return;const n=this.tasks.findIndex(i=>i.key===t);if(n!==-1){const i=this.tasks.splice(n,1);v.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")),i[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,v.debug("[macro-task-queue] is closed."))}}function C_(e){return function(t,n,i){var o;const a=(o=i.value)!==null&&o!==void 0?o:i.get,c=function(){Da&&Da.state==="open"&&Da.runTask(e);for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];return a==null?void 0:a.apply(this,...u)};return i.value?i.value=c:i.get=c,i}}var Uy,xy,Vy,jy,Fy,By,Gy,Wy,Hy,Ky,Yy,zy,qy,Jy,Xy,Qy,$y,Zy,eI,tI,nI,Ye,iI,rI,oI,sI,aI,cI,xr,dI,lI,uI,hI,pI,fI,_I,EI,mI,gI,SI,TI,In;function vI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function A_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vI(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})(iu||(iu={}));let mn=(Uy=C_("INIT_WEBAUDIO"),xy=C_("INIT_WEBAUDIO"),Vy=C_("INIT_WEBAUDIO"),jy=pe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Fy=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),By=gt(),Gy=wa("LocalAudioTrack","_enabledMutex"),Wy=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),Hy=gt(),Ky=wa("LocalAudioTrack","_enabledMutex"),Yy=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),zy=gt(),qy=gt(),Jy=gt(),Xy=pe({argsMap:e=>[e.getTrackId()]}),Qy=gt(),$y=pe({argsMap:e=>[e.getTrackId()]}),Zy=gt(),eI=pe({argsMap:e=>[e.getTrackId()]}),tI=pe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),nI=pe({argsMap:e=>[e.getTrackId()]}),G((Ye=class extends S_{get _source(){return this._trackSource}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get processorDestination(){return this._processorDestination}set processorDestination(e){this._processorDestination=e}get isPlaying(){return this._useAudioElement?ii.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i,o){super(e,n),m(this,"trackMediaType","audio"),m(this,"_encoderConfig",void 0),m(this,"_trackSource",void 0),m(this,"_enabled",!0),m(this,"_volume",100),m(this,"_useAudioElement",!1),m(this,"_bypassWebAudio",!1),m(this,"processor",void 0),m(this,"_processorContext",void 0),m(this,"_processorDestination",void 0),m(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i;const a=()=>{this.processorContext=new My(this._source.context,this.getTrackId(),"local"),this.processorDestination=new ky(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Hn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},c=o&&wn()&&!vy();D("DISABLE_WEBAUDIO")?(this._source=new I_,this._useAudioElement=!0,this._bypassWebAudio=!0):c?this._source=new I_:(this._source=new v_(e,!1,this._getOriginVolumeLevel?e:void 0),D("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),a(),!D("DISABLE_WEBAUDIO")&&c&&(Da||(Da=new kV),Da).enqueue("INIT_WEBAUDIO",()=>{this._source=new v_(e,!1,this._getOriginVolumeLevel?e:void 0),D("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),a(),this.emit(iu.UPDATE_TRACK_SOURCE)})}setVolume(e){nt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ii.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,St(this,ge.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement)throw new N(y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ii.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await St(this,ge.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await St(this,ge.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await St(this,ge.NEED_MUTE_TRACK,this):await St(this,ge.NEED_UNMUTE_TRACK,this))}getStats(){return Gc(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Qi(this,ge.GET_STATS)||A_({},o_)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Hn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Hn.ON_AUDIO_BUFFER),this._source.on(Hn.ON_AUDIO_BUFFER,n=>e(n))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ii.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ii.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ii.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await St(this,ge.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ie.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new N(y.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new N(y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(En.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await St(this,ge.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await St(this,ge.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(En.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(En.ON_TRACK),this.processorDestination.removeAllListeners(En.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Kn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Kn.REQUEST_CONSTRAINTS)}}).prototype,"_source",[Uy],Object.getOwnPropertyDescriptor(Ye.prototype,"_source"),Ye.prototype),G(Ye.prototype,"processorContext",[xy],Object.getOwnPropertyDescriptor(Ye.prototype,"processorContext"),Ye.prototype),G(Ye.prototype,"processorDestination",[Vy],Object.getOwnPropertyDescriptor(Ye.prototype,"processorDestination"),Ye.prototype),G(Ye.prototype,"setVolume",[jy],Object.getOwnPropertyDescriptor(Ye.prototype,"setVolume"),Ye.prototype),G(Ye.prototype,"setPlaybackDevice",[Fy,By],Object.getOwnPropertyDescriptor(Ye.prototype,"setPlaybackDevice"),Ye.prototype),G(Ye.prototype,"setEnabled",[Gy,Wy,Hy],Object.getOwnPropertyDescriptor(Ye.prototype,"setEnabled"),Ye.prototype),G(Ye.prototype,"setMuted",[Ky,Yy,zy],Object.getOwnPropertyDescriptor(Ye.prototype,"setMuted"),Ye.prototype),G(Ye.prototype,"getStats",[qy],Object.getOwnPropertyDescriptor(Ye.prototype,"getStats"),Ye.prototype),G(Ye.prototype,"setAudioFrameCallback",[Jy],Object.getOwnPropertyDescriptor(Ye.prototype,"setAudioFrameCallback"),Ye.prototype),G(Ye.prototype,"play",[Xy,Qy],Object.getOwnPropertyDescriptor(Ye.prototype,"play"),Ye.prototype),G(Ye.prototype,"stop",[$y,Zy],Object.getOwnPropertyDescriptor(Ye.prototype,"stop"),Ye.prototype),G(Ye.prototype,"close",[eI],Object.getOwnPropertyDescriptor(Ye.prototype,"close"),Ye.prototype),G(Ye.prototype,"pipe",[tI],Object.getOwnPropertyDescriptor(Ye.prototype,"pipe"),Ye.prototype),G(Ye.prototype,"unpipe",[nI],Object.getOwnPropertyDescriptor(Ye.prototype,"unpipe"),Ye.prototype),Ye),ru=(iI=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),rI=gt(),oI=wa("MicrophoneAudioTrack","_enabledMutex"),sI=pe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),aI=gt(),cI=pe({argsMap:e=>[e.getTrackId()]}),G((xr=class extends mn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?Jl(t.encoderConfig):{},i,D("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),m(this,"_config",void 0),m(this,"_deviceName","default"),m(this,"_constraints",void 0),m(this,"_originalConstraints",void 0),m(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(_a()||Af())&&Ke.bindInterruptDetectorTrack(this),this.on(iu.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),vy()&&this.bindProcessorContextEvents()}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Si.getDeviceById(e),n={};n.audio=A_({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Xi(n,this.getTrackId())}catch(o){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Xi({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Si.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await St(this,ge.NEED_DISABLE_TRACK,this)}catch(c){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const o=A_({},this._constraints),a=Si.searchDeviceIdByName(this._deviceName);a&&!o.deviceId&&(o.deviceId=a);try{n||(this._enabled=!0);const c=await Xi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await St(this,ge.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(_a()||Af())&&Ke.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Nn()||kr())&&this._enabled&&!this._isClosed&&Ke.duringInterruption){const e=async()=>{Ke.off(Yt.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ke.on(Yt.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(No.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Si.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Xi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(Kn.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),t()}catch(i){n(i)}}),this.processorContext.on(Kn.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[iI,rI],Object.getOwnPropertyDescriptor(xr.prototype,"setDevice"),xr.prototype),G(xr.prototype,"setEnabled",[oI,sI,aI],Object.getOwnPropertyDescriptor(xr.prototype,"setEnabled"),xr.prototype),G(xr.prototype,"close",[cI],Object.getOwnPropertyDescriptor(xr.prototype,"close"),xr.prototype),xr),MV=(dI=pe({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),lI=gt(),uI=pe({argsMap:e=>[e.getTrackId()]}),hI=gt(),pI=pe({argsMap:e=>[e.getTrackId()]}),fI=gt(),_I=pe({argsMap:e=>[e.getTrackId()]}),EI=gt(),mI=pe({argsMap:e=>[e.getTrackId()]}),gI=gt(),SI=pe({argsMap:e=>[e.getTrackId()]}),TI=gt(),G((In=class extends mn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),m(this,"source",void 0),m(this,"_bufferSource",void 0),this.source=e,this._bufferSource=t,this._bufferSource.on(Hn.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(No.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(e){nt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[dI,lI],Object.getOwnPropertyDescriptor(In.prototype,"startProcessAudioBuffer"),In.prototype),G(In.prototype,"pauseProcessAudioBuffer",[uI,hI],Object.getOwnPropertyDescriptor(In.prototype,"pauseProcessAudioBuffer"),In.prototype),G(In.prototype,"seekAudioBuffer",[pI,fI],Object.getOwnPropertyDescriptor(In.prototype,"seekAudioBuffer"),In.prototype),G(In.prototype,"resumeProcessAudioBuffer",[_I,EI],Object.getOwnPropertyDescriptor(In.prototype,"resumeProcessAudioBuffer"),In.prototype),G(In.prototype,"stopProcessAudioBuffer",[mI,gI],Object.getOwnPropertyDescriptor(In.prototype,"stopProcessAudioBuffer"),In.prototype),G(In.prototype,"setAudioBufferPlaybackSpeed",[SI,TI],Object.getOwnPropertyDescriptor(In.prototype,"setAudioBufferPlaybackSpeed"),In.prototype),In);class Yn extends mn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Na().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,at(8,"track-mix-")),m(this,"trackList",void 0),m(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(v.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):v.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){v.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}N_(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof Yn?n.emit(jc.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class UV extends ft{constructor(){super(...arguments),m(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(D("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(o&&(o.result.push(i),o.result.length>=5)){const a=o.result.includes(!0);o.isPrevNormal&&!a&&this.emit("exception",RI[t],t,n),!o.isPrevNormal&&a&&this.emit("exception",RI[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=a,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Yn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=to(n._encoderConfig.frameRate));const o=t.captureFrameRate;return!i||!o||!(i>10&&o<5||i<10&&i>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Yn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const RI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Pi=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function yI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ws(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yI(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Pa{constructor(t){m(this,"store",void 0),m(this,"onStatsException",void 0),m(this,"onUploadPublishDuration",void 0),m(this,"onStatsChanged",void 0),m(this,"localStats",new Map),m(this,"remoteStats",new Map),m(this,"updateStatsInterval",void 0),m(this,"trafficStats",void 0),m(this,"trafficStatsPeerList",[]),m(this,"uplinkStats",void 0),m(this,"exceptionMonitor",void 0),m(this,"p2pChannel",void 0),m(this,"scalabilityMode",Rf.L1T1),m(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new UV,this.exceptionMonitor.on("exception",(n,i,o)=>{this.onStatsException&&this.onStatsException(n,i,o)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(oe.LocalAudioTrack)||ws({},o_)}getLocalVideoTrackStats(){return this.localStats.get(oe.LocalVideoTrack)||ws({},s_)}getRemoteAudioTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(t){var o;const a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;a&&(i[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{audioStats:l}]=a;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{networkStats:c}]=o;c&&(n[a]=c)});return n}getRemoteVideoTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(t){var o;const a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;a&&(i[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{videoStats:l}]=a;l&&(i[c]=n(c,l))});return i}getRTCStats(){let t=0,n=0,i=0,o=0;const a=this.localStats.get(oe.LocalAudioTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const c=this.localStats.get(oe.LocalVideoTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(oe.LocalVideoLowTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:p,videoStats:_}=f;p&&(i+=p.receiveBytes,o+=p.receiveBitrate),_&&(i+=_.receiveBytes,o+=_.receiveBitrate)});let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const o=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),a=o!=null&&o.videoSSRC?Pi.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,c=o!=null&&o.audioSSRC?Pi.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>c?a:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const o=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||n.framesDecodeCount>i.framesDecodeCount;return o||!a}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,o]=n;switch(i){case oe.LocalVideoTrack:case oe.LocalVideoLowTrack:{const c=o,l=ws({},s_),u=t.getStats(),f=t.getLocalMedia(i);if(u){const p=u.videoSend.find(_=>_.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(p){const _=t.getLocalVideoSize(),S=t.getEncoderConfig(oe.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):_&&(l.captureResolutionWidth=_.width,l.captureResolutionHeight=_.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):_&&(l.sendResolutionWidth=_.width,l.sendResolutionHeight=_.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),S&&S.bitrateMax&&(l.targetSendBitrate=1e3*S.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var a;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,l);break}case oe.LocalAudioTrack:{const c=o,l=ws({},o_),u=t.getStats(),f=t.getLocalMedia(i);if(u){const p=u.audioSend.find(_=>_.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const _=t.getLocalAudioVolume();_&&(l.sendVolumeLevel=Math.round(32767*_))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(oe.LocalAudioTrack,l),l&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{let[i,{videoStats:o,audioStats:a,videoPcStats:c}]=n;const l=a,u=o,f=c,p=ws({},JR),_=ws({},XR),S=ws({},_2),{audioTrack:R,videoTrack:C,audioSSRC:A,videoSSRC:O}=t.getRemoteMedia(i),k=t.getStats(),M=k==null?void 0:k.audioRecv.find(Y=>Y.ssrc===A),H=k==null?void 0:k.videoRecv.find(Y=>Y.ssrc===O),re=this.trafficStats&&this.trafficStats.peer_delay.find(Y=>Y.peer_uid===i);if(M&&(M.codec!=="opus"&&M.codec!=="aac"&&M.codec!=="PCMU"&&M.codec!=="PCMA"&&M.codec!=="G722"||(p.codecType=M.codec),M.outputLevel?p.receiveLevel=Math.round(32767*M.outputLevel):R&&(p.receiveLevel=Math.round(32767*R.getVolumeLevel())),p.receiveBytes=M.bytes,p.receivePackets=M.packets,p.receivePacketsLost=M.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.receiveBitrate=l?8*Math.max(0,p.receiveBytes-l.receiveBytes):0,p.totalDuration=l?l.totalDuration+1:1,p.totalFreezeTime=l?l.totalFreezeTime:0,p.freezeRate=p.totalFreezeTime/p.totalDuration,p.receiveDelay=M.jitterBufferMs,p.totalDuration>10&&Pa.isRemoteAudioFreeze(R)&&(p.totalFreezeTime+=1)),H){H.codec!=="H264"&&H.codec!=="H265"&&H.codec!=="VP8"&&H.codec!=="VP9"&&H.codec!=="AV1X"&&H.codec!=="AV1"||(_.codecType=H.codec),_.receiveBytes=H.bytes,_.receiveBitrate=u?8*Math.max(0,_.receiveBytes-u.receiveBytes):0,_.decodeFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,_.renderFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,H.outputFrame&&(_.renderFrameRate=H.outputFrame.frameRate),H.receivedFrame?(_.receiveFrameRate=H.receivedFrame.frameRate,_.receiveResolutionHeight=H.receivedFrame.height,_.receiveResolutionWidth=H.receivedFrame.width):C&&(_.receiveResolutionHeight=C._videoHeight||0,_.receiveResolutionWidth=C._videoWidth||0),H.framesRateFirefox!==void 0&&(_.receiveFrameRate=Math.round(H.framesRateFirefox)),_.receivePackets=H.packets,_.receivePacketsLost=H.packetsLost,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.totalDuration=u?u.totalDuration+1:1,_.totalFreezeTime=u?u.totalFreezeTime:0,_.receiveDelay=H.jitterBufferMs||0;const Y=!!O&&t.getRemoteVideoIsReady(O);C&&Y&&Pa.isRemoteVideoFreeze(C,H,f)&&(_.totalFreezeTime+=1),_.freezeRate=_.totalFreezeTime/_.totalDuration}re&&(p.end2EndDelay=re.B_ad,_.end2EndDelay=re.B_vd,p.transportDelay=re.B_ed,_.transportDelay=re.B_ed,p.currentPacketLossRate=re.B_ealr4/100,_.currentPacketLossRate=re.B_evlr4/100,S.uplinkNetworkQuality=re.B_punq?re.B_punq:0,S.downlinkNetworkQuality=re.B_pdnq?re.B_pdnq:0),this.remoteStats.set(i,{audioStats:p,videoStats:_,videoPcStats:H,networkStats:S}),R&&this.exceptionMonitor.setRemoteAudioStats(R,p),C&&this.exceptionMonitor.setRemoteVideoStats(C,_)})}}const eo=new class extends ft{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),m(this,"_lastHiddenTime",0),m(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function II(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ou(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?II(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):II(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function su(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(D("TURN_DOMAIN")):(v.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function CI(e,t){var n,i;const o=D("GATEWAY_DOMAINS");let a=o[1]&&t.indexOf(o[1])!==-1?1:0;e.addresses=e.addresses||[];const c=e.addresses.map(u=>u.domain_prefix?{address:"".concat(u.domain_prefix,".").concat(o[a++%o.length],":").concat(u.port)}:u.ip.match(/^[\.\:\d]+$/)?{ip:u.ip,port:u.port,address:"".concat(u.ip.replace(/[^\d]/g,"-"),".").concat(o[a++%o.length],":").concat(u.port)}:(v.info("Cannot recognized as IP address ".concat(u.ip,". Used As Host instead")),{ip:u.ip,port:u.port,address:"".concat(u.ip,":").concat(u.port)}));if((n=e.detail)!==null&&n!==void 0&&n[18]&&typeof((i=e.detail)===null||i===void 0?void 0:i[18])=="string"){const u=e.detail[18],f=u==null?void 0:u.split(";");for(let p=0;p<f.length;p++){var l;const _=Jr(l=f[p]).call(l);c[p]&&_&&(c[p].ip6=_)}}return{gatewayAddrs:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function to(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function AI(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(to(t.width),"x").concat(to(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function OI(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function O_(e,t){let n,i,o;switch(t){case Kt.CHOOSE_SERVER:n=4096,i="choose server";break;case Kt.CLOUD_PROXY:n=1048576,i="proxy";break;case Kt.CLOUD_PROXY_5:n=4194304,i="proxy5";break;case Kt.CLOUD_PROXY_FALLBACK:n=4194310,i="proxy fallback";break;default:throw new N(y.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(a=>{a.buffer&&a.buffer.flag===n&&(o={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(c=>ou(ou({},c),{},{ticket:a.buffer.cert})),server_ts:e.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:ou(ou({},a.buffer.detail),e.detail),flag:a.buffer.flag,opid:e.opid,cert:a.buffer.cert})}),!o)throw new N(y.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return o}async function xV(e,t){return await ie.all(e.addresses.map(async n=>({address:su(n.ip),tcpport:n.port,udpport:n.port,username:t&&D("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():pi.username,password:t&&D("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await vV(t.toString()):pi.password})))}function VV(e,t){const n=t._videoWidth||t.getMediaStreamTrack(!0).getSettings().width;return n||v.warning("cannot get original video track's width, default scale down 4 times for low stream"),n?n/to(e.width):4}function au(e){let{candidateType:t,relayProtocol:n,type:i,address:o,port:a,protocol:c}=e;return i==="local-candidate"?{candidateType:t,relayProtocol:n,protocol:c}:{candidateType:t,relayProtocol:n,address:o,port:a,protocol:c}}function wI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ns(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wI(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function La(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function gn(e){return new ie(t=>{window.setTimeout(t,e)})}function jV(e){const t=new N(y.TIMEOUT,"timeout");return new ie((n,i)=>{window.setTimeout(()=>i(t),e)})}function at(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+at(e-n.length,"")}function w_(){return at(32,"").toUpperCase()}const cu=()=>{};function NI(e){return new ie((t,n)=>{let i=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const a=Nn()?"canplay":"playing";o.addEventListener(a,()=>{const c=o.videoWidth,l=o.videoHeight;!c&&Et()||(i=!0,o.srcObject=null,o.remove(),t([c,l]))}),o.srcObject=new MediaStream([e]),o.play().catch(cu),setTimeout(()=>{i||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function ka(e){return ie.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}function Sn(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return e.getListeners(t).length===0?ie.reject(new N(y.UNEXPECTED_ERROR,"can not emit promise")):new ie((a,c)=>{e.emit(t,...i,a,c)})}function St(e,t){if(e.getListeners(t).length===0)return ie.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return Sn(e,t,...i)}function Qi(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return bs(e,t,...i)}function bs(e,t){let n=null,i=null;for(var o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];if(e.emit(t,...a,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new N(y.UNEXPECTED_ERROR,"handler is not sync");return n}function N_(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function bI(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Tr(e){ie.resolve().then(e)}function Pt(e){return JSON.parse(JSON.stringify(e))}const DI={};function Gc(e,t){DI[t]||(DI[t]=!0,e())}function b_(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function du(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}const PI=new class{constructor(){m(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var o=arguments.length,a=new Array(o>4?o-4:0),c=4;c<o;c++)a[c-4]=arguments[c];if(this.fnMap.has(t)){const l=this.fnMap.get(t);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const u=window.setTimeout(()=>{const f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:a,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,Ns(Ns({},l),{},{fn:e,args:a,skipFn:i}))}else{const l=window.setTimeout(()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:a,skipFn:i})}}},LI=PI.throttleByKey.bind(PI),Wc=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:o,promisesCollector:a}=e,c=0;const l=t;let u,f=0;const p=async()=>{const _=(()=>{const S=c*l,R=S+l;return n.slice(S,R).map(i)})();a&&a.push(..._);try{u=await ka(_)}catch(S){if(f+=l,c++,!(f>=n.length))return void await p();o(S)}_.forEach(S=>S.cancel())};return await p(),u};function kI(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}const FV={[Ia.ACCESS_POINT]:{[fn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[fn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[fn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[fn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[fn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[fn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[fn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ia.UNILBS]:{[fi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[fi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[fi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[fi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[fi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[fi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[fi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[fi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[fi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[fi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[fi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[fi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ia.STRING_UID_ALLOCATOR]:{[xc.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[xc.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[xc.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function lu(e){const t=FV[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Ia.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const BV={[fe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[fe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[fe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[fe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[fe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[fe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[fe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[fe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[fe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[fe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[fe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[fe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[fe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[fe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[fe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[fe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[fe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[fe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[fe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[fe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[fe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[fe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[fe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[fe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[fe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[fe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[fe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[fe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[fe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[fe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[fe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[fe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[fe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[fe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[fe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[fe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[fe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[fe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[fe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[fe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[fe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[fe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[fe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[fe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[fe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[fe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[fe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[fe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[fe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[fe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[fe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[fe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[fe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[fe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[fe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[fe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[fe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[fe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[fe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[fe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[fe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[fe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[fe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[fe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Hc(e){return BV[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function MI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class Ds extends ft{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Te.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Te.CONNECTED):this._state==="closed"?this.emit(Te.CLOSED):this._state==="failed"&&this.emit(Te.FAILED))}resetReconnectCount(t){v.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4?arguments[4]:void 0;super(),m(this,"connectionID",0),m(this,"currentURLIndex",0),m(this,"urls",void 0),m(this,"_reconnectMode","tryNext"),m(this,"reconnectReason",void 0),m(this,"_initMutex",new Pn("websocket")),m(this,"name",void 0),m(this,"_state","closed"),m(this,"reconnectInterrupter",void 0),m(this,"websocket",void 0),m(this,"retryConfig",void 0),m(this,"reconnectCount",0),m(this,"forceCloseTimeout",5e3),m(this,"onlineReconnectListener",void 0),m(this,"useCompress",void 0),m(this,"tryDoubleDomain",!1),m(this,"wsInflateLength",0),m(this,"wsDeflateLength",0),m(this,"closeEstablishingWs",()=>{}),m(this,"store",void 0),m(this,"joinChannelServiceRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(p){for(var _=1;_<arguments.length;_++){var S=arguments[_]!=null?arguments[_]:{};_%2?MI(Object(S),!0).forEach(function(R){m(p,R,S[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(S)):MI(Object(S)).forEach(function(R){Object.defineProperty(p,R,Object.getOwnPropertyDescriptor(S,R))})}return p}({},n),this.useCompress=i,this.tryDoubleDomain=o;const{timeout:c,timeoutFactor:l}=n,u=Math.max(300,Math.floor(3*c/5)),f=Math.max(1.2,Math.floor(8*l)/10);Rn.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=f),Dt.on(bo.NETWORK_STATE_CHANGE,(p,_)=>{p!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(p)),p===Rn.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=f):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=n;const i=(o,a)=>{this.urls=t;const c=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(c).then(o).catch(a),this.once(Te.CLOSED,()=>a(new N(y.WS_DISCONNECT))),this.once(Te.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new ie((a,c)=>{i(a,c)}).then(()=>{o()}).catch(()=>{o()}))}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((i=this.store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinChannelServiceRecordIndex));const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new N(y.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new N(y.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t,n){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new ie((i,o)=>{var a;const c=p=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i()},l=async p=>{if(v.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const _=Qi(this,Te.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,S=await this.reconnectWithAction(_);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!S)return o(new N(y.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),void this.close(!0);i()}else o(new N(y.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close()},u=p=>{this.emit(Te.ON_MESSAGE,p)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),D("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=D("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url: ").concat(t));const f=(a=this.store)===null||a===void 0?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(t,!!n,f).then(p=>{var _;this.websocket=p,c&&c(p.url),p.onclose=l,p.onmessage=u,(_=this.store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},f),this.joinChannelServiceRecordIndex=f}).catch(p=>{var _;if((_=this.store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:p instanceof N&&p.code===y.WS_ABORT?"aborted":"error",errors:[p]},f),this.state!=="closed"){if(p instanceof N&&p.code===y.WS_ERR){const S=new N(y.WS_ERR,"init websocket failed! Error: ".concat(p.toString()));return v.error("[".concat(this.name,"]").concat(S)),void o(S)}l&&l(p)}else o(new N(y.WS_DISCONNECT,"websocket is closed: ".concat(p.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||Dt.networkState!==Rn.OFFLINE||(this.onlineReconnectListener=Dt.onlineWaiter&&Dt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>{i=!1},n){const c=Gf(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await ie.race([gn(c),this.onlineReconnectListener||new ie(()=>{})])}if(this.state==="closed"||!i)return!1;this.reconnectCount+=1;const o=async(c,l)=>{this.emit(Te.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(t==="retry"){const c=this.urls[this.currentURLIndex];this.emit(Te.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const c=this.urls[this.currentURLIndex];this.emit(Te.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="recover"){v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Te.RECONNECT_WAITTING_FINISH,t),this.urls=await Sn(this,Te.REQUEST_NEW_URLS),this.currentURLIndex=0;const c=this.urls[this.currentURLIndex];await o(c,t)}return!0}catch(c){var a;return v.error("[".concat(this.name,"] reconnect failed"),c.toString()),c!=null&&(a=c.data)!==null&&a!==void 0&&a.desc&&Array.isArray(c.data.desc)&&c.data.desc.length&&c.data.desc.includes("dynamic key expired")?(this.emit(Te.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}async chooseBestWebsocketConnection(t,n,i){return new ie((o,a)=>{let c=!1;const l=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),l.forEach(A=>{A.onclose=null,A.onopen=null,A.onmessage=null,A.close()}),a(new N(y.WS_ABORT,"choose best websocket aborted"))};const u=D("GATEWAY_DOMAINS");let f;const p=t.indexOf("?h="),_=u.find(A=>p!==-1?t.includes(A,p):t.includes(A));v.debug("[choose-best-ws] currentDomain: ",_,", domains: ",u);let S=!this.tryDoubleDomain||n||!_;if(!S&&_){var R;const A=Date.now();try{u.forEach(O=>{const k=p===-1?t.replace(_,O):t.substr(0,p)+t.substr(p).replace(_,O),M=new WebSocket(k);M.binaryType="arraybuffer",l.push(M),v.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(k=>k.close());l.length;)l.pop();S=!0}(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:l.map(O=>O.url),service:"gateway"},i),l.forEach(O=>{O.onopen=()=>{if(c)return;const k=Date.now()-A;v.debug("[choose-best-ws] ws open cost ".concat(k,"ms")),l.filter(M=>M!==O).forEach(M=>{v.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),c=!0,o(O)},O.onclose=k=>{f=k,!c&&(l.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),c=!0,a(f)))},O.onmessage=k=>{v.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(k.data))}}),gn(this.forceCloseTimeout).then(()=>{l.forEach(O=>{O.readyState!==WebSocket.OPEN&&O.close()})})}if(S){var C;let A;v.debug("[choose-best-ws] use single url: ",t),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[t],service:"gateway"},i);try{A=new WebSocket(t),l.push(A),A.binaryType="arraybuffer"}catch(O){const k=new N(y.WS_ERR,"init websocket failed! Error: ".concat(O.toString()));return v.error("[".concat(this.name,"]").concat(k)),void a(k)}A.onopen=()=>{o(A)},A.onclose=O=>{a(O)},A.onmessage=O=>{v.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(O.data))},gn(this.forceCloseTimeout).then(()=>{A&&A.readyState!==WebSocket.OPEN&&A.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class UI{constructor(t){m(this,"input",[]),m(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ro(t=this.input).call(t,(n,i)=>n+i)/this.input.length}}class xI extends ft{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Je.CONNECTED?this.emit(de.WS_CONNECTED):t===Je.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):t===Je.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),m(this,"_disconnectedReason",void 0),m(this,"_websocketReconnectReason",void 0),m(this,"_connectionState",Je.CLOSED),m(this,"reconnectToken",void 0),m(this,"websocket",void 0),m(this,"openConnectionTime",void 0),m(this,"clientId",void 0),m(this,"lastMsgTime",Date.now()),m(this,"uploadCache",[]),m(this,"uploadCacheInterval",void 0),m(this,"rttRolling",new UI(5)),m(this,"pingpongTimer",void 0),m(this,"wsInflateDataTimer",void 0),m(this,"pingpongTimeoutCount",0),m(this,"joinResponse",void 0),m(this,"multiIpOption",void 0),m(this,"initError",void 0),m(this,"spec",void 0),m(this,"store",void 0),m(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===we.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===we.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(He.UID_BANNED);break;case 15:this.close(He.IP_BANNED);break;case 16:this.close(He.CHANNEL_BANNED)}if(o._type===we.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case fe.ERR_LICENSE_MISSING:this.close(He.LICENSE_MISSING);break;case fe.ERR_LICENSE_EXPIRED:this.close(He.LICENSE_EXPIRED);break;case fe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(He.LICENSE_MINUTES_EXCEEDED);break;case fe.ERR_LICENSE_PERIOD_INVALID:this.close(He.LICENSE_PERIOD_INVALID);break;case fe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(He.LICENSE_MULTIPLE_SDK_SERVICE);break;case fe.ERR_LICENSE_ILLEGAL:this.close(He.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Ds("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Je.CONNECTED&&this.reconnect("retry",xn.OFFLINE)})}async request(t,n,i,o){const a=at(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,u=()=>new ie((C,A)=>{if(this.connectionState===Je.CONNECTED)return C();const O=()=>{this.off(de.WS_CLOSED,k),C()},k=()=>{this.off(de.WS_CONNECTED,O),A(new N(y.WS_ABORT))};this.once(de.WS_CONNECTED,O),this.once(de.WS_CLOSED,k),t!==Ee.PUBLISH&&t!==Ee.SUBSCRIBE&&t!==Ee.UNSUBSCRIBE&&t!==Ee.UNPUBLISH&&t!==Ee.CONTROL&&t!==Ee.RESTART_ICE||this.once(de.DISCONNECT_P2P,()=>{A(new N(y.DISCONNECT_P2P))}),t!==Ee.PUBLISH&&t!==Ee.RESTART_ICE||this.once(de.ABORT_P2P_EXECUTION,()=>{A(new N(y.DISCONNECT_P2P))})});if(this.connectionState!==Je.CONNECTING&&this.connectionState!==Je.RECONNECTING||t===Ee.JOIN||t===Ee.REJOIN||await u(),this.websocket.sendMessage(c,!0),o)return;const f=new ie((C,A)=>{let O=!1;const k=(H,re)=>{O=!0,C({isSuccess:H==="success",message:re||{}}),this.off(de.WS_CLOSED,M),this.off(de.WS_RECONNECTING,M),this.emit(de.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),k);const M=()=>{A(new N(y.WS_ABORT,"type: ".concat(t))),this.off(de.WS_CLOSED,M),this.off(de.WS_RECONNECTING,M),this.off("res-@".concat(a),k)};this.once(de.WS_CLOSED,M),this.once(de.WS_RECONNECTING,M),gn(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(de.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await f}catch(C){if(this.connectionState===Je.CLOSED||t===Ee.LEAVE)throw new N(y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?C.throw():t===Ee.JOIN||t===Ee.REJOIN?null:(await u(),await this.request(t,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),S=Hc(_),R=new N(y.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(p.message.error_str),{code:_,data:p.message});return S.action==="success"?p.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(S.desc,", action: ").concat(S.action)),_===fe.ERR_TOO_MANY_BROADCASTERS?((t===Ee.JOIN||t===Ee.REJOIN)&&(this.initError=R,this.close()),R.throw()):S.action==="failed"?R.throw():S.action==="quit"?(this.initError=R,this.close(),R.throw()):(_===fe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",xn.MULTI_IP)):this.reconnect(S.action,xn.SERVER_ERROR),t===Ee.JOIN||t===Ee.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ie(i=>{const o=a=>{(!n||n(a))&&(this.off(t,o),i(a))};this.on(t,o)})}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const a=D("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Je.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},D("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((i,o)=>{this.once(de.WS_CONNECTED,()=>i(this.joinResponse)),this.once(de.WS_CLOSED,()=>o(this.initError||new N(y.WS_ABORT))),this.connectionState=Je.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),o(new N(y.INIT_WEBSOCKET_TIMEOUT)))},D("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||He.LEAVE,this.connectionState=Je.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===He.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Ds("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(de.ABORT_P2P_EXECUTION);const t=await Sn(this,de.REQUEST_JOIN_INFO),n=await this.request(Ee.JOIN,t);if(!n)return this.emit(de.REPORT_JOIN_GATEWAY,y.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(de.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Je.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new N(y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=bs(this,de.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ee.REJOIN,t);return!!n&&(this.connectionState=Je.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(we.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(we.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(we.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(we.MUTE_AUDIO,{uid:i.uid}):this.emit(we.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(we.MUTE_VIDEO,{uid:i.uid}):this.emit(we.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(we.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(we.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(we.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(we.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(we.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Hc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(He.UID_BANNED),void this.close()):void this.reconnect(n.action,xn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=D("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>D("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",xn.TIMEOUT):this.request(Ee.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),D("REPORT_STATS")&&this.send(Ee.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(ti.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Te.RECONNECT_WAITTING_FINISH,t=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Te.RECONNECT_CREATE_CONNECTION,t=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Te.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Te.CLOSED,()=>{this.connectionState=Je.CLOSED}),this.websocket.on(Te.FAILED,()=>{this._disconnectedReason=He.NETWORK_ERROR,this.connectionState=Je.CLOSED}),this.websocket.on(Te.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Je.CONNECTED?this.connectionState=Je.RECONNECTING:this.connectionState=Je.CONNECTING}),this.websocket.on(Te.WILL_RECONNECT,(t,n)=>{if(bs(this,de.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),n(t)}),this.websocket.on(Te.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",xn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(de.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof N&&t.code===y.UNEXPECTED_RESPONSE&&t.data.code===fe.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",xn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",xn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Te.REQUEST_NEW_URLS,(t,n)=>{Sn(this,de.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Te.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function VI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class GV extends ft{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(mt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(mt.CONNECTED):this._state==="closed"?this.emit(mt.CLOSED):this._state==="failed"&&this.emit(mt.FAILED))}constructor(t,n,i,o){super(),m(this,"connectionID",0),m(this,"currentURLIndex",0),m(this,"reconnectReason",void 0),m(this,"_reconnectMode","tryNext"),m(this,"_initMutex",void 0),m(this,"_name",void 0),m(this,"_state","closed"),m(this,"_reconnectInterrupter",void 0),m(this,"_url",void 0),m(this,"_retryConfig",void 0),m(this,"_reconnectCount",0),m(this,"_forceCloseTimeout",5e3),m(this,"_onlineReconnectListener",void 0),m(this,"_closeEstablishingTransmitter",()=>{}),m(this,"_store",void 0),m(this,"_joinChannelServiceRecordIndex",void 0),m(this,"_transmitter",void 0),m(this,"_useCompress",void 0),m(this,"_inflateLength",0),m(this,"_deflateLength",0),this._store=o,this._name=t,this._retryConfig=function(a){for(var c=1;c<arguments.length;c++){var l=arguments[c]!=null?arguments[c]:{};c%2?VI(Object(l),!0).forEach(function(u){m(a,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):VI(Object(l)).forEach(function(u){Object.defineProperty(a,u,Object.getOwnPropertyDescriptor(l,u))})}return a}({},n),this._useCompress=i}resetReconnectCount(t){v.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;n?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void v.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const o=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),o&&o.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function jI(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const i=e.getUint32(t,n),o=e.getUint32(t+4,n),a=+!!n,c=+!n;return BigInt(i*c+o*a)<<BigInt(32)|BigInt(i*a+o*c)}function FI(e,t,n,i){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,i);const o=Number(n>>BigInt(32)),a=Number(n&BigInt(4294967295));i?(e.setUint32(t+4,o,i),e.setUint32(t,a,i)):(e.setUint32(t,o,i),e.setUint32(t+4,a,i))}let Li;(function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"})(Li||(Li={}));class WV{constructor(t,n,i){m(this,"version",1),m(this,"initialRTO",void 0),m(this,"maxBatchAckCount",void 0),m(this,"maxRTO",void 0),m(this,"initialRTT",void 0),m(this,"ID",void 0),m(this,"rtt",void 0),m(this,"packetNumber",1),m(this,"rtoRatioMap",new Map),m(this,"timeoutMap",new Map),m(this,"unorderedPacketQueue",[]),m(this,"batchAckPacketQueue",[]),m(this,"lastOrderedPacketNumber",0),m(this,"batchAckTimer",void 0),m(this,"sendImpl",void 0),m(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=at(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:D("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:D("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:D("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:D("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:D("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Li.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Li.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const i=new ArrayBuffer(n.length+15),o=new DataView(i);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.packetNumber),FI(o,7,BigInt(t.sendTs)),new Uint8Array(o.buffer).set(n,15),i}case Li.Ack:{const n=new ArrayBuffer(16),i=new DataView(n);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),FI(i,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),i=n.getUint16(0),o=n.getUint8(2);switch(o){case Li.Default:{const a=n.getUint32(3),c=jI(n,7),l=t.slice(15),u=new TextDecoder().decode(l);return{version:i,type:o,packetNumber:a,sendTs:Number(c),payload:u}}case Li.Ack:{const a=n.getUint32(3),c=n.getUint8(7),l=jI(n,8);return{version:i,type:o,maxAckPacketNumber:a,shift:c,ackSendTs:Number(l)}}default:throw v.error("[".concat(this.ID,"] Unrecognized packet type ").concat(o)),new Error("Unrecognized packet type ".concat(o))}}sendMessage(t){const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(n),o=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,o),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===Li.Default?this.ack(n):n.type===Li.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),i=window.setTimeout(()=>{this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,n){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Li.Ack,version:this.version};this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Li.Ack,version:this.version};this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Li.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Li.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const i=this.timeoutMap.get(n);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class BI extends GV{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),m(this,"_initMutex",void 0),m(this,"_reconnectInterrupter",void 0),m(this,"_url",void 0),m(this,"_transmitter",void 0),m(this,"_addresses",void 0),m(this,"_reliableTransmission",void 0),this._initMutex=new Pn("datachannel");const{timeout:i,timeoutFactor:o}=n,a=Math.max(300,Math.floor(3*i/5)),c=Math.max(1.2,Math.floor(8*o)/10);Rn.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c),Dt.on(bo.NETWORK_STATE_CHANGE,(l,u)=>{l!==u&&(this.resetReconnectCount("network state change: ".concat(u," -> ").concat(l)),l===Rn.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const i=(o,a)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(l=>l.fingerprint||D("FINGERPRINT"));const c=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(c).then(o).catch(a),this.once(mt.CLOSED,()=>a(new N(y.WS_DISCONNECT))),this.once(mt.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new ie((a,c)=>{i(a,c)}).then(()=>{o()}).catch(()=>{o()}))}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new N(y.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(i){throw new N(y.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new ie((n,i)=>{var o;const a=()=>{v.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},c=async p=>{var _;if((_=this._closeEstablishingTransmitter)===null||_===void 0||_.call(this),v.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const S=Qi(this,mt.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,R=await this.reconnectWithAction(S);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!R)return i(new N(y.WS_DISCONNECT,"datachannel reconnect failed: ".concat(p.code))),void this.close(!0);n()}else i(new N(y.WS_DISCONNECT,"datachannel close: ".concat(p.code))),this.close()},l=p=>{var _;(_=this._reliableTransmission)===null||_===void 0||_.onData(p.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),v.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const u=(o=this._store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),f=Date.now();Sn(this,mt.TO_CONNECT_DATACHANNEL,t).then(p=>{var _,S;if(!p)throw new Error("transmissonInfo not exist yet");const{transmitter:R,close:C}=p;this._transmitter=R,(_=this._store)===null||_===void 0||_.signalChannelOpen();const A=Date.now()-f;v.debug("[choose dc] dc open cost ".concat(A,"ms")),this._reliableTransmission=new WV(O=>{var k;this._transmitter&&this._transmitter.readyState==="open"&&((k=this._transmitter)===null||k===void 0||k.send(O))},O=>{typeof O=="string"&&this.emit(mt.ON_MESSAGE,O)}),this._closeEstablishingTransmitter=()=>{var O;(O=this._reliableTransmission)===null||O===void 0||O.close(),this._reliableTransmission=void 0,C()},a&&a(),R.onclose=c,R.onmessage=l,(S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this._joinChannelServiceRecordIndex=u}).catch(p=>{var _;if((_=this._store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:p instanceof N&&p.code===y.WS_ABORT?"aborted":"error",errors:[p]},u),this.state!=="closed"){if(p instanceof N&&p.code===y.WS_ERR){const S=new N(y.WS_ERR,"init datachannel failed! Error: ".concat(p.toString()));return v.error("[".concat(this._name,"]").concat(S)),void i(S)}c&&c(p)}else i(new N(y.WS_DISCONNECT,"datachannel is closed: ".concat(p.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Dt.networkState!==Rn.OFFLINE||(this._onlineReconnectListener=Dt.onlineWaiter&&Dt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},n){const c=Gf(this._reconnectCount,this._retryConfig);v.debug("[".concat(this._name,"] wait ").concat(c,"ms to reconnect datachannel, mode: ").concat(t)),await ie.race([gn(c),this._onlineReconnectListener||new ie(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const o=async(c,l)=>{this.emit(mt.RECONNECT_CREATE_CONNECTION,l),await this.createTransmitterConnection(c)};try{if(t==="retry"){const c=this._addresses[this.currentURLIndex];this.emit(mt.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let l=this.currentURLIndex;l<this._addresses.length;l++){if(this._addresses[l].fingerprint||D("FINGERPRINT")){this.currentURLIndex=l;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return v.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);v.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const c=this._addresses[this.currentURLIndex];this.emit(mt.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else t==="recover"&&(v.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(mt.RECONNECT_WAITTING_FINISH,t),this.emit(mt.FAILBACK));return!0}catch(c){var a;return v.error("[".concat(this._name,"] reconnect failed"),c.toString()),c!=null&&(a=c.data)!==null&&a!==void 0&&a.desc&&Array.isArray(c.data.desc)&&c.data.desc.length&&c.data.desc.includes("dynamic key expired")?(this.emit(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class no extends ft{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Je.CONNECTED?this.emit(de.WS_CONNECTED):t===Je.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):t===Je.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),m(this,"_disconnectedReason",void 0),m(this,"_websocketReconnectReason",void 0),m(this,"_connectionState",Je.CLOSED),m(this,"reconnectToken",void 0),m(this,"websocket",void 0),m(this,"openConnectionTime",void 0),m(this,"clientId",void 0),m(this,"lastMsgTime",Date.now()),m(this,"uploadCache",[]),m(this,"uploadCacheInterval",void 0),m(this,"rttRolling",new UI(5)),m(this,"pingpongTimer",void 0),m(this,"inflateDataTimer",void 0),m(this,"pingpongTimeoutCount",0),m(this,"joinResponse",void 0),m(this,"multiIpOption",void 0),m(this,"initError",void 0),m(this,"spec",void 0),m(this,"store",void 0),m(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,i);const o=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")&&(this.emit(o._type,o._message),o._type===we.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===we.ON_USER_BANNED))switch(o._message.error_code){case 14:this.close(He.UID_BANNED);break;case 15:this.close(He.IP_BANNED);break;case 16:this.close(He.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new BI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Je.CONNECTED&&this.reconnect("retry",Mr.OFFLINE)})}async request(t,n,i,o){const a=at(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,u=()=>new ie((C,A)=>{if(this.connectionState===Je.CONNECTED)return C();const O=()=>{this.off(de.WS_CLOSED,k),C()},k=()=>{this.off(de.WS_CONNECTED,O),A(new N(y.WS_ABORT))};this.once(de.WS_CONNECTED,O),this.once(de.WS_CLOSED,k),t!==Ee.PUBLISH&&t!==Ee.SUBSCRIBE&&t!==Ee.UNSUBSCRIBE&&t!==Ee.UNPUBLISH&&t!==Ee.CONTROL&&t!==Ee.RESTART_ICE||this.once(de.DISCONNECT_P2P,()=>{A(new N(y.DISCONNECT_P2P))}),t!==Ee.PUBLISH&&t!==Ee.RESTART_ICE||this.once(de.ABORT_P2P_EXECUTION,()=>{A(new N(y.DISCONNECT_P2P))})});if(this.connectionState!==Je.CONNECTING&&this.connectionState!==Je.RECONNECTING||t===Ee.JOIN||t===Ee.REJOIN||await u(),t===Ee.LEAVE&&(this.websocket.unbindDcCloseEventListener(),o=!0),this.websocket.sendMessage(c,!0,!1),o)return;const f=new ie((C,A)=>{let O=!1;const k=(H,re)=>{O=!0,C({isSuccess:H==="success",message:re||{}}),this.off(de.WS_CLOSED,M),this.off(de.WS_RECONNECTING,M),this.emit(de.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),k);const M=()=>{A(new N(y.WS_ABORT,"type: ".concat(t))),this.off(de.WS_CLOSED,M),this.off(de.WS_RECONNECTING,M),this.off("res-@".concat(a),k)};this.once(de.WS_CLOSED,M),this.once(de.WS_RECONNECTING,M),gn(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(v.warning("dc request timeout, type: ".concat(t)),this.emit(de.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await f}catch(C){if(this.connectionState===Je.CLOSED||t===Ee.LEAVE)throw new N(y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?C.throw():t===Ee.JOIN||t===Ee.REJOIN?null:(await u(),await this.request(t,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),S=Hc(_),R=new N(y.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(p.message.error_str),{code:_,data:p.message});return S.action==="success"?p.message:(v.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(S.desc,", action: ").concat(S.action)),_===fe.ERR_TOO_MANY_BROADCASTERS?((t===Ee.JOIN||t===Ee.REJOIN)&&(this.initError=R,this.close()),R.throw()):S.action==="failed"?R.throw():S.action==="quit"?(this.initError=R,this.close(),R.throw()):(_===fe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Mr.MULTI_IP)):this.reconnect(S.action,Mr.SERVER_ERROR),t===Ee.JOIN||t===Ee.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ie(i=>{const o=a=>{(!n||n(a))&&(this.off(t,o),i(a))};this.on(t,o)})}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const a=D("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Je.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},D("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((i,o)=>{this.once(de.WS_CONNECTED,()=>i(this.joinResponse)),this.once(de.WS_CLOSED,()=>o(this.initError||new N(y.WS_ABORT))),this.connectionState=Je.CONNECTING,this.websocket.init(t).catch(o),this.websocket.once(mt.FAILBACK,()=>{this.openConnectionTime===void 0&&o(new N(y.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),o(new N(y.INIT_DATACHANNEL_TIMEOUT)))},D("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||He.LEAVE,this.connectionState=Je.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===He.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new BI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(de.ABORT_P2P_EXECUTION);const t=await Sn(this,de.DATACHANNEL_CONNECTING),n=await this.request(Ee.JOIN,t);if(!n)return this.emit(de.REPORT_JOIN_GATEWAY,y.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(de.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Je.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new N(y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=bs(this,de.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ee.REJOIN,t);return!!n&&(this.connectionState=Je.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(we.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(we.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(we.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(we.MUTE_AUDIO,{uid:i.uid}):this.emit(we.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(we.MUTE_VIDEO,{uid:i.uid}):this.emit(we.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(we.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(we.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(we.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(we.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(we.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Hc(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(He.UID_BANNED),void this.close()):void this.reconnect(n.action,Mr.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=D("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>D("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Mr.TIMEOUT):this.request(Ee.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),D("REPORT_STATS")&&this.send(Ee.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(ti.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(mt.RECONNECT_WAITTING_FINISH,t=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(mt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(mt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(mt.CLOSED,()=>{this.connectionState=Je.CLOSED}),this.websocket.on(mt.FAILED,()=>{this._disconnectedReason=He.NETWORK_ERROR,this.connectionState=Je.CLOSED}),this.websocket.on(mt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Je.CONNECTED?this.connectionState=Je.RECONNECTING:this.connectionState=Je.CONNECTING}),this.websocket.on(mt.WILL_RECONNECT,(t,n)=>{if(bs(this,de.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),n(t)}),this.websocket.on(mt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Mr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(de.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof N&&t.code===y.UNEXPECTED_RESPONSE&&t.data.code===fe.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Mr.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Mr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(mt.REQUEST_NEW_URLS,(t,n)=>{Sn(this,de.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(mt.TO_CONNECT_DATACHANNEL,async(t,n,i)=>Sn(this,de.DATACHANNEL_PRECONNECT,t).then(n).catch(i)),this.websocket.on(mt.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(de.DATACHANNEL_FAILBACK)})}}function GI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Vr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GI(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const D_=new Map;class HV extends ft{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(ht.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(ht.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),m(this,"store",void 0),m(this,"joinInfo",void 0),m(this,"key",void 0),m(this,"signal",void 0),m(this,"role",void 0),m(this,"inChannelInfo",{joinAt:null,duration:0}),m(this,"spec",void 0),m(this,"_state","DISCONNECTED"),m(this,"_statsCollector",void 0),m(this,"_disconnectedReason",void 0),m(this,"isSignalRecover",!1),m(this,"hasChangeBGPAddress",!1),m(this,"trafficStatsInterval",void 0),m(this,"networkQualityInterval",void 0),m(this,"_joinGatewayStartTime",0),m(this,"_signalTimeout",!1),m(this,"_clientRoleOptions",void 0),m(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useDataChannel?new no(Vr(Vr({},n),{},{retryConfig:n.websocketRetryConfig}),t):new xI(Vr(Vr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,i){if(this.signal instanceof no){let u=!1;t.cloudProxyServer!=="disabled"?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),u=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),u=!0):t.apResponse.addresses.some(f=>f.fingerprint)||D("FINGERPRINT")||(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),u=!0),u&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let a=D_.get(t.cname);if(a||(a=new Map,D_.set(t.cname,a)),this._isProactiveJoin=!0,a.has(t.uid)){const u=new N(y.UID_CONFLICT);throw se.joinGateway(t.sid,{lts:o,succ:!1,ec:u.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof no?"1":"0"}),this._isProactiveJoin=!1,u}a.set(t.uid,!0),this.joinInfo=t,this.key=n;let c=0;this.joinGatewayStartTime=o;const l=t.proxyServer;try{let u;if(v.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof no?"datachannel":"websocket"," join uid ").concat(c)),this.signal instanceof no)u=await this.signal.init(t.apResponse.addresses,i);else{const f=t.proxyServer,p=f?t.gatewayAddrs.map(_=>{const S=_.address.split(":");return"wss://".concat(f,"/ws/?h=").concat(S[0],"&p=").concat(S[1])}):t.gatewayAddrs.map(_=>"wss://".concat(_.address));u=await this.signal.init(p,i)}c=u.uid,v.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof no?"datachannel":"websocket"," join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){throw u&&u.code===y.INIT_WEBSOCKET_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join failed"),u.toString()),u):u&&u.code===y.INIT_DATACHANNEL_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join datachannel failed"),u.toString()),this.resetSignal(),u):(v.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),se.joinGateway(t.sid,{lts:o,succ:!1,ec:u.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:this.signal instanceof no?"1":"0"}),this._isProactiveJoin=!1,a.delete(t.uid),this.signal.close(),u)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ht.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ht.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ht.NETWORK_QUALITY,{uplinkNetworkQuality:OI(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:OI(this._statsCollector.trafficStats.B_dnq)}):this.emit(ht.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==He.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Je.CONNECTED||await function(i,o){return o===1/0?i:ie.race([i,jV(o)])}(this.signal.request(Ee.LEAVE,void 0,!0),3e3)}catch(i){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==He.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:D("PUB_EXTEND"),twcc:!!D("PUBLISH_TWCC"),rtx:!!D("USE_PUB_RTX")};try{return(await this.signal.request(Ee.PUBLISH,o,!0))._message}catch(a){if(i&&a.data&&a.data.code===fe.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw a}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ee.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(y.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!D("SUBSCRIBE_TWCC"),rtx:!!D("USE_SUB_RTX"),extend:D("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0};try{return(await this.signal.request(Ee.SUBSCRIBE,o,!0))._message}catch(a){if(i&&a.data&&a.data.code===fe.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw a}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(y.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!D("USE_SUB_RTX")};try{return await this.signal.request(Ee.SUBSCRIBE_STREAMS,i,!0)}catch(o){if(n&&o.data&&o.data.code===fe.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let o=i.frameRate,a=i.width,c=i.height,l=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(l=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,o||(l=!1)),l?{stream_type:0,width:a,height:c,fps:o,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ee.SET_VIDEO_PROFILE,n);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ee.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async massUnsubscribe(t){try{await this.signal.request(Ee.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(Ee.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ee.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ee.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=t);let i;i=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(Ee.SET_CLIENT_ROLE,{role:t,level:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Ee.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ee.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ee.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ee.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Vr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ee.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=D_.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:pi.username,password:pi.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Vr(Vr({},pi),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ee.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&Tr(()=>{this.emit(ht.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new N(y.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=D("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const o=Vr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:bi,browser:navigator.userAgent,process_id:D("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:D("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:D("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:D("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof D("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?D("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof D("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?D("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof D("ENABLE_USER_LICENSE_CHECK")=="boolean"?D("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:D("USE_PUB_RTX")===!0||D("USE_SUB_RTX")===!0||void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,D("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new N(y.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(de.WS_RECONNECT_WAITTING_FINISH,t=>{["tryNext","recover"].includes(t)&&this.joinInfo&&se.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(de.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(de.WS_RECONNECTING,t=>{this.joinInfo&&se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||xn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",se.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(de.WS_CLOSED,t=>{let n;switch(t){case He.LEAVE:n=xn.LEAVE;break;case He.UID_BANNED:case He.IP_BANNED:case He.CHANNEL_BANNED:case He.SERVER_ERROR:n=xn.SERVER_ERROR;break;case He.FALLBACK:n=xn.FALLBACK;break;case He.LICENSE_MISSING:case He.LICENSE_EXPIRED:case He.LICENSE_MINUTES_EXCEEDED:case He.LICENSE_PERIOD_INVALID:case He.LICENSE_MULTIPLE_SDK_SERVICE:case He.LICENSE_ILLEGAL:n=t;break;default:n=xn.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+xn.NETWORK_ERROR)),this.joinInfo&&se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===He.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==He.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(de.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof no?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));et("EVENT_REPORT_DOMAIN",t[1]),et("EVENT_REPORT_BACKUP_DOMAIN",t[1]),et("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(we.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(de.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new N(y.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Sn(this,ht.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(de.REQUEST_JOIN_INFO,async t=>{var n;this.updateTurnConfigFromSignal();const{iceParameters:i,dtlsParameters:o,rtpCapabilities:a}=await Sn(this,ht.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:a,version:"2"}}))}),this.signal.on(de.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(de.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&(se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof no?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(de.IS_P2P_DISCONNECTED,t=>{t(bs(this,ht.IS_P2P_DISCONNECTED))}),this.signal.on(de.DISCONNECT_P2P,()=>{this.emit(ht.DISCONNECT_P2P)}),this.signal.on(de.NEED_RENEW_SESSION,()=>{this.emit(ht.NEED_RENEW_SESSION)}),this.signal.on(de.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(de.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(de.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(ht.JOIN_RESPONSE,t,n)}),this.signal.on(de.DATACHANNEL_PRECONNECT,async(t,n,i)=>{this.updateTurnConfigFromSignal();const o=this.getCurrentGatewayAddress();return Sn(this,ht.DATACHANNEL_PRECONNECT,t,o).then(n).catch(i)}),this.signal.on(de.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=await Sn(this,ht.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:o,version:"2"}}))}),this.signal.on(de.DATACHANNEL_FAILBACK,()=>{v.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(ht.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ee.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ee.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Ee.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(o=>o.stream_type===xt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ee.CONTROL,i,!0,!0)}catch(o){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,n){const i={action:t.find(o=>o.stream_type===xt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ee.CONTROL,i,!0,!0)}catch(o){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}uploadStats(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ee.RESTART_ICE,n,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,xn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!D("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ee.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(He.FALLBACK)),this.store.useDataChannel=!1,this.signal=new xI(Vr(Vr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(ht.RESET_SIGNAL,Xl.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(x){var K=0;return function(){return K<x.length?{done:!1,value:x[K++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,K,te){return x==Array.prototype||x==Object.prototype||(x[K]=te.value),x},i,o=function(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof h=="object"&&h];for(var K=0;K<x.length;++K){var te=x[K];if(te&&te.Math==Math)return te}throw Error("Cannot find global object")}(this);function a(x,K){if(K)e:{var te=o;x=x.split(".");for(var Se=0;Se<x.length-1;Se++){var xe=x[Se];if(!(xe in te))break e;te=te[xe]}(K=K(Se=te[x=x[x.length-1]]))!=Se&&K!=null&&n(te,x,{configurable:!0,writable:!0,value:K})}}function c(x){return(x={next:x})[Symbol.iterator]=function(){return this},x}function l(x){var K=typeof Symbol<"u"&&Symbol.iterator&&x[Symbol.iterator];return K?K.call(x):{next:t(x)}}if(a("Symbol",function(x){function K(xe,X){this.A=xe,n(this,"description",{configurable:!0,writable:!0,value:X})}if(x)return x;K.prototype.toString=function(){return this.A};var te="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Se=0;return function xe(X){if(this instanceof xe)throw new TypeError("Symbol is not a constructor");return new K(te+(X||"")+"_"+Se++,X)}}),a("Symbol.iterator",function(x){if(x)return x;x=Symbol("Symbol.iterator");for(var K="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),te=0;te<K.length;te++){var Se=o[K[te]];typeof Se=="function"&&typeof Se.prototype[x]!="function"&&n(Se.prototype,x,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return x}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var u;e:{var f={};try{f.__proto__={a:!0},u=f.a;break e}catch{}u=!1}i=u?function(x,K){if(x.__proto__=K,x.__proto__!==K)throw new TypeError(x+" is not extensible");return x}:null}var p=i;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(x){if(x.m)throw new TypeError("Generator is already running");x.m=!0}function R(x,K){return x.h=3,{value:K}}function C(x){this.g=new _,this.G=x}function A(x,K,te,Se){try{var xe=K.call(x.g.j,te);if(!(xe instanceof Object))throw new TypeError("Iterator result "+xe+" is not an object");if(!xe.done)return x.g.m=!1,xe;var X=xe.value}catch(g){return x.g.j=null,x.g.s(g),O(x)}return x.g.j=null,Se.call(x.g,X),O(x)}function O(x){for(;x.g.h;)try{var K=x.G(x.g);if(K)return x.g.m=!1,{value:K.value,done:!1}}catch(te){x.g.v=void 0,x.g.s(te)}if(x.g.m=!1,x.g.l){if(K=x.g.l,x.g.l=null,K.F)throw K.D;return{value:K.return,done:!0}}return{value:void 0,done:!0}}function k(x){this.next=function(K){return x.o(K)},this.throw=function(K){return x.s(K)},this.return=function(K){return function(te,Se){S(te.g);var xe=te.g.j;return xe?A(te,"return"in xe?xe.return:function(X){return{value:X,done:!0}},Se,te.g.return):(te.g.return(Se),O(te))}(x,K)},this[Symbol.iterator]=function(){return this}}function M(x,K){return K=new k(new C(K)),p&&x.prototype&&p(K,x.prototype),K}if(_.prototype.o=function(x){this.v=x},_.prototype.s=function(x){this.l={D:x,F:!0},this.h=this.C||this.u},_.prototype.return=function(x){this.l={return:x},this.h=this.u},C.prototype.o=function(x){return S(this.g),this.g.j?A(this,this.g.j.next,x,this.g.o):(this.g.o(x),O(this))},C.prototype.s=function(x){return S(this.g),this.g.j?A(this,this.g.j.throw,x,this.g.o):(this.g.s(x),O(this))},a("Array.prototype.entries",function(x){return x||function(){return function(K,te){K instanceof String&&(K+="");var Se=0,xe=!1,X={next:function(){if(!xe&&Se<K.length){var g=Se++;return{value:te(g,K[g]),done:!1}}return xe=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}(this,function(K,te){return[K,te]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var H=function(x,K){for(var te=0;te<x.length;te++)K(x[te])},re=function(x){return x.replace(/\r?\n|\r/g,`\r
`)},Y=function(x,K,te){return K instanceof Blob?(te=te!==void 0?te+"":typeof K.name=="string"?K.name:"blob",K.name===te&&Object.prototype.toString.call(K)!=="[object Blob]"||(K=new File([K],te)),[String(x),K]):[String(x),String(K)]},J=function(x,K){if(x.length<K)throw new TypeError(K+" argument required, but only "+x.length+" present.")},W=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Q=W.FormData,Be=W.XMLHttpRequest&&W.XMLHttpRequest.prototype.send,he=W.Request&&W.fetch,rt=W.navigator&&W.navigator.sendBeacon,Xe=W.Element&&W.Element.prototype,Ot=W.Symbol&&Symbol.toStringTag;Ot&&(Blob.prototype[Ot]||(Blob.prototype[Ot]="Blob"),"File"in W&&!File.prototype[Ot]&&(File.prototype[Ot]="File"));try{new File([],"")}catch{W.File=function(K,te,Se){return K=new Blob(K,Se||{}),Object.defineProperties(K,{name:{value:te},lastModified:{value:+(Se&&Se.lastModified!==void 0?new Date(Se.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ot&&Object.defineProperty(K,Ot,{value:"File"}),K}}var sn=function(x){return x.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},yt=function(x){this.i=[];var K=this;x&&H(x.elements,function(te){if(te.name&&!te.disabled&&te.type!=="submit"&&te.type!=="button"&&!te.matches("form fieldset[disabled] *"))if(te.type==="file"){var Se=te.files&&te.files.length?te.files:[new File([],"",{type:"application/octet-stream"})];H(Se,function(xe){K.append(te.name,xe)})}else te.type==="select-multiple"||te.type==="select-one"?H(te.options,function(xe){!xe.disabled&&xe.selected&&K.append(te.name,xe.value)}):te.type==="checkbox"||te.type==="radio"?te.checked&&K.append(te.name,te.value):(Se=te.type==="textarea"?re(te.value):te.value,K.append(te.name,Se))})};if((e=yt.prototype).append=function(x,K,te){J(arguments,2),this.i.push(Y(x,K,te))},e.delete=function(x){J(arguments,1);var K=[];x=String(x),H(this.i,function(te){te[0]!==x&&K.push(te)}),this.i=K},e.entries=function x(){var K,te=this;return M(x,function(Se){if(Se.h==1&&(K=0),Se.h!=3)return K<te.i.length?Se=R(Se,te.i[K]):(Se.h=0,Se=void 0),Se;K++,Se.h=2})},e.forEach=function(x,K){J(arguments,1);for(var te=l(this),Se=te.next();!Se.done;Se=te.next()){var xe=l(Se.value);Se=xe.next().value,xe=xe.next().value,x.call(K,xe,Se,this)}},e.get=function(x){J(arguments,1);var K=this.i;x=String(x);for(var te=0;te<K.length;te++)if(K[te][0]===x)return K[te][1];return null},e.getAll=function(x){J(arguments,1);var K=[];return x=String(x),H(this.i,function(te){te[0]===x&&K.push(te[1])}),K},e.has=function(x){J(arguments,1),x=String(x);for(var K=0;K<this.i.length;K++)if(this.i[K][0]===x)return!0;return!1},e.keys=function x(){var K,te,Se,xe,X=this;return M(x,function(g){if(g.h==1&&(K=l(X),te=K.next()),g.h!=3)return te.done?void(g.h=0):(Se=te.value,xe=l(Se),R(g,xe.next().value));te=K.next(),g.h=2})},e.set=function(x,K,te){J(arguments,2),x=String(x);var Se=[],xe=Y(x,K,te),X=!0;H(this.i,function(g){g[0]===x?X&&(X=!Se.push(xe)):Se.push(g)}),X&&Se.push(xe),this.i=Se},e.values=function x(){var K,te,Se,xe,X=this;return M(x,function(g){if(g.h==1&&(K=l(X),te=K.next()),g.h!=3)return te.done?void(g.h=0):(Se=te.value,(xe=l(Se)).next(),R(g,xe.next().value));te=K.next(),g.h=2})},yt.prototype._asNative=function(){for(var x=new Q,K=l(this),te=K.next();!te.done;te=K.next()){var Se=l(te.value);te=Se.next().value,Se=Se.next().value,x.append(te,Se)}return x},yt.prototype._blob=function(){var x="----formdata-polyfill-"+Math.random(),K=[],te="--"+x+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Se,xe){return typeof Se=="string"?K.push(te+sn(re(xe))+`"\r
\r
`+re(Se)+`\r
`):K.push(te+sn(re(xe))+'"; filename="'+sn(Se.name)+`"\r
Content-Type: `+(Se.type||"application/octet-stream")+`\r
\r
`,Se,`\r
`)}),K.push("--"+x+"--"),new Blob(K,{type:"multipart/form-data; boundary="+x})},yt.prototype[Symbol.iterator]=function(){return this.entries()},yt.prototype.toString=function(){return"[object FormData]"},Xe&&!Xe.matches&&(Xe.matches=Xe.matchesSelector||Xe.mozMatchesSelector||Xe.msMatchesSelector||Xe.oMatchesSelector||Xe.webkitMatchesSelector||function(x){for(var K=(x=(this.document||this.ownerDocument).querySelectorAll(x)).length;0<=--K&&x.item(K)!==this;);return-1<K}),Ot&&(yt.prototype[Ot]="FormData"),Be){var qn=W.XMLHttpRequest.prototype.setRequestHeader;W.XMLHttpRequest.prototype.setRequestHeader=function(x,K){qn.call(this,x,K),x.toLowerCase()==="content-type"&&(this.B=!0)},W.XMLHttpRequest.prototype.send=function(x){x instanceof yt?(x=x._blob(),this.B||this.setRequestHeader("Content-Type",x.type),Be.call(this,x)):Be.call(this,x)}}he&&(W.fetch=function(x,K){return K&&K.body&&K.body instanceof yt&&(K.body=K.body._blob()),he.call(this,x,K)}),rt&&(W.navigator.sendBeacon=function(x,K){return K instanceof yt&&(K=K._asNative()),rt.call(this,x,K)}),W.FormData=yt}})();const uu=()=>{const e=D("AREAS");return e.length===0&&e.push(ke.GLOBAL),Ro(e).call(e,(t,n,i)=>{const o=WI(n);return o?i===0?o:"".concat(t,",").concat(o):t},"")},WI=e=>e===ke.OVERSEA?"".concat(Xt.ASIA,",").concat(Xt.EUROPE,",").concat(Xt.AFRICA,",").concat(Xt.NORTH_AMERICA,",").concat(Xt.SOUTH_AMERICA,",").concat(Xt.OCEANIA):Xt[e],KV=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=Ql[n],o=Object.keys(i);o&&o.map(a=>{a!=="CODE"&&(t[a]=t[a].concat(i[a]))})}),t},hu={GLOBAL:{ASIA:[ke.CHINA,ke.JAPAN,ke.INDIA,ke.KOREA,ke.HKMC],EUROPE:[],NORTH_AMERICA:[ke.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},P_=Object.keys(hu[ke.GLOBAL]),HI=[ke.CHINA,ke.NORTH_AMERICA,ke.EUROPE,ke.ASIA,ke.JAPAN,ke.INDIA,ke.OCEANIA,ke.SOUTH_AMERICA,ke.AFRICA,ke.KOREA,ke.HKMC,ke.US],YV=function(e,t){let n=[];if(e.includes(ke.GLOBAL)){const a=[ke.GLOBAL,ke.OVERSEA],c=Object.keys(Ql);if(t===ke.GLOBAL)throw new N(y.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===ke.CHINA)n=[ke.OVERSEA];else if(o=t,P_.includes(o)){const l=(i=t,hu[ke.GLOBAL][i]||[]),u=[...a,t,...l];n=c.filter(f=>!u.includes(f))}else if(function(l){let u=!1;return P_.forEach(f=>{hu[ke.GLOBAL][f].includes(l)&&(u=!0)}),u}(t)){const l=function(f){let p;return P_.forEach(_=>{hu[ke.GLOBAL][_].includes(f)&&(p=_)}),p}(t),u=[...a,l,t];n=c.filter(f=>!u.includes(f))}else n=e;n=function(l){const u=[];return HI.forEach(f=>{l.includes(f)&&u.push(f)}),u.concat(l.filter(f=>!HI.includes(f)))}(n)}else n=e;var i,o;return n};function KI(e){if(!e&&D("AREAS").includes(ke.EXTENSIONS))return v.debug("update area from ap : reset"),void L_(wR,!0);if(!D("AREAS").includes(ke.GLOBAL)||!e)return;let t=Ql.EXTENSIONS;t&&(t={CODE:WI(ke.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},v.debug("update area from ap success: ".concat(e,",config is "),t),et("AREAS",[ke.EXTENSIONS],!0),Object.keys(t).map(n=>{n==="LOG_UPLOAD_SERVER"||n==="EVENT_REPORT_DOMAIN"||n==="EVENT_REPORT_BACKUP_DOMAIN"||n==="PROXY_SERVER_TYPE3"?et(n,t[n][0]):et(n,t[n])}))}function L_(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=se.reportApiInvoke(null,{name:Nt.SET_AREA,options:e,tag:ut.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(a=>{if(!S2.includes(a))throw new N(y.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:a,excludedArea:c}=e;if(!a)throw new N(y.INVALID_PARAMS,"area code is needed");let l=a;typeof a=="string"&&(l=[a]),i=c?YV(l,c):l}if(!t){if(Rs.AREAS){const a=new N(y.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void v.warning("setArea is prohibited because of config-distribute")}if(i.includes(ke.GLOBAL)&&D("AREAS")===ke.EXTENSIONS){const a=new N(y.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void v.warning("setArea is prohibited because of ap extensions")}}et("AREAS",i,t);const o=KV(i);Object.keys(o).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?et(a,o[a][0]):et(a,o[a])}),v.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function YI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function zI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?YI(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let k_=1;function zV(e,t,n,i,o){k_+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:k_,requestId:k_,version:bi,cname:n.cname},c={service_name:t,json_body:JSON.stringify(a)};let l,u,f=e[0];return Er(async()=>{l=Date.now();const p=await Ji(f,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-l,p.code!==0){const R=new N(y.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:u});throw v.error(R.toString()),R}const _=JSON.parse(p.json_body);if(_.code!==200){const R=new N(y.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:u});throw v.error(R.toString()),R}if(!_.servers||_.servers.length===0){const R=new N(y.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:u});throw v.error(R.toString()),R}const S=function(R,C){return{addressList:R.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(D("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(C))),workerToken:R.workerToken,vid:R.vid}}(_,t);return D("LIVE_STREAMING_ADDRESS")&&(S.addressList=D("LIVE_STREAMING_ADDRESS")instanceof Array?D("LIVE_STREAMING_ADDRESS"):[D("LIVE_STREAMING_ADDRESS")]),zI(zI({},S),{},{responseTime:u})},(p,_)=>(se.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(p.addressList),firstSuccess:_===0,responseTime:u,serverIp:e[_%e.length]}),!1),(p,_)=>(se.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:t,responseTime:u,serverIp:e[_%e.length]}),!!(p.code!==y.OPERATION_ABORTED&&p.code!==y.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(f=e[(_+1)%e.length],!0)),o)}let M_=1;function qI(e,t,n,i){let{url:o,areaCode:a}=e;const c=Date.now();let l;const[u,f]=$I(t,a,[Kt.CHOOSE_SERVER]);let p=Dt.networkState;return Er(async()=>{p&&Dt.networkState===Rn.OFFLINE&&Dt.onlineWaiter&&await ie.race([Dt.onlineWaiter,gn(i&&i.maxRetryTimeout||wt.maxRetryTimeout)]),p=Dt.networkState;const{data:_,headers:S}=await Ji(o,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=S.http3==="1"?1:-1,se.reportResourceTiming(o,t.sid),XI(_,o,t,c,[Kt.CHOOSE_SERVER],l);const R=O_(_,Kt.CHOOSE_SERVER);return QI(R),CI(R,o)},_=>(_&&se.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,opid:f,serverList:_.gatewayAddrs.map(S=>S.address),ec:null,cid:_.cid.toString(),uid:_.uid.toString(),csIp:_.csIp,unilbsServerIds:[Kt.CHOOSE_SERVER].toString(),isHttp3:l}),!1),_=>_.code!==y.OPERATION_ABORTED&&(_.code===y.CAN_NOT_GET_GATEWAY_SERVER?_.data.retry:(se.joinChooseServer(t.sid,{lts:c,succ:!1,csAddr:o,serverList:null,opid:f,ec:_.code,csIp:_.data&&_.data.csIp,unilbsServerIds:[Kt.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l}),v.warning("[".concat(t.clientId,"] Choose server network error, retry"),_),!0)),i)}function JI(e,t,n,i){let o,{url:a,areaCode:c,serviceIds:l}=e;const u=Date.now(),[f,p]=$I(t,c,l);let _;return Er(async()=>{_&&Dt.networkState===Rn.OFFLINE&&Dt.onlineWaiter&&await ie.race([Dt.onlineWaiter,gn(i&&i.maxRetryTimeout||wt.maxRetryTimeout)]),_=Dt.networkState;const{data:S,headers:R}=await Ji(a,{data:f,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=R.http3==="1"?1:-1,se.reportResourceTiming(a,t.sid),XI(S,a,t,u,l,o);const C=O_(S,Kt.CHOOSE_SERVER),A=O_(S,t.cloudProxyServer==="proxy5"?Kt.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Kt.CLOUD_PROXY:Kt.CLOUD_PROXY_FALLBACK);return QI(C),{gatewayInfo:CI(C,a),proxyInfo:A,url:a}},S=>(S.gatewayInfo&&se.joinChooseServer(t.sid,{lts:u,succ:!0,csAddr:a,serverList:S.gatewayInfo.gatewayAddrs.map(R=>R.address),ec:null,opid:p,cid:S.gatewayInfo.cid.toString(),uid:S.gatewayInfo.uid.toString(),csIp:S.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:o}),S.proxyInfo&&se.joinWebProxyAP(t.sid,{lts:u,sucess:1,apServerAddr:a,turnServerAddrList:S.proxyInfo.addresses.map(R=>R.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),S=>S.code!==y.OPERATION_ABORTED&&(S.code===y.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(se.joinWebProxyAP(t.sid,{lts:u,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:S.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:_})}),v.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),S),!0)),i)}const XI=(e,t,n,i,o,a)=>{const c=[],l=u=>{u.flag===4096?se.joinChooseServer(n.sid,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:u.error.message,csIp:u.error.data&&u.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:a}):u.flag!==1048576&&u.flag!==4194304&&u.flag!==4194310||se.joinWebProxyAP(n.sid,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:u.error.code,eventType:n.cloudProxyServer,unilbsServerIds:o.toString()})};if(e.response_body.forEach(u=>{const f=u.buffer.code;if(u.uri===23&&f===0&&!u.buffer.edges_services)if(u.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),u.buffer.edges_services=[];else{const p={error:new N(y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:u.buffer.flag};c.push(p),l(p)}if(f!==0){const p=lu(f),_={error:new N(y.CAN_NOT_GET_GATEWAY_SERVER,p.desc,{desc:p.desc,retry:p.retry,csIp:e.detail[502]}),flag:u.buffer.flag};u.buffer.flag===4194310?v.warning(_.error.toString()):c.push(_),l(_)}}),c.length)throw v.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(c.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message,", retry: ").concat(u.error.data.retry)).join(" | "))),new N(y.CAN_NOT_GET_GATEWAY_SERVER,c.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message)).join(" | "),{retry:!!c.find(u=>u.error.data.retry),csIp:e.detail[502],desc:[...new Set(c.map(u=>{var f,p;return u==null||(f=u.error)===null||f===void 0||(p=f.data)===null||p===void 0?void 0:p.desc}).filter(u=>!!u))]})},QI=e=>{var t,n,i,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new N(y.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(D("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?KI(e.detail[23].toLowerCase()):KI()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const c=e.detail[19],l=c==null?void 0:c.split(";");for(let u=0;u<l.length;u++){var a;const f=Jr(a=l[u]).call(a);e.addresses[u]&&l&&(e.addresses[u].fingerprint=f)}}if(D("GATEWAY_ADDRESS")&&D("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",D("GATEWAY_ADDRESS"));const c=D("GATEWAY_ADDRESS").map(l=>{var u,f;const p=(u=(f=e.addresses.find(_=>_.ip===l.ip&&_.port===l.port))===null||f===void 0?void 0:f.fingerprint)!==null&&u!==void 0?u:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:p}});e.addresses=c}},qV=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=lu(n.buffer.code);throw new N(y.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",t),new N(y.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},$I=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:D("USE_NEW_TOKEN")?"1":void 0,22:t},key:e.token,service_ids:n,uid:e.uid||0}}]};o.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(o)),[a,i]},JV=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(i)),[o,n]};let Ma=0;async function U_(e,t,n,i){return{gatewayInfo:await async function(a,c,l,u){let f=null;const p=[],_=async()=>{const R=D("WEBCS_DOMAIN").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(O=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:uu()})),C=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),A=await Wc({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(v.debug("[".concat(a.clientId,"] Connect to choose_server:"),O.url),qI(O,a,c,l)),allFailedhandler:O=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},C),O[0]},promisesCollector:p});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},C),A},S=async()=>{if(await gn(1e3),f!==null)return f;const R=D("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:uu()})),C=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),A=await Wc({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(v.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),O.url),qI(O,a,c,l)),allFailedhandler:O=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},C),O[0]},promisesCollector:p});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},C),A};try{return f=await ka([_(),S()]),p.length&&p.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),f}catch(R){throw R[0]}}(e,t,n,i)}}async function ZI(e,t,n,i,o){const a=e.cloudProxyServer;if(a==="disabled"){if(!i)return;if(e.useLocalAccessPoint)return await U_(e,t,n,o);if(D("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:f,proxyInfo:p}=await tC(e,t,n,o);return e.turnServer&&e.turnServer.mode!=="auto"||(e.turnServer={mode:"manual",servers:p.map(_=>({turnServerURL:_.address,tcpport:_.tcpport||pi.tcpport,udpport:_.udpport||pi.udpport,username:_.username||pi.username,password:_.password||pi.password,forceturn:!1,security:!0}))}),{gatewayInfo:f}}return await U_(e,t,n,o)}const{proxyInfo:c,gatewayInfo:l}=await tC(e,t,n,o),u={gatewayInfo:l};return e.turnServer={mode:"manual",servers:c.map(f=>({turnServerURL:f.address,tcpport:a==="proxy3"?void 0:f.tcpport?f.tcpport:pi.tcpport,udpport:a==="proxy4"?void 0:f.udpport?f.udpport:pi.udpport,username:f.username||pi.username,password:f.password||pi.password,forceturn:a!=="proxy4",security:a==="proxy5"}))},v.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),u}async function eC(e,t,n,i,o){const a=D("ACCOUNT_REGISTER").slice(0,D("AJAX_REQUEST_CONCURRENT"));let c=[];c=t.proxyServer?a.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):a.map(u=>"https://".concat(u,"/api/v1"));const l=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const u=await async function(f,p,_,S,R){const C=Date.now(),A={sid:_.sid,opid:10,appid:_.appId,string_uid:p};let O=f[0];const k=await Er(()=>Ji(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(M,H)=>{if(M.code===0){if(M.uid<=0||M.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(p," => ").concat(M.uid),M),se.reqUserAccount(A.sid,{lts:C,success:!1,serverAddr:O,stringUid:A.string_uid,uid:M.uid,errorCode:y.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new N(y.INVALID_UINT_UID_FROM_STRING_UID);return se.reqUserAccount(A.sid,{lts:C,success:!0,serverAddr:O,stringUid:A.string_uid,uid:M.uid,errorCode:null,extend:A}),!1}const re=lu(M.code);return re.retry&&(O=f[(H+1)%f.length]),se.reqUserAccount(A.sid,{lts:C,success:!1,serverAddr:O,stringUid:A.string_uid,uid:M.uid,errorCode:re.desc,extend:A}),re.retry},(M,H)=>M.code!==y.OPERATION_ABORTED&&(se.reqUserAccount(A.sid,{lts:C,success:!1,serverAddr:O,stringUid:A.string_uid,uid:null,errorCode:M.code,extend:A}),O=f[(H+1)%f.length],!0),R);if(k.code!==0){const M=lu(k.code);throw new N(y.UNEXPECTED_RESPONSE,M.desc)}return k}(c,e,t,n,i);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},l),u.uid}catch(u){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},l),u}}async function XV(e,t,n){const i=D("CDS_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config")).map(l=>function(u,f,p,_){const S=We(),R={flag:64,cipher_method:0,features:{device:S.name,system:S.os,system_general:navigator.userAgent,vendor:f.appId,version:bi,cname:f.cname,sid:f.sid,session_id:f.sid,detail:"",proxyServer:f.proxyServer}};return Er(()=>Ji(u,{data:R,timeout:1e3,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,C=>C.code!==y.OPERATION_ABORTED,_)}(l,e,t,n));let o=null,a=null,c={};try{o=await ka(i)}catch(l){if(l.code===y.OPERATION_ABORTED)throw l;a=l}if(i.forEach(l=>l.cancel()),se.reportApiInvoke(e.sid,{name:Nt.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{c=function(l){if(!l.test_tags)return{};const u=l.test_tags,f=Object.keys(u),p={};return f.forEach(_=>{var S;const R=Jr(S=_.slice(4)).call(S),C=JSON.parse(u[_])[1];p[R]=C}),p}(o)}catch{}return c}async function tC(e,t,n,i){const o=D("PROXY_SERVER_TYPE3"),a=(R,C,A)=>{let O=A||o;return Array.isArray(O)&&(O=C%2==0?o[1]:o[0]),"https://".concat(O,"/ap/?url=").concat(R)};let c=null;const l=[],u=async()=>{const R=D("WEBCS_DOMAIN").slice(0,D("AJAX_REQUEST_CONCURRENT")).map((O,k)=>{let M;return M=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(O,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):a("".concat(O,"/api/v2/transpond/webrtc?v=2"),k),{url:M,areaCode:uu(),serviceIds:[Kt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Kt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Kt.CLOUD_PROXY:Kt.CLOUD_PROXY_FALLBACK]}}),C=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),A=await Wc({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(v.debug("[".concat(e.clientId,"] Connect to choose_server:"),O.url),JI(O,e,t,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},C),O[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},C),A},f=async()=>{if(await gn(1e3),c!==null)return c;const R=D("WEBCS_DOMAIN_BACKUP_LIST").map((O,k)=>{let M;return M=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(O,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):a("".concat(O,"/api/v2/transpond/webrtc?v=2"),k),{url:M,areaCode:uu(),serviceIds:[Kt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Kt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Kt.CLOUD_PROXY:Kt.CLOUD_PROXY_FALLBACK]}}),C=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),A=await Wc({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(v.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),O.url),JI(O,e,t,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},C),O[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},C),A};let p,_,S;try{({gatewayInfo:p,proxyInfo:_,url:S}=await ka([u(),f()]))}catch(R){throw R[0]}if(l.length&&l.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),!p||!_)throw new N(y.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=S,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&S){const R=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];o.includes(R)&&(e.proxyServer=R,v.setProxyServer(R),se.setProxyServer(R))}return c={gatewayInfo:p,proxyInfo:await xV(_,p.uid)},c}async function nC(e,t,n,i){const o=D("UAP_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await zV(o,e,t,n,i)}async function QV(e,t,n){const i=D("UAP_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")).map(o=>function(a,c,l,u){const f={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:bi,cname:c.cname,uid:c.uid.toString(),requestId:M_,seq:M_};M_+=1;const p={service_name:"tele_channel",json_body:JSON.stringify(f)};return Er(async()=>{const _=await Ji(a,{data:p,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_.code!==0){const R=new N(y.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_.code,{retry:!0});throw v.error(R.toString()),R}const S=JSON.parse(_.json_body);if(S.code!==200){const R=new N(y.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw v.error(R.toString()),R}if(!S.servers||S.servers.length===0){const R=new N(y.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(R.toString()),R}return{vid:S.vid,workerToken:S.workerToken,addressList:(D("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(D("WORKER_DOMAIN"),":").concat(R.wss))}},void 0,_=>!!(_.code!==y.OPERATION_ABORTED&&_.code!==y.UNEXPECTED_RESPONSE||_.data&&_.data.retry),u)}(o,e,t,n));try{const o=await ka(i);return i.forEach(a=>a.cancel()),o}catch(o){throw o[0]}}async function $V(e,t,n){let i=null;const o=[],a=async c=>{const l=D(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2"));return c&&(await gn(1e3),i!==null)?i:await Wc({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:u=>(v.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),u),function(f,p,_,S){const[R]=JV(p,[Kt.CHOOSE_SERVER]);let C=Dt.networkState;return Er(async()=>{C&&Dt.networkState===Rn.OFFLINE&&Dt.onlineWaiter&&await ie.race([Dt.onlineWaiter,gn(S&&S.maxRetryTimeout||wt.maxRetryTimeout)]),C=Dt.networkState;const A=await Ji(f,{data:R,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return qV(A,f)},()=>!1,A=>A.code!==y.OPERATION_ABORTED&&(A.code===y.UPDATE_TICKET_FAILED?A.data.retry:(v.warning("[".concat(p.clientId,"] update ticket network error, retry"),A),!0)),S)}(u,e,t,n)),allFailedhandler:u=>{throw u[0]},promisesCollector:o})};try{return i=await ka([a(!1),a(!0)]),o.length&&o.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function iC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function rC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iC(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iC(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class ZV extends ft{constructor(){super(),m(this,"configs",void 0),m(this,"joinInfo",void 0),m(this,"cancelToken",void 0),m(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),m(this,"interval",void 0),m(this,"mutex",new Pn("config-distribute")),m(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),D("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},D("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,se.reportApiInvoke(null,{options:void 0,name:Nt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:ut.TRACER}).onSuccess(JSON.stringify(Rs))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await XV(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){const o=new N(y.NETWORK_RESPONSE_ERROR,i);v.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(Fc.UPDATE_BITRATE_LIMIT,t):this.emit(Fc.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&rC({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const i=$f(n=Object.keys(t).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(n);for(let a=0;a<i.length;a++)for(let c=i.length-1;c>a;c--){const l=i[c];if(typeof t[l].__priority=="number"){const u=t[l].__priority,f=i[c-1];if(typeof t[f].__priority=="number"){if(!(u>t[f].__priority))continue;{const p=l;i[c]=i[c-1],i[c-1]=p}}else{const p=l;i[c]=i[c-1],i[c-1]=p}}}const o={};i.forEach(a=>{const c=t[a],l=c.__expires;Object.keys(c).forEach(u=>{u==="__priority"||u==="__expires"||Object.prototype.hasOwnProperty.call(o,u)||(o[u]=rC({value:c[u]},l&&{expires:l}))})});try{const a=JSON.stringify(o),c=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",c),v.debug("Caching global parameters ".concat(a))}catch(a){v.error("Error caching global parameters:",a.message)}}}function oC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Kc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oC(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oC(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class ej extends ft{constructor(t,n,i,o){super(),m(this,"spec",void 0),m(this,"token",void 0),m(this,"websocket",void 0),m(this,"pingpongTimer",void 0),m(this,"reconnectMode","retry"),m(this,"serviceMode",void 0),m(this,"reqId",0),m(this,"commandReqId",0),m(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),m(this,"handleWebSocketMessage",a=>{if(!a.data)return;const c=JSON.parse(a.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):this.serviceMode===Ut.INJECT?this.emit(qi.INJECT_STREAM_STATUS,c):(se.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Ut.TRANSCODE?1:2}),this.emit(qi.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new Ds("live-streaming",i),this.websocket.on(Te.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Te.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Te.REQUEST_NEW_URLS,(a,c)=>{Sn(this,qi.REQUEST_NEW_ADDRESS).then(a).catch(c)}),this.websocket.on(Te.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const a=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new N(y.UNEXPECTED_ERROR);const l=Kc({command:t,sdkVersion:bi==="4.18.2"?"0.0.1":bi,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new N(y.WS_DISCONNECT);const u=()=>new ie((S,R)=>{this.websocket.once(Te.CLOSED,()=>R(new N(y.WS_ABORT))),this.websocket.once(Te.CONNECTED,S)});this.websocket.state!=="connected"&&await u(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const f=new ie((S,R)=>{const C=()=>{R(new N(y.WS_ABORT))};this.websocket.once(Te.RECONNECTING,C),this.websocket.once(Te.CLOSED,C),this.once("@".concat(c,"-").concat(this.spec.sid),A=>{S(A)})});o&&se.workerEvent(this.spec.sid,Kc(Kc({},o),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let _=null;try{_=await f}catch(S){if(this.websocket.state==="closed")throw S;return await u(),await this.request(t,n,i)}return o&&se.workerEvent(this.spec.sid,Kc(Kc({},o),{},{requestId:a,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-p})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=bi==="4.18.2"?"0.0.1":bi;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Rt.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case Rt.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Rt.LIVE_STREAM_RESPONSE_BAD_STREAM:case Rt.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new N(y.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Rt.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new N(y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Rt.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new N(y.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Rt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new N(y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(qi.WARNING,n,t.serverResponse.url)}case Rt.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new N(y.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(qi.WARNING,n,t.serverResponse.url)}case Rt.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new N(y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Rt.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new N(y.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Rt.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new N(y.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(qi.WARNING,n,t.serverResponse.url)}case Rt.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new N(y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Rt.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new N(y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Rt.LIVE_STREAM_RESPONSE_WORKER_LOST:case Rt.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new N(y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Rt.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new N(y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new N(y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Rt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Rt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Rt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Rt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new N(y.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(cu)},6e3)}}function sC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Vn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sC(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sC(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class tj extends ft{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wt,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wt;super(),m(this,"onLiveStreamWarning",void 0),m(this,"onLiveStreamError",void 0),m(this,"onInjectStatusChange",void 0),m(this,"spec",void 0),m(this,"retryTimeout",1e4),m(this,"connection",void 0),m(this,"httpRetryConfig",void 0),m(this,"wsRetryConfig",void 0),m(this,"streamingTasks",new Map),m(this,"isStartingStreamingTask",!1),m(this,"taskMutex",new Pn("live-streaming")),m(this,"cancelToken",hi.CancelToken.source()),m(this,"transcodingConfig",void 0),m(this,"injectConfig",Vn({},g2)),m(this,"injectLoopTimes",0),m(this,"uapResponse",void 0),m(this,"lastTaskId",1),m(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=Vn(Vn({},m2),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>Vn(Vn(Vn({},E2),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){dt(c.width)||nt(c.width,"config.width",0,1e4),dt(c.height)||nt(c.height,"config.height",0,1e4),dt(c.videoBitrate)||nt(c.videoBitrate,"config.videoBitrate",1,1e6),dt(c.videoFrameRate)||nt(c.videoFrameRate,"config.videoFrameRate"),dt(c.lowLatency)||ya(c.lowLatency,"config.lowLatency"),dt(c.audioSampleRate)||Jt(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),dt(c.audioBitrate)||nt(c.audioBitrate,"config.audioBitrate",1,128),dt(c.audioChannels)||Jt(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),dt(c.videoGop)||nt(c.videoGop,"config.videoGop"),dt(c.videoCodecProfile)||Jt(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),dt(c.userCount)||nt(c.userCount,"config.userCount",0,17),dt(c.backgroundColor)||nt(c.backgroundColor,"config.backgroundColor",0,16777215),dt(c.userConfigExtraInfo)||hn(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!dt(c.transcodingUsers)&&($r(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,u)=>{t_(l.uid),dt(l.x)||nt(l.x,"transcodingUser[".concat(u,"].x"),0,1e4),dt(l.y)||nt(l.y,"transcodingUser[".concat(u,"].y"),0,1e4),dt(l.width)||nt(l.width,"transcodingUser[".concat(u,"].width"),0,1e4),dt(l.height)||nt(l.height,"transcodingUser[".concat(u,"].height"),0,1e4),dt(l.zOrder)||nt(l.zOrder-1,"transcodingUser[".concat(u,"].zOrder"),0,100),dt(l.alpha)||nt(l.alpha,"transcodingUser[".concat(u,"].alpha"),0,1,!1)})),dt(c.watermark)||c_(c.watermark,"watermark"),dt(c.backgroundImage)||c_(c.backgroundImage,"backgroundImage"),c.images&&!dt(c.images)&&($r(c.images,"config.images"),c.images.forEach((l,u)=>{c_(l,"images[".concat(u,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>Vn(Vn(Vn({},a_),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(Vn(Vn(Vn({},a_),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(Vn(Vn(Vn({},a_),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>Vn({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?ie.resolve(c.uid):eC(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ie.all(o)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var a;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ur(a=this.streamingTasks).call(a)).map(l=>l.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(u=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)})})}}setInjectStreamConfig(t,n){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=n}async startLiveStreamingTask(t,n,i){var o;if(Array.from(Ur(o=this.streamingTasks).call(o)).find(u=>u.mode===Ut.INJECT)&&n===Ut.INJECT)return new N(y.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===Ut.TRANSCODE)throw new N(y.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const c=await this.taskMutex.lock();if(!this.connection&&i)return void c();if(this.streamingTasks.get(t)&&!i)return c(),new N(y.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(u){throw c(),u}switch(n){case Ut.TRANSCODE:a.transcodingConfig=Vn({},this.transcodingConfig);break;case Ut.RAW:break;case Ut.INJECT:a={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const l=this.lastTaskId++;try{const u=new ie((p,_)=>{gn(this.retryTimeout).then(()=>{if(i)return _(i);const S=this.statusError.get(t);return S?(this.statusError.delete(t),_(S)):void 0})}),f=await ie.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:n===Ut.TRANSCODE?1:2,requestByUser:!i,tid:l.toString()}),u]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(t,{clientRequest:a,mode:n,url:t,taskId:l}),c()}catch(u){if(c(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||i)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,u)):await this.startLiveStreamingTask(t,n,u)}}stopLiveStreamingTask(t){return new ie((n,i)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new N(y.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=o.mode;o.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:a===Ut.INJECT?"UninjectStream":"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:a===Ut.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&a!==Ut.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),a===Ut.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Oo.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(i)})}async controlInjectStream(t,n,i,o){const a=this.streamingTasks.get(t);if(!a||!this.connection||a.mode!==Ut.INJECT)throw new N(y.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:i,position:o}})).serverResponse}resetAllTask(){var t;const n=Array.from(Ur(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=hi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new N(y.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Sn(this,Ca.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new ej(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(qi.WARNING,(i,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,i)),this.connection.on(qi.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(qi.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(qi.REQUEST_NEW_ADDRESS,(i,o)=>{if(!this.connection)return o(new N(y.UNEXPECTED_ERROR,"can not get new live streaming address list"));Sn(this,Ca.REQUEST_WORKER_MANAGER_LIST,t).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),o=t.reason;switch(t.code){case Rt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Rt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Rt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Rt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new N(y.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return v.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Rt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new N(y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Rt.LIVE_STREAM_RESPONSE_WORKER_LOST:case Rt.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Ur(a=this.streamingTasks).call(a));for(const l of c)l.abortTask?l.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new N(y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(u=>{v.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)}));return}}}handleInjectStreamServerStatus(t){const n=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Oo.INJECT_STREAM_STATUS_START_SUCCESS,n,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Oo.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Oo.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Oo.INJECT_STREAM_STATUS_BROKEN,n,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Oo.INJECT_STREAM_STATUS_START_TIMEOUT,n,i),void this.streamingTasks.delete(i);default:return void v.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class aC{constructor(){m(this,"destChannelMediaInfos",new Map),m(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){$R(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){$R(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){e_(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function cC(e){if(!(e instanceof aC))return new N(y.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new N(y.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new N(y.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class nj extends ft{constructor(t,n,i){super(),m(this,"ws",void 0),m(this,"requestId",1),m(this,"heartBeatTimer",void 0),m(this,"joinInfo",void 0),m(this,"clientId",void 0),m(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),m(this,"onClose",o=>{this.emit("close"),this.dispose()}),m(this,"onMessage",o=>{const a=JSON.parse(o.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=t,this.clientId=n,this.ws=new Ds("cross-channel-".concat(this.clientId),i),this.ws.on(Te.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Te.CONNECTED,this.onOpen),this.ws.on(Te.ON_MESSAGE,this.onMessage),this.ws.on(Te.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ie((n,i)=>{const o=window.setTimeout(()=>{i(new N(y.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,a=>{window.clearTimeout(o),a.state&&a.state!==0?i(new N(y.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),i(new N(y.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new N(y.WS_DISCONNECT);const n=()=>new ie((c,l)=>{this.ws.once(Te.CLOSED,()=>l(new N(y.WS_ABORT))),this.ws.once(Te.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),o=new ie((c,l)=>{const u=()=>{l(new N(y.WS_ABORT))};this.ws.once(Te.RECONNECTING,u),this.ws.once(Te.CLOSED,u),this.once("req_".concat(i),c),gn(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Te.RECONNECTING,u),this.ws.off(Te.CLOSED,u),l(new N(y.TIMEOUT,"cross channel ws request timeout"))})}),a=await o;if(!a||a.code!==200)throw new N(y.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(t){this.ws.removeAllListeners(Te.REQUEST_NEW_URLS),this.ws.on(Te.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class ij extends ft{set state(t){t!==this._state&&(t!==Dn.RELAY_STATE_FAILURE&&(this.errorCode=wo.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,o,a){super(),m(this,"joinInfo",void 0),m(this,"sid",void 0),m(this,"clientId",void 0),m(this,"cancelToken",hi.CancelToken.source()),m(this,"workerToken",void 0),m(this,"requestId",0),m(this,"signal",void 0),m(this,"prevChannelMediaConfig",void 0),m(this,"httpRetryConfig",void 0),m(this,"_resolution",void 0),m(this,"_state",Dn.RELAY_STATE_IDLE),m(this,"errorCode",wo.RELAY_OK),m(this,"onStatus",c=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",mr.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",mr.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=wo.SRC_TOKEN_EXPIRED,this.state=Dn.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=wo.DEST_TOKEN_EXPIRED,this.state=Dn.RELAY_STATE_FAILURE))}),m(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",mr.NETWORK_DISCONNECTED),this.state=Dn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Dn.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",c.toString()),this.errorCode=wo.SERVER_CONNECTION_LOST,this.state=Dn.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=w_(),this.signal=new nj(this.joinInfo,this.clientId,i),this.httpRetryConfig=o,this._resolution=a}async startChannelMediaRelay(t){if(this.state!==Dn.RELAY_STATE_IDLE)throw new N(y.INVALID_OPERATION);this.state=Dn.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new N(y.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new N(y.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new N(y.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Dn.RELAY_STATE_RUNNING)throw new N(y.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Dn.RELAY_STATE_RUNNING)throw new N(y.INVALID_OPERATION);const n=this.genMessage(_n.SetVideoProfile);await this.signal.request(n),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Dn.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=hi.CancelToken.source(),this.state=Dn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await QV(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",mr.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(_n.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(_n.SetSdkProfile,t);await this.signal.request(i),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(_n.SetSourceChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",mr.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(_n.SetSourceUserId,t);await this.signal.request(a),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(_n.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",mr.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(_n.StartPacketTransfer,t);await this.signal.request(l),this.emit("event",mr.PACKET_SENT_TO_DEST_CHANNEL),this.state=Dn.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(_n.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",mr.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(_n.StopPacketTransfer);await this.signal.request(t),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],o=[],a=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:bi,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.18.2"&&(c.sdkVersion="0.0.1");let l=null,u=null;switch(t){case _n.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case _n.SetSourceChannel:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new N(y.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:u.channelName,token:u.token||this.joinInfo.appId},c;case _n.SetSourceUserId:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new N(y.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:u.uid+""},c;case _n.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new N(y.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(f=>{i.push(f.channelName),o.push(f.uid+""),a.push(f.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:o,token:a},c;case _n.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case _n.Reconnect:return c.clientRequest={command:"Reconnect"},c;case _n.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case _n.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new N(y.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(f=>{i.push(f.channelName),o.push(f.uid+""),a.push(f.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:o,token:a},c;case _n.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const x_=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new ie((n,i)=>{t.toBlob(async o=>{if(t.remove(),o){const a=await dC(o);n({buffer:a,width:t.width,height:t.height})}else i(new N(y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},dC=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};function lC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function uC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lC(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lC(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class V_{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){m(this,"trackId",void 0),m(this,"config",void 0),m(this,"onFirstVideoFrameDecoded",void 0),m(this,"freezeTimeCounterList",[]),m(this,"renderFreezeAccTime",0),m(this,"isKeepLastFrame",!1),m(this,"timeUpdatedCount",0),m(this,"freezeTime",0),m(this,"playbackTime",0),m(this,"lastTimeUpdatedTime",0),m(this,"autoplayFailed",!1),m(this,"videoTrack",void 0),m(this,"videoElement",void 0),m(this,"cacheVideoElement",void 0),m(this,"videoElementCheckInterval",void 0),m(this,"_videoElementStatus",pn.NONE),m(this,"isGettingVideoDimensions",!1),m(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),m(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Ke.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Gv())),zv()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),m(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=pn.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=pn.CANPLAY;break;case"stalled":this.videoElementStatus=pn.STALLED;break;case"suspend":this.videoElementStatus=pn.SUSPEND;break;case"pause":this.videoElementStatus=pn.PAUSED,Nn()||kr()||wn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=pn.WAITING;break;case"abort":this.videoElementStatus=pn.ABORT;break;case"ended":this.videoElementStatus=pn.ENDED;break;case"emptied":this.videoElementStatus=pn.EMPTIED;break;case"error":{this.videoElementStatus=pn.ERROR;const i=this.videoElement.error;i&&v.error("[".concat(this.trackId,"] media error, code: ").concat(i.code,", message: ").concat(i.message));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const o=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,eo.lastVisibleTime<eo.lastHiddenTime||a<eo.lastHiddenTime||a<eo.lastVisibleTime)return;for(o>D("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),m(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Gv())),zv()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Ke.on(Yt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ke.on(Yt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&se.autoplayFailed(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),o)});const i=We();if((i.name==="Safari"&&Number(i.version)===15||_a())&&n&&n.then&&n.catch){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return v.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,i.width,i.height),new ie((a,c)=>{i.toBlob(async l=>{if(i.remove(),l){const u=await dC(l);a({buffer:u,width:i.width,height:i.height})}else c(new N(y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await x_(t)}destroy(){Ke.off(Yt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ke.off(Yt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=pn.INIT,!this.videoElementCheckInterval&&(hC.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=pn.DESTROYED)},1e3),D("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let a;const c=(l,u)=>{if(this.videoElementStatus===pn.PLAYING){if(a){const _=u.presentationTime-a.presentationTime;_>D("VIDEO_FREEZE_DURATION")&&eo.lastVisibleTime>=eo.lastHiddenTime&&a.timestamp>eo.lastVisibleTime&&a.timestamp>eo.lastHiddenTime&&(this.renderFreezeAccTime+=_)}a=uC(uC({},u),{},{timestamp:l})}var f,p;D("ENABLE_VIDEO_FRAME_CALLBACK")&&((f=(p=this.videoElement).requestVideoFrameCallback)===null||f===void 0||f.call(p,c))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,c)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),xl()&&(this.videoElement.poster="noposter");const i=We();i.name==="Safari"&&Number(i.version)===15||_a()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Et()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Et()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(a=>{v.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){hC.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=pn.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{v.error(i)}),this.autoplayFailed=!1,Lc()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Lc()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),_y()}}const hC=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class pC extends V_{constructor(t){super(t),m(this,"container",void 0),m(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await x_(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",D("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function pu(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=vs(e.encoderConfig);return t.width=n.width,t.height=n.height,!Jv()&&n.frameRate&&(t.frameRate=n.frameRate),We().name===qe.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Et()&&(t.frameRate={ideal:30,max:30}),t}function rj(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&If()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:i,surfaceSwitching:o,systemAudio:a}=e;(Cf(107)||Wv(107)||Hv(93))&&(n&&(Jt(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),i?(Jt(i,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=i):t.selfBrowserSurface="include",o&&(Jt(o,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=o)),(Cf(105)||Wv(105)||Hv(91))&&a&&(Jt(a,"systemAudio",["exclude","include"]),t.systemAudio=a),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const c=e.encoderConfig?Yf(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:c?c.width:void 0,maxHeight:c?c.height:void 0},c&&(c.frameRate&&(typeof c.frameRate=="number"?(t.mandatory.maxFrameRate=c.frameRate,t.mandatory.minFrameRate=c.frameRate):(t.mandatory.maxFrameRate=c.frameRate.max||c.frameRate.ideal||c.frameRate.exact||void 0,t.mandatory.minFrameRate=c.frameRate.min||c.frameRate.ideal||c.frameRate.exact||void 0),t.frameRate=c.frameRate),c.width&&(t.width=c.width),c.height&&(t.height=c.height)),t}function fC(e){const t={};if(Jv()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,If()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=Jl(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),xl()&&(t.sampleRate=void 0),t}var Ua,fu;(function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"})(Ua||(Ua={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(fu||(fu={}));var _C,EC,mC,gC,SC,TC,vC,RC,yC,IC,CC,AC,OC,wC,NC,bC,DC,PC,LC,kC,MC,UC,xC,VC,De,jC,FC,BC,GC,WC,HC,KC,YC,ki,zC=new class{constructor(){m(this,"_clientSize",null),m(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),m(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),m(this,"getStyle",e=>window.getComputedStyle(e,null)),m(this,"checkCssVisibleProperty",e=>{let t=!0;const n=this.getStyle(e),{display:i,visibility:o,opacity:a,filter:c}=n;return(i==="none"||["hidden","collapse"].includes(o)||Number(a)<.1)&&(t=!1),t?(c&&c.split(" ").filter(l=>{const u=l.split("(")[0];return["brightness","blur","opacity"].includes(u)}).map(l=>{const[u,f]=l.split(/\(|\)/);return[u,Number(f.match(/^[0-9\.]+/))]}).forEach(l=>{const[u,f]=l;switch(u){case"brightness":(f<.1||f>3)&&(t=!1);break;case"blur":f>3&&(t=!1);break;case"opacity":f<.1&&(t=!1)}}),t):!1}),m(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const o=c=>t(c);let a=e;for(;a&&i;)o(a)||(n=!1,i=!1),a=a.parentElement,a||(i=!1);return n}),m(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),m(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:o,top:a,bottom:c}=e.getBoundingClientRect(),l=this.getClientWidth(),u=this.getClientHeight();return{width:t,height:n,left:i,right:o,top:a,bottom:c,clientWidth:l,clientHeight:u,clientMin:Math.min(l,u)}}),m(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),m(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),m(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),m(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,o=e/6,a=t/6,c=[],l=10**6;for(let u=0;u<5;u++)for(let f=0;f<5;f++){const p=(n*l+(u===0?.1:u===4?(o*u*l-1e5)/l:o*u)*l)/l,_=(i*l+(f===0?.1:f===4?(a*f*l-1e5)/l:a*f)*l)/l;c.push({x:p,y:_})}return[...c]}),m(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),m(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),m(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:o,clientWidth:a,clientMin:c}=this._clientSize;let l,u,f,p;if(e<0)l=0;else{if(!(e<a))return!1;l=e}if(t<0)return!1;if(u=t<a?t:a,n<0)f=0;else{if(!(n<o))return!1;f=n}if(i<0)return!1;p=i<o?i:o;const _=u-l,S=p-f;return this.checkSizeIsVisible(_,S,c)}),m(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),m(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Ua.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Ua.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ua.SIZE)}}return this.returnHiddenResult(Ua.STYLE)}return this.returnHiddenResult(fu.UNMOUNTED)}return this.returnHiddenResult(fu.INVALID_HTML_ELEMENT)}),m(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function qC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Yc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qC(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qC(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Lt=(_C=pe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),EC=gt(),mC=pe({argsMap:e=>[e.getTrackId()]}),gC=wa("LocalVideoTrack","_enabledMutex"),SC=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),TC=gt(),vC=wa("LocalVideoTrack","_enabledMutex"),RC=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),yC=gt(),IC=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),CC=gt(),AC=gt(),OC=pe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),wC=gt(),NC=gt(),bC=gt(),DC=gt(),PC=gt(),LC=gt(),kC=gt(),MC=pe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),UC=pe({argsMap:e=>[e.getTrackId()]}),xC=pe({argsMap:e=>[e.getTrackId()]}),VC=pe({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),G((De=class aD extends S_{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==pn.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,o,a,c){if(super(t,a),m(this,"trackMediaType","video"),m(this,"_player",void 0),m(this,"_videoVisibleTimer",null),m(this,"_previousVideoVisibleStatus",void 0),m(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),m(this,"_encoderConfig",void 0),m(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),m(this,"_optimizationMode",void 0),m(this,"_videoHeight",void 0),m(this,"_videoWidth",void 0),m(this,"_forceBitrateLimit",void 0),m(this,"_enabled",!0),m(this,"processorDestination",void 0),m(this,"_processorContext",void 0),wn()){const{width:l,height:u}=t.getSettings();this._videoWidth=l,this._videoHeight=u}else this.updateMediaStreamTrackResolution();this._encoderConfig=n,this._scalabiltyMode=i,this._optimizationMode=o,this._hints=c||[],this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),n&&this._hints.indexOf(Ft.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this.processorContext=new Ly(this.getTrackId(),"local"),this.processorDestination=new Py(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Yc(Yc(Yc({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new V_(i):this._player=new pC(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(No.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},D("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await St(this,ge.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await St(this,ge.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await St(this,ge.NEED_MUTE_TRACK,this):await St(this,ge.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new N(y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=vs(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=pu({encoderConfig:t});(wn()||Nn()||kr())&&(i.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const a=new N(y.UNEXPECTED_ERROR,o.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=t,this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await St(this,ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw()}}getStats(){return Gc(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Qi(this,ge.GET_STATS)||Yc({},s_)}async setBeautyEffect(t){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await x_(t)}clone(t,n,i,o){const a=this._mediaStreamTrack.clone();return new aD(a,t,n,i,o)}async setBitrateLimit(t){if(v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await St(this,ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw()}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void v.error(y.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await St(this,ge.SET_OPTIMIZATION_MODE,this)}catch(i){throw this._optimizationMode=n,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return v.error(y.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){NI(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(cu)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const[o,a]=function(c,l,u){const f=D("BITRATE_ADAPTER_TYPE");let p;const _=200*Math.pow(u/15,.6)*Math.pow(c*l/640/360,.75),S=_;if(f==="STANDARD_BITRATE")p=4*_;else{if(f!=="COMPATIABLE_BITRATE")return;p=2*_}return[Math.floor(p),Math.floor(S)]}(t,n,i)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]")))}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:c}=o;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=zC.checkOneElementVisible(a),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const f=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(i){throw new N(y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new N(y.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new N(y.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new N(y.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(En.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await St(this,ge.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await St(this,ge.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(En.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Kn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Kn.REQUEST_CONSTRAINTS)}}).prototype,"play",[_C,EC],Object.getOwnPropertyDescriptor(De.prototype,"play"),De.prototype),G(De.prototype,"stop",[mC],Object.getOwnPropertyDescriptor(De.prototype,"stop"),De.prototype),G(De.prototype,"setEnabled",[gC,SC,TC],Object.getOwnPropertyDescriptor(De.prototype,"setEnabled"),De.prototype),G(De.prototype,"setMuted",[vC,RC,yC],Object.getOwnPropertyDescriptor(De.prototype,"setMuted"),De.prototype),G(De.prototype,"setEncoderConfiguration",[IC,CC],Object.getOwnPropertyDescriptor(De.prototype,"setEncoderConfiguration"),De.prototype),G(De.prototype,"getStats",[AC],Object.getOwnPropertyDescriptor(De.prototype,"getStats"),De.prototype),G(De.prototype,"setBeautyEffect",[OC,wC],Object.getOwnPropertyDescriptor(De.prototype,"setBeautyEffect"),De.prototype),G(De.prototype,"getCurrentFrameData",[NC],Object.getOwnPropertyDescriptor(De.prototype,"getCurrentFrameData"),De.prototype),G(De.prototype,"getCurrentFrameImage",[bC],Object.getOwnPropertyDescriptor(De.prototype,"getCurrentFrameImage"),De.prototype),G(De.prototype,"setBitrateLimit",[DC],Object.getOwnPropertyDescriptor(De.prototype,"setBitrateLimit"),De.prototype),G(De.prototype,"setOptimizationMode",[PC],Object.getOwnPropertyDescriptor(De.prototype,"setOptimizationMode"),De.prototype),G(De.prototype,"setScalabiltyMode",[LC],Object.getOwnPropertyDescriptor(De.prototype,"setScalabiltyMode"),De.prototype),G(De.prototype,"updateMediaStreamTrackResolution",[kC],Object.getOwnPropertyDescriptor(De.prototype,"updateMediaStreamTrackResolution"),De.prototype),G(De.prototype,"pipe",[MC],Object.getOwnPropertyDescriptor(De.prototype,"pipe"),De.prototype),G(De.prototype,"unpipe",[UC],Object.getOwnPropertyDescriptor(De.prototype,"unpipe"),De.prototype),G(De.prototype,"close",[xC],Object.getOwnPropertyDescriptor(De.prototype,"close"),De.prototype),G(De.prototype,"replaceTrack",[VC],Object.getOwnPropertyDescriptor(De.prototype,"replaceTrack"),De.prototype),De),JC=(jC=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),FC=gt(),BC=wa("CameraVideoTrack","_enabledMutex"),GC=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),WC=gt(),HC=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),KC=gt(),YC=pe({argsMap:e=>[e.getTrackId()]}),G((ki=class extends Lt{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,i,o,a){super(e,vs(t.encoderConfig),i,o,a),m(this,"_config",void 0),m(this,"_originalConstraints",void 0),m(this,"_constraints",void 0),m(this,"_enabled",!0),m(this,"_deviceName","default"),m(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(_a()||Af())&&!function(){const c=We();if(c.os!==un.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&qv()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=vs(this._config.encoderConfig),Ke.on(Yt.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ke.on(Yt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await Si.getDeviceById(e),n={};n.video=Yc({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Xi(n,this.getTrackId())}catch(o){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Xi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Si.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const n=await Xi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await St(this,ge.NEED_ENABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await St(this,ge.NEED_DISABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new N(y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=vs(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const n=Pt(this._config);n.encoderConfig=e;const i=pu(n);(wn()||Nn()||kr())&&(i.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const a=new N(y.UNEXPECTED_ERROR,o.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await St(this,ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Nn()||kr())&&this._enabled&&!this._isClosed&&Ke.duringInterruption){const e=async()=>{Ke.off(Yt.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ke.on(Yt.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(No.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Si.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const i=await Xi({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ke.off(Yt.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ke.off(Yt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){this.processorContext.on(Kn.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),t()}catch(i){n(i)}}),this.processorContext.on(Kn.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[jC,FC],Object.getOwnPropertyDescriptor(ki.prototype,"setDevice"),ki.prototype),G(ki.prototype,"setEnabled",[BC,GC,WC],Object.getOwnPropertyDescriptor(ki.prototype,"setEnabled"),ki.prototype),G(ki.prototype,"setEncoderConfiguration",[HC,KC],Object.getOwnPropertyDescriptor(ki.prototype,"setEncoderConfiguration"),ki.prototype),G(ki.prototype,"close",[YC],Object.getOwnPropertyDescriptor(ki.prototype,"close"),ki.prototype),ki);class j_{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(t,n){m(this,"uid",void 0),m(this,"_uintid",void 0),m(this,"_trust_in_room_",!0),m(this,"_trust_audio_enabled_state_",!0),m(this,"_trust_video_enabled_state_",!0),m(this,"_trust_audio_mute_state_",!0),m(this,"_trust_video_mute_state_",!0),m(this,"_audio_muted_",!1),m(this,"_video_muted_",!1),m(this,"_audio_enabled_",!0),m(this,"_video_enabled_",!0),m(this,"_audio_added_",!1),m(this,"_video_added_",!1),m(this,"_trust_video_stream_added_state_",!0),m(this,"_trust_audio_stream_added_state_",!0),m(this,"_audioTrack",void 0),m(this,"_videoTrack",void 0),m(this,"_audioSSRC",void 0),m(this,"_videoSSRC",void 0),m(this,"_audioOrtc",void 0),m(this,"_videoOrtc",void 0),m(this,"_cname",void 0),m(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=n}}var oj=sv,sj=la,aj=Il;Mn({target:"Promise",stat:!0},{try:function(e){var t=sj.f(this),n=aj(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var F_=oj,cj=Mn,dj=$,lj=E,uj=Bc,hj=Yi,pj=So,fj=To,XC=qf,_j=ry,Ej=ly,mj=na,QC=ln("isConcatSpreadable"),$C=9007199254740991,ZC="Maximum allowed index exceeded",eA=dj.TypeError,gj=mj>=51||!lj(function(){var e=[];return e[QC]=!1,e.concat()[0]!==e}),Sj=Ej("concat"),Tj=function(e){if(!hj(e))return!1;var t=e[QC];return t!==void 0?!!t:uj(e)};cj({target:"Array",proto:!0,forced:!gj||!Sj},{concat:function(e){var t,n,i,o,a,c=pj(this),l=_j(c,0),u=0;for(t=-1,i=arguments.length;t<i;t++)if(Tj(a=t===-1?c:arguments[t])){if(u+(o=fj(a))>$C)throw eA(ZC);for(n=0;n<o;n++,u++)n in a&&XC(l,u,a[n])}else{if(u>=$C)throw eA(ZC);XC(l,u++,a)}return l.length=u,l}});var tA={},vj=je,Rj=mo,nA=sl.f,yj=bR,iA=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];tA.f=function(e){return iA&&vj(e)=="Window"?function(t){try{return nA(t)}catch{return yj(iA)}}(e):nA(Rj(e))};var zc={},Ij=ln;zc.f=Ij;var rA=go,Cj=ei,Aj=zc,Oj=pr.f,on=function(e){var t=rA.Symbol||(rA.Symbol={});Cj(t,e)||Oj(t,e,{value:Aj.f(e)})},xa=Mn,B_=$,wj=Dr,Nj=F,qc=ct,bj=q,Va=me,Ps=ep,G_=E,Tn=ei,Dj=Bc,Pj=ee,Lj=Yi,kj=z,W_=tp,H_=fr,Mj=So,_u=mo,K_=el,oA=sa,Y_=lr,Jc=ll,sA=Rp,Uj=sl,aA=tA,z_=Tp,cA=le,dA=pr,xj=vp,lA=Ze,Vj=Fp,q_=Tl,Xc=Zd.exports,uA=al,hA=ap,pA=ln,jj=zc,Fj=on,Bj=Oc,fA=Sl,Eu=sy.forEach,Ti=ol("hidden"),mu="Symbol",_A=pA("toPrimitive"),Gj=fA.set,EA=fA.getterFor(mu),vr=Object.prototype,Lo=B_.Symbol,Ls=Lo&&Lo.prototype,mA=B_.TypeError,J_=B_.QObject,Qc=wj("JSON","stringify"),gA=cA.f,ko=dA.f,SA=aA.f,Wj=lA.f,TA=bj([].push),io=Xc("symbols"),$c=Xc("op-symbols"),X_=Xc("string-to-symbol-registry"),Q_=Xc("symbol-to-string-registry"),Hj=Xc("wks"),$_=!J_||!J_.prototype||!J_.prototype.findChild,Z_=Va&&G_(function(){return Jc(ko({},"a",{get:function(){return ko(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var i=gA(vr,t);i&&delete vr[t],ko(e,t,n),i&&e!==vr&&ko(vr,t,i)}:ko,eE=function(e,t){var n=io[e]=Jc(Ls);return Gj(n,{type:mu,tag:e,description:t}),Va||(n.description=t),n},gu=function(e,t,n){e===vr&&gu($c,t,n),H_(e);var i=K_(t);return H_(n),Tn(io,i)?(n.enumerable?(Tn(e,Ti)&&e[Ti][i]&&(e[Ti][i]=!1),n=Jc(n,{enumerable:Y_(0,!1)})):(Tn(e,Ti)||ko(e,Ti,Y_(1,{})),e[Ti][i]=!0),Z_(e,i,n)):ko(e,i,n)},tE=function(e,t){H_(e);var n=_u(t),i=sA(n).concat(nE(n));return Eu(i,function(o){Va&&!qc(vA,n,o)||gu(e,o,n[o])}),e},vA=function(e){var t=K_(e),n=qc(Wj,this,t);return!(this===vr&&Tn(io,t)&&!Tn($c,t))&&(!(n||!Tn(this,t)||!Tn(io,t)||Tn(this,Ti)&&this[Ti][t])||n)},RA=function(e,t){var n=_u(e),i=K_(t);if(n!==vr||!Tn(io,i)||Tn($c,i)){var o=gA(n,i);return!o||!Tn(io,i)||Tn(n,Ti)&&n[Ti][i]||(o.enumerable=!0),o}},yA=function(e){var t=SA(_u(e)),n=[];return Eu(t,function(i){Tn(io,i)||Tn(uA,i)||TA(n,i)}),n},nE=function(e){var t=e===vr,n=SA(t?$c:_u(e)),i=[];return Eu(n,function(o){!Tn(io,o)||t&&!Tn(vr,o)||TA(i,io[o])}),i};if(Ps||(q_(Ls=(Lo=function(){if(kj(Ls,this))throw mA("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?oA(arguments[0]):void 0,t=hA(e),n=function(i){this===vr&&qc(n,$c,i),Tn(this,Ti)&&Tn(this[Ti],t)&&(this[Ti][t]=!1),Z_(this,t,Y_(1,i))};return Va&&$_&&Z_(vr,t,{configurable:!0,set:n}),eE(t,e)}).prototype,"toString",function(){return EA(this).tag}),q_(Lo,"withoutSetter",function(e){return eE(hA(e),e)}),lA.f=vA,dA.f=gu,xj.f=tE,cA.f=RA,Uj.f=aA.f=yA,z_.f=nE,jj.f=function(e){return eE(pA(e),e)},Va&&ko(Ls,"description",{configurable:!0,get:function(){return EA(this).description}})),xa({global:!0,wrap:!0,forced:!Ps,sham:!Ps},{Symbol:Lo}),Eu(sA(Hj),function(e){Fj(e)}),xa({target:mu,stat:!0,forced:!Ps},{for:function(e){var t=oA(e);if(Tn(X_,t))return X_[t];var n=Lo(t);return X_[t]=n,Q_[n]=t,n},keyFor:function(e){if(!W_(e))throw mA(e+" is not a symbol");if(Tn(Q_,e))return Q_[e]},useSetter:function(){$_=!0},useSimple:function(){$_=!1}}),xa({target:"Object",stat:!0,forced:!Ps,sham:!Va},{create:function(e,t){return t===void 0?Jc(e):tE(Jc(e),t)},defineProperty:gu,defineProperties:tE,getOwnPropertyDescriptor:RA}),xa({target:"Object",stat:!0,forced:!Ps},{getOwnPropertyNames:yA,getOwnPropertySymbols:nE}),xa({target:"Object",stat:!0,forced:G_(function(){z_.f(1)})},{getOwnPropertySymbols:function(e){return z_.f(Mj(e))}}),Qc&&xa({target:"JSON",stat:!0,forced:!Ps||G_(function(){var e=Lo();return Qc([e])!="[null]"||Qc({a:e})!="{}"||Qc(Object(e))!="{}"})},{stringify:function(e,t,n){var i=Vj(arguments),o=t;if((Lj(t)||e!==void 0)&&!W_(e))return Dj(t)||(t=function(a,c){if(Pj(o)&&(c=qc(o,this,a,c)),!W_(c))return c}),i[1]=t,Nj(Qc,null,i)}}),!Ls[_A]){var Kj=Ls.valueOf;q_(Ls,_A,function(e){return qc(Kj,this)})}Bj(Lo,mu),uA[Ti]=!0,on("asyncIterator"),on("hasInstance"),on("isConcatSpreadable"),on("iterator"),on("match"),on("matchAll"),on("replace"),on("search"),on("species"),on("split"),on("toPrimitive"),on("toStringTag"),on("unscopables"),Oc($.JSON,"JSON",!0);var Yj=go.Symbol;on("asyncDispose"),on("dispose"),on("matcher"),on("metadata"),on("observable"),on("patternMatch"),on("replaceAll");var IA=Yj,CA=zc.f("asyncIterator"),zj=CA;function AA(e){this.wrapped=e}function Zc(e){var t,n;function i(a,c){try{var l=e[a](c),u=l.value,f=u instanceof AA;F_.resolve(f?u.wrapped:u).then(function(p){f?i(a==="return"?"return":"next",p):o(l.done?"return":"normal",p)},function(p){i("throw",p)})}catch(p){o("throw",p)}}function o(a,c){switch(a){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(a,c){return new F_(function(l,u){var f={key:a,arg:c,resolve:l,reject:u,next:null};n?n=n.next=f:(t=n=f,i(a,c))})},typeof e.return!="function"&&(this.return=void 0)}function $i(e){return function(){return new Zc(e.apply(this,arguments))}}function Pe(e){return new AA(e)}Zc.prototype[typeof IA=="function"&&zj||"@@asyncIterator"]=function(){return this},Zc.prototype.next=function(e){return this._invoke("next",e)},Zc.prototype.throw=function(e){return this._invoke("throw",e)},Zc.prototype.return=function(e){return this._invoke("return",e)};var qj=zc.f("iterator");function Su(e,t){var n={},i=!1;function o(a,c){return i=!0,c=new F_(function(l){l(e[a](c))}),{done:!1,value:t(c)}}return n[IA!==void 0&&qj||"@@iterator"]=function(){return this},n.next=function(a){return i?(i=!1,a):o("next",a)},typeof e.throw=="function"&&(n.throw=function(a){if(i)throw i=!1,a;return o("throw",a)}),typeof e.return=="function"&&(n.return=function(a){return i?(i=!1,a):o("return",a)}),n}var OA=CA,kt={exports:{}};function wA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function NA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wA(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function iE(e,t,n,i,o,a,c){let l=[],u=[],f=[],p=[],_=!1,S=!1;if(kt.exports.parse(e).mediaDescriptions.forEach(R=>{c&&c!==R.attributes.direction||(R.media.mediaType!=="video"||_||(u=R.attributes.payloads,p=R.attributes.extmaps,_=!0),R.media.mediaType!=="audio"||S||(l=R.attributes.payloads,f=R.attributes.extmaps,S=!0))}),!p||u.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!f||l.length===0)throw new Error("Cannot get audio capabilities from SDP.");return u.forEach(R=>{var C;(C=R.rtpMap)!==null&&C!==void 0&&C.clockRate&&(R.rtpMap.clockRate=parseInt(R.rtpMap.clockRate))}),l.forEach(R=>{var C;(C=R.rtpMap)!==null&&C!==void 0&&C.clockRate&&(R.rtpMap.clockRate=parseInt(R.rtpMap.clockRate))}),t&&(l=l.filter(R=>{var C;return((C=R.rtpMap)===null||C===void 0?void 0:C.encodingName.toLowerCase())!=="rtx"}),u=u.filter(R=>{var C;return((C=R.rtpMap)===null||C===void 0?void 0:C.encodingName.toLowerCase())!=="rtx"})),n&&(u=u.filter(R=>{var C;return!/(red)|(ulpfec)|(flexfec)/i.test(((C=R.rtpMap)===null||C===void 0?void 0:C.encodingName)||"")})),i&&(l=l.filter(R=>{var C;return!/(red)|(ulpfec)|(flexfec)/i.test(((C=R.rtpMap)===null||C===void 0?void 0:C.encodingName)||"")})),o&&(o==null?void 0:o.length)>0&&(l=l.filter(R=>{var C;return o.includes(((C=R.rtpMap)===null||C===void 0?void 0:C.encodingName.toLowerCase())||"")})),a&&(a==null?void 0:a.length)>0&&(u=u.filter(R=>{var C;return a.includes(((C=R.rtpMap)===null||C===void 0?void 0:C.encodingName.toLowerCase())||"")})),{audioCodecs:l,videoCodecs:u,audioExtensions:f,videoExtensions:p}}function ks(e){const t=kt.exports.parse(e);let n,i;for(const o of t.mediaDescriptions){if(!n){const a=o.attributes.iceUfrag,c=o.attributes.icePwd;if(!a||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:c}}if(!i){const a=o.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function bA(e,t){const n=[],i=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),o=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),a=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(c=>{var l;const u=(l=i.find(f=>f.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:t?u:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:t?l:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function DA(e,t){const{cname:n}=e;let i;t&&t.ip&&typeof t.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):i=e.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}}));const o={fingerprints:e.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}return{dtlsParameters:o,iceParameters:a,candidates:i,rtpCapabilities:sE(e.rtpCapabilities),setup:c,cname:n}}function Mi(e,t,n){const i=[],o=[];return e.forEach(a=>{let{ssrcId:c,rtx:l}=a;const u=at(8,"track-"),f={ssrcId:c,attributes:NA({label:u,mslabel:n=n||at(10,""),msid:"".concat(n," ").concat(u)},t&&{cname:t})};if(i.push(f),l!==void 0){const p={ssrcId:l,attributes:NA({label:u,mslabel:n,msid:"".concat(n," ").concat(u)},t&&{cname:t})};i.push(p),o.push({semantic:"FID",ssrcIds:[c,l]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(a=>{let{ssrcId:c}=a;return c})}),{ssrcs:i,ssrcGroups:o}}function ja(e,t){t instanceof mn&&e.attributes.payloads.forEach(n=>{var i;const o=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=t._encoderConfig;a&&o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(a.bitrate&&!Et()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function rE(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function oE(e,t){if(!(t instanceof Lt&&t._encoderConfig&&t._hints.indexOf(Ft.SCREEN_TRACK)===-1))return;const n=t._encoderConfig;Ct().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(i=>{var o;["h264","h265","vp8","vp9","av1"].includes(((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),Ct().supportMinBitrate&&!t._hints.includes(Ft.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(i=>{var o;["h264","h265","vp8","vp9","av1"].includes(((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(D("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function PA(e){if(e.media.mediaType!=="video")return;const t=We();if(t.name!==qe.SAFARI&&t.os!==un.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Tu(e,t,n){if(!t)return;let i,o;if(e.media.mediaType==="video"?(i=n.videoExtensions,o=n.videoCodecs):(i=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){const a=i.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(e.attributes.extmaps.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(c,l){return l.filter(u=>!!c.find(f=>f.payloadType===u.payloadType&&!!f.rtcpFeedbacks.find(p=>p.type==="transport-cc")))}(o,e.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="transport-cc")||c.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){const a=i.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(e.attributes.extmaps.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(c,l){return l.filter(u=>!!c.find(f=>f.payloadType===u.payloadType&&!!f.rtcpFeedbacks.find(p=>p.type==="goog-remb")))}(o,e.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="goog-remb")||c.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function LA(e,t,n){if(Et()||e.media.mediaType!=="video"||!(t instanceof Lt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!D("SIMULCAST")||t._scalabiltyMode===void 0||t._scalabiltyMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabiltyMode.numSpatialLayers,o=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===o.ssrcId),c={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let l=1;l<i;l++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+l,attributes:Pt(o.attributes)}),c.ssrcIds.push(o.ssrcId+l),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+l,attributes:Pt(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+l,a.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(c)}async function kA(e,t,n,i,o){const a=new RTCPeerConnection;a.addTransceiver("video",{direction:"sendonly"}),a.addTransceiver("audio",{direction:"sendonly"}),a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"});const c=(await a.createOffer()).sdp,l=iE(c,e,t,n,i,o,"sendonly"),u=iE(c,e,t,n,i,o,"recvonly"),f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vu(l,u,"videoExtensions",f,p,_),vu(l,u,"videoCodecs",f,p,_),vu(l,u,"audioExtensions",f,p,_),vu(l,u,"audioCodecs",f,p,_),D("RAISE_H264_BASELINE_PRIORITY")){const S=_.videoCodecs.findIndex(R=>{var C,A;return((C=R.rtpMap)===null||C===void 0?void 0:C.encodingName.toLocaleLowerCase())==="h264"&&((A=R.fmtp)===null||A===void 0?void 0:A.parameters["profile-level-id"])==="42001f"});if(S!==-1){const R=_.videoCodecs.findIndex(C=>{var A;return((A=C.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"});if(R<S){v.debug("raising H264 baseline profile priority");const C=_.videoCodecs[S];_.videoCodecs.splice(S,1),_.videoCodecs.splice(R,0,C)}R!==-1&&(p.videoCodecs=p.videoCodecs.filter(C=>{var A,O;return!(((A=C.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"&&((O=C.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])!=="42001f")})),R!==-1&&D("FILTER_SEND_H264_BASELINE")&&(f.videoCodecs=f.videoCodecs.filter(C=>{var A,O;return!(((A=C.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"&&((O=C.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])!=="42001f")}))}}try{a.close()}catch{}return{send:f,recv:p,sendrecv:_}}function vu(e,t,n,i,o,a){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return e[n].forEach(l=>{t[n].some((u,f)=>{if(l.entry===u.entry&&l.extensionName===u.extensionName)return c.push(f),!0})?a[n].push(l):i[n].push(l)}),void t[n].forEach((l,u)=>{c.indexOf(u)===-1&&o[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return e[n].forEach(l=>{t[n].some((u,f)=>{if(l.payloadType===u.payloadType&&JSON.stringify(l)===JSON.stringify(u))return c.push(f),!0})?a[n].push(l):i[n].push(l)}),void t[n].forEach((l,u)=>{c.indexOf(u)===-1&&o[n].push(l)})}}function sE(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,a;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...i.audioCodecs],o.videoCodecs=[...t.videoCodecs,...i.videoCodecs],o.audioExtensions=[...t.audioExtensions,...i.audioExtensions],o.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):o=i,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...i.audioCodecs],a.videoCodecs=[...n.videoCodecs,...i.videoCodecs],a.audioExtensions=[...n.audioExtensions,...i.audioExtensions],a.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):a=i,{send:o,recv:a}}function Mo(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function MA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function UA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MA(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}(function(e,t){e.exports=(()=>{var n={8:(a,c,l)=>{l.r(c),l.d(c,{Parser:()=>rt,Printer:()=>qn,parse:()=>Se,print:()=>xe});const u=`
`,f="".concat("\r").concat(u),p=" ";let _;function S(X){return X>="0"&&X<="9"}function R(X){return X>="!"&&X<="~"}function C(X){return R(X)||X>=""&&X<="ÿ"}function A(X){return X==="!"||X>="#"&&X<="'"||X>="*"&&X<="+"||X>="-"&&X<="."||X>="0"&&X<="9"||X>="A"&&X<="Z"||X>="^"&&X<="~"}function O(X){return X>="1"&&X<="9"}function k(X){return X>="A"&&X<="Z"||X>="a"&&X<="z"}function M(X){return X==="d"||X==="h"||X==="m"||X==="s"}function H(X){return X>""&&X<"	"||X>"\v"&&X<"\f"||X>""&&X<"ÿ"}function re(X){return k(X)||S(X)||X==="+"||X==="/"}function Y(X){return S(X)||k(X)||X==="+"||X==="/"||X==="-"||X==="_"}function J(X){return k(X)||S(X)||X==="+"||X==="/"}function W(X,g){var w=Object.keys(X);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(X);g&&(b=b.filter(function(B){return Object.getOwnPropertyDescriptor(X,B).enumerable})),w.push.apply(w,b)}return w}function Q(X){for(var g=1;g<arguments.length;g++){var w=arguments[g]!=null?arguments[g]:{};g%2?W(Object(w),!0).forEach(function(b){Be(X,b,w[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(w)):W(Object(w)).forEach(function(b){Object.defineProperty(X,b,Object.getOwnPropertyDescriptor(w,b))})}return X}function Be(X,g,w){return g in X?Object.defineProperty(X,g,{value:w,enumerable:!0,configurable:!0,writable:!0}):X[g]=w,X}(function(X){X.VERSION="v",X.ORIGIN="o",X.SESSION_NAME="s",X.INFORMATION="i",X.URI="u",X.EMAIL="e",X.PHONE="p",X.CONNECTION="c",X.BANDWIDTH="b",X.TIME="t",X.REPEAT="r",X.ZONE_ADJUSTMENTS="z",X.KEY="k",X.ATTRIBUTE="a",X.MEDIA="m"})(_||(_={}));class he{consumeText(g,w){let b=w;for(;b<g.length;){const B=g[b];if(B==="\0"||B==="\r"||B===u)break;b+=1}if(b-w==0)throw new Error("Invalid text, at ".concat(g));return b}consumeUnicastAddress(g,w,b){return this.consumeTill(g,w,p)}consumeOneOrMore(g,w,b){let B=w;for(;b(g[B]);)B++;if(B-w==0)throw new Error("Invalid rule at ".concat(w,"."));return B}consumeSpace(g,w){if(g[w]===p)return w+1;throw new Error("Invalid space at ".concat(w,"."))}consumeIP4Address(g,w){let b=w;for(let B=0;B<4;B++)if(b=this.consumeDecimalUChar(g,b),B!==3){if(g[b]!==".")throw new Error("Invalid IP4 address.");b++}return b}consumeDecimalUChar(g,w){let b=w;for(let ve=0;ve<3&&S(g[b]);ve++,b++);if(b-w==0)throw new Error("Invalid decimal uchar.");const B=parseInt(g.slice(w,b));if(B>=0&&B<=255)return b;throw new Error("Invalid decimal uchar")}consumeIP6Address(g,w){let b=this.consumeHexpart(g,w);return g[b]===":"&&(b+=1,b=this.consumeIP4Address(g,b)),b}consumeHexpart(g,w){let b=w;if(g[b]===":"&&g[b+1]===":"){b+=2;try{b=this.consumeHexseq(g,b)}catch{}return b}if(b=this.consumeHexseq(g,b),g[b]===":"&&g[b+1]===":"){b+=2;try{b=this.consumeHexseq(g,b)}catch{}return b}return b}consumeHexseq(g,w){let b=w;for(;b=this.consumeHex4(g,b),g[b]===":"&&g[b+1]!==":";)b+=1;return b}consumeHex4(g,w){let b=0;for(;b<4;b++)if(!((B=g[w+b])>="0"&&B<="9"||B>="a"&&B<="f"||B>="A"&&B<="F")){if(b===0)throw new Error("Invalid hex 4");break}var B;return w+b}consumeFQDN(g,w){let b=w;for(;S(g[b])||k(g[b])||g[b]==="-"||g[b]===".";)b+=1;if(b-w<4)throw new Error("Invalid FQDN");return b}consumeExtnAddr(g,w){return this.consumeOneOrMore(g,w,C)}consumeMulticastAddress(g,w,b){switch(b){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(g,w);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(g,w);default:try{return this.consumeFQDN(g,w)}catch{return this.consumeExtnAddr(g,w)}}}consumeIP6MulticastAddress(g,w){const b=this.consumeHexpart(g,w);return g[b]==="/"?this.consumeInteger(g,b+1):b}consumeIP4MulticastAddress(g,w){let b=w+3;const B=g.slice(w,b),ve=parseInt(B);if(ve<224||ve>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ot=0;ot<3;ot++){if(g[b]!==".")throw new Error("Invalid IP4 multicast address.");b+=1,b=this.consumeDecimalUChar(g,b)}return g[b]==="/"&&(b+=1),b=this.consumeTTL(g,b),g[b]==="/"&&(b=this.consumeInteger(g,b)),b}consumeInteger(g,w){if(!O(g[w]))throw new Error("Invalid integer.");for(w+=1;S(g[w]);)w+=1;return w}consumeTTL(g,w){if(g[w]==="0")return w+1;if(!O(g[w]))throw new Error("Invalid TTL.");w+=1;for(let b=0;b<2&&S(g[w]);b++)w+=1;return w}consumeToken(g,w){return this.consumeOneOrMore(g,w,A)}consumeTime(g,w){let b=w;if(g[b]==="0")return b+1;for(O(g[b])&&(b+=1);S(g[b]);)b++;if(b-w<10)throw new Error("Invalid time");return b}consumeAddress(g,w){return this.consumeTill(g,w,p)}consumeTypedTime(g,w){let b=w;return b=this.consumeOneOrMore(g,b,S),M(g[b])?b+1:b}consumeRepeatInterval(g,w){if(!O(g[w]))throw new Error("Invalid repeat interval");for(w+=1;S(g[w]);)w+=1;return M(g[w])&&(w+=1),w}consumePort(g,w){return this.consumeOneOrMore(g,w,S)}consume(g,w,b){for(let B=0;B<b.length;B++){if(w+B>=g.length)throw new Error("consume exceeding value length");if(g[w+B]!==b[B])throw new Error("consume ".concat(b," failed at ").concat(B))}return w+b.length}consumeTill(g,w,b){let B=w;for(;B<g.length&&(typeof b!="string"||g[B]!==b)&&(typeof b!="function"||!b(g[B]));)B++;return B}}class rt extends he{constructor(){super(),Be(this,"records",[]),Be(this,"currentLine",0)}parse(g){const w=this.probeEOL(g);this.records=g.split(w).filter(jn=>!!jn.trim()).map(this.parseLine),this.currentLine=0;const b=this.parseVersion(),B=this.parseOrigin(),ve=this.parseSessionName(),ot=this.parseInformation(),an=this.parseUri(),nr=this.parseEmail(),Bo=this.parsePhone(),ji=this.parseConnection(),Go=this.parseBandWidth(),Ka=this.parseTimeFields(),Tt=this.parseKey(),Mt=this.parseSessionAttribute(),tt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:b,origin:B,sessionName:ve,information:ot,uri:an,emails:nr,phones:Bo,connection:ji,bandwidths:Go,timeFields:Ka,key:Tt,attributes:Mt,mediaDescriptions:tt}}getCurrentRecord(){const g=this.records[this.currentLine];if(!g)throw new Error("Record doesn't exit.");return g}probeEOL(g){for(let w=0;w<g.length;w++)if(g[w]===u)return g[w-1]==="\r"?f:u;throw new Error("Invalid newline character.")}parseLine(g,w){if(g.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const b=g[0];if(g[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:b,value:g.slice(2),line:w,cur:0}}parseSessionAttribute(){const g=new Ot;for(;this.currentLine<this.records.length;){const w=this.getCurrentRecord();if(w.type!==_.ATTRIBUTE)break;const b={attField:this.extractOneOrMore(w,B=>A(B)&&B!==":"),_cur:0};w.value[w.cur]===":"&&(w.cur+=1,b.attValue=this.extractOneOrMore(w,H)),g.parse(b),this.currentLine++}return g.digest()}parseMediaAttributes(g){const w=new sn(g);for(;this.currentLine<this.records.length;){const b=this.getCurrentRecord();if(b.type!==_.ATTRIBUTE)break;const B={attField:this.extractOneOrMore(b,ve=>A(ve)&&ve!==":"),_cur:0};b.value[b.cur]===":"&&(b.cur+=1,B.attValue=this.extractOneOrMore(b,H)),w.parse(B),this.currentLine++}return w.digest()}parseKey(){const g=this.getCurrentRecord();if(g.type===_.KEY){if(g.value==="prompt"||g.value==="clear:"||g.value==="base64:"||g.value==="uri:")return g.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const g=this.getCurrentRecord();if(g.type===_.ZONE_ADJUSTMENTS){const w=[];for(;;)try{const b=this.extract(g,this.consumeTime);this.consumeSpaceForRecord(g);let B=!1;g.value[g.cur]==="-"&&(B=!0,g.cur+=1);const ve=this.extract(g,this.consumeTypedTime);w.push({time:b,typedTime:ve,back:B})}catch{break}if(w.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,w}return[]}parseRepeat(){const g=[];for(;;){const w=this.getCurrentRecord();if(w.type!==_.REPEAT)break;{const b=this.extract(w,this.consumeRepeatInterval),B=this.parseTypedTime(w);g.push({repeatInterval:b,typedTimes:B}),this.currentLine++}}return g}parseTypedTime(g){const w=[];for(;;)try{this.consumeSpaceForRecord(g),w.push(this.extract(g,this.consumeTypedTime))}catch{break}if(w.length===0)throw new Error("Invalid typed time.");return w}parseTime(){const g=this.getCurrentRecord(),w=this.extract(g,this.consumeTime);this.consumeSpaceForRecord(g);const b=this.extract(g,this.consumeTime);return this.currentLine++,{startTime:w,stopTime:b}}parseBandWidth(){const g=[];for(;this.currentLine<this.records.length;){const w=this.getCurrentRecord();if(w.type!==_.BANDWIDTH)break;{const b=this.extractOneOrMore(w,A);if(w.value[w.cur]!==":")throw new Error("Invalid bandwidth field.");w.cur++;const B=this.extractOneOrMore(w,S);g.push({bwtype:b,bandwidth:B}),this.currentLine++}}return g}parseVersion(){const g=this.getCurrentRecord();if(g.type!==_.VERSION)throw new Error("first sdp record must be version");const w=g.value.slice(0,this.consumeOneOrMore(g.value,0,S));if(w.length!==g.value.length)throw new Error('invalid proto version, "v='.concat(g.value,'"'));return this.currentLine++,w}parseOrigin(){const g=this.getCurrentRecord();if(g.type!==_.ORIGIN)throw new Error("second line of sdp must be origin");const w=this.extractOneOrMore(g,C);this.consumeSpaceForRecord(g);const b=this.extractOneOrMore(g,S);this.consumeSpaceForRecord(g);const B=this.extractOneOrMore(g,S);this.consumeSpaceForRecord(g);const ve=this.extractOneOrMore(g,A);this.consumeSpaceForRecord(g);const ot=this.extractOneOrMore(g,A);this.consumeSpaceForRecord(g);const an=this.extract(g,this.consumeUnicastAddress);return this.currentLine++,{username:w,sessId:b,sessVersion:B,nettype:ve,addrtype:ot,unicastAddress:an}}parseSessionName(){const g=this.getCurrentRecord();if(g.type===_.SESSION_NAME){const w=this.extract(g,this.consumeText);return this.currentLine++,w}}parseInformation(){const g=this.getCurrentRecord();if(g.type!==_.INFORMATION)return;const w=this.extract(g,this.consumeText);return this.currentLine++,w}parseUri(){const g=this.getCurrentRecord();if(g.type===_.URI)return this.currentLine++,g.value}parseEmail(){const g=[];for(;;){const w=this.getCurrentRecord();if(w.type!==_.EMAIL)break;g.push(w.value),this.currentLine++}return g}parsePhone(){const g=[];for(;;){const w=this.getCurrentRecord();if(w.type!==_.PHONE)break;g.push(w.value),this.currentLine++}return g}parseConnection(){const g=this.getCurrentRecord();if(g.type===_.CONNECTION){const w=this.extractOneOrMore(g,A);this.consumeSpaceForRecord(g);const b=this.extractOneOrMore(g,A);this.consumeSpaceForRecord(g);const B=this.extract(g,this.consumeAddress);return this.currentLine++,{nettype:w,addrtype:b,address:B}}}parseMedia(){const g=this.getCurrentRecord(),w=this.extract(g,this.consumeToken);this.consumeSpaceForRecord(g);let b=this.extract(g,this.consumePort);g.value[g.cur]==="/"&&(g.cur+=1,b+=this.extract(g,this.consumeInteger)),this.consumeSpaceForRecord(g);const B=[];for(B.push(this.extract(g,this.consumeToken));g.value[g.cur]==="/";)g.cur+=1,B.push(this.extract(g,this.consumeToken));if(B.length===0)throw new Error("Invalid proto");const ve=this.parseFmt(g);return this.currentLine++,{mediaType:w,port:b,protos:B,fmts:ve}}parseTimeFields(){const g=[];for(;this.getCurrentRecord().type===_.TIME;){const w=this.parseTime(),b=this.parseRepeat(),B=this.parseZone();g.push({time:w,repeats:b,zones:B})}return g}parseMediaDescription(){const g=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.MEDIA;){const w=this.parseMedia(),b=this.parseInformation(),B=this.parseConnections(),ve=this.parseBandWidth(),ot=this.parseKey(),an=this.parseMediaAttributes(w);g.push({media:w,information:b,connections:B,bandwidths:ve,key:ot,attributes:an})}return g}parseConnections(){const g=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.CONNECTION;)g.push(this.parseConnection());return g}parseFmt(g){const w=[];for(;;)try{this.consumeSpaceForRecord(g),w.push(this.extract(g,this.consumeToken))}catch{break}if(w.length===0)throw new Error("Invalid fmts");return w}extract(g,w,...b){const B=w.call(this,g.value,g.cur,...b),ve=g.value.slice(g.cur,B);return g.cur=B,ve}extractOneOrMore(g,w){const b=this.consumeOneOrMore(g.value,g.cur,w),B=g.value.slice(g.cur,b);return g.cur=b,B}consumeSpaceForRecord(g){if(g.value[g.cur]!==p)throw new Error("Invalid space at ".concat(g.cur,"."));g.cur+=1}}class Xe extends he{constructor(...g){super(...g),Be(this,"attributes",void 0),Be(this,"digested",!1)}extractOneOrMore(g,w,b){const B=this.consumeOneOrMore(g.attValue,g._cur,w),ve=g.attValue.slice(g._cur,B),[ot,an]=b||[];if(typeof ot=="number"&&ve.length<ot)throw new Error("error in length, should be more or equal than ".concat(ot," characters."));if(typeof an=="number"&&ve.length>an)throw new Error("error in length, should be less or equal than ".concat(an," characters."));return g._cur=B,ve}consumeAttributeSpace(g){if(g.attValue[g._cur]!==p)throw new Error("Invalid space at ".concat(g._cur,"."));g._cur+=1}extract(g,w,...b){if(!g.attValue)throw new Error("Nothing to extract from attValue.");const B=w.call(this,g.attValue,g._cur,...b),ve=g.attValue.slice(g._cur,B);return g._cur=B,ve}atEnd(g){if(!g.attValue)throw new Error;return g._cur>=g.attValue.length}peekChar(g){if(!g.attValue)throw new Error;return g.attValue[g._cur]}peek(g,w){if(!g.attValue)throw new Error;for(let b=0;b<w.length;b++)if(w[b]!==g.attValue[g._cur+b])return!1;return!0}parseIceUfrag(g){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(g,re,[4,256])}parseIcePwd(g){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(g,re,[22,256])}parseIceOptions(g){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const w=[];for(;!this.atEnd(g);){w.push(this.extractOneOrMore(g,re));try{this.consumeAttributeSpace(g)}catch(b){if(this.atEnd(g))break;throw b}}this.attributes.iceOptions=w}parseFingerprint(g){const w=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill);this.attributes.fingerprints.push({hashFunction:w,fingerprint:b})}parseExtmap(g){const w=this.extractOneOrMore(g,S);let b;this.peekChar(g)==="/"&&(this.extract(g,this.consume,"/"),b=this.extract(g,this.consumeToken)),this.consumeAttributeSpace(g);const B=this.extract(g,this.consumeTill,p),ve=Q(Q({entry:parseInt(w,10)},b&&{direction:b}),{},{extensionName:B});this.peekChar(g)===p&&(this.consumeAttributeSpace(g),ve.extensionAttributes=this.extract(g,this.consumeTill)),this.attributes.extmaps.push(ve)}parseSetup(g){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const w=this.extract(g,this.consumeTill);if(w!=="active"&&w!=="passive"&&w!=="actpass"&&w!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=w}}class Ot extends Xe{constructor(...g){super(...g),Be(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(g){if(this.digested)throw new Error("already digested");try{switch(g.attField){case"group":this.parseGroup(g);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(g);break;case"ice-pwd":this.parseIcePwd(g);break;case"ice-options":this.parseIceOptions(g);break;case"fingerprint":this.parseFingerprint(g);break;case"setup":this.parseSetup(g);break;case"tls-id":this.parseTlsId(g);break;case"identity":this.parseIdentity(g);break;case"extmap":this.parseExtmap(g);break;case"msid-semantic":this.parseMsidSemantic(g);break;default:g.ignored=!0,this.attributes.unrecognized.push(g)}}catch(w){throw console.error("parsing session attribute ".concat(g.attField,' error, "a=').concat(g.attField,":").concat(g.attValue,'"')),w}if(!g.ignored&&g.attValue&&!this.atEnd(g))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(g){const w=this.extract(g,this.consumeToken),b=[];for(;!this.atEnd(g)&&this.peekChar(g)===p;)this.consumeAttributeSpace(g),b.push(this.extract(g,this.consumeToken));this.attributes.groups.push({semantic:w,identificationTag:b})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(g){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(g,Y)}parseIdentity(g){const w=this.extractOneOrMore(g,J),b=[];for(;!this.atEnd(g)&&this.peekChar(g)===p;){this.consumeAttributeSpace(g);const B=this.extract(g,this.consumeToken);this.extract(g,this.consume,"=");const ve=this.extractOneOrMore(g,ot=>ot!==p&&H(ot));b.push({name:B,value:ve})}this.attributes.identities.push({assertionValue:w,extensions:b})}parseMsidSemantic(g){this.peekChar(g)===p&&this.consumeAttributeSpace(g);const w={semantic:this.extract(g,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(g)}catch{break}if(this.peekChar(g)==="*"){this.extract(g,this.consume,"*"),w.applyForAll=!0;break}{const b=this.extract(g,this.consumeTill,p);w.identifierList.push(b)}}this.attributes.msidSemantic=w}}class sn extends Xe{constructor(g){super(),Be(this,"attributes",void 0),g.protos.indexOf("RTP")!==-1||g.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(g){if(this.digested)throw new Error("already digested");try{switch(g.attField){case"extmap":this.parseExtmap(g);break;case"setup":this.parseSetup(g);break;case"ice-ufrag":this.parseIceUfrag(g);break;case"ice-pwd":this.parseIcePwd(g);break;case"ice-options":this.parseIceOptions(g);break;case"candidate":this.parseCandidate(g);break;case"remote-candidate":this.parseRemoteCandidate(g);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(g);break;case"rtpmap":this.parseRtpmap(g);break;case"ptime":this.parsePtime(g);break;case"maxptime":this.parseMaxPtime(g);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(g);break;case"ssrc":this.parseSSRC(g);break;case"fmtp":this.parseFmtp(g);break;case"rtcp-fb":this.parseRtcpFb(g);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(g);break;case"mid":this.parseMid(g);break;case"msid":this.parseMsid(g);break;case"imageattr":this.parseImageAttr(g);break;case"rid":this.parseRid(g);break;case"simulcast":this.parseSimulcast(g);break;case"sctp-port":this.parseSctpPort(g);break;case"max-message-size":this.parseMaxMessageSize(g);break;case"ssrc-group":this.parseSSRCGroup(g);break;default:g.ignored=!0,this.attributes.unrecognized.push(g)}}catch(w){throw console.error("parsing media attribute ".concat(g.attField,' error, "a=').concat(g.attField,":").concat(g.attValue,'"')),w}if(!g.ignored&&g.attValue&&!this.atEnd(g))throw new Error("attribute parsing error")}parseCandidate(g){const w=this.extractOneOrMore(g,re,[1,32]);this.consumeAttributeSpace(g);const b=this.extractOneOrMore(g,S,[1,5]);this.consumeAttributeSpace(g);const B=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);const ve=this.extractOneOrMore(g,S,[1,10]);this.consumeAttributeSpace(g);const ot=this.extract(g,this.consumeAddress);this.consumeAttributeSpace(g);const an=this.extract(g,this.consumePort);this.consumeAttributeSpace(g),this.extract(g,this.consume,"typ"),this.consumeAttributeSpace(g);const nr={foundation:w,componentId:b,transport:B,priority:ve,connectionAddress:ot,port:an,type:this.extract(g,this.consumeToken),extension:{}};for(this.peek(g," raddr")&&(this.extract(g,this.consume," raddr"),this.consumeAttributeSpace(g),nr.relAddr=this.extract(g,this.consumeAddress)),this.peek(g," rport")&&(this.extract(g,this.consume," rport"),this.consumeAttributeSpace(g),nr.relPort=this.extract(g,this.consumePort));this.peekChar(g)===p;){this.consumeAttributeSpace(g);const Bo=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g),nr.extension[Bo]=this.extractOneOrMore(g,R)}this.attributes.candidates.push(nr)}parseRemoteCandidate(g){const w=[];for(;;){const b=this.extractOneOrMore(g,S,[1,5]);this.consumeAttributeSpace(g);const B=this.extract(g,this.consumeAddress);this.consumeAttributeSpace(g);const ve=this.extract(g,this.consumePort);w.push({componentId:b,connectionAddress:B,port:ve});try{this.consumeAttributeSpace(g)}catch{break}}this.attributes.remoteCandidatesList.push(w)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(g){const w=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill,"/");this.extract(g,this.consume,"/");const B={encodingName:b,clockRate:this.extractOneOrMore(g,S)};this.atEnd(g)||this.peekChar(g)!=="/"||(this.extract(g,this.consume,"/"),B.encodingParameters=parseInt(this.extract(g,this.consumeTill),10));const ve=this.attributes.payloads.find(ot=>ot.payloadType===parseInt(w,10));ve?ve.rtpMap=B:this.attributes.payloads.push({payloadType:parseInt(w,10),rtpMap:B,rtcpFeedbacks:[]})}parsePtime(g){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(g,this.consumeTill)}parseMaxPtime(g){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(g,this.consumeTill)}parseDirection(g){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=g.attField}parseSSRC(g){const w=this.extractOneOrMore(g,S);this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill,":");let B;this.peekChar(g)===":"&&(this.extract(g,this.consume,":"),B=this.extract(g,this.consumeTill));const ve=this.attributes.ssrcs.find(ot=>ot.ssrcId===parseInt(w,10));ve?ve.attributes[b]=B:this.attributes.ssrcs.push({ssrcId:parseInt(w,10),attributes:{[b]:B}})}parseFmtp(g){const w=this.extract(g,this.consumeTill,p);this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill),B={};b.split(";").forEach(ot=>{let[an,nr]=ot.split("=");an=an.trim();const Bo=typeof nr=="string"?nr.trim():null;typeof an=="string"&&an.length>0&&(B[an]=Bo)});const ve=this.attributes.payloads.find(ot=>ot.payloadType===parseInt(w,10));ve?ve.fmtp={parameters:B}:this.attributes.payloads.push({payloadType:parseInt(w,10),rtcpFeedbacks:[],fmtp:{parameters:B}})}parseFmtParameters(g){const w={},b=this.extract(g,this.consumeTill,"=");g._cur++;const B=this.extract(g,this.consumeTill,";");for(w[b]=B;g.attValue[g._cur]===";";){const ve=this.extract(g,this.consumeTill,"=");g._cur++;const ot=this.extract(g,this.consumeTill,";");w[ve]=ot}return w}parseRtcpFb(g){let w="";w=this.peekChar(g)==="*"?this.extract(g,this.consume,"*"):this.extract(g,this.consumeTill,p),this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill,p);let B;switch(b){case"trr-int":B={type:b,interval:this.extract(g,this.consumeTill)};break;case"ack":case"nack":default:{const ve={type:b};this.peekChar(g)===p&&(this.consumeAttributeSpace(g),ve.parameter=this.extract(g,this.consumeToken),this.peekChar(g)===p&&(ve.additional=this.extract(g,this.consumeTill))),B=ve}}if(w==="*")this.attributes.rtcpFeedbackWildcards.push(B);else{const ve=this.attributes.payloads.find(ot=>ot.payloadType===parseInt(w,10));ve?ve.rtcpFeedbacks.push(B):this.attributes.payloads.push({payloadType:parseInt(w,10),rtcpFeedbacks:[B]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(g){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const w={port:this.extract(g,this.consumePort)};this.peekChar(g)===p&&(this.consumeAttributeSpace(g),w.netType=this.extractOneOrMore(g,A),this.consumeAttributeSpace(g),w.addressType=this.extractOneOrMore(g,A),this.consumeAttributeSpace(g),w.address=this.extract(g,this.consumeAddress)),this.attributes.rtcp=w}parseMsid(g){const w={id:this.extractOneOrMore(g,A,[1,64])};this.peekChar(g)===p&&(this.consumeAttributeSpace(g),w.appdata=this.extractOneOrMore(g,A,[1,64])),this.attributes.msids.push(w)}parseImageAttr(g){this.attributes.imageattr.push(g.attValue)}parseRid(g){const w=this.extractOneOrMore(g,B=>k(B)||S(B)||B==="_"||B==="-");this.consumeAttributeSpace(g);const b={id:w,direction:this.extract(g,this.consumeToken),params:[]};if(this.peekChar(g)===p){if(this.consumeAttributeSpace(g),this.peek(g,"pt=")){this.extract(g,this.consume,"pt=");const B=[];for(;;){const ve=this.extract(g,this.consumeToken);B.push(ve);try{this.extract(g,this.consume,",")}catch{break}}b.payloads=B,this.peekChar(g)===p&&this.extract(g,this.consume,p)}for(;;){const B=this.extract(g,this.consumeToken);switch(B){case"depend":{const ve={type:B,rids:this.extract(g,this.consume,"=").split(",")};b.params.push(ve);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const ve={type:B};this.peekChar(g)==="="&&(this.extract(g,this.consume,"="),ve.val=this.extract(g,this.consumeTill,";")),b.params.push(ve)}}try{this.extract(g,this.consume,";")}catch{break}}}this.attributes.rids.push(b)}parseSimulcast(g){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=g.attValue,this.extract(g,this.consumeTill)}parseSctpPort(g){this.attributes.sctpPort=this.extractOneOrMore(g,S,[1,5])}parseMaxMessageSize(g){this.attributes.maxMessageSize=this.extractOneOrMore(g,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(g){this.attributes.mid=this.extract(g,this.consumeToken)}parseSSRCGroup(g){const w=this.extract(g,this.consumeToken),b=[];for(;;)try{this.consumeAttributeSpace(g);const B=this.extract(g,this.consumeInteger);b.push(parseInt(B,10))}catch{break}this.attributes.ssrcGroups.push({semantic:w,ssrcIds:b})}}function yt(X,g,w){return g in X?Object.defineProperty(X,g,{value:w,enumerable:!0,configurable:!0,writable:!0}):X[g]=w,X}class qn{constructor(){yt(this,"eol",f)}print(g,w){let b="";return w&&(this.eol=w),b+=this.printVersion(g.version),b+=this.printOrigin(g.origin),b+=this.printSessionName(g.sessionName),b+=this.printInformation(g.information),b+=this.printUri(g.uri),b+=this.printEmail(g.emails),b+=this.printPhone(g.phones),b+=this.printConnection(g.connection),b+=this.printBandwidth(g.bandwidths),b+=this.printTimeFields(g.timeFields),b+=this.printKey(g.key),b+=this.printSessionAttributes(g.attributes),b+=this.printMediaDescription(g.mediaDescriptions),b}printVersion(g){return"v=".concat(g).concat(this.eol)}printOrigin(g){return"o=".concat(g.username," ").concat(g.sessId," ").concat(g.sessVersion," ").concat(g.nettype," ").concat(g.addrtype," ").concat(g.unicastAddress).concat(this.eol)}printSessionName(g){return g?"s=".concat(g).concat(this.eol):""}printInformation(g){return g?"i=".concat(g).concat(this.eol):""}printUri(g){return g?"u=".concat(g).concat(this.eol):""}printEmail(g){let w="";for(const b of g)w+="e=".concat(b).concat(this.eol);return w}printPhone(g){let w="";for(const b of g)w+="e=".concat(b).concat(this.eol);return w}printConnection(g){return g?"c=".concat(g.nettype," ").concat(g.addrtype," ").concat(g.address).concat(this.eol):""}printBandwidth(g){let w="";for(const b of g)w+="b=".concat(b.bwtype,":").concat(b.bandwidth).concat(this.eol);return w}printTimeFields(g){let w="";for(const b of g){w+="t=".concat(b.time.startTime," ").concat(b.time.startTime).concat(this.eol);for(const B of b.repeats)w+="r=".concat(B.repeatInterval," ").concat(B.typedTimes.join(" ")).concat(this.eol);b.zoneAdjustments&&(w+="z=",w+="z=".concat(b.zoneAdjustments.map(B=>"".concat(B.time," ").concat(B.back?"-":""," ").concat(B.typedTime)).join(" ")).concat(this.eol),w+=this.eol)}return w}printKey(g){return g?"k=".concat(g).concat(this.eol):""}printAttributes(g){let w="";for(const b of g)w+="a=".concat(b.attField).concat(b.attValue?":".concat(b.attValue):"").concat(this.eol);return w}printMediaDescription(g){let w="";for(const b of g)w+=this.printMedia(b.media),w+=this.printInformation(b.information),w+=this.printConnections(b.connections),w+=this.printBandwidth(b.bandwidths),w+=this.printKey(b.key),w+=this.printMediaAttributes(b);return w}printConnections(g){let w="";for(const b of g)w+=this.printConnection(b);return w}printMedia(g){return"m=".concat(g.mediaType," ").concat(g.port," ").concat(g.protos.join("/")," ").concat(g.fmts.join(" ")).concat(this.eol)}printSessionAttributes(g){return new K(this.eol).print(g)}printMediaAttributes(g){return new te(this.eol).print(g)}}class x{constructor(g){yt(this,"eol",void 0),this.eol=g}printIceUfrag(g){return g===void 0?"":"a=ice-ufrag:".concat(g).concat(this.eol)}printIcePwd(g){return g===void 0?"":"a=ice-pwd:".concat(g).concat(this.eol)}printIceOptions(g){return g===void 0?"":"a=ice-options:".concat(g.join(p)).concat(this.eol)}printFingerprints(g){return g.length>0?g.map(w=>"a=fingerprint:".concat(w.hashFunction).concat(p).concat(w.fingerprint)).join(this.eol)+this.eol:""}printExtmap(g){return g.map(w=>"a=extmap:".concat(w.entry).concat(w.direction?"/".concat(w.direction):"").concat(p).concat(w.extensionName).concat(w.extensionAttributes?"".concat(p).concat(w.extensionAttributes):"").concat(this.eol)).join("")}printSetup(g){return g===void 0?"":"a=setup:".concat(g).concat(this.eol)}printUnrecognized(g){return g.map(w=>"a=".concat(w.attField).concat(w.attValue?":".concat(w.attValue):"").concat(this.eol)).join("")}}class K extends x{print(g){let w="";return w+=this.printGroups(g.groups),w+=this.printMsidSemantic(g.msidSemantic),w+=this.printIceLite(g.iceLite),w+=this.printIceUfrag(g.iceUfrag),w+=this.printIcePwd(g.icePwd),w+=this.printIceOptions(g.iceOptions),w+=this.printFingerprints(g.fingerprints),w+=this.printSetup(g.setup),w+=this.printTlsId(g.tlsId),w+=this.printIdentity(g.identities),w+=this.printExtmap(g.extmaps),w+=this.printUnrecognized(g.unrecognized),w}printGroups(g){let w="";return g.length>0&&(w+=g.map(b=>"a=group:".concat(b.semantic).concat(b.identificationTag.map(B=>"".concat(p).concat(B)).join("")).concat(this.eol)).join("")),w}printIceLite(g){return g===void 0?"":"a=ice-lite"+this.eol}printTlsId(g){return g?"a=tls-id:".concat(g).concat(this.eol):""}printIdentity(g){return g.length===0?"":g.map(w=>"a=identity:".concat(w.assertionValue).concat(w.extensions.map(b=>"".concat(p).concat(b.name).concat(b.value?"=".concat(b.value):"")))).join(this.eol)+this.eol}printMsidSemantic(g){if(!g)return"";let w="a=msid-semantic:".concat(g.semantic);return g.applyForAll?w+="".concat(p,"*"):g.identifierList.length>0&&(w+=g.identifierList.map(b=>"".concat(p).concat(b))),w+this.eol}}class te extends x{print(g){const w=g.attributes;let b="";return b+=this.printRTCP(w.rtcp),b+=this.printIceUfrag(w.iceUfrag),b+=this.printIcePwd(w.icePwd),b+=this.printIceOptions(w.iceOptions),b+=this.printCandidates(w.candidates),b+=this.printRemoteCandidatesList(w.remoteCandidatesList),b+=this.printEndOfCandidates(w.endOfCandidates),b+=this.printFingerprints(w.fingerprints),b+=this.printSetup(w.setup),b+=this.printMid(w.mid),b+=this.printExtmap(w.extmaps),b+=this.printRTPRelated(w),b+=this.printPtime(w.ptime),b+=this.printMaxPtime(w.maxPtime),b+=this.printDirection(w.direction),b+=this.printSSRCGroups(w.ssrcGroups),b+=this.printSSRC(w.ssrcs),b+=this.printRTCPMux(w.rtcpMux),b+=this.printRTCPMuxOnly(w.rtcpMuxOnly),b+=this.printRTCPRsize(w.rtcpRsize),b+=this.printMSId(w.msids),b+=this.printImageattr(w.imageattr),b+=this.printRid(w.rids),b+=this.printSimulcast(w.simulcast),b+=this.printSCTPPort(w.sctpPort),b+=this.printMaxMessageSize(w.maxMessageSize),b+=this.printUnrecognized(w.unrecognized),b}printCandidates(g){return g.map(w=>"a=candidate:".concat(w.foundation).concat(p).concat(w.componentId).concat(p).concat(w.transport).concat(p).concat(w.priority).concat(p).concat(w.connectionAddress).concat(p).concat(w.port).concat(p,"typ").concat(p).concat(w.type).concat(w.relAddr?"".concat(p,"raddr").concat(p).concat(w.relAddr):"").concat(w.relPort?"".concat(p,"rport").concat(p).concat(w.relPort):"").concat(Object.keys(w.extension).map(b=>"".concat(p).concat(b).concat(p).concat(w.extension[b])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(g){return g.map(w=>"a=remote-candidates:".concat(w.join(p)).concat(this.eol)).join("")}printEndOfCandidates(g){return g===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(g){if(!g.payloads)return"";const w=g.payloads;let b="";b+=g.rtcpFeedbackWildcards.map(B=>this.printRTCPFeedback("*",B)).join("");for(const B of w)b+=this.printRtpMap(B.payloadType,B.rtpMap),b+=this.printFmtp(B.payloadType,B.fmtp),b+=B.rtcpFeedbacks.map(ve=>this.printRTCPFeedback(B.payloadType,ve)).join("");return b}printFmtp(g,w){if(!w)return"";const b=Object.keys(w.parameters);return b.length===1&&w.parameters[b[0]]===null?"a=fmtp:".concat(g).concat(p).concat(b[0]).concat(this.eol):"a=fmtp:".concat(g).concat(p).concat(Object.keys(w.parameters).map(B=>"".concat(B,"=").concat(w.parameters[B])).join(";")).concat(this.eol)}printRtpMap(g,w){return w?"a=rtpmap:".concat(g).concat(p).concat(w.encodingName,"/").concat(w.clockRate).concat(w.encodingParameters?"/".concat(w.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(g,w){let b="a=rtcp-fb:".concat(g).concat(p),B=w;switch(B.type){case"trr-int":b+="ttr-int".concat(p).concat(B.interval);break;case"ack":case"nack":default:B=B,b+="".concat(B.type),B.parameter&&(b+="".concat(p).concat(B.parameter),B.additional&&(b+="".concat(p).concat(B.additional)))}return b+this.eol}printPtime(g){return g===void 0?"":"a=ptime:".concat(g).concat(this.eol)}printMaxPtime(g){return g===void 0?"":"a=maxptime:".concat(g).concat(this.eol)}printDirection(g){return g===void 0?"":"a=".concat(g).concat(this.eol)}printSSRC(g){return g.map(w=>Object.keys(w.attributes).map(b=>"a=ssrc:".concat(w.ssrcId.toString(10)).concat(p).concat(b).concat(w.attributes[b]?":".concat(w.attributes[b]):"").concat(this.eol)).join("")).join("")}printRTCPMux(g){return g===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(g){return g===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(g){return g===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(g){if(g===void 0)return"";let w="a=rtcp:".concat(g.port);return g.netType&&(w+="".concat(p).concat(g.netType)),g.addressType&&(w+="".concat(p).concat(g.addressType)),g.address&&(w+="".concat(p).concat(g.address)),w+this.eol}printMSId(g){return g.map(w=>"a=msid:".concat(w.id).concat(w.appdata?"".concat(p).concat(w.appdata):"").concat(this.eol)).join("")}printImageattr(g){return g.map(w=>"a=imageattr:".concat(w).concat(this.eol)).join("")}printRid(g){return g.map(w=>{let b="a=rid:".concat(w.id).concat(p).concat(w.direction);return w.payloads&&(b+="".concat(p,"pt=").concat(w.payloads.join(","))),w.params.length>0&&(b+="".concat(p).concat(w.params.map(B=>B.type==="depend"?"depend=".concat(B.rids.join(",")):"".concat(B.type,"=").concat(B.val)).join(";"))),b+this.eol}).join("")}printSimulcast(g){return g===void 0?"":"a=simulcast:".concat(g).concat(this.eol)}printSCTPPort(g){return g===void 0?"":"a=sctp-port:".concat(g).concat(this.eol)}printMaxMessageSize(g){return g===void 0?"":"a=max-message-size:".concat(g).concat(this.eol)}printMid(g){return g===void 0?"":"a=mid:".concat(g).concat(this.eol)}printSSRCGroups(g){return g.map(w=>"a=ssrc-group:".concat(w.semantic).concat(w.ssrcIds.map(b=>"".concat(p).concat(b.toString(10))).join("")).concat(this.eol)).join("")}}function Se(X){return new rt().parse(X)}function xe(X,g){return new qn().print(X,g)}}},i={};function o(a){if(i[a])return i[a].exports;var c=i[a]={exports:{}};return n[a](c,c.exports,o),c.exports}return o.d=(a,c)=>{for(var l in c)o.o(c,l)&&!o.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:c[l]})},o.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),o.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},o(8)})()})(kt);class Jj{constructor(t){m(this,"sessionDesc",void 0),m(this,"localCapabilities",void 0),m(this,"rtpCapabilities",void 0),m(this,"candidates",void 0),m(this,"iceParameters",void 0),m(this,"dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),t=Pt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,sdkCodec:u,cname:f}=t,p=kt.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=o,this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=f;for(let _=0;_<p.mediaDescriptions.length;_++){const S=p.mediaDescriptions[_];S.attributes.iceUfrag=n.iceUfrag,S.attributes.icePwd=n.icePwd,S.attributes.fingerprints=i.fingerprints,S.attributes.candidates=o,S.attributes.setup=c,S.media.mediaType==="video"&&(S.media.fmts=a.videoCodecs.map(R=>R.payloadType.toString(10)),S.attributes.payloads=a.videoCodecs,S.attributes.extmaps=a.videoExtensions),S.media.mediaType==="audio"&&(S.media.fmts=a.audioCodecs.map(R=>R.payloadType.toString(10)),S.attributes.payloads=a.audioCodecs,S.attributes.extmaps=a.audioExtensions),p.mediaDescriptions[_]=this.mungMediaDesc(S)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return kt.exports.print(this.sessionDesc)}send(t,n,i){const{ssrcs:o,ssrcGroups:a}=Mi(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(f=>t===Ie.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),l=o[0].attributes.label,u=o[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(o),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(a),{id:l,mslabel:u}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:o}=n;return this.send(i,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],o=[],a=[];n.attributes.ssrcs.forEach(c=>{t.includes(c.attributes.label||"")?a.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{a.map(l=>l.ssrcId).includes(c.ssrcIds[0])||o.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=o})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((o,a)=>{const c=o._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===c.kind),u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],o);this.sessionDesc.mediaDescriptions[l]=u})}stopReceiving(t){}updateCandidates(t){t===rn.TCP?this.candidates.forEach(n=>{this.candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===n.connectionAddress&&i.port===n.port)===-1&&this.candidates.push(UA(UA({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this.candidates=this.candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Pt(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=Pt(t);return ja(i,n),oE(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const o=this.sessionDesc.mediaDescriptions.find(c=>t===Ie.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(o){const c=o.attributes.ssrcs.find(l=>l.attributes.label===n);var a;c&&(c.attributes.label=i,(a=c.attributes.msid)===null||a===void 0||a.replace(n,i))}}mungMediaDesc(t){const n=Pt(t);return rE(n),function(i){const o=i.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(o),1),i.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}function Zi(e){if(Array.isArray(e))return e.map(n=>n);if(!xA(e))return e;const t={};for(const n in e)xA(e[n])||Array.isArray(e[n])?t[n]=Zi(e[n]):t[n]=e[n];return t}function xA(e){return!(typeof e!="object"||Array.isArray(e)||!e)}function Xj(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}function Qj(e){return window.RTCStatsReport?e.getStats()instanceof ie:!1}class aE{constructor(t){m(this,"input",[]),m(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Uo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},ed={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Uo,remoteCandidate:Uo}},VA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},jA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},FA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},BA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function GA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function WA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GA(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class cE{constructor(t,n){m(this,"onFirstVideoReceived",void 0),m(this,"onFirstVideoDecoded",void 0),m(this,"onFirstAudioReceived",void 0),m(this,"onFirstVideoDecodedTimeout",void 0),m(this,"onFirstAudioDecoded",void 0),m(this,"onSelectedLocalCandidateChanged",void 0),m(this,"onSelectedRemoteCandidateChanged",void 0),m(this,"videoIsReady",!1),m(this,"videoIsReady2",{}),m(this,"pc",void 0),m(this,"options",void 0),m(this,"intervalTimer",void 0),m(this,"stats",Zi(ed)),m(this,"isFirstVideoReceived",{}),m(this,"isFirstVideoDecoded",{}),m(this,"isFirstAudioReceived",{}),m(this,"isFirstAudioDecoded",{}),m(this,"isFirstVideoDecodedTimeout",{}),m(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ie(t=>{t({local:WA({},Uo),remote:WA({},Uo)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,a=0,c=0,l=0;for(const u of i)t[u].forEach((f,p)=>{if(!this.lossRateWindowStats[n-1][u][p]||!this.lossRateWindowStats[0][u][p])return;const _=this.lossRateWindowStats[n-1][u][p].packets-this.lossRateWindowStats[0][u][p].packets,S=this.lossRateWindowStats[n-1][u][p].packetsLost-this.lossRateWindowStats[0][u][p].packetsLost;u==="videoSend"||u==="audioSend"?(o+=_,c+=S):(a+=_,l+=S),Number.isNaN(_)||Number.isNaN(_)?f.packetLostRate=0:f.packetLostRate=_<=0||S<=0?0:S/(_+S)});t.sendPacketLossRate=o<=0||c<=0?0:c/(o+c),t.recvPacketLossRate=a<=0||l<=0?0:l/(a+l)}}function HA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function $j(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HA(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Zj extends cE{constructor(){super(...arguments),m(this,"_stats",ed),m(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),n=this.statsResponsesToObjects(t);this._stats=Zi(ed);const i=n.filter(a=>a.type==="ssrc");this.processSSRCStats(i);const o=n.find(a=>a.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{const i=n.id.includes("send");switch("".concat(n.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const o=Zi(jA);o.codec=n.googCodecName,o.adaptionChangeReason="none",n.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(n.googAvgEncodeMs),o.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.firsCount=Number(n.googFirReceived),o.nacksCount=Number(n.googNacksReceived),o.plisCount=Number(n.googPlisReceived),o.frameCount=Number(n.framesEncoded),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=Zi(VA),a=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(o.codec=n.googCodecName,o.targetDelayMs=Number(n.googTargetDelayMs),o.renderDelayMs=Number(n.googRenderDelayMs),o.currentDelayMs=Number(n.googCurrentDelayMs),o.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),o.decodeMs=Number(n.googDecodeMs),o.maxDecodeMs=Number(n.googMaxDecodeMs),o.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},o.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},o.decodeFrameRate=Number(n.googFrameRateDecoded),o.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},o.jitterBufferMs=Number(n.googJitterBufferMs),o.firsCount=Number(n.googFirsSent),o.nacksCount=Number(n.googNacksSent),o.plisCount=Number(n.googPlisSent),o.framesDecodeCount=Number(n.framesDecoded),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),a){const c=a.stats,l=Date.now()-a.lts;o.framesDecodeFreezeTime=c.framesDecodeFreezeTime,o.framesDecodeInterval=c.framesDecodeInterval,o.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(a.lts=Date.now(),o.framesDecodeInterval=l,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):o.framesDecodeCount<a.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:$j({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=Zi(BA);o.codec=n.googCodecName,o.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,o.decodingCNG=Number(n.googDecodingCNG),o.decodingCTN=Number(n.googDecodingCTN),o.decodingCTSG=Number(n.googDecodingCTSG),o.decodingNormal=Number(n.googDecodingNormal),o.decodingPLC=Number(n.googDecodingPLC),o.decodingPLCCNG=Number(n.googDecodingPLCCNG),o.expandRate=Number(n.googExpandRate),o.accelerateRate=Number(n.googAccelerateRate),o.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),o.speechExpandRate=Number(n.googSpeechExpandRate),o.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),o.jitterBufferMs=Number(n.googJitterBufferMs),o.jitterMs=Number(n.googJitterReceived),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),o.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=Zi(FA);o.codec=n.googCodecName,o.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,o.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new ie((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(a=>{o[a]=i.stat(a)}),n.push(o)}),n}}function KA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ms(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KA(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class YA extends cE{constructor(){super(...arguments),m(this,"_stats",ed),m(this,"report",void 0),m(this,"lastDecodeVideoReceiverStats",new Map),m(this,"lastVideoFramesRecv",new Map),m(this,"lastVideoFramesSent",new Map),m(this,"lastVideoFramesDecode",new Map),m(this,"lastVideoJBDelay",new Map),m(this,"lastAudioJBDelay",new Map),m(this,"mediaBytesSent",new Map),m(this,"mediaBytesRetransmit",new Map),m(this,"mediaBytesTargetEncode",new Map),m(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Zi(ed),this.report.forEach(t=>{switch(t.type){case li.OUTBOUND:t.mediaType==="audio"?this.processAudioOutboundStats(t):t.mediaType==="video"&&this.processVideoOutboundStats(t);break;case li.INBOUND:t.mediaType==="audio"?this.processAudioInboundStats(t):t.mediaType==="video"&&this.processVideoInboundStats(t);break;case li.TRANSPORT:{const n=this.report.get(t.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case li.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),n={local:Ms({},Uo),remote:Ms({},Uo)};return t.forEach(i=>{let o;if(i.type===li.TRANSPORT&&(o=t.get(i.selectedCandidatePairId)),i.type===li.CANDIDATE_PAIR&&i.selected&&(o=i),o){const a=(c,l)=>{c.type=l.type,c.id=l.id,l.address&&(c.address=l.address),l.candidateType&&(c.candidateType=l.candidateType),l.port&&(c.port=l.port),l.priority&&(c.priority=l.priority),l.protocol&&(c.protocol=l.protocol),l.relayProtocol&&(c.relayProtocol=l.relayProtocol)};if(o.localCandidateId){const c=t.get(o.localCandidateId);c&&a(n.local,c)}if(o.remoteCandidateId){const c=t.get(o.remoteCandidateId);c&&a(n.remote,c)}}}),n}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===li.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===li.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===li.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ms({},n),Ms({},this.stats.selectedCandidatePair.localCandidate)),t.type===li.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ms({},n),Ms({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);n||(n=Zi(BA),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof t.concealedSamples=="number"&&(n.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let n=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);n||(n=Zi(VA),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),a=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const c=n.decodedFrame?n.decodedFrame.width:0,l=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,c,l),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const c=i.stats,l=a-i.lts;n.framesDecodeFreezeTime=c.framesDecodeFreezeTime,n.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=l,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<c.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?n.qpSumPerFrame=t.qpSum/t.framesDecoded:n.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}o&&a-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((a-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:a,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:a,rate:0}),t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:Ms({},n),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);n||(n=Zi(jA),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const o=new aE(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const a=new aE(10);a.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,a)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const a=new aE(10);a.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,a)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,n.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)n.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const a=t.framesEncoded-o.lastFrameCount,c=t.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*c/a}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?n.qpSumPerFrame=t.qpSum/t.framesEncoded:n.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const o=this.findRemoteStatsId(t.ssrc,li.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(n||(n=Zi(FA),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const i=this.findRemoteStatsId(t.ssrc,li.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(t,n){var i;const o=Array.from(Ur(i=this.report).call(i)).find(a=>a.type===n&&a.ssrc===t);return o?o.id:null}processVideoMediaSource(t,n){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,n){const i=this.report.get(t);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,n,i){var o,a,c;const l=n?this.report.get(n):void 0,u=(o=l==null?void 0:l.framesSent)!==null&&o!==void 0?o:t.framesSent;let f=(a=l==null?void 0:l.frameWidth)!==null&&a!==void 0?a:t.frameWidth,p=(c=l==null?void 0:l.frameHeight)!==null&&c!==void 0?c:t.frameHeight;if(typeof u!="number")return;typeof f=="number"&&typeof p=="number"||(f=0,p=0);let _=0;const S=Date.now(),R=this.lastVideoFramesSent.get(i.ssrc);R&&S-R.lts>=800?(_=Math.round((u-R.count)/((S-R.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:S,rate:_})):R?_=R.rate:this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:S,rate:0}),i.sentFrame={width:f,height:p,frameRate:Math.max(0,_)}}processVideoTrackReceiverStats(t,n,i){var o,a,c,l,u;const f=n?this.report.get(n):void 0,p=(o=f==null?void 0:f.framesReceived)!==null&&o!==void 0?o:t.framesReceived,_=(a=f==null?void 0:f.frameWidth)!==null&&a!==void 0?a:t.frameWidth,S=(c=f==null?void 0:f.frameHeight)!==null&&c!==void 0?c:t.frameHeight,R=(l=f==null?void 0:f.jitterBufferDelay)!==null&&l!==void 0?l:t.jitterBufferDelay,C=(u=f==null?void 0:f.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount;if(typeof p=="number"){const A=this.lastVideoFramesRecv.get(i.ssrc),O=Date.now();i.framesReceivedCount=p;let k=0;A&&O-A.lts>=800?(k=Math.round((p-A.count)/((O-A.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:p,lts:O,rate:k})):A?k=A.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:p,lts:O,rate:0}),i.receivedFrame={width:_||0,height:S||0,frameRate:k||0},i.decodedFrame={width:_||0,height:S||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:_||0,height:S||0,frameRate:i.decodeFrameRate||0}}if(R&&C){let A=this.lastVideoJBDelay.get(i.ssrc);this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:C}),A||(A={jitterBufferDelay:0,jitterBufferEmittedCount:0});const O=1e3*(R-A.jitterBufferDelay)/(C-A.jitterBufferEmittedCount);i.jitterBufferMs=O,i.currentDelayMs=Math.round(O)}}processAudioTrackSenderStats(t,n,i){var o,a,c,l;const u=n?this.report.get(n):void 0,f=(o=(a=u==null?void 0:u.echoReturnLoss)!==null&&a!==void 0?a:t.echoReturnLoss)!==null&&o!==void 0?o:0,p=(c=(l=u==null?void 0:u.echoReturnLossEnhancement)!==null&&l!==void 0?l:t.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;i.aecReturnLoss=f,i.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(t,n,i){var o,a,c,l,u,f,p;const _=n?this.report.get(n):void 0,S=(o=_==null?void 0:_.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,R=(a=_==null?void 0:_.totalSamplesReceived)!==null&&a!==void 0?a:t.totalSamplesReceived,C=(c=_==null?void 0:_.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,A=(l=_==null?void 0:_.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount,O=(u=_==null?void 0:_.audioLevel)!==null&&u!==void 0?u:t==null?void 0:t.audioLevel,k=(f=_==null?void 0:_.totalSamplesDuration)!==null&&f!==void 0?f:t==null?void 0:t.totalSamplesDuration,M=(p=_==null?void 0:_.concealedSamples)!==null&&p!==void 0?p:t.concealedSamples;if(S&&R&&(i.accelerateRate=S/R),C&&A){let re=this.lastAudioJBDelay.get(i.ssrc);this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:A}),re||(re={jitterBufferDelay:0,jitterBufferEmittedCount:0});const Y=1e3*(C-re.jitterBufferDelay)/(A-re.jitterBufferEmittedCount);i.jitterBufferMs=Math.round(Y)}i.outputLevel=O;let H=1920;k&&R&&(H=R/k/50,i.receivedFrames=Math.round(R/H)),M&&(i.droppedFrames=Math.round(M/H))}processRemoteInboundStats(t,n){const i=this.report.get(t);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,n=null,i=null;this.mediaBytesSent.forEach(a=>{t+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{i=i===null?a.diffMean():i+a.diffMean()});const o=n!==null?t-n:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class eF extends cE{updateStats(){return ie.resolve()}}function dE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=Xj();return a?a<76?new Zj(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new YA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):Qj(e)?new YA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new eF(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o})}var Qe;function zA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function qA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zA(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let td=(G((Qe=class gd extends $l{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,n){super(t,n),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"statsFilter",void 0),m(this,"useRTX",!1),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"establishPromise",void 0),m(this,"mutex",new Pn("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(gd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=dE(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,Et()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=ks(t.sdp),i=iE(t.sdp,!this.useRTX,D("FILTER_VIDEO_FEC"),D("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=i,this.initialOffer=t,qA(qA({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new N(y.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,i,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Jj({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:c});const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(t,n){var i=this;return $i(function*(){const o=yield Pe(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=t.map(S=>i.peerConnection.addTrack(S._mediaStreamTrack)),c=yield Pe(i.peerConnection.createOffer()),l=kt.exports.parse(c.sdp),u=t.map(S=>{const R=S._mediaStreamTrack,C=l.mediaDescriptions.find(A=>A.attributes.mid===R.kind);if(!C)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,O,k){const M=A.attributes.ssrcs.filter(re=>re.attributes.label===O),H=A.attributes.ssrcGroups;if(M.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(H&&M.length>1){const re=H.find(Y=>Y.ssrcIds.indexOf(M[0].ssrcId)!==-1);return re?[{ssrcId:re.ssrcIds[0],rtx:k?re.ssrcIds[1]:void 0}]:[{ssrcId:M[0].ssrcId}]}return[{ssrcId:M[0].ssrcId}]}(C,R.id,i.useRTX)});let f;try{f=yield u}catch(S){throw a.forEach(R=>{wn()&&R.replaceTrack(null),i.peerConnection.removeTrack(R)}),S}const p=i.mungSendOfferSDP(c.sdp,t);i.remoteSDP.receive(t,n,f);const _=i.remoteSDP.toString();return yield Pe(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Pe(i.applySendEncodings(a,t)),yield Pe(i.peerConnection.setRemoteDescription({type:"answer",sdp:_})),t.map((S,R)=>{const C=S._mediaStreamTrack.id;return{localSSRC:u[R],id:C}})}catch(a){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{wn()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:a,mslabel:c}=this.remoteSDP.send(t,n,o),l=new ie((p,_)=>{const S=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(a)))},1e4),R=C=>{const A=We();if((A.name==="Safari"&&Number(A.version)===11||Nn())&&C.track.id!==a&&C.streams[0].id===c){var O;const k=C.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(t,a,C.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(S),void p(k)}if(C.track.id===a)return this.peerConnection.removeEventListener("track",R),clearTimeout(S),void p(C.track)};this.peerConnection.addEventListener("track",R)}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await l,id:a}}catch(a){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var o;return t.indexOf(((o=i.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(wn()&&i.track)i.track.enabled=!1;else{const o=i.getParameters();o.encodings.forEach(a=>a.active=!1),i.setParameters(o)}})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if(wn()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!0),await a.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return $i(function*(){const i=yield Pe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ct().supportPCSetConfiguration){const u=n.peerConnection.getConfiguration(),f=t===rn.RELAY?"relay":"all";u.iceTransportPolicy!==f&&(v.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(f,"]")),u.iceTransportPolicy=f,n.peerConnection.setConfiguration(u))}else if(t===rn.RELAY)return;t!==rn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield Pe(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ks(o.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString();yield Pe(n.peerConnection.setLocalDescription(o)),yield Pe(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(o){v.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new N(y.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...gd.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...gd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Ct().supportSetRtpSenderParameters||t.length!==n.length)return;for(let o=0;o<t.length;o++){var i;const a=t[o],c=n[o];if(!c)continue;const l={},u={};if(c instanceof Lt)switch(c._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(D("DSCP_TYPE")&&Ss()){const _=D("DSCP_TYPE");["very-low","low","medium","high"].includes(_)&&(u.networkPriority=_)}const f=a.getParameters(),p=(i=f.encodings)===null||i===void 0?void 0:i[0];p&&Object.assign(p,u),Object.assign(f,l),await a.setParameters(f)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=kt.exports.parse(t);return n.forEach((o,a)=>{const c=o._mediaStreamTrack,l=i.mediaDescriptions.find(u=>u.attributes.mid===c.kind);l&&ja(l,o)}),kt.exports.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((a,c)=>{let{id:l,mslabel:u}=a;const{kind:f}=t[c];return new ie((p,_)=>{const S=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(l)))},1e4),R=C=>{const A=We();if(A.name==="Safari"&&Number(A.version)===11&&C.track.id!==l&&C.streams[0].id===u){var O;const k=C.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(f,l,C.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(S),void p({track:k,id:l})}if(C.track.id===l)return this.peerConnection.removeEventListener("track",R),clearTimeout(S),void p({track:C.track,id:l})};this.peerConnection.addEventListener("track",R)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await ie.all(n)}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ct().supportPCSetConfiguration){const n=gd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"connect"),Qe.prototype),G(Qe.prototype,"stopSending",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"stopSending"),Qe.prototype),G(Qe.prototype,"receive",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"receive"),Qe.prototype),G(Qe.prototype,"stopReceiving",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"stopReceiving"),Qe.prototype),G(Qe.prototype,"muteRemote",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"muteRemote"),Qe.prototype),G(Qe.prototype,"unmuteRemote",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"unmuteRemote"),Qe.prototype),G(Qe.prototype,"muteLocal",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"muteLocal"),Qe.prototype),G(Qe.prototype,"unmuteLocal",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"unmuteLocal"),Qe.prototype),G(Qe.prototype,"close",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"close"),Qe.prototype),G(Qe.prototype,"updateEncoderConfig",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"updateEncoderConfig"),Qe.prototype),G(Qe.prototype,"updateSendParameters",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"updateSendParameters"),Qe.prototype),G(Qe.prototype,"replaceTrack",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"replaceTrack"),Qe.prototype),G(Qe.prototype,"getRemoteSSRC",[Ui],Object.getOwnPropertyDescriptor(Qe.prototype,"getRemoteSSRC"),Qe.prototype),Qe);function Ui(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}function JA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function XA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JA(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Ru="9",QA=4e4;class tF{get localCapabilities(){return Pt(this._localCapabilities)}get rtpCapabilities(){return Pt(this._rtpCapabilities)}get candidates(){return Pt(this._candidates)}get iceParameters(){return Pt(this._iceParameters)}get dtlsParameters(){return Pt(this._dtlsParameters)}constructor(t){m(this,"sessionDesc",void 0),m(this,"_localCapabilities",void 0),m(this,"_rtpCapabilities",void 0),m(this,"_candidates",void 0),m(this,"_iceParameters",void 0),m(this,"_dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),m(this,"firefoxSsrcMidMap",new Map),t=Pt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,cname:u}=t,f=kt.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=l,this.setup=c,this.cname=u;const p=this.rtpCapabilities.send;for(const _ of f.mediaDescriptions){if(_.attributes.iceUfrag=n.iceUfrag,_.attributes.icePwd=n.icePwd,_.attributes.fingerprints=i.fingerprints,_.attributes.candidates=o,_.attributes.setup=c,_.media.mediaType==="video"&&(_.media.fmts=p.videoCodecs.map(S=>S.payloadType.toString(10)),_.attributes.payloads=p.videoCodecs,_.attributes.extmaps=p.videoExtensions,D("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:R}=Mi([{ssrcId:QA,rtx:D("USE_SUB_RTX")?40001:void 0}],this.cname);_.attributes.ssrcs=S,_.attributes.ssrcGroups=R}if(_.media.mediaType==="audio"&&(_.media.fmts=p.audioCodecs.map(S=>S.payloadType.toString(10)),_.attributes.payloads=p.audioCodecs,_.attributes.extmaps=p.audioExtensions,Mo(_),D("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:R}=Mi([{ssrcId:2e4}],this.cname);_.attributes.ssrcs=S,_.attributes.ssrcGroups=R}}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}preloadRemoteMedia(){const t=D("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const n=this.candidates,i=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<t;c++){const l=2*c+2e4,u=2*c+QA,{ssrcs:f,ssrcGroups:p}=Mi([{ssrcId:l}],this.cname),{ssrcs:_,ssrcGroups:S}=Mi([{ssrcId:u,rtx:D("USE_SUB_RTX")?u+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Ru,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Ru,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return kt.exports.print(this.sessionDesc)}send(t,n,i,o){const{ssrcs:a,ssrcGroups:c}=Mi(n,this.cname,D("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(a);if(l){if(Et()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),o&&(o.twcc||o.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,o),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,a);let f;return u===-1||u===1&&(wn()||Kv())||u===0&&D("USE_SUB_RTX")||Yv()?(f=this.createOrRecycleSendMedia(t,a,c,"sendonly",o),this.updateBundleMids()):(f=Pt(this.sessionDesc.mediaDescriptions[u]),f.attributes.direction="sendonly",f.attributes.ssrcs=a,f.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(f,o)),Et()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,f.attributes.mid),{mid:f.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:c,ssrcMsg:l,mslabel:u}=a;return this.send(c,l,u)}),i=[];let o=!1;return n.forEach(a=>{let{mid:c,needExchangeSDP:l}=a;l&&(o=!0),i.push(c)}),{mids:i,needExchangeSDP:o}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.mid==="0"||Et()||Yv()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,n,i,o){t.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,i,o[c])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===rn.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===n.connectionAddress&&i.port===n.port)===-1&&this._candidates.push(XA(XA({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Pt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Et()){if(o){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(t,n,i,o,a,c){const l=t._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,f=this.localCapabilities.send;let p=[];if(l===Ie.VIDEO){var _,S;if(D("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(p=u.videoCodecs.filter(k=>{var M,H;return(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"").includes(o)&&(k==null||(H=k.fmtp)===null||H===void 0?void 0:H.parameters["profile-level-id"])===D("H264_PROFILE_LEVEL_ID")})),!p||((_=p)===null||_===void 0?void 0:_.length)===0){const k=f.videoCodecs.filter(M=>{var H;return(((H=M.rtpMap)===null||H===void 0?void 0:H.encodingName.toLowerCase())||"").includes(o)});k.length!==0&&(p=u.videoCodecs.filter(M=>k.some(H=>H.payloadType===M.payloadType)))}if(D("USE_PUB_RTX")){const k=p.map(H=>H.payloadType.toString()),M=u.videoCodecs.filter(H=>{var re,Y;return((re=H.rtpMap)===null||re===void 0?void 0:re.encodingName)==="rtx"&&k.includes(((Y=H.fmtp)===null||Y===void 0?void 0:Y.parameters.apt)||"")});p=[...p,...M]}p.length===0&&(v.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat((S=u.videoCodecs[0].rtpMap)===null||S===void 0?void 0:S.encodingName)),p=u.videoCodecs)}else p=u.audioCodecs.filter(k=>{var M;return(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"").includes(a)}),p.length===0&&(v.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),p=u.audioCodecs.filter(k=>{var M;return(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"").includes("opus")}));const R=l===Ie.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const C="".concat(this.currentMidIndex);let A={media:{mediaType:l,port:Ru,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(C)}};A=this.mungRecvMediaDsec(A,t,c);const O=this.findFirstClosedMedia(l);if(O){const k=this.sessionDesc.mediaDescriptions.indexOf(O);this.sessionDesc.mediaDescriptions[k]=A}else this.sessionDesc.mediaDescriptions.push(A);return A}createOrRecycleSendMedia(t,n,i,o,a){const c=this.rtpCapabilities.send,l=t===Ie.VIDEO?c.videoCodecs:c.audioCodecs,u=t===Ie.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let p={media:{mediaType:t,port:Ru,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};p=this.mungSendMediaDesc(p,a);const _=this.findFirstClosedMedia(t);if(_){const S=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[S]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,i){const o=Pt(t);return rE(o),ja(o,n),oE(o,n),PA(o),Tu(o,i,this.localCapabilities.send),o}mungSendMediaDesc(t,n){const i=Pt(t);return Tu(i,n,this.localCapabilities.recv),Mo(i),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Et()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var i,o;return((i=n.attributes)===null||i===void 0||(o=i.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var $e;function $A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Fa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$A(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$A(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let ro=(G(($e=class Sd extends $l{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n,i;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(i=n.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}constructor(t,n){super(t,n),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"transportEventReceiver",void 0),m(this,"statsFilter",void 0),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"selectedCandidatePairTimer",void 0),m(this,"establishPromise",void 0),m(this,"mutex",new Pn("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(Sd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=dE(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,Et()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=ks(t.sdp),i=await kA(!D("USE_PUB_RTX")&&!D("USE_SUB_RTX"),D("FILTER_VIDEO_FEC"),D("FILTER_AUDIO_FEC"));return this.localCapabilities=sE(i),this.initialOffer=t,Fa(Fa({},n),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new N(y.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,i,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new tF({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:this.localCapabilities,cname:c});const l=this.remoteSDP.toString(),u=kt.exports.parse(this.initialOffer.sdp),f=u.mediaDescriptions.find(R=>R.media.mediaType==="audio");f&&Mo(f);const p=kt.exports.print(u),_=this.logSDPExchange(p||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),_==null||_(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l});const S=this.peerConnection.getTransceivers()[0];if(S!=null&&S.receiver&&this.tryBindTransportEvents(S.receiver),D("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const R=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:R});const C=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(C)}}catch(l){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(t,n,i){var o=this;return $i(function*(){const a=yield Pe(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[];t.forEach(A=>{const O=o.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});c.push(O),A._updateRtpTransceiver(O)}),Et()&&D("SIMULCAST")===!0&&(yield Pe(o.applySimulcastForFirefox(c,t)));const l=yield Pe(o.peerConnection.createOffer()),u=o.remoteSDP.predictReceivingMids(t.length),f=o.mungSendOfferSDP(l.sdp,t,u),p=kt.exports.parse(f),_=u.map(A=>{const O=p.mediaDescriptions.find(k=>k.attributes.mid===A);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return bA(O,D("USE_PUB_RTX"))});let S;try{S=yield _}catch(A){S=[],o.remoteSDP.receive(t,n,i,S);const O=o.remoteSDP.toString();throw yield Pe(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Pe(o.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield Pe(o.stopSending(u,!0)),A}o.remoteSDP.receive(t,n,i,S);const R=o.remoteSDP.toString(),C=o.logSDPExchange(f,"offer","local","send");return yield Pe(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Pe(o.applySimulcastEncodings(c,t)),yield Pe(o.applySendEncodings(c,t)),C==null||C(R),yield Pe(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),c.map((A,O)=>{const k=u[O];return{localSSRC:_[O],id:k,transceiver:A}})}catch(c){throw c instanceof N?c:new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(u=>{var f;u.direction="inactive",(f=u.stop)===null||f===void 0||f.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,o);if(c){const u=this.remoteSDP.toString(),f=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(p.sdp,a,t);f==null||f(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}}catch(a){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return n.map(o=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o,transceiver:a}})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return $i(function*(){const i=yield Pe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ct().supportPCSetConfiguration){const f=n.peerConnection.getConfiguration(),p=t===rn.RELAY?"relay":"all";f.iceTransportPolicy!==p&&(v.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(p,"]")),f.iceTransportPolicy=p,n.peerConnection.setConfiguration(f))}else if(t===rn.RELAY)return;t!==rn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield Pe(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ks(o.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString(),u=n.logSDPExchange(o.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Pe(n.peerConnection.setLocalDescription(o)),u==null||u(l),yield Pe(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(o){v.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new N(y.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Et()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:Fa(Fa({},Uo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Fa(Fa({},Uo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Sd.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Sd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&Ct().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(su(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var a;o&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:a}=i.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(t,n){try{if(!Ct().supportSetRtpSenderParameters||t.length!==n.length)return;for(let f=0;f<t.length;f++){const p=t[f],_=n[f];if(_&&_ instanceof Lt){var i,o;if(this.isVP8Simulcast(_))continue;const S={},R={};switch(_._optimizationMode){case"motion":S.degradationPreference="maintain-framerate";break;case"detail":S.degradationPreference="maintain-resolution";break;default:S.degradationPreference="balanced"}var a,c,l,u;if((i=_._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(R.maxBitrate=1e3*((a=_._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),_._hints.includes(Ft.LOW_STREAM)&&((c=_._encoderConfig)!==null&&c!==void 0&&c.frameRate&&(R.maxFramerate=to(_._encoderConfig.frameRate)),(l=_._encoderConfig)!==null&&l!==void 0&&l.scaleResolutionDownBy&&((u=_._encoderConfig)===null||u===void 0?void 0:u.scaleResolutionDownBy)>1&&(R.scaleResolutionDownBy=_._encoderConfig.scaleResolutionDownBy)),D("DSCP_TYPE")&&Ss()){const O=D("DSCP_TYPE");["very-low","low","medium","high"].includes(O)&&(R.networkPriority=O)}const C=p.sender.getParameters(),A=(o=C.encodings)===null||o===void 0?void 0:o[0];Et()&&!A&&(S.encodings=[R]),A&&Object.assign(A,R),Object.assign(C,S),await p.sender.setParameters(C)}}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const o=kt.exports.parse(t);return n.forEach((a,c)=>{const l=i[c],u=o.mediaDescriptions.find(f=>f.attributes.mid===l);u&&(ja(u,a),LA(u,a,this.store.codec))}),kt.exports.print(o)}mungReceiveAnswerSDP(t,n,i){const o=kt.exports.parse(t),a=o.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&i===Ie.AUDIO&&a.media.mediaType==="audio"&&Mo(a),kt.exports.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var i,o,a,c;const u=t[l],f=n[l];if(f instanceof Lt&&!f._hints.includes(Ft.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=f._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=f._scalabiltyMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=f._scalabiltyMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const p={},_={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const S=u.sender.getParameters();await u.sender.setParameters(Object.assign(S,p))}}}async applySimulcastEncodings(t,n){if(!Et()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof Lt&&this.isVP8Simulcast(o)){const a=t[i],c={},l={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,i,o,a;return!!(t instanceof Lt&&D("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(Ft.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=t._scalabiltyMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabiltyMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(D("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ct().supportPCSetConfiguration){const n=Sd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[xi],Object.getOwnPropertyDescriptor($e.prototype,"connect"),$e.prototype),G($e.prototype,"receive",[xi],Object.getOwnPropertyDescriptor($e.prototype,"receive"),$e.prototype),G($e.prototype,"batchReceive",[xi],Object.getOwnPropertyDescriptor($e.prototype,"batchReceive"),$e.prototype),G($e.prototype,"stopReceiving",[xi],Object.getOwnPropertyDescriptor($e.prototype,"stopReceiving"),$e.prototype),G($e.prototype,"muteRemote",[xi],Object.getOwnPropertyDescriptor($e.prototype,"muteRemote"),$e.prototype),G($e.prototype,"unmuteRemote",[xi],Object.getOwnPropertyDescriptor($e.prototype,"unmuteRemote"),$e.prototype),G($e.prototype,"muteLocal",[xi],Object.getOwnPropertyDescriptor($e.prototype,"muteLocal"),$e.prototype),G($e.prototype,"unmuteLocal",[xi],Object.getOwnPropertyDescriptor($e.prototype,"unmuteLocal"),$e.prototype),G($e.prototype,"close",[xi],Object.getOwnPropertyDescriptor($e.prototype,"close"),$e.prototype),G($e.prototype,"updateEncoderConfig",[xi],Object.getOwnPropertyDescriptor($e.prototype,"updateEncoderConfig"),$e.prototype),G($e.prototype,"updateSendParameters",[xi],Object.getOwnPropertyDescriptor($e.prototype,"updateSendParameters"),$e.prototype),G($e.prototype,"replaceTrack",[xi],Object.getOwnPropertyDescriptor($e.prototype,"replaceTrack"),$e.prototype),G($e.prototype,"getRemoteSSRC",[xi],Object.getOwnPropertyDescriptor($e.prototype,"getRemoteSSRC"),$e.prototype),$e);function xi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}function ZA(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=to(t.width),i.height=to(t.height);const o=to(t.framerate||15);document.body.append(n),document.body.append(i);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const c=i.getContext("2d");if(!c)throw new N(y.UNEXPECTED_ERROR,"can not get canvas context");const l=Ct(),u=i.captureStream(l.supportRequestFrame?0:o).getVideoTracks()[0],f=Ry(()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const _=n.videoWidth,S=n.videoHeight/_,R=i.width*S;Math.abs(R-i.height)>=2&&(v.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(R)),i.height=R)}c.drawImage(n,0,0,i.width,i.height),u.requestFrame&&u.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))})(),o),p=u.stop;return u.stop=()=>{p.call(u),f(),n&&(n.remove(),n=null),i&&(i.width=0,i.remove(),i=null),v.debug("clean low stream renderer")},u}var eO,tO,nO,iO,Vi,rO,oO,sO,aO,cO,dO,Cn;function lO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function yu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lO(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class uO extends gy{getUserId(){return this._userId}constructor(t,n,i,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(at(5,""))),m(this,"_userId",void 0),m(this,"_uintId",void 0),m(this,"_isDestroyed",!1),m(this,"store",void 0),m(this,"processor",void 0),m(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Iu=(eO=pe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),tO=pe({argsMap:e=>[e.getTrackId()]}),nO=pe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),iO=pe({argsMap:e=>[e.getTrackId()]}),G((Vi=class extends uO{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==pn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i){super(e,t,n,i),m(this,"_videoVisibleTimer",null),m(this,"_previousVideoVisibleStatus",void 0),m(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),m(this,"trackMediaType","video"),m(this,"_videoWidth",void 0),m(this,"_videoHeight",void 0),m(this,"_player",void 0),m(this,"processorDestination",void 0),m(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Ly(this.getTrackId(),"remote"),this.processorDestination=new Py(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Gc(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Qi(this,ge.GET_STATS)||yu({},XR)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=yu(yu({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new V_(n):this._player=new pC(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Oa.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Oa.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},D("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){NI(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(cu)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:a}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=zC.checkOneElementVisible(o),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new N(y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new N(y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(En.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(En.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[eO],Object.getOwnPropertyDescriptor(Vi.prototype,"play"),Vi.prototype),G(Vi.prototype,"stop",[tO],Object.getOwnPropertyDescriptor(Vi.prototype,"stop"),Vi.prototype),G(Vi.prototype,"pipe",[nO],Object.getOwnPropertyDescriptor(Vi.prototype,"pipe"),Vi.prototype),G(Vi.prototype,"unpipe",[iO],Object.getOwnPropertyDescriptor(Vi.prototype,"unpipe"),Vi.prototype),Vi),Cu=(rO=pe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),oO=pe({argsMap:(e,t)=>[e.getTrackId(),t]}),sO=pe({argsMap:e=>[e.getTrackId()]}),aO=pe({argsMap:e=>[e.getTrackId()]}),cO=pe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),dO=pe({argsMap:e=>[e.getTrackId()]}),G((Cn=class extends uO{get isPlaying(){return this._useAudioElement?ii.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),m(this,"trackMediaType","audio"),m(this,"_source",void 0),m(this,"_useAudioElement",!0),m(this,"_volume",100),m(this,"processorContext",void 0),m(this,"processorDestination",void 0),m(this,"_played",!1),m(this,"_bypassWebAudio",!1),D("DISABLE_WEBAUDIO")?(this._source=new I_,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new v_(e,!0),D("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Hn.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Oa.FIRST_FRAME_DECODED)}),this.processorContext=new My(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new ky(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Hn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Hn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Hn.ON_AUDIO_BUFFER),this._source.on(Hn.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?ii.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement)throw new N(y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ii.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Gc(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Qi(this,ge.GET_STATS)||yu({},JR)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),ii.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ii.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ii.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new N(y.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new N(y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new N(y.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(En.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(En.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(En.ON_TRACK),this.processorDestination.removeAllListeners(En.ON_NODE)}}).prototype,"setVolume",[rO],Object.getOwnPropertyDescriptor(Cn.prototype,"setVolume"),Cn.prototype),G(Cn.prototype,"setPlaybackDevice",[oO],Object.getOwnPropertyDescriptor(Cn.prototype,"setPlaybackDevice"),Cn.prototype),G(Cn.prototype,"play",[sO],Object.getOwnPropertyDescriptor(Cn.prototype,"play"),Cn.prototype),G(Cn.prototype,"stop",[aO],Object.getOwnPropertyDescriptor(Cn.prototype,"stop"),Cn.prototype),G(Cn.prototype,"pipe",[cO],Object.getOwnPropertyDescriptor(Cn.prototype,"pipe"),Cn.prototype),G(Cn.prototype,"unpipe",[dO],Object.getOwnPropertyDescriptor(Cn.prototype,"unpipe"),Cn.prototype),Cn);function hO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function pO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hO(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class nF extends ft{constructor(){super(),m(this,"uplinkStatsUploadInterval",void 0),m(this,"uplinkRelatedStatsUploadInterval",void 0),m(this,"uplinkDenoiserStatsUploadInterval",void 0),m(this,"transportStatsUploadInterval",void 0),m(this,"uplinkExtensionStatsUploadInterval",void 0),m(this,"downlinkExtensionStatsUploadInterval",void 0),m(this,"extensionUsageStatsUploadInterval",void 0),m(this,"downlinkStatsUploadInterval",void 0),m(this,"downlinkRelatedStatsUploadInterval",void 0),m(this,"lastStats",void 0),m(this,"uploadUnplinkStarted",!1),m(this,"uploadDownlinkStarted",!1),m(this,"uploadTransportStarted",!1),m(this,"uploadExtensionUsageStarted",!1),m(this,"requestStats",void 0),m(this,"requestLocalMedia",void 0),m(this,"requestRemoteMedia",void 0),m(this,"requestAllTracks",void 0),m(this,"requestVideoIsReady",void 0),m(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadTransportStats(n)},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var n,i,o;const a=Date.now(),c={connectionInterval:D("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let l=[];const u=((n=this.requestAllTracks)===null||n===void 0?void 0:n.call(this))||[];for(const S of u)!S.muted&&S.enabled&&(l=l.concat(await S.getProcessorUsage()));const f=((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[];for(const[S,R]of f)R.has(Ie.VIDEO)&&S.videoTrack&&(l=l.concat(await S.videoTrack.getProcessorUsage())),R.has(Ie.AUDIO)&&S.audioTrack&&(l=l.concat(await S.audioTrack.getProcessorUsage()));if(l.length===0)return;c.details=function(S,R){const C={};for(const{id:M,value:H,level:re,direction:Y}of S){var A;const J=(A=R.get(M))!==null&&A!==void 0?A:0,W=H===2?J+D("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:J;var O,k;R.set(M,W),C[M]?(H===2&&(C[M].value=H),re>C[M].level&&(C[M].level=re),Y==="remote"&&(C[M].remoteUidCount+=1),C[M].totalTs=(O=R.get(M))!==null&&O!==void 0?O:0):C[M]={value:H,level:re,remoteUidCount:Y==="local"?0:1,totalTs:(k=R.get(M))!==null&&k!==void 0?k:0}}return Object.keys(C).map(M=>{const{level:H,value:re,totalTs:Y}=C[M];return{id:M,level:H,value:re,totalTs:Y}})}(l,t);const p=Date.now(),_=p>a?p:a+1;(o=this.requestUpload)===null||o===void 0||o.call(this,ti.EXTENSION_USAGE_STATS,{usageStats:c,sendTs:_})},D("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&(this.uploadUplinkStats(n),this.lastStats=n)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadRelatedUplinkStats(n,this.lastStats),this.lastStats=n},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadDenoiserStats(n)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadExtensionStats(n)},2e3))}uploadTransportStats(t){Tr(()=>{var n;(n=this.requestUpload)===null||n===void 0||n.call(this,ti.TRANSPORT_STATS,function(i){const o={connectionType:100,googRtt:i.rtt};if(i.selectedCandidatePair.localCandidate.candidateType==="relay"){const a=i.selectedCandidatePair.localCandidate.relayProtocol;a==="udp"&&(o.connectionType=101),a==="tcp"&&(o.connectionType=103),a==="tls"&&(o.connectionType=104)}return o}(t))})}uploadUplinkStats(t){var n;(((n=this.requestLocalMedia)===null||n===void 0?void 0:n.call(this))||[]).forEach(i=>{let[o,{track:a,ssrcs:c}]=i;switch(o){case oe.LocalVideoLowTrack:case oe.LocalVideoTrack:{const l=function(p,_,S){var R;const C=_.videoSend.find(O=>O.ssrc===p);if(!C)return null;const A={id:at(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:C.ssrc.toString()};switch(A.A_vstd=S._originMediaStreamTrack&&!S._originMediaStreamTrack.enabled||S._mediaStreamTrack&&!S._mediaStreamTrack.enabled?"1":"0",C.sentFrame&&(A.A_fhs=C.sentFrame.height.toString(),A.A_frs=C.sentFrame.frameRate.toString(),A.A_fws=C.sentFrame.width.toString()),C.adaptionChangeReason){case"none":A.A_ac="0";break;case"cpu":A.A_ac="1";break;case"bandwidth":A.A_ac="2";break;case"other":A.A_ac="3"}return A.A_lvps=n_[S._player?S._player.videoElementStatus:"uninit"].toString(),A.A_nr=(R=C.nacksCount)===null||R===void 0?void 0:R.toString(),C.avgEncodeMs&&(A.A_aem=C.avgEncodeMs.toFixed(0).toString()),A}(c[0].ssrcId,t,a),u=o===oe.LocalVideoTrack?function(p,_,S){var R,C,A,O,k,M,H,re;const Y=_.videoSend.find(he=>he.ssrc===p);if(!Y)return null;const J={id:at(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Y.ssrc.toString()},W=(R=(C=(A=Y.inputFrame)===null||A===void 0?void 0:A.height)!==null&&C!==void 0?C:S==null?void 0:S._videoHeight)!==null&&R!==void 0?R:0,Q=(O=(k=(M=Y.inputFrame)===null||M===void 0?void 0:M.width)!==null&&k!==void 0?k:S==null?void 0:S._videoWidth)!==null&&O!==void 0?O:0,Be=(H=(re=Y.inputFrame)===null||re===void 0?void 0:re.frameRate)!==null&&H!==void 0?H:0;return W&&(J.A_fhi=W+""),Q&&(J.A_fwi=Q+""),Be&&(J.A_fri=Be+""),J}(c[0].ssrcId,t,a):null;l&&Tr(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,ti.PUBLISH_STATS,{stream_type:o===oe.LocalVideoLowTrack?"low":"high",stats:pO(pO({},l),u)})});const f=function(p){const _={id:"bweforvideo",timestamp:new Date(p.timestamp).toISOString(),type:"VideoBwe"};return p.bitrate.retransmit&&(_.A_rb=p.bitrate.retransmit.toString()),p.bitrate.targetEncoded&&(_.A_teb=p.bitrate.targetEncoded.toString()),_.A_aeb=p.bitrate.actualEncoded.toString(),_.A_tb=p.bitrate.transmit.toString(),p.sendBandwidth!==void 0&&(_.A_asb=p.sendBandwidth.toString()),_}(t);f&&setTimeout(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,ti.PUBLISH_STATS,{stream_type:o===oe.LocalVideoLowTrack?"low":"high",stats:f})},1e3);break}case oe.LocalAudioTrack:{const l=function(u,f,p){const _=f.audioSend.find(R=>R.ssrc===u);if(!_)return null;const S={id:at(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:_.ssrc.toString()};return S.A_astd=p._originMediaStreamTrack&&!p._originMediaStreamTrack.enabled||p._mediaStreamTrack&&!p._mediaStreamTrack.enabled?"1":"0",_.inputLevel?S.A_ail=Math.round(100*_.inputLevel).toString():S.A_ail=Math.round(100*p._source.getAccurateVolumeLevel()).toString(),S.A_apil=Math.round(100*p._source.getAccurateVolumeLevel()).toString(),_.aecReturnLoss&&(S.A_ecrl=Math.round(_.aecReturnLoss).toString()),_.aecReturnLossEnhancement&&(S.A_ecrle=Math.round(_.aecReturnLossEnhancement).toString()),S}(c[0].ssrcId,t,a);l&&Tr(()=>{var u;return(u=this.requestUpload)===null||u===void 0?void 0:u.call(this,ti.PUBLISH_STATS,{stream_type:"high",stats:l})});break}}})}uploadRelatedUplinkStats(t,n){var i;(((i=this.requestLocalMedia)===null||i===void 0?void 0:i.call(this))||[]).filter(o=>{let[a]=o;return a===oe.LocalVideoLowTrack||a===oe.LocalVideoTrack}).forEach(o=>{let[a,{ssrcs:c}]=o;const l=function(u,f){const p=f.videoSend.find(_=>_.ssrc===u);return p?{mediaType:"video",isVideoMute:!1,frameRateInput:p.inputFrame&&p.inputFrame.frameRate.toString(),frameRateSent:p.sentFrame&&p.sentFrame.frameRate.toString(),googRtt:p.rttMs.toString(),qpSumPerFrame:Math.floor(p.qpSumPerFrame).toString()}:null}(c[0].ssrcId,t);l&&Tr(()=>{var u;(u=this.requestUpload)===null||u===void 0||u.call(this,ti.PUBLISH_RELATED_STATS,{stream_type:a===oe.LocalVideoLowTrack?"low":"high",stats:l})})})}uploadDenoiserStats(t){for(let a=0;a<t.length;a++){const c=t[a];if(c instanceof ru){var n,i,o;const l=(n=(i=c._external).getDenoiserStats)===null||n===void 0?void 0:n.call(i);return void(l&&((o=this.requestUpload)===null||o===void 0||o.call(this,ti.DENOISER_STATS,l)))}}}uploadExtensionStats(t){for(let n=0;n<t.length;n++)t[n].getProcessorStats().forEach(i=>{var o;(o=this.requestUpload)===null||o===void 0||o.call(this,i.type,i.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let n=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);o&&(this.uploadDownlinkStats(o,n,t),t=o),n=!n},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);o&&(this.uploadRelatedDownlinkStats(o,this.lastStats),this.lastStats=o)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this);o&&this.uploadDownlinkExtensionStats(o)},2e3)}uploadDownlinkStats(t,n,i){var o;(((o=this.requestRemoteMedia)===null||o===void 0?void 0:o.call(this))||[]).forEach(a=>{let[c,l]=a;if(l.has(Ie.VIDEO)&&c.videoTrack){const u=c.videoTrack?function(f,p,_,S,R){const C=p.videoRecv.find(M=>M.ssrc===f);if(!C)return null;const A={id:at(10,""),timestamp:new Date(p.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:C.ssrc.toString()};var O,k;if(A.bytesReceived=C.bytes.toString(),A.packetsLost=C.packetsLost.toString(),A.packetsReceived=C.packets.toString(),C.framesRateFirefox&&(A.A_frr=C.framesRateFirefox.toString()),C.receivedFrame?(A.A_frr=C.receivedFrame.frameRate.toString(),A.A_fhr=C.receivedFrame.height.toString(),A.A_fwr=C.receivedFrame.width.toString()):(A.A_fhr=(O=S._videoHeight)===null||O===void 0?void 0:O.toString(),A.A_fwr=(k=S._videoWidth)===null||k===void 0?void 0:k.toString()),A.A_frd=C.decodeFrameRate.toString(),C.outputFrame&&(A.A_fro=C.outputFrame.frameRate.toString()),C.jitterBufferMs!==void 0&&(A.A_jbm=Math.floor(C.jitterBufferMs).toString()),C.currentDelayMs!==void 0&&(A.A_cdm=Math.floor(C.currentDelayMs).toString()),A.A_fs=C.firsCount.toString(),A.A_ns=C.nacksCount.toString(),A.A_ps=C.plisCount.toString(),S&&(A.A_vrtd=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?"0":"1"),S._player&&S._player.freezeTimeCounterList.length>0&&(A.A_vrft=Math.round(S._player.freezeTimeCounterList.splice(0,1)[0]).toString()),R&&S._player&&eo.visibility==="visible"){const M=Math.min(6e3,S._player.renderFreezeAccTime);A.A_vrrft=Math.round(M).toString(),S._player.renderFreezeAccTime=Math.max(0,S._player.renderFreezeAccTime-M)}if(A.A_rvps=n_[S._player?S._player.videoElementStatus:"uninit"].toString(),_){const M=_.videoRecv.find(H=>H.ssrc===f);if(M&&C.totalInterFrameDelay!==void 0&&C.totalSquaredInterFrameDelay!==void 0&&M.totalInterFrameDelay!==void 0&&M.totalSquaredInterFrameDelay!==void 0){const H=C.totalInterFrameDelay-M.totalInterFrameDelay,re=C.totalSquaredInterFrameDelay-M.totalSquaredInterFrameDelay,Y=C.framesDecodeCount-M.framesDecodeCount,J=H/Y*1e3,W=Math.round(1e3*Math.sqrt((re-Math.pow(H,2)/Y)/Y));!isNaN(W)&&J+W>Math.max(3*J,J+150)&&(A.A_ifdsd=W.toString())}}return A}(c._videoSSRC,t,i,c.videoTrack,n):void 0;u&&Tr(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,ti.SUBSCRIBE_STATS,{stream_id:c.uid,stats:u})})}if(l.has(Ie.AUDIO)&&c.audioTrack){const u=c.audioTrack?function(f,p,_,S){const R=p.audioRecv.find(A=>A.ssrc===f);if(!R)return null;const C={id:at(10,""),timestamp:new Date(p.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:R.ssrc.toString()};if(C.bytesReceived=R.bytes.toString(),C.packetsLost=R.packetsLost.toString(),C.packetsReceived=R.packets.toString(),R.outputLevel?C.A_aol=Math.round(100*R.outputLevel).toString():C.A_aol=Math.round(100*S._source.getAccurateVolumeLevel()).toString(),C.A_apol=Math.round(100*S._source.getAccurateVolumeLevel()).toString(),S&&(C.A_artd=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?"0":"1"),C.A_jr=R.jitterMs.toString(),C.A_jbm=Math.floor(R.jitterBufferMs).toString(),C.A_cdm=Math.floor(R.jitterBufferMs).toString(),C.A_raps=n_[ii.getPlayerState(S.getTrackId())].toString(),_){const A=_.audioRecv.find(O=>O.ssrc===f);if(A){const O=R.concealedSamples-A.concealedSamples;O>0&&(C.A_cs=Math.round(O).toString())}}return C}(c._audioSSRC,t,i,c.audioTrack):void 0;u&&Tr(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,ti.SUBSCRIBE_STATS,{stream_id:c.uid,stats:u})})}})}uploadRelatedDownlinkStats(t,n){var i;(((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[]).forEach(o=>{let[a,c]=o;if(c.has(Ie.VIDEO)&&a.videoTrack){var l;const u=(a._videoSSRC&&((l=this.requestVideoIsReady)===null||l===void 0?void 0:l.call(this,a._videoSSRC))||!1)===!0,f=function(p,_,S,R,C,A){const O=S.videoRecv.find(re=>re.ssrc===p),k=C?C.videoRecv.find(re=>re.ssrc===p):void 0;if(!O)return null;const M=Pa.isRemoteVideoFreeze(A,O,k)&&_,H={mediaType:"video",isVideoMute:!1,peerId:R,frameRateReceived:O.receivedFrame&&O.receivedFrame.frameRate.toString(),frameRateDecoded:O.decodedFrame&&O.decodedFrame.frameRate.toString(),isFreeze:M,bytesReceived:O.bytes.toString(),packetsReceived:O.packets.toString(),packetsLost:O.packetsLost.toString(),qpSumPerFrame:Math.floor(O.qpSumPerFrame).toString()};return O.framesRateFirefox&&(H.frameRateDecoded=O.framesRateFirefox.toString(),H.frameRateReceived=O.framesRateFirefox.toString()),H}(a._videoSSRC,u,t,a.uid,n,a.videoTrack);f&&Tr(()=>{var p;(p=this.requestUpload)===null||p===void 0||p.call(this,ti.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:f})})}if(c.has(Ie.AUDIO)&&a.audioTrack){const u=function(f,p,_,S){const R=p.audioRecv.find(A=>A.ssrc===f);if(!R)return null;const C=Pa.isRemoteAudioFreeze(S);return{mediaType:"audio",isAudioMute:!1,peerId:_,googJitterReceived:R.jitterMs.toString(),isFreeze:C,bytesReceived:R.bytes.toString(),packetsReceived:R.packets.toString(),packetsLost:R.packetsLost.toString(),frameReceived:R.receivedFrames.toString(),frameDropped:R.droppedFrames.toString()}}(a._audioSSRC,t,a.uid,a.audioTrack);u&&Tr(()=>{var f;(f=this.requestUpload)===null||f===void 0||f.call(this,ti.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:u})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach(n=>{let[i,o]=n;o.has(Ie.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(a=>{var c;(c=this.requestUpload)===null||c===void 0||c.call(this,a.type,a.stats)}),o.has(Ie.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(a=>{var c;(c=this.requestUpload)===null||c===void 0||c.call(this,a.type,a.stats)})})}}function fO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function _O(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fO(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const EO=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,Au="9",lE=2e4,uE=4e4;class iF{get localCapabilities(){return Pt(this._localCapabilities)}get rtpCapabilities(){return Pt(this._rtpCapabilities)}get candidates(){return Pt(this._candidates)}get iceParameters(){return Pt(this._iceParameters)}get dtlsParameters(){return Pt(this._dtlsParameters)}constructor(t){m(this,"sessionDesc",void 0),m(this,"_localCapabilities",void 0),m(this,"_rtpCapabilities",void 0),m(this,"_candidates",void 0),m(this,"_iceParameters",void 0),m(this,"_dtlsParameters",void 0),m(this,"setup",void 0),m(this,"currentMidIndex",void 0),m(this,"cname",void 0),m(this,"firefoxSsrcMidMap",new Map),t=Pt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,cname:u}=t,f=kt.exports.parse(EO);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=l,this.setup=c,this.cname=u;const p=this.rtpCapabilities.send;for(const _ of f.mediaDescriptions){if(_.attributes.iceUfrag=n.iceUfrag,_.attributes.icePwd=n.icePwd,_.attributes.fingerprints=i.fingerprints,_.attributes.candidates=o,_.attributes.setup=c,_.media.mediaType==="application"&&(_.attributes.sctpPort="5000"),_.media.mediaType==="video"&&(_.media.fmts=p.videoCodecs.map(S=>S.payloadType.toString(10)),_.attributes.payloads=p.videoCodecs,_.attributes.extmaps=p.videoExtensions,D("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:R}=Mi([{ssrcId:uE,rtx:D("USE_SUB_RTX")?40001:void 0}],this.cname);_.attributes.ssrcs=S,_.attributes.ssrcGroups=R}if(_.media.mediaType==="audio"&&(_.media.fmts=p.audioCodecs.map(S=>S.payloadType.toString(10)),_.attributes.payloads=p.audioCodecs,_.attributes.extmaps=p.audioExtensions,Mo(_),D("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:R}=Mi([{ssrcId:lE}],this.cname);_.attributes.ssrcs=S,_.attributes.ssrcGroups=R}}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const n=kt.exports.parse(EO);this._rtpCapabilities=t;const i=this.rtpCapabilities.send;for(const o of n.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"&&(o.media.fmts=i.videoCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=i.videoCodecs,o.attributes.extmaps=i.videoExtensions,D("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=Mi([{ssrcId:uE,rtx:D("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=c}if(o.media.mediaType==="audio"&&(o.media.fmts=i.audioCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=i.audioCodecs,o.attributes.extmaps=i.audioExtensions,D("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=Mi([{ssrcId:lE}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=c}}this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const n=this.candidates,i=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<t;c++){const l=2*c+lE,u=2*c+uE,{ssrcs:f,ssrcGroups:p}=Mi([{ssrcId:l}],this.cname),{ssrcs:_,ssrcGroups:S}=Mi([{ssrcId:u,rtx:D("USE_SUB_RTX")?u+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Au,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Au,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return kt.exports.print(this.sessionDesc)}send(t,n,i,o){const{ssrcs:a,ssrcGroups:c}=Mi(n,this.cname,D("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(a);if(l){if(Et()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),o&&(o.twcc||o.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,o),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,a);let f;return u===-1||wn()||Nn()||Kv()||u===0&&D("USE_SUB_RTX")?(f=this.createOrRecycleSendMedia(t,a,c,"sendonly",o),this.updateBundleMids()):(f=Pt(this.sessionDesc.mediaDescriptions[u]),f.attributes.direction="sendonly",f.attributes.ssrcs=a,f.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(f,o)),Et()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,f.attributes.mid),{mid:f.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:c,ssrcMsg:l,mslabel:u}=a;return this.send(c,l,u)}),i=[];let o=!1;return n.forEach(a=>{let{mid:c,needExchangeSDP:l}=a;l&&(o=!0),i.push(c)}),{mids:i,needExchangeSDP:o}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.mid==="0"||Et()||wn()||Nn()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,n,i,o){t.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,i,o[c])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===rn.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===n.connectionAddress&&i.port===n.port)===-1&&this._candidates.push(_O(_O({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Pt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Et()){if(o){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(t,n,i,o,a,c){const l=t._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,f=this.localCapabilities.send;let p=[];if(l===Ie.VIDEO){var _,S;if(D("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(p=u.videoCodecs.filter(k=>{var M,H;return(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"").includes(o)&&(k==null||(H=k.fmtp)===null||H===void 0?void 0:H.parameters["profile-level-id"])===D("H264_PROFILE_LEVEL_ID")})),!p||((_=p)===null||_===void 0?void 0:_.length)===0){const k=f.videoCodecs.filter(M=>{var H;return(((H=M.rtpMap)===null||H===void 0?void 0:H.encodingName.toLowerCase())||"").includes(o)});k.length!==0&&(p=u.videoCodecs.filter(M=>k.some(H=>H.payloadType===M.payloadType)))}if(D("USE_PUB_RTX")){const k=p.map(H=>H.payloadType.toString()),M=u.videoCodecs.filter(H=>{var re,Y;return((re=H.rtpMap)===null||re===void 0?void 0:re.encodingName)==="rtx"&&k.includes(((Y=H.fmtp)===null||Y===void 0?void 0:Y.parameters.apt)||"")});p=[...p,...M]}p.length===0&&(v.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat((S=u.videoCodecs[0].rtpMap)===null||S===void 0?void 0:S.encodingName)),p=u.videoCodecs)}else p=u.audioCodecs.filter(k=>{var M;return(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"").includes(a)}),p.length===0&&(v.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),p=u.audioCodecs.filter(k=>{var M;return(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"").includes("opus")}));const R=l===Ie.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const C="".concat(this.currentMidIndex);let A={media:{mediaType:l,port:Au,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(C)}};A=this.mungRecvMediaDsec(A,t,c);const O=this.findFirstClosedMedia(l);if(O){const k=this.sessionDesc.mediaDescriptions.indexOf(O);this.sessionDesc.mediaDescriptions[k]=A}else this.sessionDesc.mediaDescriptions.push(A);return A}createOrRecycleSendMedia(t,n,i,o,a){const c=this.rtpCapabilities.send,l=t===Ie.VIDEO?c.videoCodecs:c.audioCodecs,u=t===Ie.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let p={media:{mediaType:t,port:Au,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};p=this.mungSendMediaDesc(p,a);const _=this.findFirstClosedMedia(t);if(_){const S=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[S]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,i){const o=Pt(t);return rE(o),ja(o,n),oE(o,n),PA(o),Tu(o,i,this.localCapabilities.send),o}mungSendMediaDesc(t,n){const i=Pt(t);return Tu(i,n,this.localCapabilities.recv),Mo(i),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Et()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var i,o;return((i=n.attributes)===null||i===void 0||(o=i.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var ze;function mO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ou(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mO(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let rF=(G((ze=class dh extends $l{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n,i){super(t,n),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"remoteSDP",void 0),m(this,"initialOffer",void 0),m(this,"transportEventReceiver",void 0),m(this,"statsFilter",void 0),m(this,"localCapabilities",void 0),m(this,"localCandidateCount",0),m(this,"allCandidatesReceived",!1),m(this,"establishPromise",void 0),m(this,"mutex",new Pn("NVExtentionsConnection-mutex")),m(this,"rtcMedia",void 0),this.store=n,this.peerConnection=i,this.statsFilter=dE(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,Et()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=ks(n.sdp),o=await kA(!D("USE_PUB_RTX")&&!D("USE_SUB_RTX"),D("FILTER_VIDEO_FEC"),D("FILTER_AUDIO_FEC"));return this.localCapabilities=o,this.initialOffer=n,Ou(Ou({},i),{},{rtpCapabilities:o,offerSDP:n.sdp})}catch(n){throw new N(y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t,n,i,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new iF({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:sE(this.localCapabilities),cname:c});const l=this.remoteSDP.toString(),u=kt.exports.parse(this.initialOffer.sdp),f=u.mediaDescriptions.find(S=>S.media.mediaType==="audio");f&&Mo(f);const p=kt.exports.print(u),_=this.logSDPExchange(p||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),_==null||_(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new N(y.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(l.toString()))}}async updateRemoteConnect(t){var n,i,o;(n=this.remoteSDP)===null||n===void 0||n.updateRemoteRTPCapabilities(t),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);const a=(o=this.remoteSDP)===null||o===void 0?void 0:o.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),v.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,n,i){var o=this;return $i(function*(){const a=yield Pe(o.mutex.lock("From NVExtentionsConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const c=[];t.forEach(A=>{const O=o.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});c.push(O)}),Et()&&D("SIMULCAST")===!0&&(yield Pe(o.applySimulcastForFirefox(c,t)));const l=yield Pe(o.peerConnection.createOffer()),u=o.remoteSDP.predictReceivingMids(t.length),f=o.mungSendOfferSDP(l.sdp,t,u),p=kt.exports.parse(f),_=u.map(A=>{const O=p.mediaDescriptions.find(k=>k.attributes.mid===A);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return bA(O,D("USE_PUB_RTX"))});let S;try{S=yield _}catch(A){S=[],o.remoteSDP.receive(t,n,i,S);const O=o.remoteSDP.toString();throw yield Pe(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Pe(o.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield Pe(o.stopSending(u,!0)),A}o.remoteSDP.receive(t,n,i,S);const R=o.remoteSDP.toString(),C=o.logSDPExchange(f,"offer","local","send");return yield Pe(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Pe(o.applySimulcastEncodings(c,t)),yield Pe(o.applySendEncodings(c,t)),C==null||C(R),yield Pe(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),c.map((A,O)=>{const k=u[O];return{localSSRC:_[O],id:k,transceiver:A}})}catch(c){throw c instanceof N?c:new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");o.map(u=>{var f;u.direction="inactive",(f=u.stop)===null||f===void 0||f.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,o);if(c){const u=this.remoteSDP.toString(),f=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(p.sdp,a,t);f==null||f(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),v.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else v.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a}}catch(a){throw new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),v.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else v.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return n.map(o=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o}})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(y.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return $i(function*(){const i=yield Pe(n.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ct().supportPCSetConfiguration){const f=n.peerConnection.getConfiguration(),p=t===rn.RELAY?"relay":"all";f.iceTransportPolicy!==p&&(v.debug("restartICE change iceTransportPolicy from [".concat(f.iceTransportPolicy,"] to [").concat(p,"]")),f.iceTransportPolicy=p,n.peerConnection.setConfiguration(f))}else if(t===rn.RELAY)return;t!==rn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield Pe(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ks(o.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString(),u=n.logSDPExchange(o.sdp||"","offer","local","restartICE");yield Pe(n.peerConnection.setLocalDescription(o)),u==null||u(l),yield Pe(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(o){v.warning("restart ICE failed, abort operation",o)}finally{i()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new N(y.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Et()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return Ou(Ou({},ks(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...dh.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...dh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(su(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Ct().supportSetRtpSenderParameters||t.length!==n.length)return;for(let f=0;f<t.length;f++){const p=t[f],_=n[f];if(_&&_ instanceof Lt){var i,o;if(this.isVP8Simulcast(_))continue;const S={},R={};switch(_._optimizationMode){case"motion":S.degradationPreference="maintain-framerate";break;case"detail":S.degradationPreference="maintain-resolution";break;default:S.degradationPreference="balanced"}var a,c,l,u;if((i=_._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(R.maxBitrate=1e3*((a=_._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),_._hints.includes(Ft.LOW_STREAM)&&((c=_._encoderConfig)!==null&&c!==void 0&&c.frameRate&&(R.maxFramerate=to(_._encoderConfig.frameRate)),(l=_._encoderConfig)!==null&&l!==void 0&&l.scaleResolutionDownBy&&((u=_._encoderConfig)===null||u===void 0?void 0:u.scaleResolutionDownBy)>1&&(R.scaleResolutionDownBy=_._encoderConfig.scaleResolutionDownBy)),D("DSCP_TYPE")&&Ss()){const O=D("DSCP_TYPE");["very-low","low","medium","high"].includes(O)&&(R.networkPriority=O)}const C=p.sender.getParameters(),A=(o=C.encodings)===null||o===void 0?void 0:o[0];Et()&&!A&&(S.encodings=[R]),A&&Object.assign(A,R),Object.assign(C,S),await p.sender.setParameters(C)}}}catch{v.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,i){const o=kt.exports.parse(t);return n.forEach((a,c)=>{const l=i[c],u=o.mediaDescriptions.find(f=>f.attributes.mid===l);u&&(ja(u,a),LA(u,a,this.store.codec))}),kt.exports.print(o)}mungReceiveAnswerSDP(t,n,i){const o=kt.exports.parse(t),a=o.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&i===Ie.AUDIO&&a.media.mediaType==="audio"&&Mo(a),kt.exports.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var i,o,a,c;const u=t[l],f=n[l];if(f instanceof Lt&&!f._hints.includes(Ft.LOW_STREAM)&&(i=f._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=f._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=f._scalabiltyMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=f._scalabiltyMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const p={},_={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const S=u.sender.getParameters();await u.sender.setParameters(Object.assign(S,p))}}}async applySimulcastEncodings(t,n){if(!Et()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof Lt&&this.isVP8Simulcast(o)){const a=t[i],c={},l={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,i,o,a;return!!(t instanceof Lt&&D("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(Ft.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=t._scalabiltyMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabiltyMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(D("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(n," SDP during NVExtentionsConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ct().supportPCSetConfiguration){const n=dh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"connect"),ze.prototype),G(ze.prototype,"updateRemoteConnect",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"updateRemoteConnect"),ze.prototype),G(ze.prototype,"receive",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"receive"),ze.prototype),G(ze.prototype,"batchReceive",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"batchReceive"),ze.prototype),G(ze.prototype,"stopReceiving",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"stopReceiving"),ze.prototype),G(ze.prototype,"muteRemote",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"muteRemote"),ze.prototype),G(ze.prototype,"unmuteRemote",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"unmuteRemote"),ze.prototype),G(ze.prototype,"muteLocal",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"muteLocal"),ze.prototype),G(ze.prototype,"unmuteLocal",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"unmuteLocal"),ze.prototype),G(ze.prototype,"close",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"close"),ze.prototype),G(ze.prototype,"updateEncoderConfig",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"updateEncoderConfig"),ze.prototype),G(ze.prototype,"updateSendParameters",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"updateSendParameters"),ze.prototype),G(ze.prototype,"replaceTrack",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"replaceTrack"),ze.prototype),G(ze.prototype,"getRemoteSSRC",[vi],Object.getOwnPropertyDescriptor(ze.prototype,"getRemoteSSRC"),ze.prototype),ze);function vi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From NVExtentionsConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}var it;function gO(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=OA,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new hE(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function hE(e){function t(n){if(Object(n)!==n)return ie.reject(new TypeError(n+" is not an object."));var i=n.done;return ie.resolve(n.value).then(function(o){return{value:o,done:i}})}return(hE=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?ie.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?ie.reject(n):t(i.apply(this.s,arguments))}},new hE(e)}let xo=(G((it=class lh extends $l{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n){super(t,n),m(this,"store",void 0),m(this,"peerConnection",void 0),m(this,"cname",void 0),m(this,"mutex",new Pn("DataChannelConnection-mutex")),m(this,"dataChannel",void 0),m(this,"_p2pConnection",void 0),m(this,"establishPromise",void 0),m(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(lh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new rF(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const n=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(n)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,n,i,o,a,c){return this.cname=c,await this._p2pConnection.connect(t,n,i,o,a,c),await new ie((l,u)=>{const f=setTimeout(()=>{this.closeSignal(),u(new N(y.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(f),void l()},this.dataChannel.onerror=p=>{this.closeSignal(),u(p)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(t,n,i){var o=this;return $i(function*(){const a=yield Pe(o.mutex.lock("From DataChannelConnection.send"));try{return yield*Su(gO(o._p2pConnection.send(t,n,i)),Pe)}finally{a()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async receive(t,n,i,o){return this._nvMedia?(v.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(v.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,i,o))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return $i(function*(){return yield*Su(gO(n._p2pConnection.restartICE(t)),Pe)})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,i,o){if(D("SDP_LOGGING"))return v.upload("exchanging ".concat(i," ").concat(n," SDP during DataChannelConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Vc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...lh.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...lh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(su(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,i)=>{var o;return(o=this.onFirstVideoDecoded)===null||o===void 0?void 0:o.call(this,t,n,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}).prototype,"connect",[er],Object.getOwnPropertyDescriptor(it.prototype,"connect"),it.prototype),G(it.prototype,"receive",[er],Object.getOwnPropertyDescriptor(it.prototype,"receive"),it.prototype),G(it.prototype,"stopReceiving",[er],Object.getOwnPropertyDescriptor(it.prototype,"stopReceiving"),it.prototype),G(it.prototype,"muteRemote",[er],Object.getOwnPropertyDescriptor(it.prototype,"muteRemote"),it.prototype),G(it.prototype,"unmuteRemote",[er],Object.getOwnPropertyDescriptor(it.prototype,"unmuteRemote"),it.prototype),G(it.prototype,"muteLocal",[er],Object.getOwnPropertyDescriptor(it.prototype,"muteLocal"),it.prototype),G(it.prototype,"unmuteLocal",[er],Object.getOwnPropertyDescriptor(it.prototype,"unmuteLocal"),it.prototype),G(it.prototype,"close",[er],Object.getOwnPropertyDescriptor(it.prototype,"close"),it.prototype),G(it.prototype,"updateEncoderConfig",[er],Object.getOwnPropertyDescriptor(it.prototype,"updateEncoderConfig"),it.prototype),G(it.prototype,"updateSendParameters",[er],Object.getOwnPropertyDescriptor(it.prototype,"updateSendParameters"),it.prototype),G(it.prototype,"replaceTrack",[er],Object.getOwnPropertyDescriptor(it.prototype,"replaceTrack"),it.prototype),G(it.prototype,"getRemoteSSRC",[er],Object.getOwnPropertyDescriptor(it.prototype,"getRemoteSSRC"),it.prototype),it);function er(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From DataChannelConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}var Ve;function SO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Vo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?SO(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function TO(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=OA,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new pE(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function pE(e){function t(n){if(Object(n)!==n)return ie.reject(new TypeError(n+" is not an object."));var i=n.done;return ie.resolve(n.value).then(function(o){return{value:o,done:i}})}return(pE=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?ie.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?ie.reject(n):t(i.apply(this.s,arguments))}},new pE(e)}let oF=(G((Ve=class extends ft{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Me.StateChange,t,this._state)}constructor(e,t){super(),m(this,"store",void 0),m(this,"statsUploader",void 0),m(this,"connection",void 0),m(this,"localTrackMap",new Map),m(this,"remoteUserMap",new Map),m(this,"pendingLocalTracks",[]),m(this,"pendingRemoteTracks",[]),m(this,"statsCollector",void 0),m(this,"isPlanB",!1),m(this,"shouldForwardP2PCreation",void 0),m(this,"iceFailedCount",0),m(this,"dtlsFailedCount",0),m(this,"mutex",new Pn("P2PChannel-mutex")),m(this,"_state",Bt.Disconnected),m(this,"_pcStatsUploadType",D("NEW_ICE_RESTART")?gr.FIRST_CONNECTION:gr.OLD_FIRST_CONNECTION),m(this,"_isInRestartIce",!1),m(this,"_isStartRestartIce",!1),m(this,"_restartStates",["disconnected","failed"]),m(this,"_restartTimer",void 0),m(this,"_isFirstConnected",!0),m(this,"handleMuteLocalTrack",async(n,i,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Bt.Connected)return void o(new N(y.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(f=>f[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(f=>{let[,{id:p}]=f;return p}));const u=this.createMuteMessage(c);await St(this,Me.RequestMuteLocal,u),i()}catch(c){o(c)}finally{a()}}),m(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Bt.Connected)return void o(new N(y.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(f=>f[0]==="videoLowTrack");if(l){const f=l[1];if(f.track._originMediaStreamTrack.stop(),Ct().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();f.track._mediaStreamTrack=p,f.track._originMediaStreamTrack=p}else{const p=ZA(n,bs(this,Me.RequestLowStreamParameter));f.track._mediaStreamTrack=p,f.track._originMediaStreamTrack=p}await new ie((p,_)=>{this.handleReplaceTrack(f.track,p,_,!0)})}await this.connection.unmuteLocal(c.map(f=>{let[,{id:p}]=f;return p}));const u=this.createUnmuteMessage(c);await St(this,Me.RequestUnmuteLocal,u),i()}catch(c){o(c)}finally{a()}}),m(this,"handleUpdateVideoEncoder",async(n,i,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const c=this.localTrackMap.get(oe.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Bt.Connected)return void i();const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),await this.connection.updateEncoderConfig(l,u),this.emit(Me.UpdateVideoEncoder,u),i()}catch(c){o(c)}finally{a()}}),m(this,"handleSetOptimizationMode",async(n,i,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const c=this.localTrackMap.get(oe.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Bt.Connected)return;const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),i()}catch(c){o(c)}finally{a()}}),m(this,"handleReplaceTrack",async(n,i,o,a)=>{let c;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const f=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.connection||!f||this.state!==Bt.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,f[1].id)),this.isPlanB){const p=f[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(f[0],p)}if(f[0]===oe.LocalVideoTrack&&Ct().supportDualStreamEncoding){const p=this.localTrackMap.get(oe.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new ie((S,R)=>{this.handleReplaceTrack(p.track,S,R,!0)})}}i()}catch(f){o(f)}finally{var u;(u=c)===null||u===void 0||u()}}),m(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),m(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),m(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),m(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new nF,this.bindStatsUploaderEvents(),this.isPlanB=!Ct().supportUnifiedPlan||D("CHROME_FORCE_PLAN_B")&&Ss(),this.shouldForwardP2PCreation=D("FORWARD_P2P_CREATION")&&Ct().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new xo({},this.store):this.isPlanB?new td({},this.store):new ro({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Bt.New;const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new xo(e,this.store):this.isPlanB?new td(e,this.store):new ro(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new N(y.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=D("NEW_ICE_RESTART")?gr.FIRST_CONNECTION:gr.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,i,o,a){if(!this.connection)throw new N(y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof xo?this.connection.updateRemoteConnect(i):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,i,o,a),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bt.Connected)}async preConnect(e,t,n,i,o,a){if(!this.connection)throw new N(y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const c=await this.connection.connect(e,t,n,i,o,a);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bt.Connected,c}getEstablishParams(){if(this.connection instanceof xo)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(e,t,n){var i=this;return $i(function*(){const o=yield Pe(i.mutex.lock("From P2PChannel.publish"));try{if(!i.connection||i.state!==Bt.Connected){if(i.state===Bt.Disconnected)throw new N(y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const c=e.filter(l=>i.pendingLocalTracks.indexOf(l)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(c))}i.store.pubId=i.store.pubId+1,Pi.markPublishStart(i.store.clientId,i.store.pubId);const a=i.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield Pe(i.tryToUnmuteAudio(e)));yield*Su(TO(i.doPublish(i.connection,a)),Pe)}finally{o()}})()}doPublish(e,t){var n=this;return $i(function*(){t.forEach(f=>{let{track:p,type:_}=f;const S=Date.now();n.store.publish(p.getTrackId(),_===oe.LocalAudioTrack?"audio":"video",S)}),n.bindLocalTrackEvents(t);const i=yield Pe(e.send(t.map(f=>{let{track:p}=f;return p}),n.store.codec,n.store.audioCodec)),o=(yield Pe(i.next())).value,a=n.createGatewayPublishMessage(t,o);let c;try{c=yield a}catch(f){throw i.throw(f),(f==null?void 0:f.code)===y.WS_ABORT&&t.forEach(p=>{let{track:_}=p;n.pendingLocalTracks.indexOf(_)===-1&&n.pendingLocalTracks.push(_)}),n.unbindLocalTrackEvents(t),f}const l=n.mapPubResToRemoteConfig(a,c),u=(yield Pe(i.next(l))).value;t.forEach(f=>{let{type:p}=f;n.statsCollector.addLocalStats(p)}),n.assignLocalTracks(t,u),n.statsUploader.startUploadUplinkStats(),t.forEach(f=>{let{track:p,type:_}=f;const S=Date.now();n.store.publish(p.getTrackId(),_===oe.LocalAudioTrack?"audio":"video",void 0,S)})})()}publishLowStream(e){var t=this;return $i(function*(){if(!t.connection||t.state!==Bt.Connected)return;const n=yield Pe(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(oe.LocalVideoTrack);if(!o)throw new N(y.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(oe.LocalVideoLowTrack))throw new N(y.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:t.getLowVideoTrack(o.track,e),type:oe.LocalVideoLowTrack}];if(yield*Su(TO(t.doPublish(t.connection,a)),Pe),o.track.muted||!o.track.enabled){var i;const c=(i=t.localTrackMap.get(oe.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield Pe(t.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Sn(this,Me.RequestRePublish,this.pendingLocalTracks),this.emit(Me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==Ie.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==Ie.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Sn(this,Me.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Ie.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Me.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Bt.Connected)return void e.forEach(i=>{const o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishLowStream(){if(!this.connection||this.state!==Bt.Connected)return;const e=this.localTrackMap.get(oe.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[oe.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[o,{track:a}]=i;return{type:o,track:a}})),t.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),n}async subscribe(e,t,n,i,o){var a;if(!this.connection||this.state!==Bt.Connected)throw new N(y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let c,l,u;if(o){const _=o.find(R=>{let{stream_type:C}=R;return C===t});if(!_)throw new N(y.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const S=await this.connection.receive(t,_.ssrcs,String(e._uintid),_.attributes);this.connection instanceof ro&&(u=S.transceiver),c=S.track,l=S.id}else{const _=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);this.connection instanceof ro&&(u=_.transceiver),c=_.track,l=_.id}t===Ie.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new Cu(c,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new Iu(c,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack));const f=this.remoteUserMap.get(e);f?f.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats();const p=this.pendingRemoteTracks.findIndex(_=>{let{user:S,kind:R}=_;return S.uid===e.uid&&t===R});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Me.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Bt.Connected)throw new N(y.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var i;let{user:o,mediaType:a}=n;return!((i=this.remoteUserMap.get(o))!==null&&i!==void 0&&i.has(a))});const t=await this.connection.batchReceive(e.map(n=>{let{user:i,mediaType:o,ssrcId:a,rtxSsrcId:c}=n;return{kind:o,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(i._uintid)}}));e.forEach((n,i)=>{let{user:o,mediaType:a}=n;const{track:c,id:l,transceiver:u}=t[i];a===Ie.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(c):(o._audioTrack=new Cu(c,o.uid,o._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),u&&o._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(c):(o._videoTrack=new Iu(c,o.uid,o._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),u&&o._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(o,o._videoTrack));const f=this.remoteUserMap.get(o);f?f.set(a,l):this.remoteUserMap.set(o,new Map([[a,l]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadDownlinkStats();const p=this.pendingRemoteTracks.findIndex(_=>{let{user:S,kind:R}=_;return S.uid===o.uid&&a===R});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Me.MediaReconnectEnd,o.uid))})}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Bt.Connected||n||i.forEach(c=>{let{kind:l}=c;var u;if(l===Ie.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===Ie.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Bt.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),o.forEach(c=>{let[l,{kind:u}]=c;var f,p;if(u===Ie.VIDEO&&l._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===Ie.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(u===Ie.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0)}}),a}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:a}of e){const c=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:f}=l;return a!==void 0?u.uid===o.uid&&a===f:u.uid===o.uid});c.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),t=t.concat(c)}if(!this.connection||this.state!==Bt.Connected)return void t.forEach(o=>{let{user:a,kind:c}=o;var l;if(c===Ie.AUDIO)(l=a._audioTrack)===null||l===void 0||l._destroy(),a._audioTrack=void 0;else if(c===Ie.VIDEO){var u;(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0}});const n=Ro(e).call(e,(o,a)=>{let{user:c,mediaType:l}=a;const u=this.filterTobeUnSubscribedTracks(c,l);return o.concat(u)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:a}]=o;return a}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),n.forEach(o=>{let[a,{kind:c}]=o;var l,u;if(c===Ie.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===Ie.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0;else if(c===Ie.AUDIO){var f;this.unbindRemoteTrackEvents(a._audioTrack),(f=a._audioTrack)===null||f===void 0||f._destroy(),a._audioTrack=void 0}}),i}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Ie.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(oe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Yn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==oe.LocalAudioTrack}).filter(i=>{let[o]=i;return!(e&&o===oe.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===oe.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,o){if(e){const c=this.localTrackMap.get(oe.LocalAudioTrack),l=i?this.localTrackMap.get(oe.LocalVideoLowTrack):this.localTrackMap.get(oe.LocalVideoTrack);se.publish(this.store.sessionId,{eventElapse:Pi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Ft.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var a;n||(n=[]);const c=n.find(u=>u instanceof mn),l=i?(a=this.localTrackMap.get(oe.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(u=>u instanceof Lt);se.publish(this.store.sessionId,{eventElapse:Pi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Ft.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,i){const o=i===Ie.VIDEO?n._videoSSRC:n._audioSSRC;o&&se.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Ie.VIDEO,audio:i===Ie.AUDIO,peerid:n.uid,subscribeRequestid:i===Ie.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Pi.measureFromSubscribeStart(this.store.clientId,o)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Pn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new xo({},this.store):this.isPlanB?new td({},this.store):new ro({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(oe.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Yn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Bt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(oe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(oe.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Lt||t&&t.track instanceof mn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(As(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(oe.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=$f(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Bt.Reconnecting,D("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new xo({},this.store):this.isPlanB?new td({},this.store):new ro({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;switch(t){case oe.LocalVideoTrack:n._hints.includes(Ft.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case oe.LocalAudioTrack:n instanceof Yn?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);break;case oe.LocalVideoLowTrack:}}),this.emit(Me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(As(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((e instanceof j_?e.uid:e)===i.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return $i(function*(){if(!t.connection||t.state!==Bt.Connected||t.connection instanceof xo)return;const n=yield Pe(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Pe(t.connection.restartICE(e));const a=yield Pe(i.next());if(a.done)return;const c=a.value,l=yield c;switch(t.reportPCDisconnectedOrFailed(e),e){case rn.TCP:t._pcStatsUploadType=gr.TCP_RESTART;break;case rn.RELAY:t._pcStatsUploadType=gr.RELAY_RESTART;break;default:t._pcStatsUploadType=gr.OLD_RESTART}t._isInRestartIce=!0,i.next(l)}catch(a){var o;(o=i)===null||o===void 0||o.throw(a)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(oe.LocalVideoTrack),n=this.localTrackMap.get(oe.LocalAudioTrack),i=e.videoSend.find(R=>R.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),o=e.audioSend.find(R=>R.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!o)return 1;const a=Qi(this,Me.NeedSignalRTT),c=i?i.rttMs:void 0,l=o?o.rttMs:void 0,u=c&&l?(c+l)/2:c||l,f=(u&&a?(u+a)/2:u||a)||0,p=100*e.sendPacketLossRate*.7/50+.3*f/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(Ft.SCREEN_TRACK)===-1){const R=S._encoderConfig.bitrateMax,C=e.bitrate.actualEncoded;if(R&&C){const A=(1e3*R-C)/(1e3*R);return Mx[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,a=i._videoSSRC,c=e.audioRecv.find(C=>C.ssrc===o),l=e.videoRecv.find(C=>C.ssrc===a);if(!c&&!l)return void(t+=1);const u=Qi(this,Me.NeedSignalRTT),f=e.rtt,p=(f&&u?(f+u)/2:f||u)||0,_=c?c.jitterMs:void 0,S=e.recvPacketLossRate;let R=.7*S*100/50+.3*p/1500;_&&(R=.6*S*100/50+.2*p/1500+.2*_/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ie((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],o=Ct(),a=this.getAllTracks();e=bI(e=e.filter(u=>a.indexOf(u)===-1));let c=!1,l=!1;for(const u of e){if(u instanceof Lt&&(this.localTrackMap.has(oe.LocalVideoTrack)||c?new N(y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:oe.LocalVideoTrack}),c=!0),t)){const f=this.getLowVideoTrack(u,n);i.push({track:f,type:oe.LocalVideoLowTrack})}if(u instanceof mn){const f=this.localTrackMap.get(oe.LocalAudioTrack);if(f){if(!(f.track instanceof Yn))throw new N(y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new N(y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const p=i.find(_=>{let{type:S}=_;return S===oe.LocalAudioTrack});if(!(p.track instanceof Yn))throw new N(y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new N(y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u)}else{if(!o.webAudioMediaStreamDest||u instanceof Yn||u._bypassWebAudio)i.push({track:u,type:oe.LocalAudioTrack});else{const p=new Yn;p.addAudioTrack(u),i.push({track:p,type:oe.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=bI(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof mn){const o=this.localTrackMap.get(oe.LocalAudioTrack);if(!o)continue;o.track instanceof Yn?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(t.push([oe.LocalAudioTrack,o]),o.track.close())):t.push([oe.LocalAudioTrack,o])}if(i instanceof Lt){const o=this.localTrackMap.get(oe.LocalVideoTrack);if(!o)continue;t.push([oe.LocalVideoTrack,o]);const a=this.localTrackMap.get(oe.LocalVideoLowTrack);a&&t.push([oe.LocalVideoLowTrack,a])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case oe.LocalVideoTrack:n.addListener(ge.GET_STATS,this.handleGetLocalVideoStats),n.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(ge.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case oe.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);break;case oe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Yn?e.trackList.forEach(n=>{n.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),n.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case oe.LocalVideoTrack:n.off(ge.GET_STATS,this.handleGetLocalVideoStats),n.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(ge.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case oe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);break;case oe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Yn?e.trackList.forEach(t=>{t.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ge.GET_STATS,this.handleGetLocalAudioStats),t.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ge.GET_STATS,this.handleGetLocalAudioStats),e.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Iu&&t.addListener(ge.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Cu&&t.addListener(ge.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Ie.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Ie.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{let o,a,{track:c,type:l}=n;switch(l){case oe.LocalAudioTrack:o=xt.Audio,a={dtx:c instanceof ru&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case oe.LocalVideoTrack:o=c._hints.includes(Ft.SCREEN_TRACK)?xt.Screen:xt.High,a=Vo(Vo({},AI(c)),{},{codec:this.store.codec});break;case oe.LocalVideoLowTrack:o=xt.Low,a=Vo(Vo({},AI(c)),{},{codec:this.store.codec})}return{stream_type:o,attributes:a,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{let n,[i,{track:o,ssrcs:a,id:c}]=t;switch(i){case oe.LocalVideoTrack:n=o._hints.includes(Ft.SCREEN_TRACK)?xt.Screen:xt.High;break;case oe.LocalAudioTrack:n=xt.Audio;break;case oe.LocalVideoLowTrack:n=xt.Low}return{stream_type:n,ssrcs:a,mid:c}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:o,type:a}=n;this.localTrackMap.set(a,{track:o,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Me.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),D("NEW_ICE_RESTART")){if(this._restartStates.includes(t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=a=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(a)),Qi(this,Me.QueryClientConnectionState)==="CONNECTED"&&this.emit(Me.RequestRestartICE,a))},i=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o=D("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(D("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ct().supportPCSetConfiguration)n(rn.RELAY),this._restartTimer=window.setTimeout(i,o);else if(Et())n(rn.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(n(rn.TCP),Ct().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{n(rn.RELAY),this._restartTimer=window.setTimeout(i,o)},o));this._restartTimer=window.setTimeout(i,o)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&D("ICE_RESTART")&&Qi(this,Me.QueryClientConnectionState)==="CONNECTED"&&this.emit(Me.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Me.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:ut.TRACER}).onSuccess(),this.emit(Me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(As(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(Oa.FIRST_FRAME_DECODED),se.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_DECODE,_t.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(As(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);i&&se.firstRemoteFrame(this.store.sessionId,nn.FIRST_AUDIO_RECEIVED,_t.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(As(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&se.firstRemoteFrame(this.store.sessionId,nn.FIRST_VIDEO_RECEIVED,_t.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(Me.ConnectionTypeChange,i),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(au(n))," -> ").concat(JSON.stringify(au(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(au(n))," -> ").concat(JSON.stringify(au(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(oe.LocalAudioTrack);if(e instanceof mn&&(n==null?void 0:n.track)instanceof Yn)return n.track.isActive||t.push([oe.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(i&&(t.push(i),i[0]===oe.LocalVideoTrack)){const o=this.localTrackMap.get(oe.LocalVideoLowTrack);o&&t.push([oe.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(oe.LocalAudioTrack);if(e instanceof mn&&(n==null?void 0:n.track)instanceof Yn)return n.track.isActive&&t.push([oe.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(i)if(i[0]===oe.LocalVideoTrack){t.push(i);const o=this.localTrackMap.get(oe.LocalVideoLowTrack);o&&t.push([oe.LocalVideoLowTrack,o])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{let n,[i,{track:o,ssrcs:a,id:c}]=t;switch(i){case oe.LocalAudioTrack:n=xt.Audio;break;case oe.LocalVideoTrack:n=o._hints.includes(Ft.SCREEN_TRACK)?xt.Screen:xt.High;break;case oe.LocalVideoLowTrack:n=xt.Low}return{stream_type:n,ssrcs:a,mid:c}})}createUnmuteMessage(e){return e.map(t=>{let n,[i,{track:o,ssrcs:a,id:c}]=t;switch(i){case oe.LocalAudioTrack:n=xt.Audio;break;case oe.LocalVideoTrack:n=o._hints.includes(Ft.SCREEN_TRACK)?xt.Screen:xt.High;break;case oe.LocalVideoLowTrack:n=xt.Low}return{stream_type:n,ssrcs:a,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const o=i.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(i.entries()).forEach(o=>{let[a,c]=o;n.push([e,{kind:a,id:c}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:o,id:a}]=n;switch(o){case Ie.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Ie.VIDEO,ssrcId:i._videoSSRC}));case Ie.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Ie.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:o}]=n;if(t.has(i)){let a=t.get(i);o===Ie.VIDEO?a|=bt.Video:a|=bt.Audio,t.set(i,a)}else o===Ie.VIDEO?t.set(i,bt.Video):t.set(i,bt.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,o]=n;return{stream_id:i.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(oe.LocalVideoTrack),n=this.localTrackMap.get(oe.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((n,i)=>{var o;let{stream_type:a}=n;return(o=t.find(c=>{let{stream_type:l}=c;return a===l}))===null||o===void 0?void 0:o.attributes})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof mn){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(a=>{let[,{id:c}]=a;return c})));const o=this.createUnmuteMessage(i);return void await St(this,Me.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Me.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await gn(Gf(this.dtlsFailedCount,wt)),this.emit(Me.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Sn(this,Me.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Me.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(oe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Lt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Lt).length>1)throw new N(y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof mn).length>1&&(e.some(t=>t instanceof mn&&t._bypassWebAudio)||!Ct().webAudioMediaStreamDest))throw new N(y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Lt&&this.pendingLocalTracks.some(n=>n instanceof Lt))throw new N(y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof mn&&this.pendingLocalTracks.some(n=>n instanceof mn)&&(!Ct().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof mn&&n._bypassWebAudio)))throw new N(y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=Ct().supportDualStreamEncoding,i=Vo(Vo({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=n?e._mediaStreamTrack.clone():ZA(e,i);const a=at(8,"track-low-"),c=new Lt(o,Vo(Vo({},n&&{scaleResolutionDownBy:VV(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return c.on(jc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,Aa.LOW_STREAM)}),c._hints.push(Ft.LOW_STREAM),e.addListener(ge.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof ro){var o,a,c,l;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:p,peerConnectionState:_}=this.connection,{local:S,remote:R}=await this.connection.getSelectedCandidatePair();se.pcStats(this.store.sessionId,{startTime:u,eventElapse:e-u||0,iceconnectionsate:f,dtlsstate:p,connectionstate:_,intSucc:t?1:2,error:i,selectedLocalCandidateProtocol:(o=S==null?void 0:S.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(a=S.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(c=R.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=R.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(R.address,":").concat(R.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,i){var o;const a=Array.from(As(o=this.remoteUserMap).call(o)).find(c=>c._videoSSRC===e);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");se.firstRemoteVideoDecode(this.store.sessionId,nn.FIRST_VIDEO_DECODE,_t.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:Pi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const o=i.get(t);if(!o)return!1;const a=await this.connection.getRemoteSSRC(o);return a!==void 0&&a!==n}resetConnection(e){v.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===Bt.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===Xl.datachannel?new xo({},this.store):this.isPlanB?new td({},this.store):new ro({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===oe.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Aa.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof ro&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===gr.TCP_RESTART&&e===rn.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,gr.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"startP2PConnection"),Ve.prototype),G(Ve.prototype,"connect",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"connect"),Ve.prototype),G(Ve.prototype,"preConnect",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"preConnect"),Ve.prototype),G(Ve.prototype,"unpublish",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"unpublish"),Ve.prototype),G(Ve.prototype,"unpublishLowStream",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"unpublishLowStream"),Ve.prototype),G(Ve.prototype,"subscribe",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"subscribe"),Ve.prototype),G(Ve.prototype,"massSubscribe",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"massSubscribe"),Ve.prototype),G(Ve.prototype,"unsubscribe",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"unsubscribe"),Ve.prototype),G(Ve.prototype,"massUnsubscribe",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"massUnsubscribe"),Ve.prototype),G(Ve.prototype,"muteRemote",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"muteRemote"),Ve.prototype),G(Ve.prototype,"unmuteRemote",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"unmuteRemote"),Ve.prototype),G(Ve.prototype,"hasRemoteMediaWithLock",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"hasRemoteMediaWithLock"),Ve.prototype),G(Ve.prototype,"disconnectForReconnect",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"disconnectForReconnect"),Ve.prototype),G(Ve.prototype,"updateBitrateLimit",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"updateBitrateLimit"),Ve.prototype),G(Ve.prototype,"remoteMediaSsrcChanged",[ri],Object.getOwnPropertyDescriptor(Ve.prototype,"remoteMediaSsrcChanged"),Ve.prototype),Ve);function ri(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}function vO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vO(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Ne;(function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(Ne||(Ne={}));class sF{constructor(t,n,i,o){m(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:i,clientId:o,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(t){this.state=function(n,i){switch(i.type){case Ne.SET_SESSION_ID:return ae(ae({},n),{},{sessionId:i.sessionId});case Ne.SET_P2P_ID:return ae(ae({},n),{},{p2pId:i.p2pId});case Ne.SET_UID:return ae(ae({},n),{},{uid:i.uid});case Ne.SET_PUB_ID:return ae(ae({},n),{},{pubId:i.pubId});case Ne.KEY_METRIC_CLIENT_CREATED:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{clientCreated:i.metric})});case Ne.KEY_METRIC_JOIN_START:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{joinStart:i.metric})});case Ne.AVOID_JOIN_START:return ae(ae({},n),{},{avoidJoinStart:i.avoidJoinStart});case Ne.KEY_METRIC_JOIN_END:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{joinEnd:i.metric})});case Ne.KEY_METRIC_REQUEST_AP_START:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{requestAPStart:i.metric})});case Ne.KEY_METRIC_REQUEST_AP_END:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{requestAPEnd:i.metric})});case Ne.KEY_METRIC_JOIN_GATEWAY_START:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{joinGatewayStart:i.metric})});case Ne.KEY_METRIC_JOIN_GATEWAY_END:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{joinGatewayEnd:i.metric})});case Ne.KEY_METRIC_PEER_CONNECTION_START:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{peerConnectionStart:i.metric})});case Ne.KEY_METRIC_PEER_CONNECTION_END:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{peerConnectionEnd:i.metric})});case Ne.KEY_METRIC_DESCRIPTION_START:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{descriptionStart:i.metric})});case Ne.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{signalChannelOpen:i.metric})});case Ne.KEY_METRIC_ICE_CONNECTION_END:return ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{iceConnectionEnd:i.metric})});case Ne.KEY_METRIC_PUBLISH:{const o=n.keyMetrics.publish,a=o.findIndex(c=>c.trackId===i.metric.trackId);return a!==-1?(o[a]=ae(ae({},o[a]),i.metric),ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{publish:[...o]})})):ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,i.metric]})})}case Ne.KEY_METRIC_SUBSCRIBE:{const o=n.keyMetrics.subscribe,a=o.findIndex(c=>c.userId===i.metric.userId&&c.type===i.metric.type);return a!==-1?(o[a]=ae(ae({},o[a]),i.metric),ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{subscribe:[...o]})})):ae(ae({},n),{},{keyMetrics:ae(ae({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,i.metric]})})}case Ne.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=i.mode,n;case Ne.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,i.record]:(n.joinChannelServiceRecords[i.index]=ae(ae({},n.joinChannelServiceRecords[i.index]),i.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case Ne.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case Ne.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case Ne.SET_USE_DATACHANNEL:return ae(ae({},n),{},{useDataChannel:i.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:Ne.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:Ne.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:Ne.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:Ne.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:Ne.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:Ne.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:Ne.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:Ne.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ne.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ne.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ne.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ne.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ne.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ne.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ne.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ne.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ne.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ne.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ne.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,i,o){this.dispatch({type:Ne.KEY_METRIC_PUBLISH,metric:ae(ae({trackId:t,type:n},i&&{publishStart:i}),o&&{publishEnd:o})})}subscribe(t,n,i,o,a,c,l){this.dispatch({type:Ne.KEY_METRIC_SUBSCRIBE,metric:ae(ae(ae(ae(ae({userId:t,type:n},i&&{subscribeStart:i}),o&&{subscribeEnd:o}),a&&{firstFrame:a}),c&&{streamAdded:c}),l&&{firstDecoded:l})})}massSubscribe(t,n,i,o){t.forEach(a=>{this.dispatch({type:Ne.KEY_METRIC_SUBSCRIBE,metric:ae(ae(ae({userId:a.userId,type:a.type},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),o&&{firstFrame:o})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:Ne.RECORD_JOIN_CHANNEL_SERVICE,record:ae(ae({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ne.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ne.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ne.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:Ne.AVOID_JOIN_START,avoidJoinStart:t})}}let wu;const aF=()=>(wu||wu||(wu=(window.location.protocol.split(":")[0]||"").toUpperCase(),wu))==="HTTPS",RO=()=>window.isSecureContext!==void 0;function cF(e){let t=CO();return function(n,i){let o=n.appId;o!==void 0&&(Fe(i,10),jr(i,o));let a=n.cid;a!==void 0&&(Fe(i,16),Fe(i,a));let c=n.cname;c!==void 0&&(Fe(i,26),jr(i,c));let l=n.deviceId;l!==void 0&&(Fe(i,34),jr(i,l));let u=n.elapse;u!==void 0&&(Fe(i,40),jo(i,u));let f=n.fileSize;f!==void 0&&(Fe(i,48),jo(i,Ba(f)));let p=n.height;p!==void 0&&(Fe(i,56),jo(i,Ba(p)));let _=n.jpg;_!==void 0&&(Fe(i,66),Fe(i,_.length),function(qn,x){let K=Ga(qn,x.length);qn.bytes.set(x,K)}(i,_));let S=n.networkType;S!==void 0&&(Fe(i,72),jo(i,Ba(S)));let R=n.osType;R!==void 0&&(Fe(i,80),jo(i,Ba(R)));let C=n.requestId;C!==void 0&&(Fe(i,90),jr(i,C));let A=n.sdkVersion;A!==void 0&&(Fe(i,98),jr(i,A));let O=n.sequence;O!==void 0&&(Fe(i,104),jo(i,Ba(O)));let k=n.sid;k!==void 0&&(Fe(i,114),jr(i,k));let M=n.timestamp;M!==void 0&&(Fe(i,120),jo(i,M));let H=n.uid;H!==void 0&&(Fe(i,128),Fe(i,H));let re=n.vid;re!==void 0&&(Fe(i,136),Fe(i,re));let Y=n.width;Y!==void 0&&(Fe(i,144),jo(i,Ba(Y)));let J=n.service;J!==void 0&&(Fe(i,152),Fe(i,J));let W=n.callbackData;W!==void 0&&(Fe(i,162),jr(i,W));let Q=n.jpgEncryption;Q!==void 0&&(Fe(i,168),Fe(i,Q));let Be=n.requestType;Be!==void 0&&(Fe(i,176),Fe(i,Be));let he=n.scorePorn;he!==void 0&&(Fe(i,185),gE(i,he));let rt=n.scoreSexy;rt!==void 0&&(Fe(i,193),gE(i,rt));let Xe=n.scoreNeutral;Xe!==void 0&&(Fe(i,201),gE(i,Xe));let Ot=n.scene;Ot!==void 0&&(Fe(i,208),Fe(i,Ot));let sn=n.ossFilePrefix;sn!==void 0&&(Fe(i,218),jr(i,sn));let yt=n.serviceVendor;if(yt!==void 0)for(let qn of yt){Fe(i,226);let x=CO();uF(qn,x),Fe(i,x.limit),_F(i,x),fF(x)}}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function dF(e){return function(n){let i={};e:for(;!AO(n);){let o=Fr(n);switch(o>>>3){case 0:break e;case 1:i.code=Fr(n);break;case 2:i.msg=OO(n,Fr(n));break;case 3:{let a=hF(n);i.data=lF(n),n.limit=a;break}default:yO(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function lF(e){let t={};e:for(;!AO(e);){let n=Fr(e);switch(n>>>3){case 0:break e;case 1:t.requestId=OO(e,Fr(e));break;case 2:t.requestType=Fr(e)>>>0;break;case 3:t.scorePorn=mE(e);break;case 4:t.scoreSexy=mE(e);break;case 5:t.scoreNeutral=mE(e);break;case 6:t.requestScene=Fr(e)>>>0;break;case 7:t.scene=Fr(e)>>>0;break;default:yO(e,7&n)}}return t}function uF(e,t){let n=e.service;n!==void 0&&(Fe(t,8),Fe(t,n));let i=e.vendor;i!==void 0&&(Fe(t,16),Fe(t,i));let o=e.token;o!==void 0&&(Fe(t,26),jr(t,o));let a=e.callbackUrl;a!==void 0&&(Fe(t,34),jr(t,a))}function hF(e){let t=Fr(e),n=e.limit;return e.limit=e.offset+t,n}function yO(e,t){switch(t){case 0:for(;128&wO(e););break;case 2:_E(e,Fr(e));break;case 5:_E(e,4);break;case 1:_E(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let pF=new Float32Array(1);new Uint8Array(pF.buffer);let fE=new Float64Array(1),zn=new Uint8Array(fE.buffer);function Ba(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let IO=[];function CO(){const e=IO.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function fF(e){IO.push(e)}function _E(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function AO(e){return e.offset>=e.limit}function Ga(e,t){let n=e.bytes,i=e.offset,o=e.limit,a=i+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>o&&(e.limit=a),i}function EE(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function OO(e,t){let n=EE(e,t),i=String.fromCharCode,o=e.bytes,a="�",c="";for(let l=0;l<t;l++){let u,f,p,_,S=o[l+n];128&S?(224&S)==192?l+1>=t?c+=a:(u=o[l+n+1],(192&u)!=128?c+=a:(_=(31&S)<<6|63&u,_<128?c+=a:(c+=i(_),l++))):(240&S)==224?l+2>=t?c+=a:(u=o[l+n+1],f=o[l+n+2],(49344&(u|f<<8))!=32896?c+=a:(_=(15&S)<<12|(63&u)<<6|63&f,_<2048||_>=55296&&_<=57343?c+=a:(c+=i(_),l+=2))):(248&S)==240?l+3>=t?c+=a:(u=o[l+n+1],f=o[l+n+2],p=o[l+n+3],(12632256&(u|f<<8|p<<16))!=8421504?c+=a:(_=(7&S)<<18|(63&u)<<12|(63&f)<<6|63&p,_<65536||_>1114111?c+=a:(_-=65536,c+=i(55296+(_>>10),56320+(1023&_)),l+=3))):c+=a:c+=i(S)}return c}function jr(e,t){let n=t.length,i=0;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}Fe(e,i);let o=Ga(e,i),a=e.bytes;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?a[o++]=l:(l<2048?a[o++]=l>>6&31|192:(l<65536?a[o++]=l>>12&15|224:(a[o++]=l>>18&7|240,a[o++]=l>>12&63|128),a[o++]=l>>6&63|128),a[o++]=63&l|128)}}function _F(e,t){let n=Ga(e,t.limit),i=e.bytes,o=t.bytes;for(let a=0,c=t.limit;a<c;a++)i[a+n]=o[a]}function wO(e){return e.bytes[EE(e,1)]}function NO(e,t){let n=Ga(e,1);e.bytes[n]=t}function mE(e){let t=EE(e,8),n=e.bytes;return zn[0]=n[t++],zn[1]=n[t++],zn[2]=n[t++],zn[3]=n[t++],zn[4]=n[t++],zn[5]=n[t++],zn[6]=n[t++],zn[7]=n[t++],fE[0]}function gE(e,t){let n=Ga(e,8),i=e.bytes;fE[0]=t,i[n++]=zn[0],i[n++]=zn[1],i[n++]=zn[2],i[n++]=zn[3],i[n++]=zn[4],i[n++]=zn[5],i[n++]=zn[6],i[n++]=zn[7]}function Fr(e){let t,n=0,i=0;do t=wO(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function Fe(e,t){for(t>>>=0;t>=128;)NO(e,127&t|128),t>>>=7;NO(e,t)}function jo(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,a=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,c=Ga(e,a),l=e.bytes;switch(a){case 10:l[c+9]=o>>>7&1;case 9:l[c+8]=a!==9?128|o:127&o;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}const EF=async(e,t,n)=>{const i=function(c){const l=[];for(let u=0;u<c.length;u+=2)l.push(parseInt(c.slice(u,u+2),16));return Uint8Array.from(l)}(function(c){const l="0123456789abcdef";function u(Be){let he,rt="";for(he=0;he<=3;he++)rt+=l.charAt(Be>>8*he+4&15)+l.charAt(Be>>8*he&15);return rt}function f(Be,he){const rt=(65535&Be)+(65535&he);return(Be>>16)+(he>>16)+(rt>>16)<<16|65535&rt}function p(Be,he,rt,Xe,Ot,sn){return f(function(yt,qn){return yt<<qn|yt>>>32-qn}(f(f(he,Be),f(Xe,sn)),Ot),rt)}function _(Be,he,rt,Xe,Ot,sn,yt){return p(he&rt|~he&Xe,Be,he,Ot,sn,yt)}function S(Be,he,rt,Xe,Ot,sn,yt){return p(he&Xe|rt&~Xe,Be,he,Ot,sn,yt)}function R(Be,he,rt,Xe,Ot,sn,yt){return p(he^rt^Xe,Be,he,Ot,sn,yt)}function C(Be,he,rt,Xe,Ot,sn,yt){return p(rt^(he|~Xe),Be,he,Ot,sn,yt)}const A=function(Be){let he;const rt=1+(Be.length+8>>6),Xe=new Array(16*rt);for(he=0;he<16*rt;he++)Xe[he]=0;for(he=0;he<Be.length;he++)Xe[he>>2]|=Be.charCodeAt(he)<<he%4*8;return Xe[he>>2]|=128<<he%4*8,Xe[16*rt-2]=8*Be.length,Xe}(c);let O,k,M,H,re,Y=1732584193,J=-271733879,W=-1732584194,Q=271733878;for(O=0;O<A.length;O+=16)k=Y,M=J,H=W,re=Q,Y=_(Y,J,W,Q,A[O+0],7,-680876936),Q=_(Q,Y,J,W,A[O+1],12,-389564586),W=_(W,Q,Y,J,A[O+2],17,606105819),J=_(J,W,Q,Y,A[O+3],22,-1044525330),Y=_(Y,J,W,Q,A[O+4],7,-176418897),Q=_(Q,Y,J,W,A[O+5],12,1200080426),W=_(W,Q,Y,J,A[O+6],17,-1473231341),J=_(J,W,Q,Y,A[O+7],22,-45705983),Y=_(Y,J,W,Q,A[O+8],7,1770035416),Q=_(Q,Y,J,W,A[O+9],12,-1958414417),W=_(W,Q,Y,J,A[O+10],17,-42063),J=_(J,W,Q,Y,A[O+11],22,-1990404162),Y=_(Y,J,W,Q,A[O+12],7,1804603682),Q=_(Q,Y,J,W,A[O+13],12,-40341101),W=_(W,Q,Y,J,A[O+14],17,-1502002290),J=_(J,W,Q,Y,A[O+15],22,1236535329),Y=S(Y,J,W,Q,A[O+1],5,-165796510),Q=S(Q,Y,J,W,A[O+6],9,-1069501632),W=S(W,Q,Y,J,A[O+11],14,643717713),J=S(J,W,Q,Y,A[O+0],20,-373897302),Y=S(Y,J,W,Q,A[O+5],5,-701558691),Q=S(Q,Y,J,W,A[O+10],9,38016083),W=S(W,Q,Y,J,A[O+15],14,-660478335),J=S(J,W,Q,Y,A[O+4],20,-405537848),Y=S(Y,J,W,Q,A[O+9],5,568446438),Q=S(Q,Y,J,W,A[O+14],9,-1019803690),W=S(W,Q,Y,J,A[O+3],14,-187363961),J=S(J,W,Q,Y,A[O+8],20,1163531501),Y=S(Y,J,W,Q,A[O+13],5,-1444681467),Q=S(Q,Y,J,W,A[O+2],9,-51403784),W=S(W,Q,Y,J,A[O+7],14,1735328473),J=S(J,W,Q,Y,A[O+12],20,-1926607734),Y=R(Y,J,W,Q,A[O+5],4,-378558),Q=R(Q,Y,J,W,A[O+8],11,-2022574463),W=R(W,Q,Y,J,A[O+11],16,1839030562),J=R(J,W,Q,Y,A[O+14],23,-35309556),Y=R(Y,J,W,Q,A[O+1],4,-1530992060),Q=R(Q,Y,J,W,A[O+4],11,1272893353),W=R(W,Q,Y,J,A[O+7],16,-155497632),J=R(J,W,Q,Y,A[O+10],23,-1094730640),Y=R(Y,J,W,Q,A[O+13],4,681279174),Q=R(Q,Y,J,W,A[O+0],11,-358537222),W=R(W,Q,Y,J,A[O+3],16,-722521979),J=R(J,W,Q,Y,A[O+6],23,76029189),Y=R(Y,J,W,Q,A[O+9],4,-640364487),Q=R(Q,Y,J,W,A[O+12],11,-421815835),W=R(W,Q,Y,J,A[O+15],16,530742520),J=R(J,W,Q,Y,A[O+2],23,-995338651),Y=C(Y,J,W,Q,A[O+0],6,-198630844),Q=C(Q,Y,J,W,A[O+7],10,1126891415),W=C(W,Q,Y,J,A[O+14],15,-1416354905),J=C(J,W,Q,Y,A[O+5],21,-57434055),Y=C(Y,J,W,Q,A[O+12],6,1700485571),Q=C(Q,Y,J,W,A[O+3],10,-1894986606),W=C(W,Q,Y,J,A[O+10],15,-1051523),J=C(J,W,Q,Y,A[O+1],21,-2054922799),Y=C(Y,J,W,Q,A[O+8],6,1873313359),Q=C(Q,Y,J,W,A[O+15],10,-30611744),W=C(W,Q,Y,J,A[O+6],15,-1560198380),J=C(J,W,Q,Y,A[O+13],21,1309151649),Y=C(Y,J,W,Q,A[O+4],6,-145523070),Q=C(Q,Y,J,W,A[O+11],10,-1120210379),W=C(W,Q,Y,J,A[O+2],15,718787259),J=C(J,W,Q,Y,A[O+9],21,-343485551),Y=f(Y,k),J=f(J,M),W=f(W,H),Q=f(Q,re);return u(Y)+u(J)+u(W)+u(Q)}(""+t+n)).slice(0,16),o=i.slice(0,12),a=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},a,e))},bO=async(e,t,n)=>await EF(e.buffer,t,n);function DO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}const mF=new Map([["moderation",1],["supervise",2]]);class Nu extends ft{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Vt.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Ro(n=t.map(i=>mF.get(i)||0)).call(n,(i,o)=>i+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),m(this,"name","AgoraRTCVideoContentInspect"),m(this,"_connectionState",_i.CONNECTING),m(this,"_innerConnectionState",void 0),m(this,"sequence",0),m(this,"inspectStartTime",void 0),m(this,"workerManagerConnection",void 0),m(this,"workerConnection",void 0),m(this,"workerMessageLengthLimit",void 0),m(this,"inspectIntervalMinimum",void 0),m(this,"qualityRatio",void 0),m(this,"_connectInfo",void 0),m(this,"_cancelTokenSource",hi.CancelToken.source()),m(this,"_retryConfig",void 0),m(this,"wmSequence",0),m(this,"inspectInterval",void 0),m(this,"inspectTimer",null),m(this,"ossFilePrefix",void 0),m(this,"extraInfo",void 0),m(this,"_inspectType",void 0),m(this,"_inspectMode",void 0),m(this,"_quality",1),m(this,"qualityTimer",null),m(this,"_inspectId",void 0),m(this,"_needWorkUrlOnly",!1),m(this,"inspectImage",()=>{if(this.connectionState!==_i.CONNECTED)throw new N(y.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===_i.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=at(5,"inspect-"),this.workerMessageLengthLimit=D("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=D("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=D("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ds("worker-manager-"+this._inspectId,wt),this.on(Vt.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ei[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ds("worker-"+this._inspectId,wt),this.handleWorkerEvents()}async init(t,n){this.emit(Vt.STATE_CHANGE,Ei.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new ie((o,a)=>{this.on(Vt.CONNECTION_STATE_CHANGE,(c,l)=>{l===_i.CONNECTED&&o()}),this.requestAP(t,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{a(c)})})}async requestAP(t,n,i){const o=D("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),a=await function(l,u,f,p){let{appId:_,areaCode:S,cname:R,sid:C,token:A,uid:O}=u;Ma++;const k="image_moderation_api",M={service_name:k,json_body:JSON.stringify({appId:_,areaCode:S,cname:R,command:"allocateEdge",requestId:Ma,seq:Ma,sid:C,token:A,ts:Date.now(),uid:O+""})};let H,re,Y=l[0];return Er(async()=>{H=Date.now();const J=await Ji(Y,{data:M,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(re=Date.now()-H,J.code!==0){const he=new N(y.UNEXPECTED_RESPONSE,"image inspect ap error, code"+J.code,{retry:!0,responseTime:re});throw v.error(he.toString()),he}const W=JSON.parse(J.json_body);if(W.code!==200){const he=new N(y.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(W.code,", reason: ").concat(W.reason),{code:W.code,responseTime:re});throw v.error(he.toString()),he}if(!W.servers||!Array.isArray(W.servers)||W.servers.length===0){const he=new N(y.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:W.code,responseTime:re});throw v.error(he.toString()),he}const Q=D("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Be=D("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:W.servers.map(he=>{let{address:rt,wss:Xe}=he;if(rt&&Xe)return"wss://".concat(rt.replace(/\./g,"-"),".").concat(Q,":").concat(Be||Xe)}).filter(he=>!!he),workerToken:W.workerToken,vid:W.vid,responseTime:re}},(J,W)=>(se.apworkerEvent(C,{success:!0,sc:200,serviceName:k,responseDetail:JSON.stringify(J.addressList),firstSuccess:W===0,responseTime:re,serverIp:l[W%l.length]}),!1),(J,W)=>(se.apworkerEvent(C,{success:!1,sc:J.data&&J.data.code||200,serviceName:k,responseTime:re,serverIp:l[W%l.length]}),!!(J.code!==y.OPERATION_ABORTED&&J.code!==y.UNEXPECTED_RESPONSE||J.data&&J.data.retry)&&(Y=l[(W+1)%l.length],!0)),p)}(o,t,n,i);this.emit(Vt.STATE_CHANGE,Ei.AP_CONNECTED);const{addressList:c}=a;return this.wmSequence++,c}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Vt.STATE_CHANGE,Ei.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Te.CONNECTED,async()=>{this.emit(Vt.STATE_CHANGE,Ei.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.18.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Te.CLOSED,()=>{this._innerConnectionState<Ei.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Te.FAILED,()=>{this._innerConnectionState<Ei.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Te.RECONNECTING,()=>{this._innerConnectionState<Ei.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Te.ON_MESSAGE,async t=>{this.emit(Vt.STATE_CHANGE,Ei.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new N(y.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new N(y.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const o=D("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(o));this.emit(Vt.STATE_CHANGE,Ei.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(Vt.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(Te.WILL_RECONNECT,(t,n)=>{n(t)}),this.workerManagerConnection.on(Te.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Te.CONNECTED,async()=>{this.emit(Vt.STATE_CHANGE,Ei.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=_i.CONNECTED}),this.workerConnection.on(Te.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=dF(new Uint8Array(t.data));if(D("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Vt.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const o={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=Ro(n=Object.keys(o)).call(n,(l,u)=>o[l]>o[u]?l:u,"porn"),c=Object.keys(o).find(l=>l===a);this.emit(Vt.INSPECT_RESULT,c)}else this.emit(Vt.INSPECT_RESULT,void 0,new N(y.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Vt.INSPECT_RESULT,void 0,new N(y.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Vt.INSPECT_RESULT,void 0,new N(y.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Te.CLOSED,()=>{this.connectionState=_i.CLOSED}),this.workerConnection.on(Te.FAILED,()=>{this.connectionState=_i.CLOSED}),this.workerConnection.on(Te.RECONNECTING,()=>{this.connectionState=this.connectionState===_i.CONNECTED?_i.RECONNECTING:_i.CONNECTING}),this.workerConnection.on(Te.WILL_RECONNECT,(t,n)=>{t==="recover"&&n(t),n("tryNext")}),this.workerConnection.on(Te.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Vt.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=Qi(this,Vt.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Vt.INSPECT_RESULT,void 0,new N(y.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Vt.INSPECT_RESULT,void 0,new N(y.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:o,cid:a,vid:c,sid:l,uid:u}=n;const f=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await bO(p,i,o),S=this.sequence+"-"+a+"-"+u+"-"+f+"-"+at(12,""),R={appId:i,cid:a,cname:o,deviceId:"",elapse:Nu.intToLong(Number(f-this.inspectStartTime)),fileSize:_.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:S,sdkVersion:"4.18.2",sequence:this.sequence,sid:l,timestamp:Nu.intToLong(f),uid:u,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete R.callbackData,this.ossFilePrefix===void 0&&delete R.ossFilePrefix;const C=cF(R);if(C.byteLength<this.workerMessageLengthLimit){if(D("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const A=function(O){for(var k=1;k<arguments.length;k++){var M=arguments[k]!=null?arguments[k]:{};k%2?DO(Object(M),!0).forEach(function(H){m(O,H,M[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(M)):DO(Object(M)).forEach(function(H){Object.defineProperty(O,H,Object.getOwnPropertyDescriptor(M,H))})}return O}({},R);delete A.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(A))}return C}{const A=this.quality*this.qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:i,cname:o,cid:a,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=hi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=_i.CLOSED,this.emit(Vt.STATE_CHANGE,Ei.CLOSED)}}function gF(e){let t=function(){const n=vF.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let o=n.appId;o!==void 0&&(At(i,10),Us(i,o));let a=n.cid;a!==void 0&&(At(i,16),At(i,a));let c=n.cname;c!==void 0&&(At(i,26),Us(i,c));let l=n.deviceId;l!==void 0&&(At(i,34),Us(i,l));let u=n.elapse;u!==void 0&&(At(i,40),Fo(i,u));let f=n.fileSize;f!==void 0&&(At(i,48),Fo(i,Wa(f)));let p=n.height;p!==void 0&&(At(i,56),Fo(i,Wa(p)));let _=n.jpg;_!==void 0&&(At(i,66),At(i,_.length),LO(i,_));let S=n.networkType;S!==void 0&&(At(i,72),Fo(i,Wa(S)));let R=n.osType;R!==void 0&&(At(i,80),Fo(i,Wa(R)));let C=n.requestId;C!==void 0&&(At(i,90),Us(i,C));let A=n.sdkVersion;A!==void 0&&(At(i,98),Us(i,A));let O=n.sequence;O!==void 0&&(At(i,104),Fo(i,Wa(O)));let k=n.sid;k!==void 0&&(At(i,114),Us(i,k));let M=n.timestamp;M!==void 0&&(At(i,120),Fo(i,M));let H=n.uid;H!==void 0&&(At(i,128),At(i,H));let re=n.vid;re!==void 0&&(At(i,136),At(i,re));let Y=n.width;Y!==void 0&&(At(i,144),Fo(i,Wa(Y)));let J=n.service;J!==void 0&&(At(i,152),At(i,J));let W=n.callbackData;W!==void 0&&(At(i,162),At(i,W.length),LO(i,W));let Q=n.ticket;Q!==void 0&&(At(i,170),Us(i,Q))}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function SF(e){return function(n){let i={};e:for(;!RF(n);){let o=nd(n);switch(o>>>3){case 0:break e;case 1:i.code=nd(n);break;case 2:i.msg=kO(n,nd(n));break;case 3:i.requestId=kO(n,nd(n));break;case 4:i.timestamp=yF(n,!1);break;default:TF(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function TF(e,t){switch(t){case 0:for(;128&tr(e););break;case 2:SE(e,nd(e));break;case 5:SE(e,4);break;case 1:SE(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Wa(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let vF=[];function SE(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function RF(e){return e.offset>=e.limit}function bu(e,t){let n=e.bytes,i=e.offset,o=e.limit,a=i+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>o&&(e.limit=a),i}function PO(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function LO(e,t){let n=bu(e,t.length);e.bytes.set(t,n)}function kO(e,t){let n=PO(e,t),i=String.fromCharCode,o=e.bytes,a="�",c="";for(let l=0;l<t;l++){let u,f,p,_,S=o[l+n];128&S?(224&S)==192?l+1>=t?c+=a:(u=o[l+n+1],(192&u)!=128?c+=a:(_=(31&S)<<6|63&u,_<128?c+=a:(c+=i(_),l++))):(240&S)==224?l+2>=t?c+=a:(u=o[l+n+1],f=o[l+n+2],(49344&(u|f<<8))!=32896?c+=a:(_=(15&S)<<12|(63&u)<<6|63&f,_<2048||_>=55296&&_<=57343?c+=a:(c+=i(_),l+=2))):(248&S)==240?l+3>=t?c+=a:(u=o[l+n+1],f=o[l+n+2],p=o[l+n+3],(12632256&(u|f<<8|p<<16))!=8421504?c+=a:(_=(7&S)<<18|(63&u)<<12|(63&f)<<6|63&p,_<65536||_>1114111?c+=a:(_-=65536,c+=i(55296+(_>>10),56320+(1023&_)),l+=3))):c+=a:c+=i(S)}return c}function Us(e,t){let n=t.length,i=0;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}At(e,i);let o=bu(e,i),a=e.bytes;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?a[o++]=l:(l<2048?a[o++]=l>>6&31|192:(l<65536?a[o++]=l>>12&15|224:(a[o++]=l>>18&7|240,a[o++]=l>>12&63|128),a[o++]=l>>6&63|128),a[o++]=63&l|128)}}function tr(e){return e.bytes[PO(e,1)]}function MO(e,t){let n=bu(e,1);e.bytes[n]=t}function nd(e){let t,n=0,i=0;do t=tr(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function At(e,t){for(t>>>=0;t>=128;)MO(e,127&t|128),t>>>=7;MO(e,t)}function yF(e,t){let n,i=0,o=0,a=0;return n=tr(e),i=127&n,128&n&&(n=tr(e),i|=(127&n)<<7,128&n&&(n=tr(e),i|=(127&n)<<14,128&n&&(n=tr(e),i|=(127&n)<<21,128&n&&(n=tr(e),o=127&n,128&n&&(n=tr(e),o|=(127&n)<<7,128&n&&(n=tr(e),o|=(127&n)<<14,128&n&&(n=tr(e),o|=(127&n)<<21,128&n&&(n=tr(e),a=127&n,128&n&&(n=tr(e),a|=(127&n)<<7))))))))),{low:i|o<<28,high:o>>>4|a<<24,unsigned:t}}function Fo(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,a=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,c=bu(e,a),l=e.bytes;switch(a){case 10:l[c+9]=o>>>7&1;case 9:l[c+8]=a!==9?128|o:127&o;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}const UO={},xO={},VO=4294967296,jO=18446744073709552e3,FO=jO/2,TE=GO(0,!0),BO=GO(0),IF=Ha(0,-2147483648,!1),CF=Ha(-1,2147483647,!1),AF=Ha(-1,-1,!0);function GO(e,t){let n,i,o;return t?(o=0<=(e>>>=0)&&e<256)&&(i=xO[e],i)?i:(n=Ha(e,0,!0),o&&(xO[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(i=UO[e],i)?i:(n=Ha(e,e<0?-1:0,!1),o&&(UO[e]=n),n)}function Ha(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function OF(e,t){if(isNaN(e))return t?TE:BO;if(t){if(e<0)return TE;if(e>=jO)return AF}else{if(e<=-FO)return IF;if(e+1>=FO)return CF}return e<0?t?TE:BO:Ha(e%VO|0,e/VO|0,t)}function WO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class vE extends ft{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Di.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),m(this,"name","AgoraRTCImageModeration"),m(this,"_connectionState",ni.CONNECTING),m(this,"_sequence",0),m(this,"_moderationStartTime",void 0),m(this,"_workerConnection",void 0),m(this,"_workerMessageLengthLimit",void 0),m(this,"_qualityRatio",void 0),m(this,"_connectInfo",void 0),m(this,"_cancelTokenSource",hi.CancelToken.source()),m(this,"_retryConfig",void 0),m(this,"_moderationInterval",void 0),m(this,"_moderationTimer",null),m(this,"_moderationMode",1),m(this,"_quality",1),m(this,"_qualityTimer",null),m(this,"_ticket",void 0),m(this,"_moderationIntervalMinimum",void 0),m(this,"_uploadFailedNum",0),m(this,"_uploadNum",0),m(this,"_uploadTimer",null),m(this,"_moderationId",void 0),m(this,"inspectImage",()=>{if(this.connectionState!==ni.CONNECTED)throw new N(y.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ni.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=at(5,"image-moderation-"),this._workerMessageLengthLimit=D("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=D("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,this._qualityRatio=D("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ds("worker-"+this._moderationId,wt),this.on(Di.STATE_CHANGE,(i,o)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Do[i]," ").concat(o||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Di.STATE_CHANGE,Do.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new ie((o,a)=>{this.on(Di.CONNECTION_STATE_CHANGE,(c,l)=>{c===ni.CONNECTED&&o()}),this.requestAP(t,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{a(c)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ni.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const o=D("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),a=await function(u,f,p,_){let{appId:S,areaCode:R,cname:C,sid:A,token:O,uid:k}=f;Ma++;const M="moderation_plugin",H={service_name:M,json_body:JSON.stringify({appId:S,areaCode:R,cname:C,command:"allocateEdge",requestId:Ma,seq:Ma,sid:A,appToken:O,ts:Date.now(),uid:k+""})};let re,Y,J=u[0];return Er(async()=>{re=Date.now();const W=await Ji(J,{data:H,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Y=Date.now()-re,W.code!==0){const he=new N(y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+W.code,{retry:!0,responseTime:Y});throw v.error(he.toString()),he}const Q=JSON.parse(W.json_body);if(Q.code!==200){const he=new N(y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Q.code,", reason: ").concat(Q.reason),{code:Q.code,responseTime:Y});throw v.error(he.toString()),he}if(!Q.servers||!Array.isArray(Q.servers)||Q.servers.length===0){const he=new N(y.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Q.code,responseTime:Y});throw v.error(he.toString()),he}if(!Q.servers.some(he=>!!he.wss)){const he=new N(y.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Q.code,responseTime:Y});throw v.error(he.toString()),he}const Be=D("IMAGE_MODERATION_WORKER_HOST");return{addressList:Q.servers.map(he=>{let{address:rt,wss:Xe}=he;if(rt&&Xe)return"wss://".concat(rt.replace(/\./g,"-"),".").concat(Be,":").concat(Xe,"/moderation")}).filter(he=>!!he),workerToken:Q.workerToken,vid:Q.vid,ticket:Q.appTicket,responseTime:Y}},(W,Q)=>(se.apworkerEvent(A,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(W.addressList),firstSuccess:Q===0,responseTime:Y,serverIp:u[Q%u.length]}),!1),(W,Q)=>(se.apworkerEvent(A,{success:!1,sc:W.data&&W.data.code||200,serviceName:M,responseTime:Y,serverIp:u[Q%u.length]}),!!(W.code!==y.OPERATION_ABORTED&&W.code!==y.UNEXPECTED_RESPONSE||W.data&&W.data.retry)&&(J=u[(Q+1)%u.length],!0)),_)}(o,t,n,i);this.emit(Di.STATE_CHANGE,Do.AP_CONNECTED);const{addressList:c,ticket:l}=a;return this._ticket=l,c}async connectWorker(t){this.emit(Di.STATE_CHANGE,Do.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Te.CONNECTED,async()=>{this.emit(Di.STATE_CHANGE,Do.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ni.CONNECTED}),this._workerConnection.on(Te.CLOSED,()=>{this.connectionState=ni.CLOSED}),this._workerConnection.on(Te.FAILED,()=>{this.connectionState=ni.CLOSED}),this._workerConnection.on(Te.RECONNECTING,()=>{this.connectionState=this.connectionState===ni.CONNECTED?ni.RECONNECTING:ni.CONNECTING}),this._workerConnection.on(Te.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=SF(new Uint8Array(t.data));D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{se.reportApiInvoke(this._connectInfo.sid||null,{name:Nt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:ut.TRACER}).onError(new N(y.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},D("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Te.WILL_RECONNECT,(t,n)=>{t==="recover"&&n(t),n("tryNext")}),this._workerConnection.on(Te.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Qi(this,Di.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:o,cid:a,vid:c,sid:l,uid:u}=n;const f=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await bO(p,i,o),S=this._sequence+"-"+a+"-"+u+"-"+f+"-"+at(12,""),R={appId:i,cid:a,cname:o,deviceId:"",elapse:vE.intToLong(Number(f-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:S,sdkVersion:"4.18.2",sequence:this._sequence,sid:l,timestamp:OF(f),uid:u,vid:c,service:this._moderationMode,ticket:this._ticket},C=gF(R);if(C.byteLength<this._workerMessageLengthLimit){if(D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(O){for(var k=1;k<arguments.length;k++){var M=arguments[k]!=null?arguments[k]:{};k%2?WO(Object(M),!0).forEach(function(H){m(O,H,M[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(M)):WO(Object(M)).forEach(function(H){Object.defineProperty(O,H,Object.getOwnPropertyDescriptor(M,H))})}return O}({},R);delete A.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return C}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:i,cname:o,cid:a,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=hi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ni.CLOSED,this.emit(Di.STATE_CHANGE,Do.CLOSED)}}var HO,KO,YO,zO,qO,JO,XO,QO,$O,ZO,ew,tw,nw,iw,rw,ow,sw,aw,cw,dw,lw,uw,hw,pw,fw,_w,Ew,mw,gw,Sw,Tw,vw,Rw,yw,Iw,Cw,Aw,Ow,ww,Z;function Nw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function id(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Nw(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let wF=(HO=pe(),KO=pe({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),t.map(n=>n?Object(n).toString():"null"))}),YO=pe({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId()))}),zO=pe({argsMap:(e,t,n)=>[t.uid,n]}),qO=pe({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return[i==null?void 0:i.uid,o]})}),JO=pe({argsMap:(e,t,n)=>[t.uid,n]}),XO=pe({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return{uid:i==null?void 0:i.uid,mediaType:o}})}),QO=pe(),$O=pe(),ZO=pe(),ew=pe(),tw=pe(),nw=pe(),iw=pe(),rw=pe(),ow=pe(),sw=pe(),aw=pe(),cw=pe(),dw=pe(),lw=pe(),uw=pe({argsMap:(e,t)=>[t]}),hw=pe(),pw=pe(),fw=pe(),_w=pe(),Ew=pe(),mw=pe(),gw=pe(),Sw=pe(),Tw=pe(),vw=pe(),Rw=pe({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),yw=pe(),Iw=pe(),Cw=pe(),Aw=pe(),Ow=pe({reportResult:!0}),ww=pe(),G((Z=class extends ft{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),m(this,"store",void 0),m(this,"_uid",void 0),m(this,"_channelName",void 0),m(this,"_uintUid",void 0),m(this,"_users",[]),m(this,"_config",void 0),m(this,"_clientId",void 0),m(this,"_appId",void 0),m(this,"_sessionId",null),m(this,"_key",void 0),m(this,"_joinInfo",void 0),m(this,"_gateway",void 0),m(this,"_statsCollector",void 0),m(this,"_configDistribute",void 0),m(this,"_leaveMutex",new Pn("client-leave")),m(this,"_publishMutex",new Pn("client-publish")),m(this,"_renewTokenMutex",new Pn("client-renewtoken")),m(this,"_subscribeMutex",new Pn("client-subscribe")),m(this,"_encryptionMode","none"),m(this,"_encryptionSecret",null),m(this,"_encryptionSalt",null),m(this,"_proxyServer",void 0),m(this,"_turnServer",{servers:[],mode:"auto"}),m(this,"_cloudProxyServerMode","disabled"),m(this,"_isDualStreamEnabled",!1),m(this,"_defaultStreamFallbackType",void 0),m(this,"_lowStreamParameter",void 0),m(this,"_streamFallbackTypeCacheMap",new Map),m(this,"_remoteStreamTypeCacheMap",new Map),m(this,"_axiosCancelSource",hi.CancelToken.source()),m(this,"_audioVolumeIndicationInterval",void 0),m(this,"_networkQualityInterval",void 0),m(this,"_userOfflineTimeout",void 0),m(this,"_streamRemovedTimeout",void 0),m(this,"_injectStreamingClient",void 0),m(this,"_liveTranscodeStreamingClient",void 0),m(this,"_liveRawStreamingClient",void 0),m(this,"_channelMediaRelayClient",void 0),m(this,"_networkQualitySensitivity","normal"),m(this,"_p2pChannel",void 0),m(this,"_useLocalAccessPoint",!1),m(this,"_setLocalAPVersion",void 0),m(this,"_joinAndNotLeaveYet",!1),m(this,"_numberOfJoinCount",0),m(this,"_remoteDefaultVideoStreamType",void 0),m(this,"_inspect",void 0),m(this,"_moderation",void 0),m(this,"_license",void 0),m(this,"_handleLocalTrackEnable",(n,i,o)=>{this.publish(n,!1).then(i).catch(o)}),m(this,"_handleLocalTrackDisable",(n,i,o)=>{this.unpublish(n).then(i).catch(o)}),m(this,"_handleUserOnline",n=>{if(D("BLOCK_LOCAL_CLIENT")&&Is(n.uid,this.channelName))return void v.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const i=this._users.find(o=>o.uid===n.uid);if(i)i._trust_in_room_=!0;else{const o=new j_(n.uid,n.uint_id||n.uid);this._users.push(o),v.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(be.USER_JOINED,o)}}),m(this,"_handleUserOffline",n=>{if(D("BLOCK_LOCAL_CLIENT")&&Is(n.uid,this.channelName))return;const i=this._users.find(o=>o.uid===n.uid);i&&(this._handleRemoveStream(n),N_(this._users,i),this._remoteStreamTypeCacheMap.delete(i.uid),this._streamFallbackTypeCacheMap.delete(i.uid),v.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(be.USER_LEAVED,i,n.reason))}),m(this,"_handleAddAudioOrVideoStream",(n,i,o,a,c,l,u)=>{if(D("BLOCK_LOCAL_CLIENT")&&Is(i,this.channelName))return;const f=this._users.find(_=>_.uid===i);if(!f)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(i,", type ").concat(n)),this.store.subscribe(f.uid,n,void 0,void 0,void 0,Date.now());const p=n==="audio"?f.hasAudio:f.hasVideo;f._uintid||(f._uintid=c||i),n==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,n==="audio"?(f._audio_added_=!0,o!==void 0&&(f._audioSSRC=o),a!==void 0&&(f._cname=a),l&&(f._audioOrtc=l)):(f._video_added_=!0,o!==void 0&&(f._videoSSRC=o),a!==void 0&&(f._cname=a),u!==void 0&&(f._rtxSsrcId=u),l&&(f._videoOrtc=l)),(n==="audio"?f.hasAudio:f.hasVideo)&&!p&&(v.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(n)),this.safeEmit(be.USER_PUBLISHED,f,n)),n==="video"?se.onGatewayStream(this._sessionId,nn.ON_ADD_VIDEO_STREAM,_t.ON_ADD_VIDEO_STREAM,{peer:c||i}):se.onGatewayStream(this._sessionId,nn.ON_ADD_AUDIO_STREAM,_t.ON_ADD_AUDIO_STREAM,{peer:c||i}),this._p2pChannel.remoteMediaSsrcChanged(f,n,o).then(_=>{if(_)return v.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(f.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(f,n,!0).then(()=>this._subscribe(f,n,!0).catch(S=>{v.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(f,n)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,n,!0).catch(_=>{v.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),m(this,"_handleRemoveStream",n=>{if(D("BLOCK_LOCAL_CLIENT")&&Is(n.uid,this.channelName))return;const i=this._users.find(a=>a.uid===n.uid);if(!i)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let o=()=>{};i.hasAudio&&i.hasVideo?o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.safeEmit(be.USER_UNPUBLISHED,i,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.safeEmit(be.USER_UNPUBLISHED,i,"video")}:i.hasVideo?o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.safeEmit(be.USER_UNPUBLISHED,i,"video")}:i.hasAudio&&(o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.safeEmit(be.USER_UNPUBLISHED,i,"audio")}),i._trust_audio_stream_added_state_=!0,i._trust_video_stream_added_state_=!0,i._audio_added_=!1,i._video_added_=!1,this._p2pChannel.unsubscribe(i).then(a=>{if(a)return this._gateway.unsubscribe(a,i.uid)}),i._audioSSRC=void 0,i._videoSSRC=void 0,i._audioOrtc=void 0,i._videoOrtc=void 0,i._rtxSsrcId=void 0,se.onGatewayStream(this._sessionId,nn.ON_REMOVE_STREAM,_t.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),o()}),m(this,"_handleSetStreamLocalEnable",(n,i,o)=>{if(D("BLOCK_LOCAL_CLIENT")&&Is(i,this.channelName))return;const a=this._users.find(u=>u.uid===i);if(!a)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(o?"enabled":"disabled"," with uid ").concat(i));const c=n==="audio"?a.hasAudio:a.hasVideo;if(n==="audio"){a._trust_audio_enabled_state_=!0;const u=a._audio_enabled_;if(a._audio_enabled_=o,a._audio_enabled_===u)return;{const f=a._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(i,", msg: ").concat(f)),this.safeEmit(be.USER_INFO_UPDATED,i,f)}}else{a._trust_video_enabled_state_=!0;const u=a._video_enabled_;if(a._video_enabled_=o,a._video_enabled_===u)return;{const f=a._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(f)),this.safeEmit(be.USER_INFO_UPDATED,i,f)}}const l=n==="audio"?a.hasAudio:a.hasVideo;return c!==l?!c&&l?(v.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(n)),void this.safeEmit(be.USER_PUBLISHED,a,n)):(n==="video"&&a._videoTrack&&a._videoTrack._destroy(),n==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,n),v.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(n)),void this.safeEmit(be.USER_UNPUBLISHED,a,n)):void 0}),m(this,"_handleMuteStream",(n,i,o)=>{if(D("BLOCK_LOCAL_CLIENT")&&Is(n,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),n,i,o);const a=this._users.find(u=>u.uid===n);if(!a)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const c=i==="audio"?a.hasAudio:a.hasVideo;if(i==="audio"){a._trust_audio_mute_state_=!0;const u=a._audio_muted_;if(a._audio_muted_=o,a._audio_muted_===u)return;{const f=a._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(f)),this.safeEmit(be.USER_INFO_UPDATED,n,f)}}else{a._trust_video_mute_state_=!0;const u=a._video_muted_;if(a._video_muted_=o,a._video_muted_===u)return;{const f=a._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(f)),this.safeEmit(be.USER_INFO_UPDATED,n,f)}}const l=i==="audio"?a.hasAudio:a.hasVideo;if(c!==l){if(!c&&l)return(i==="audio"?a._audioSSRC:a._videoSSRC)?(v.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(i)),void this.safeEmit(be.USER_PUBLISHED,a,i)):void v.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(i," unmute message  before add stream message, ").concat(i," SSRC doesn't exist yet."));i==="video"&&a._videoTrack&&a._videoTrack._destroy(),i==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,i),v.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(i)),this.safeEmit(be.USER_UNPUBLISHED,a,i)}}),m(this,"_handleP2PLost",async n=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),m(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(be.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),m(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),m(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(be.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(be.NETWORK_QUALITY,n)}),this._config=e,this._clientId=at(5,"client-"),this.store=new sF(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(bi," build: ").concat(Hf,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{qR(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(n){v.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new Pa(this.store),this._statsCollector.onStatsException=(n,i,o)=>{v.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(i,", uid: ").concat(o)),this.safeEmit(be.EXCEPTION,{code:n,msg:i,uid:o})},this._statsCollector.onUploadPublishDuration=(n,i,o,a)=>{const c=this._users.find(l=>l.uid===n);c&&se.peerPublishStatus(this._sessionId,{subscribeElapse:a,audioPublishDuration:i,videoPublishDuration:o,peer:c._uintid})},this.store.useDataChannel=Ct().supportDataChannel&&D("SIGNAL_CHANNEL"),this._gateway=new HV(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||wt,httpRetryConfig:e.httpRetryConfig||wt,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new ZV,this._p2pChannel=new oF(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(e,t,n,i,o){const a=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=aF(),l=RO()?window.isSecureContext:"Browser Not Support";if(!RO()&&!c||!window.isSecureContext){const R="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";v.warning(R)}const u=w_();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const f=se.reportApiInvoke(u,{name:Nt.JOIN,options:[e,t,n,i],states:{isHttps:c,isSecureContext:l},tag:ut.TRACER});se.setAppId(e);try{if(!n&&n!==null)throw new N(y.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&hn(n,"token",1,2047),hn(e,"appid",1,2047),e_(t),i&&t_(i),o&&hn(o,"optionalInfo",1,2047)}catch(R){throw f.onError(R),R}if(v.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const R=new N(y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw f.onError(R),R}this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const p=id({clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:o,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(p.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(p.stringUid=i,this._uintUid?(p.uid=this._uintUid,this._uintUid=void 0):p.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(p.aesmode=this._encryptionMode,p.aespassword=await(async R=>{const C=b_(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),A=await window.crypto.subtle.importKey("spki",C,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),O=g_(R),k=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},A,O);return du(new Uint8Array(k))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new N(y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(p.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:t,appId:e});const _=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&_===this._sessionId&&se.joinChannelTimeout(this._sessionId,5)},5e3);try{let R;const C=p.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(C)){const M=D("PROXY_SERVER_TYPE3");Array.isArray(M)?p.proxyServer=M[0]:p.proxyServer=M}if(se.setProxyServer(p.proxyServer),v.setProxyServer(p.proxyServer),this.store.requestAPStart(),p.stringUid&&!p.uid){const M=await eC(p.stringUid,p,this._axiosCancelSource.token,this._config.httpRetryConfig||wt,this.store);v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(p.stringUid," => ").concat(M)),p.uid=M,R=await ZI(p,this._axiosCancelSource.token,this._config.httpRetryConfig||wt,!0,this.store)}else R=await ZI(p,this._axiosCancelSource.token,this._config.httpRetryConfig||wt,!0,this.store);if(!this._joinAndNotLeaveYet)throw new N(y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(p,this._axiosCancelSource.token),this._configDistribute.on(Fc.UPDATE_BITRATE_LIMIT,M=>{this._p2pChannel.updateBitrateLimit(M)})},0),this._key=n||e;const A=R.gatewayInfo;this._joinInfo=id(id({},p),{},{cid:A.cid,uid:p.uid?p.uid:A.uid,vid:A.vid,apResponse:A.res,uni_lbs_ip:A.uni_lbs_ip,gatewayAddrs:A.gatewayAddrs});const O=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new N(y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));f.onSuccess(O),this._appId=e,this._channelName=p.cname,this._uid=O,this.store.uid=O,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(wn()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const k=p.stringUid?"string uid: ".concat(p.stringUid,",uid: ").concat(p.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(k)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),S=this,ys.includes(S)||ys.push(S),O}catch(R){const C=Array.isArray(R)?R[0]:R;throw C&&C.code===y.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),C):v.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),C),C.code!==y.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(C),C}var S}_joinGateway(){if(!this._joinInfo||!this._key)throw new N(y.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!D("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===y.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,He.FALLBACK),e;if(e.code===y.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,He.FALLBACK),e;throw e}).then(e=>{if(e instanceof N){if(e.code===y.INIT_WEBSOCKET_TIMEOUT){if(v.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new N(y.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=D("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const i=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),o=i.slice(i.length-2).join(".");t.forEach(a=>{this._joinInfo&&a.includes(o)&&(this._joinInfo.proxyServer=a)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const n=D("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return n&&n[1]&&n[1]!=="443"&&v.setProxyServer(this._joinInfo.proxyServer),D("STATS_COLLECTOR_PORT").toString()!=="443"&&se.setProxyServer(this._joinInfo.proxyServer),se.reportApiInvoke(this._sessionId,{name:Nt.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:ut.TRACER}).onSuccess(),this.safeEmit(be.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),D("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(i=>{"forceturn"in i&&(i.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(v.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new N(y.INVALID_OPERATION);return se.reportApiInvoke(this._sessionId,{name:Nt.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:ut.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(wn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=ys.indexOf(t);n!==-1&&ys.splice(n,1)}(this);const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(e)||(e=[e]),e.length===0)throw new N(y.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new N(y.INVALID_OPERATION,"audience can not publish stream");for(const i of e){if(!(i instanceof S_))throw new N(y.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new N(y.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(e.map(i=>"".concat(i.getTrackId()," "))));const n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&e.forEach(i=>{const o=this._configDistribute.getBitrateLimit();i instanceof Lt&&o&&i.setBitrateLimit(o.uplink)});try{await this._publishHighStream(e),v.info("[".concat(this._clientId,"] Publish success, id ").concat(e.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw v.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new N(y.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");e?Array.isArray(e)||(e=[e]):e=this._p2pChannel.getAllTracks(!0),v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(n=>"".concat(n.getTrackId()," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublish(e);n&&await this._gateway.unpublish(n,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(i=>"".concat(i.getTrackId()))))}catch(n){throw v.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t){return this._subscribe(e,t)}async _subscribe(e,t,n){if(Jt(t,"mediaType",["audio","video"]),!this._joinInfo)throw new N(y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new N(y.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new N(y.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const u=new N(y.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),u}const i=t==="audio"?e._audioSSRC:e._videoSSRC,o=t==="audio"?e._audioOrtc:e._videoOrtc,a=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Ie.AUDIO:Ie.VIDEO,ssrcId:i},l=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{Pi.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,a,o);try{await this._gateway.subscribe(e.uid,c,!0)}catch(f){if((f==null?void 0:f.code)!==y.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),f;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(f){throw this._p2pChannel.reportSubscribeEvent(!1,f==null?void 0:f.code,e,t),f}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const u=t==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new N(y.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{l()}}async massSubscribe(e){if($r(e,"subscribeList"),!this._joinInfo)throw new N(y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:u,mediaType:f}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(f)}).join("; ")));const o=(e=[...e]).map(l=>{let{user:u,mediaType:f}=l;return{user:u,mediaType:f}}),a=await this._p2pChannel.globalLock();try{var c;for(let u=e.length-1;u>=0;u--){const f=e[u],{user:p,mediaType:_}=f;if(Jt(_,"mediaType",["audio","video"]),!p){const C=new N(y.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===p)){const C=new N(y.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),o[u].error=C,e.splice(u,1);continue}if(_==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||_==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const C=new N(y.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(_,", remote user is not published")),o[u].error=C,e.splice(u,1);continue}const S=bt.Video|bt.LwoVideo,R=n.get(p);if(R){if(_==="video"?R&S:R&bt.Audio){e.splice(u,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(_," twice"));continue}n.set(p,R|(_==="video"?S:bt.Audio))}else n.set(p,_==="video"?S:bt.Audio)}for(let u=e.length-1;u>=0;u--){const f=e[u],{user:p,mediaType:_}=f,S=bt.Video|bt.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,_)){await this._p2pChannel.unmuteRemoteNoLock(p,_);const R=n.get(p);n.set(p,_==="video"?R^S:R^bt.Audio),e.splice(u,1)}}this.store.massSubscribe(e.map(u=>({userId:u.user.uid,type:u.mediaType})),t);const l=Ro(c=Array.from(n.entries())).call(c,(u,f)=>{let[p,_]=f;if(_===0)return u;const S={stream_id:p.uid,stream_type:_};return _&bt.Audio&&(S.audio_ssrc=p._audioSSRC),_&bt.Video&&(S.video_ssrc=p._videoSSRC),u.push(S),u},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:p,mediaType:_}=f;return{user:p,mediaType:_,ssrcId:_===Ie.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:_===Ie.VIDEO?p._rtxSsrcId:void 0}}));const u=new Map;if(l.length>0){const f=await this._gateway.subscribeAll(l,!0);((f==null?void 0:f.users)||[]).forEach(p=>{let{stream_id:_,video_error_code:S,audio_error_code:R,error_code:C}=p;(S||R||C)&&u.set(_,{video_error_code:S,audio_error_code:R,error_code:C})})}if(Array.from(u.entries()).length>0){const f=Array.from(u.entries()).map(p=>{let _,[S,R]=p;return R.error_code||R.video_error_code&&R.audio_error_code?_=void 0:R.video_error_code?_=Ie.VIDEO:R.audio_error_code&&(_=Ie.AUDIO),{user:this.remoteUsers.find(C=>C.uid===S),mediaType:_}});await this._p2pChannel.massUnsubscribeNoLock(f)}for(const f of o){const p=u.get(f.user.uid);if(p){const _=p.error_code||f.mediaType==="audio"&&p.audio_error_code||f.mediaType==="video"&&p.video_error_code;if(_){const S=Hc(_);v.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(S.desc)),f.error=new N(y.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(S.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(o.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),o.forEach(f=>{var p;se.subscribe(this.store.sessionId,{succ:!!f.error,ec:((p=f.error)===null||p===void 0?void 0:p.code)||null,video:f.mediaType===Ie.VIDEO,audio:f.mediaType===Ie.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===Ie.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:p,mediaType:_}=f;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_)}).join("; "))),o}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(e),u}}finally{a(),i()}}async unsubscribe(e,t){if(t&&Jt(t,"mediaType",["audio","video"]),!this._joinInfo)throw new N(y.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new N(y.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const n=await this._subscribeMutex.lock();try{const i=await this._p2pChannel.unsubscribe(e,t);i&&await this._gateway.unsubscribe(i,e.uid),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}catch(i){if(i.code===y.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}finally{n()}}async massUnsubscribe(e){if($r(e,"unsubscribeList"),!this._joinInfo)throw new N(y.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:o}=e[n];if(!i){const c=new N(y.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(Jt(o,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===i)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const a=bt.Video|bt.LwoVideo;if(t.has(i)){const c=t.get(i);let l;switch(o){case"video":l=c&a;break;case"audio":l=c&bt.Audio;break;default:l=c&(bt.Audio|a)}if(l){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(i,c|bt.Audio):o==="video"&&t.set(i,c|a):t.set(i,c|bt.Audio|a)}else o?o==="audio"?t.set(i,bt.Audio):o==="video"&&t.set(i,a):t.set(i,bt.Audio|a)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:o,mediaType:a}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===y.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}setLowStreamParameter(e){(function(n){if(!n)throw new N(y.INVALID_PARAMS);dt(n.width)||Zf(n.width,"streamParameter.width"),dt(n.height)||Zf(n.height,"streamParameter.height"),dt(n.framerate)||Zf(n.framerate,"streamParameter.framerate"),dt(n.bitrate)||nt(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e}async enableDualStream(){if(!Ct().supportDualStream)throw se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new N(y.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new N(y.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new N(y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(oe.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){Jt(n,"role",["audience","host"])}(e),t&&qR(t),this.mode==="rtc")throw v.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new N(y.INVALID_OPERATION,"rtc mode can not use setClientRole");if(t&&t.level&&e==="host")throw new N(y.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new N(y.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,v.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}setProxyServer(e,t){if(hn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new N(y.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new N(y.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,se.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new N(y.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new N(y.INVALID_OPERATION,"You have already set the proxy")}if(Vc(e))return this._turnServer={servers:e,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>zR(n)),this._turnServer={servers:e,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new N(y.INVALID_OPERATION,"you should set license before join channel");if(hn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new N(y.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,v.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new N(y.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new N(y.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new N(y.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new N(y.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new N(y.INVALID_OPERATION,"Stop proxy server after leave channel");se.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new N(y.INVALID_PARAMS,"accessPoints is required.");$r(e.accessPoints.serverList,"accessPoints.serverList"),hn(e.accessPoints.domain,"accessPoints.domain");const t=(S,R)=>{nt(S,R,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new N(y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");D("CLOSE_AFB_FOR_LOCAL_AP")&&(et("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),et("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,a=e.accessPoints.serverList.map(S=>i.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(o):S),c=a.map(S=>"".concat(S,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,et("WEBCS_DOMAIN",c),et("WEBCS_DOMAIN_BACKUP_LIST",c),et("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?($r(e.report.hostname,"report.hostname"),et("EVENT_REPORT_DOMAIN",e.report.hostname[0]),et("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(et("EVENT_REPORT_DOMAIN",a[0]),et("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),et("STATS_COLLECTOR_PORT",l),e.report?et("ENABLE_EVENT_REPORT",!0):et("ENABLE_EVENT_REPORT",!1);let u="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?($r(e.log.hostname,"log.hostname"),u=e.log.hostname[0]):u=a[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),et("LOG_UPLOAD_SERVER","".concat(u,":").concat(f));let p=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?($r(e.cds.hostname,"cds.hostname"),p=e.cds.hostname):p=a;let _=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),_=e.cds.port),et("CDS_AP",p.map(S=>"".concat(S,":").concat(_))),e.cds?et("ENABLE_CONFIG_DISTRIBUTE",!0):et("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(e,t){if($r(e,"serverList"),hn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new N(y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,et("WEBCS_DOMAIN",e),et("WEBCS_DOMAIN_BACKUP_LIST",e),et("GATEWAY_DOMAINS",[t]),et("EVENT_REPORT_DOMAIN",e[0]),et("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),et("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Jt(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Jt(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}v.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Jt(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw v.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}v.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n){if(function(i){Jt(i,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),hn(t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new N(y.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new N(y.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=du(n))}async renewToken(e){if(hn(e,"token",1,2047),!this._key||!this._joinInfo)throw new N(y.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(D("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await $V(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wt);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,v.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(be.VOLUME_INDICATOR,e)},D("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new N(y.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new N(y.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new N(y.LIVE_STREAMING_TASK_CONFLICT);const n=t?Ut.TRANSCODE:Ut.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Ut.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new N(y.INVALID_PARAMS,"can not find live streaming url to stop");await ie.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new N(y.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(Ut.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,Ut.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(Ut.INJECT),n=Array.from(Ur(e=t.streamingTasks).call(e)).find(i=>i.mode===Ut.INJECT);if(!this._joinInfo||!n)throw new N(y.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){cC(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){cC(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new N(y.INVALID_OPERATION,"can not send data stream, not joined");if(typeof e=="string"&&(e=new TextEncoder().encode(e)),new Blob([e]).size>1024)throw new N(y.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Ee.DATA_STREAM,{payload:du(e)},!t)}sendMetadata(e){if(!this._joinInfo)throw new N(y.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new N(y.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ee.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:du(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(h2),!this._joinInfo)throw new N(y.INVALID_OPERATION,"can not send custom report, not joined");await se.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Jt(t.spatialLayer,"spatialLayer",[0,1,2,3]),Jt(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=hi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Pn("client-publish"),this._subscribeMutex=new Pn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){const n=e||w_();e?v.debug("[".concat(this._clientId,"] new Session ").concat(n)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?se.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:t.channel,appid:t.appId,mode:this.mode}):this._joinInfo?se.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&se.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new N(y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&D("FORCE_TURN")&&!D("TURN_ENABLE_TCP")&&!D("TURN_ENABLE_UDP"))throw new N(y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==y.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof Lt&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===y.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new N(y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==y.DISCONNECT_P2P)throw n.throw(a),a}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===y.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new N(y.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new tj(this._joinInfo,this._config.websocketRetryConfig||wt,this._config.httpRetryConfig||wt),n=i=>{i.onLiveStreamError=(o,a)=>{se.reportApiInvoke(this._sessionId,{name:Nt.ON_LIVE_STREAM_ERROR,options:[o,a],tag:ut.TRACER}).onSuccess(),this.safeEmit(be.LIVE_STREAMING_ERROR,o,a)},i.onLiveStreamWarning=(o,a)=>{se.reportApiInvoke(this._sessionId,{name:Nt.ON_LIVE_STREAM_WARNING,options:[o,a],tag:ut.TRACER}).onSuccess(),this.safeEmit(be.LIVE_STREAMING_WARNING,o,a)},i.on(Ca.REQUEST_WORKER_MANAGER_LIST,(o,a,c)=>{if(!this._joinInfo)return c(new N(y.INVALID_OPERATION,"can not find join info to get worker manager"));nC(o,this._joinInfo,this._axiosCancelSource.token,wt).then(a).catch(c)})};switch(e){case Ut.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Ut.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Ut.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(Ca.REQUEST_WORKER_MANAGER_LIST,(i,o,a)=>{if(!this._joinInfo)return a(new N(y.INVALID_OPERATION,"can not find join info to get worker manager"));nC(i,this._joinInfo,this._axiosCancelSource.token,wt).then(o).catch(a)}),this._injectStreamingClient.onInjectStatusChange=(i,o,a)=>{this.emit(be.INJECT_STREAM_STATUS,i,o,a)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new N(y.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new ij(this._joinInfo,this._clientId,this._config.websocketRetryConfig||wt,this._config.httpRetryConfig||wt,n),this._channelMediaRelayClient.on("state",i=>{i===Dn.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(be.CHANNEL_MEDIA_RELAY_STATE,i)}),this._channelMediaRelayClient.on("event",i=>{this.safeEmit(be.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._statsCollector.onStatsChanged=(i,o)=>{var a;i==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(o))}}return this._channelMediaRelayClient}_handleGatewayEvents(){this._gateway.on(ht.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ht.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===He.FALLBACK)return;const o=()=>{this.safeEmit(be.CONNECTION_STATE_CHANGE,e,t,n)};if(se.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Nt.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:ut.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),v.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._audioSSRC=void 0,c._videoSSRC=void 0,c._videoOrtc=void 0,c._audioOrtc=void 0,c._cname=void 0,c._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(u=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(u=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,"audio",!1)),c._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,"video",!1)),c._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3)}o()}),this._gateway.on(ht.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new N(y.UNEXPECTED_ERROR,"can not recover, no join info"));U_(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wt,this.store).then(n=>{this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip),e(n.gatewayInfo.gatewayAddrs.map(i=>{if(this._joinInfo&&this._joinInfo.proxyServer){const o=i.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(o[0],"&p=").concat(o[1])}return"wss://".concat(i.address)}))}).catch(t)}),this._gateway.on(ht.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(be.NETWORK_QUALITY,e)}),this._gateway.on(ht.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(be.STREAM_TYPE_CHANGED,e,t),se.reportApiInvoke(this._sessionId,{name:Nt.STREAM_TYPE_CHANGE,options:[e,t],tag:ut.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(ht.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(ht.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(ht.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(i){n(i)}}),this._gateway.on(ht.JOIN_RESPONSE,(e,t)=>{const{dtlsParameters:n,iceParameters:i,candidates:o,rtpCapabilities:a,setup:c,cname:l}=DA(e.ortc,t);this._p2pChannel.connect(i,n,o,a,c,l)}),this._gateway.on(ht.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(ht.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(ht.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(ht.DATACHANNEL_PRECONNECT,async(e,t,n,i)=>{var o,a,c,l,u,f;await this._p2pChannel.startP2PConnection({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},!0);const p=function(_,S){let R;return S&&S.ip&&typeof S.port=="number"?(R=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip,port:S.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(S.ip,":").concat(S.port)),S.ip6&&(R.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip6,port:S.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(S.ip6,":").concat(S.port)))):R=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:_.ip,port:_.port.toString(),type:"host",extension:{}}],R}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cid,"_").concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cert),icePwd:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(f=D("FINGERPRINT"))!==null&&f!==void 0?f:e.fingerprint}]},p,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(i)})}_handleGatewaySignalEvents(){this._gateway.signal.on(we.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(we.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(we.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(we.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(we.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(we.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(we.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!0)),this._gateway.signal.on(we.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!1)),this._gateway.signal.on(we.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!0)),this._gateway.signal.on(we.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!1)),this._gateway.signal.on(we.RECEIVE_METADATA,e=>{const t=b_(e.metadata);this.safeEmit(be.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(we.ON_DATA_STREAM,e=>{e.seq&&delete e.seq,e.payload=b_(e.payload),this.safeEmit(be.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)}),this._gateway.signal.on(we.ON_CRYPT_ERROR,()=>{Gc(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(be.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(we.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.safeEmit(be.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(we.ON_STREAM_FALLBACK_UPDATE,e=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(be.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(we.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(we.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(we.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(de.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ee.PUBLISH:{if(!t)return;const c=(t=t).ortc;if(c){var n,i,o,a;const l=c.some(p=>{let{stream_type:_}=p;return _===xt.Audio}),u=c.some(p=>{let{stream_type:_}=p;return _!==xt.Audio}),f=c.some(p=>{let{stream_type:_}=p;return _===xt.Screen||_===xt.ScreenLow});t.state==="offer"&&se.publish(this._joinInfo.sid,{eventElapse:Pi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:y.TIMEOUT,audio:l,video:u,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:l?(n=c.find(p=>{let{stream_type:_}=p;return _===xt.Audio}))===null||n===void 0||(i=n.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:u?(o=c.find(p=>{let{stream_type:_}=p;return _!==xt.Audio}))===null||o===void 0||(a=o.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case Ee.SUBSCRIBE:(t=t)&&se.subscribe(this._joinInfo.sid,{succ:!1,ec:y.TIMEOUT,audio:t.stream_type===Ie.AUDIO,video:t.stream_type===Ie.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Pi.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(we.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(we.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;D("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!Is(i.audio_ssrc,this.channelName)));const t=[],n=[];for(const i of e.users){let o=this._users.find(f=>f.uid===i.stream_id);o?o._trust_in_room_=!0:(o=new j_(i.stream_id,i.stream_id),this._users.push(o),this.getListeners(be.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(be.USER_JOINED,o)));const a=bt.Audio&i.stream_type,c=(bt.Video|bt.LwoVideo)&i.stream_type,l=a&&o.hasAudio,u=c&&o.hasVideo;c&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=i.video_ssrc,o._rtxSsrcId=i.video_rtx),a&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=i.audio_ssrc),a&&!l&&this.getListeners(be.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(be.USER_PUBLISHED,o,"audio")),c&&!u&&this.getListeners(be.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(be.USER_PUBLISHED,o,"video")),(a&&!l||c&&!u)&&t.push(o),c&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(be.PUBLISHED_USER_LIST).length>0?(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(be.PUBLISHED_USER_LIST,t)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(Me.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===y.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Me.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===y.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Me.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Me.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:o}of e)o===Ie.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Me.RequestUploadStats,(e,t)=>{this._gateway.uploadStats(e,t)}),this._p2pChannel.on(Me.MediaReconnectStart,e=>{this.safeEmit(be.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Me.MediaReconnectEnd,e=>{this.safeEmit(be.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Me.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Me.RequestRestartICE,async e=>{const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let o;try{o=await this._gateway.restartICE({iceParameters:i})}catch(c){return void t.throw(c)}const{iceParameters:a}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(o);await t.next({remoteIceParameters:a})}),this._p2pChannel.on(Me.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Me.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),{dtlsParameters:c,iceParameters:l,candidates:u,rtpCapabilities:f,setup:p,cname:_}=DA(o,a);await this._p2pChannel.connect(l,c,u,f,p,_),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Me.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Me.P2PLost,()=>{this.safeEmit(be.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Me.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Me.ConnectionTypeChange,e=>{this.safeEmit(be.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Me.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Me.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new N(y.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new N(y.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new N(y.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new N(y.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(n=>{if(!["supervise","moderation"].includes(n))throw new N(y.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(n," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new N(y.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new Nu(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},wt)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new N(y.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(ya(e,"enabled"),e){if(!t)throw new N(y.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(nt(t.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new N(y.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const n=new vE(t);this._moderation=n,this.handleImageModerationEvents(this._moderation),await n.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},wt)}catch(n){throw Array.isArray(n)?n[0]:n}}else{if(!this._moderation)throw new N(y.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(e){e.on(Di.CONNECTION_STATE_CHANGE,(t,n)=>{switch(this.emit(be.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t){case ni.CONNECTED:if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new N(y.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Di.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(Vt.CONNECTION_STATE_CHANGE,(t,n)=>{switch(this.emit(be.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n){case _i.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(be.CONTENT_INSPECT_ERROR,new N(y.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Vt.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===y.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.emit(be.CONTENT_INSPECT_RESULT,t,n)}),e.on(Vt.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ya(e,"enabled"),et("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[HO],Object.getOwnPropertyDescriptor(Z.prototype,"leave"),Z.prototype),G(Z.prototype,"publish",[KO],Object.getOwnPropertyDescriptor(Z.prototype,"publish"),Z.prototype),G(Z.prototype,"unpublish",[YO],Object.getOwnPropertyDescriptor(Z.prototype,"unpublish"),Z.prototype),G(Z.prototype,"subscribe",[zO],Object.getOwnPropertyDescriptor(Z.prototype,"subscribe"),Z.prototype),G(Z.prototype,"massSubscribe",[qO],Object.getOwnPropertyDescriptor(Z.prototype,"massSubscribe"),Z.prototype),G(Z.prototype,"unsubscribe",[JO],Object.getOwnPropertyDescriptor(Z.prototype,"unsubscribe"),Z.prototype),G(Z.prototype,"massUnsubscribe",[XO],Object.getOwnPropertyDescriptor(Z.prototype,"massUnsubscribe"),Z.prototype),G(Z.prototype,"setLowStreamParameter",[QO],Object.getOwnPropertyDescriptor(Z.prototype,"setLowStreamParameter"),Z.prototype),G(Z.prototype,"enableDualStream",[$O],Object.getOwnPropertyDescriptor(Z.prototype,"enableDualStream"),Z.prototype),G(Z.prototype,"disableDualStream",[ZO],Object.getOwnPropertyDescriptor(Z.prototype,"disableDualStream"),Z.prototype),G(Z.prototype,"setClientRole",[ew],Object.getOwnPropertyDescriptor(Z.prototype,"setClientRole"),Z.prototype),G(Z.prototype,"setProxyServer",[tw],Object.getOwnPropertyDescriptor(Z.prototype,"setProxyServer"),Z.prototype),G(Z.prototype,"setTurnServer",[nw],Object.getOwnPropertyDescriptor(Z.prototype,"setTurnServer"),Z.prototype),G(Z.prototype,"setLicense",[iw],Object.getOwnPropertyDescriptor(Z.prototype,"setLicense"),Z.prototype),G(Z.prototype,"startProxyServer",[rw],Object.getOwnPropertyDescriptor(Z.prototype,"startProxyServer"),Z.prototype),G(Z.prototype,"stopProxyServer",[ow],Object.getOwnPropertyDescriptor(Z.prototype,"stopProxyServer"),Z.prototype),G(Z.prototype,"setLocalAccessPointsV2",[sw],Object.getOwnPropertyDescriptor(Z.prototype,"setLocalAccessPointsV2"),Z.prototype),G(Z.prototype,"setLocalAccessPoints",[aw],Object.getOwnPropertyDescriptor(Z.prototype,"setLocalAccessPoints"),Z.prototype),G(Z.prototype,"setRemoteDefaultVideoStreamType",[cw],Object.getOwnPropertyDescriptor(Z.prototype,"setRemoteDefaultVideoStreamType"),Z.prototype),G(Z.prototype,"setRemoteVideoStreamType",[dw],Object.getOwnPropertyDescriptor(Z.prototype,"setRemoteVideoStreamType"),Z.prototype),G(Z.prototype,"setStreamFallbackOption",[lw],Object.getOwnPropertyDescriptor(Z.prototype,"setStreamFallbackOption"),Z.prototype),G(Z.prototype,"setEncryptionConfig",[uw],Object.getOwnPropertyDescriptor(Z.prototype,"setEncryptionConfig"),Z.prototype),G(Z.prototype,"renewToken",[hw],Object.getOwnPropertyDescriptor(Z.prototype,"renewToken"),Z.prototype),G(Z.prototype,"enableAudioVolumeIndicator",[pw],Object.getOwnPropertyDescriptor(Z.prototype,"enableAudioVolumeIndicator"),Z.prototype),G(Z.prototype,"startLiveStreaming",[fw],Object.getOwnPropertyDescriptor(Z.prototype,"startLiveStreaming"),Z.prototype),G(Z.prototype,"setLiveTranscoding",[_w],Object.getOwnPropertyDescriptor(Z.prototype,"setLiveTranscoding"),Z.prototype),G(Z.prototype,"stopLiveStreaming",[Ew],Object.getOwnPropertyDescriptor(Z.prototype,"stopLiveStreaming"),Z.prototype),G(Z.prototype,"addInjectStreamUrl",[mw],Object.getOwnPropertyDescriptor(Z.prototype,"addInjectStreamUrl"),Z.prototype),G(Z.prototype,"removeInjectStreamUrl",[gw],Object.getOwnPropertyDescriptor(Z.prototype,"removeInjectStreamUrl"),Z.prototype),G(Z.prototype,"startChannelMediaRelay",[Sw],Object.getOwnPropertyDescriptor(Z.prototype,"startChannelMediaRelay"),Z.prototype),G(Z.prototype,"updateChannelMediaRelay",[Tw],Object.getOwnPropertyDescriptor(Z.prototype,"updateChannelMediaRelay"),Z.prototype),G(Z.prototype,"stopChannelMediaRelay",[vw],Object.getOwnPropertyDescriptor(Z.prototype,"stopChannelMediaRelay"),Z.prototype),G(Z.prototype,"sendCustomReportMessage",[Rw],Object.getOwnPropertyDescriptor(Z.prototype,"sendCustomReportMessage"),Z.prototype),G(Z.prototype,"pickSVCLayer",[yw],Object.getOwnPropertyDescriptor(Z.prototype,"pickSVCLayer"),Z.prototype),G(Z.prototype,"enableContentInspect",[Iw],Object.getOwnPropertyDescriptor(Z.prototype,"enableContentInspect"),Z.prototype),G(Z.prototype,"disableContentInspect",[Cw],Object.getOwnPropertyDescriptor(Z.prototype,"disableContentInspect"),Z.prototype),G(Z.prototype,"setImageModeration",[Aw],Object.getOwnPropertyDescriptor(Z.prototype,"setImageModeration"),Z.prototype),G(Z.prototype,"getJoinChannelServiceRecords",[Ow],Object.getOwnPropertyDescriptor(Z.prototype,"getJoinChannelServiceRecords"),Z.prototype),G(Z.prototype,"setPublishAudioFilterEnabled",[ww],Object.getOwnPropertyDescriptor(Z.prototype,"setPublishAudioFilterEnabled"),Z.prototype),Z);class NF extends Iy{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Hn.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),m(this,"audioBuffer",void 0),m(this,"sourceNode",void 0),m(this,"startPlayTime",0),m(this,"startPlayOffset",0),m(this,"pausePlayTime",0),m(this,"options",void 0),m(this,"currentLoopCount",0),m(this,"currentPlaybackSpeed",100),m(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const bw=new Map;async function bF(e,t){let n=null;if(typeof e=="string"){const o=bw.get(e);if(o)return v.debug("use cached audio resource: ",e),o;try{n=(await Er(()=>hi.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(a){throw new N(y.FETCH_AUDIO_FILE_FAILED,a.toString())}}else n=await new ie((a,c)=>{const l=new FileReader;l.onload=u=>{u.target?a(u.target.result):c(new N(y.READ_LOCAL_AUDIO_FILE_ERROR))},l.onerror=()=>{c(new N(y.READ_LOCAL_AUDIO_FILE_ERROR))},l.readAsArrayBuffer(e)});const i=await function(o){const a=Na();return new ie((c,l)=>{a.decodeAudioData(o,u=>{c(u)},u=>{l(new N(y.DECODE_AUDIO_FILE_FAILED,u.toString()))})})}(n);return typeof e=="string"&&t&&bw.set(e,i),i}function Dw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Du(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Dw(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function RE(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Du(Du({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?v.debug("[".concat(e,"] set content hint to"),n.optimizationMode):v.debug("[".concat(e,"] set content hint failed")))):v.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const DF=We().name;function PF(e,t,n,i){let o,a=0,c=null;return new ie((l,u)=>{setTimeout(()=>{o&&(o(),l(a))},t),o=Ry(()=>{(function(){a>i&&o&&(o(),l(a));const f=n.getContext("2d");if(!f){const S=new N(y.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(S.toString()),void u(S)}f.drawImage(e,0,0,160,120);const p=f.getImageData(0,0,n.width,n.height),_=Math.floor(p.data.length/3);if(c){for(let S=0;S<_;S+=3)if(p.data[S]!==c[S])return a+=1,void(c=p.data);c=p.data}else c=p.data})()},30)})}class rd{constructor(t,n){m(this,"id",0),m(this,"element",void 0),m(this,"peerPair",void 0),m(this,"context",void 0),m(this,"audioPlayerElement",void 0),m(this,"audioTrack",void 0),rd.count+=1,this.id=rd.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,o)=>{const a=o==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new ie(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,o)=>await i.setRemoteDescription(o);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(i){throw new N(y.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new N(y.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new N(y.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Pw,Pu;m(rd,"count",0);const LF=window.AudioContext||window.webkitAudioContext,kF=new(Pw=pe({report:se}),G((Pu=class{constructor(){m(this,"units",[]),m(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new LF);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new rd(e,this.context),this.units.push(t)),t.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return We().name!==qe.SAFARI}}).prototype,"processExternalMediaAEC",[Pw],Object.getOwnPropertyDescriptor(Pu.prototype,"processExternalMediaAEC"),Pu.prototype),Pu);function Lw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function kw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Lw(Object(n),!0).forEach(function(i){m(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const yE=window||document;function Mw(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!yE)return;const n=Gt._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=o=>{if(!(o&&o.blockedURI&&(Gt.onSecurityPolicyViolation||Gt.getListeners(Sr.SECURITY_POLICY_VIOLATION).length>0)))return;const a=o.blockedURI;D("CSP_DETECTED_HOSTNAME_LIST").some(c=>a.includes(c))&&(Gt.onSecurityPolicyViolation&&typeof Gt.onSecurityPolicyViolation=="function"&&Gt.onSecurityPolicyViolation(o),Gt.getListeners(Sr.SECURITY_POLICY_VIOLATION).length>0&&Gt.safeEmit(Sr.SECURITY_POLICY_VIOLATION,o))};n&&yE.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Gt.getListeners(Sr.SECURITY_POLICY_VIOLATION).length>0)&&yE.addEventListener("securitypolicyviolation",i),Gt._cspEventHandlerPointer=i}et("PROCESS_ID","process-".concat(at(8,""),"-").concat(at(4,""),"-").concat(at(4,""),"-").concat(at(4,""),"-").concat(at(12,""))),function(){const e=We();yn.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),yn.getStreamFromExtension=e.name===qe.CHROME&&Number(e.version)>34,yn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),yn.supportMinBitrate=e.name===qe.CHROME||e.name===qe.EDGE,yn.supportSetRtpSenderParameters=function(){const t=We();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!Ss()||!(!wn()&&!Ul())||t.name===qe.FIREFOX&&Number(t.version)>=64}(),e.name===qe.SAFARI&&(Number(e.version)>=14?yn.supportDualStream=!0:yn.supportDualStream=!1),yn.webAudioMediaStreamDest=function(){const t=We();return!(t.name===qe.SAFARI&&Number(t.version)<12)}(),yn.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),yn.supportWebGL=typeof WebGLRenderingContext<"u",yn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ss()||(yn.webAudioWithAEC=!0),yn.supportShareAudio=function(){const t=We();return(t.os===un.WIN_10||t.os===un.WIN_81||t.os===un.WIN_7||t.os===un.LINUX||t.os===un.MAC_OS)&&t.name===qe.CHROME&&Number(t.version)>=74}(),yn.supportDualStreamEncoding=function(){const t=We();return D("DISABLE_WEBAUDIO")?!0:t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&D("CHROME_DUAL_STREAM_USE_ENCODING"))}(),yn.supportDataChannel=function(){return!!(Cf(76)||function(t){const n=We();return!(n.name!==qe.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||function(t){const n=We();return!(n.name!==qe.SAFARI||!n.osVersion)&&Number(n.version)>=t}(14))}(),yn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Et()&&!!t&&t.prototype.setConfiguration instanceof Function}(),yn.supportWebRTCEncodedTransform=function(){const t=We();return t.name==="Chrome"&&Number(t.version)>=86}(),v.info("browser compatibility",JSON.stringify(yn),JSON.stringify(e))}(),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void v.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();v.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Wn,i)){const{value:o,expires:a}=t[i];if(a&&a<=n)return;Rs[i]=o,Wn[i]=o}})}catch(t){v.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Rs.AREAS)&&Rs.AREAS.length>0&&L_(Rs.AREAS,!0);const Gt=function(e){const t=new ft,n=e,i={getListeners:t.getListeners.bind(t),on:(o,a)=>(function(c,l){c===Sr.SECURITY_POLICY_VIOLATION&&Mw(l,!0)}(o,a),t.on.bind(t)(o,a)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return kw(kw({},n),i)}({__CLIENT_LIST__:ys,__TRACK_LIST__:Uc,VERSION:bi,BUILD:Hf,setParameter:(e,t,n)=>{v.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),et(e,t,n)},getParameter:D,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return e;t.close(),t=null,e=function(i){const o={video:[],audio:[]};return i.match(/ VP8/i)&&o.video.push("VP8"),i.match(/ VP9/i)&&o.video.push("VP9"),i.match(/ AV1/i)&&o.video.push("AV1"),i.match(/ H264/i)&&o.video.push("H264"),i.match(/ H265/i)&&o.video.push("H265"),i.match(/ opus/i)&&o.audio.push("OPUS"),i.match(/ PCMU/i)&&o.audio.push("PCMU"),i.match(/ PCMA/i)&&o.audio.push("PCMA"),i.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new N(y.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=se.reportApiInvoke(null,{name:Nt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:ut.TRACER});let t=!1;try{const a=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(a&&c&&l)}catch(a){return v.error("check system requirement failed: ",a),!1}let n=!1;const i=We();i.name===qe.CHROME&&Number(i.version)>=58&&(!jU()||VU())&&(n=!0),i.name===qe.FIREFOX&&Number(i.version)>=56&&(n=!0),i.name===qe.OPERA&&Number(i.version)>=45&&(n=!0),i.name===qe.SAFARI&&Number(i.version)>=11&&(n=!0),(qv()||We().name===qe.QQ)&&(n=!0),v.debug("checkSystemRequirements, api:",t,"browser",n);const o=t&&n;return e.onSuccess(o),o},getDevices:function(e){return Si.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Si.getRecordingDevices(e)},getCameras:function(e){return Si.getCamerasDevices(e)},getElectronScreenSources:Ay,getPlaybackDevices:function(e){return Si.getSpeakers(e)},createClient:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=se.reportApiInvoke(null,{name:Nt.CREATE_CLIENT,options:[e],tag:ut.TRACER});try{f2(e)}catch(n){throw t.onError(n),n}return e.audioCodec===void 0&&(e.audioCodec="opus"),t.onSuccess(),new wF(id(id({forceWaitGatewayResponse:!0},e),{},{role:e.mode==="rtc"?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CREATE_CAM_VIDEO_TRACK,options:[Du({},e)]}),n=pu(e),i=at(8,"track-cam-");let o=null;v.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{o=(await Xi({video:n},i)).getVideoTracks()[0]||null}catch(c){throw t.onError(c),c}if(!o){const c=new N(y.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw()}e.optimizationMode&&RE(i,o,e,vs(e.encoderConfig));const a=new JC(o,e,n,e.scalabiltyMode?ql(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return t.onSuccess(a.getTrackId()),v.info("create camera video success, trackId:",i),a},createCustomVideoTrack:function(e){const t=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new Lt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?ql(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,at(8,"track-cus-"),[Ft.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),v.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CREATE_SCREEN_VIDEO_TRACK,options:[Du({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=rj(e),o=at(8,"track-scr-v-");let a=null,c=null;const l=Ct();if(!l.supportShareAudio&&t==="enable"){const p=new N(y.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(p),p.throw()}v.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{const p=await Xi({screen:i,screenAudio:t==="auto"?l.supportShareAudio:t==="enable"},o);a=p.getVideoTracks()[0]||null,c=p.getAudioTracks()[0]||null}catch(p){throw n.onError(p),p}if(!a){const p=new N(y.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(p),p.throw()}if(!c&&t==="enable"){a&&a.stop();const p=new N(y.SHARE_AUDIO_NOT_ALLOWED);return n.onError(p),p.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(RE(o,a,e,e.encoderConfig&&Yf(e.encoderConfig)),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const u=new Lt(a,e.encoderConfig?Yf(e.encoderConfig):{},e.scalabiltyMode?ql(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[Ft.SCREEN_TRACK]);if(!c)return n.onSuccess(u.getTrackId()),v.info("create screen video track success","video:",u.getTrackId()),u;const f=new mn(c,void 0,at(8,"track-scr-a-"),!1,!0);return n.onSuccess([u.getTrackId(),f.getTrackId()]),v.info("create screen video track success","video:",u.getTrackId(),"audio:",f.getTrackId()),[u,f]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),i=pu(t),o=fC(e),a=at(8,"track-mic-"),c=at(8,"track-cam-");let l=null,u=null;v.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const _=await Xi({audio:o,video:i},"".concat(a,"-").concat(c));l=_.getAudioTracks()[0],u=_.getVideoTracks()[0]}catch(_){throw n.onError(_),_}if(!l||!u){const _=new N(y.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(_),_.throw()}t.optimizationMode&&RE(c,u,t,vs(t.encoderConfig));const f=new ru(l,e,o,a),p=new JC(u,t,i,t.scalabiltyMode?ql(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return n.onSuccess([f.getTrackId(),p.getTrackId()]),v.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[f,p]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=fC(e),i=at(8,"track-mic-");let o=null;v.info("start create microphone audio track with config",JSON.stringify(e),"trackId",i);try{o=(await Xi({audio:n},i)).getAudioTracks()[0]||null}catch(c){throw t.onError(c),c}if(!o){const c=new N(y.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw()}const a=new ru(o,e,n,i);return t.onSuccess(a.getTrackId()),v.info("create microphone audio track success, trackId:",i),a},createCustomAudioTrack:function(e){const t=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new mn(e.mediaStreamTrack,e.encoderConfig?Jl(e.encoderConfig):{},at(8,"track-cus-"),!1,!0);return v.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){const t=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CREATE_BUFFER_AUDIO_TRACK,options:[e]});if(D("DISABLE_WEBAUDIO"))throw new N(y.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const n=at(8,"track-buf-");v.info("start create buffer source audio track with config",JSON.stringify(e),"trackId",n);const i=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await bF(e.source,e.cacheOnlineFile)}catch(c){return t.onError(c),c.throw()}const o=new NF(e.source),a=new MV(i,o,e.encoderConfig?Jl(e.encoderConfig):{},n);return v.info("create buffer source audio track success, trackId:",n),t.onSuccess(a.getTrackId()),a},setAppType:function(e){if(v.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw v.debug("Invalid appType"),new N(y.INVALID_PARAMS,"invalid app type",e);et("APP_TYPE",Math.floor(e))},setLogLevel:function(e){v.setLogLevel(e)},enableLogUpload:function(){D("USE_NEW_LOG")?et("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){D("USE_NEW_LOG")?et("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new aC},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof mn||e instanceof Cu)){const u=new N(y.INVALID_TRACK,"the parameter is not a audio track");return n.onError(u),u.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof mn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let a=o,c=o;const l=Date.now();return new ie(u=>{const f=setInterval(()=>{const p=e.getVolumeLevel();a=p>a?p:a,c=p<c?p:c;const _=a-c>1e-4,S=Date.now()-l;if(_||S>t){clearInterval(f);const R=_,C={duration:S,deviceLabel:i,maxVolumeLevel:a,result:R};v.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(C))),n.onSuccess(C),u(R)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=se.reportApiInvoke(null,{tag:ut.TRACER,name:Nt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Lt||e instanceof Iu)){const S=new N(y.INVALID_TRACK,"the parameter is not a video track");return n.onError(S),S.throw()}const i=4;t&&t<1e3&&(t=1e3);const o=e instanceof Lt?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(wn()||Ul())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([a]),c.play();const l=document.createElement("canvas");l.width=160,l.height=120;let u=0,f=0;try{const S=Date.now();u=await PF(c,t,l,i),f=Date.now()-S}catch(S){throw n.onError(S),S}DF===qe.SAFARI&&(c.pause(),c.remove()),c.srcObject=null;const p=u>i,_={duration:f,changedPicNum:u,deviceLabel:o,result:p};return v.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),n.onSuccess(_),p},setArea:L_,audioElementPlayCenter:ii,processExternalMediaAEC:function(e){kF.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach(t=>{const n=t;n.__registered__=!0,n.logger.hookLog=v.extLog,n.reporter.hookApiInvoke=se.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(i=>{n.parameters[i]=D(i)})})},ChannelMediaRelayError:wo,ChannelMediaRelayEvent:mr,ChannelMediaRelayState:Dn,RemoteStreamFallbackType:l_,RemoteStreamType:d_,ConnectionDisconnectedReason:He,AudienceLatencyLevelType:r_,AREAS:ke});return Object.defineProperties(Gt,{onAudioAutoplayFailed:{get:()=>mi.onAudioAutoplayFailed,set:e=>{mi.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>mi.onAutoplayFailed,set:e=>{mi.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Gt._onSecurityPolicyViolation,set(e){Gt._onSecurityPolicyViolation=e,Mw(e)}}}),Si.on(Zr.CAMERA_DEVICE_CHANGED,e=>{v.info("camera device changed",JSON.stringify(e)),Gt.onCameraChanged&&Gt.onCameraChanged(e),Gt.safeEmit(Sr.CAMERA_CHANGED,e)}),Si.on(Zr.RECORDING_DEVICE_CHANGED,e=>{v.info("microphone device changed",JSON.stringify(e)),Gt.onMicrophoneChanged&&Gt.onMicrophoneChanged(e),Gt.safeEmit(Sr.MICROPHONE_CHANGED,e)}),Si.on(Zr.PLAYOUT_DEVICE_CHANGED,e=>{v.debug("playout device changed",JSON.stringify(e)),Gt.onPlaybackDeviceChanged&&Gt.onPlaybackDeviceChanged(e),Gt.safeEmit(Sr.PLAYBACK_DEVICE_CHANGED,e)}),ii.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),mi.onAudioAutoplayFailed&&mi.onAudioAutoplayFailed()},Ke.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),mi.onAudioAutoplayFailed&&mi.onAudioAutoplayFailed(),Gt.safeEmit(Sr.AUTOPLAY_FAILED)}),window&&(window.__ARTC__=Gt),Gt})})(sD);var aG=sD.exports;const Hm=Y0(aG),xs=Hm.createClient({mode:"rtc",codec:"vp8"});let Xu,pd;function cG(){const[r,s]=Ir.useState(!1),[d,h]=Ir.useState(!1),[E,T]=Ir.useState(!1),[I,P]=Ir.useState(!1),[L,V]=Ir.useState(!1),ne=async le=>{if(le=le??!d,h(le),pd)return pd.setEnabled(le);pd=await Hm.createCameraVideoTrack(),pd.play("camera-video")},q=async le=>{if(le=le??!r,s(le),Xu)return Xu.setEnabled(le);Xu=await Hm.createMicrophoneAudioTrack()},[z,ue]=Ir.useState(!1),$=Ir.useRef(""),_e=Ir.useRef(""),pt=async()=>{$.current||($.current="react-room"),z&&await j(),xs.on("user-published",U),await xs.join(_e.current,$.current,null,null),ue(!0)},j=async()=>{ue(!1),T(!1),P(!1),await xs.leave()},U=async(le,me)=>{me==="video"&&((await xs.subscribe(le,me)).play("remote-video"),V(!0)),me==="audio"&&(await xs.subscribe(le,me)).play()},F=async()=>{await ne(!0),z||await pt(),await xs.publish(pd),P(!0)},ee=async()=>{await q(!0),z||await pt(),await xs.publish(Xu),T(!0)};return Qt.jsxs(Qt.Fragment,{children:[Qt.jsxs("div",{className:"left-side",children:[Qt.jsx("h3",{children:"Pleat check you camera / microphone!"}),Qt.jsxs("div",{className:"buttons",children:[Qt.jsxs("button",{onClick:()=>ne(),className:d?"button-on":"",children:["Turn ",d?"off":"on"," camera"]}),Qt.jsxs("button",{onClick:()=>q(),className:r?"button-on":"",children:["Turn ",r?"off":"on"," Microphone"]})]}),Qt.jsxs("h3",{children:["Please input the appid (",Qt.jsx("a",{href:"https://www.agora.io/en/blog/how-to-get-started-with-agora",children:"Create an account."}),") "]}),Qt.jsx("input",{defaultValue:_e.current,onChange:le=>_e.current=le.target.value}),Qt.jsx("h3",{children:"Please input the channel name"}),Qt.jsx("input",{defaultValue:$.current,onChange:le=>$.current=le.target.value}),Qt.jsxs("div",{className:"buttons",children:[Qt.jsx("button",{onClick:pt,className:z?"button-on":"",children:"Join Channel"}),Qt.jsx("button",{onClick:F,className:I?"button-on":"",children:"Publish Video"}),Qt.jsx("button",{onClick:ee,className:E?"button-on":"",children:"Publish Audio"}),Qt.jsx("button",{onClick:j,children:"Leave Channel"})]})]}),Qt.jsxs("div",{className:"right-side",children:[Qt.jsx("video",{id:"camera-video",hidden:!d}),Qt.jsx("video",{id:"remote-video",hidden:!L}),z&&!L?Qt.jsxs("div",{className:"waiting",children:["You can shared channel ",$.current," to others....."]}):null]})]})}QE.createRoot(document.getElementById("root")).render(Qt.jsx(XF.StrictMode,{children:Qt.jsx(cG,{})}));
